<?xml version="1.0" encoding="UTF-8"?>
<molgenis name="org.molgenis">
	<module name="compute.core">
		<entity name="Autoid" abstract="true" system="true">
			<description>This interface assigns an automatic 'id'.
			</description>
			<field name="id" type="autoid" hidden="true"
				description="automatically generated internal id, only for internal use." />
		</entity>
		<entity name="Nameable" implements="Autoid" abstract="true" system="true" xref_label="name">
			<field name="name" type="string" description="Unique name" />
		</entity>	
	</module>
	<module name="compute.runtime">
		<entity name="ComputeTask" implements="Nameable" xref_label="name">
			<description>A protocolApplication that reports the application of running a ComputeProtocol.</description>
			<field name="computeRun" type="xref" xref_entity="ComputeRun" description="The run this task is part of" nillable="false" />
			<field name="computeScript" type="text" description="The actual command to be sent to the cluster, is a filled in version of the one define in the ComputeProtocol" />
   			<field name="RunInfo" type="text" description="Summary of the task execution" nillable="true" />   
			<field name="runLog" type="text" description="Log of the task execution" nillable="true" />
            <!--field name="computeStep" nillable="true" type="xref" xref_entity="ComputeStep" description="Reference to the workflow step that generated this script." /-->
			<field name="interpreter" type="enum" enum_options="[bash,R]" description="the interpreter used to run this command. For example 'shellTemplate'" />
			<field name="prevSteps" type="mref" xref_entity="ComputeTask" nillable="true" description="To keep track of calculation dependencies" />
			<field name="statusCode" nillable="false" type="enum" enum_options="[generated,ready,running,failed,done]" default="generated"
				description="Last known status of this task. See compute history for details. NB 'ready' means ready for running (cf. 'done')." />
			<unique fields="name,computeRun" />
		</entity>
        <entity name="ComputeTaskHistory" implements="Autoid" xref_label="ComputeTask">
      		<description>Keep track of the compute history of a task, including resubmissions.
      		</description>
      		<field name="ComputeTask" type="xref" xref_entity="ComputeTask" description="the task for which the history was collected" />
      		<field name="StatusTime" type="datetime" auto="true" description="time of state change" />
      		<field name="runLog" nillable="true" type="text" description="field to show the content of the error file (only applicable on fail/done of a task)" />
            <field name="StatusCode" nillable="false" type="enum" enum_options="[running,failed,done]" default="failed" description="current status of this task." />
            <unique fields="ComputeTask,StatusTime" />
      	</entity>
		<entity name="ComputeParameterValue" implements="Nameable">
			<description>Related to ComputeTask values
			</description>
            <field name="computeTask" type="xref" xref_entity="ComputeTask" xref_label="name" description="ComputeTask, to which the value belongs" />
            <field name="value" type="text" nillable="false" description="the value of the parameter" />
		</entity>
      	<entity name="ComputeRun" implements="Nameable" xref_label="name">
      		<description>A set of computetasks to run</description>
      		<field name="creationTime" type="datetime" auto="true" description="time of creation" />
      		<field name="computeBackend" type="xref" xref_entity="ComputeBackend" nillable="false" description="Backend where run will be executed" />
            <field name="pollDelay" type="long" nillable="false" label="Poll delay" description="Delay between two database ComputeTask polls" />
      		<unique fields="name" />
      	</entity>
        <entity name="ComputeBackend" implements="Nameable" xref_label="name">
            <field name="backendUrl" type="string" nillable="false" label="Backend url" description="Backend host" />
      		<field name="hostType" type="enum" nillable="false" label="Host type" enum_options="[CLUSTER,GRID,LOCALHOST]" description="type of the host" />
      		<field name="command" nillable="false" description="Command to be executed" />
            <unique fields="name" />
        </entity>
	</module>
</molgenis>