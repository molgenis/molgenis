language: java
jdk: oraclejdk8
# Trusty dist needed for postgresql version 9.6
dist: trusty
# Caches downloaded libraries between builds
cache:
  yarn: true
  directories:
    - '$HOME/.m2/repository'
env:
  # This configures the parallel jobs to run
  - COV_FLAG="api"                       SCRIPT="./mvnw verify -pl molgenis-api-tests --batch-mode -Dmaven.test.redirectTestOutputToFile=true -Dit_db_user=postgres -Dit_db_password -Dit_db_name=molgenis_${TRAVIS_PULL_REQUEST}_${TRAVIS_BUILD_ID}"
services:
  - postgresql
addons:
  sauce_connect: true
  postgresql: '9.6'
sudo: required
fail_fast: true
before_script:
  # Set the max_map_count for elasticsearch, as instructed by maven Elasticsearch plugin docs
  - mvn -N io.takari:maven:wrapper -Dmaven=3.3.9
  - sudo sysctl -w vm.max_map_count=262144

script: |
  set -e &&
  $SCRIPT
