<!doctype html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <link href="../css/select2.css" rel="stylesheet">
        <link href="../css/molgenis.css" rel="stylesheet">
        <script src="../js/jquery-2.1.1.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/moment-with-locales.min.js"></script>
        <script src="../js/bootstrap-datetimepicker.min.js"></script>
        <script src="../js/handlebars.min.js"></script>
        <script src="../js/select2.min.js"></script>        
        <script src="../js/molgenis.js"></script>
        <script src="../js/molgenis-controls.js"></script>
        <script src="../js/molgenis-filters.js"></script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
	                <div id="input-container" style="max-height: 700px; overflow-y: scroll">                        
	                </div>
                </div>
                <div class="col-md-6">
                    <h1 id="query-result-header"></h1>
                    <span id="query-result" style="white-space: pre;"></span>
                </div>
            </div>
        </div>
        <script id="attr-filter-form-template" type="text/x-handlebars-template">
        <form class="form-horizontal">
	        <div class="form-group">
	            <label for="something" class="col-md-4 control-label">{{name}}: {{type}}</label>
	            <div class="col-md-8" id="{{name}}{{type}}-filter-container">
	            </div>
	        </div>
        </form>
        </script>
	    <script>
	    $(function() {
	    	var template = Handlebars.compile($("#attr-filter-form-template").html());
	    	var container = $('#input-container');
	    	var query = {
	    		'xdate': JSON.parse('{"operator":"NESTED","nestedRules":[{"field":"xdate","operator":"GREATER_EQUAL","value":"2015-01-21"},{"operator":"OR"},{"field":"xdate","operator":"LOWER_EQUAL","value":"2015-01-22"},{"operator":"OR"},{"operator":"NESTED","nestedRules":[{"field":"xdate","operator":"GREATER_EQUAL","value":"2015-01-23"},{"operator":"AND"},{"field":"xdate","operator":"LOWER_EQUAL","value":"2015-01-24"}]}]}')
	    	}
	    	$.get('/api/v1/org_molgenis_test_TypeTest/meta?expand=attributes').done(function(meta) {
	    		for(var key in meta.attributes) {
	    			var attr = meta.attributes[key];
	    			if(attr.name === 'id') continue;
	    			
	    		    var type = 'novalue';
	    		    container.append(template({
	    		    	name: attr.name,
	    		    	type: type
	    		    }));
	    		    try {
		    		    molgenis.filters.create(attr, {
	                        'onQueryChange' : function(q) {
	                            $('#query-result-header').html('Filter query: ');
	                        	$('#query-result').html(JSON.stringify(q, null, '\t'));
	                        }
	                    }, $('#' + attr.name + type + '-filter-container'));
	    		    } catch(err) {
	    		    	console.log(err);
	    		    }
	    		}
	    	});	
		});
		</script>
	</body>
</html>