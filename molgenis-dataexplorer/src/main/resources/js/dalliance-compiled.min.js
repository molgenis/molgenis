(function e$$0(u,s,q){function n(t,h){if(!s[t]){if(!u[t]){var B="function"==typeof require&&require;if(!h&&B)return B(t,!0);if(l)return l(t,!0);throw Error("Cannot find module '"+t+"'");}B=s[t]={exports:{}};u[t][0].call(B.exports,function(c){var a=u[t][1][c];return n(a?a:c)},B,B.exports,e$$0,u,s,q)}return s[t].exports}for(var l="function"==typeof require&&require,h=0;h<q.length;h++)n(q[h]);return n})({1:[function(d,u,s){function q(){}function n(a,b,c,e,g){a.slice(0,10).fetch(function(r){return r?
l(a,b,c,e,g):e(null,"Couldn't access BAM.")},{timeout:5E3})}function l(c,e,r,m,v){function F(f){if(!f)return m(null,"Couldn't access BAM");f=b(f,f.byteLength);f=new Uint8Array(f);var a=t(f,0);if(a!=p)return m(null,"Not a BAM file, magic=0x"+a.toString(16));for(var c=t(f,4),A="",a=0;a<c;++a)A+=String.fromCharCode(f[a+8]);A=t(f,c+8);c+=12;w.chrToIndex={};w.indexToChr=[];for(a=0;a<A;++a){for(var e=t(f,c),y="",G=0;G<e-1;++G)y+=String.fromCharCode(f[c+4+G]);t(f,c+e+4);w.chrToIndex[y]=a;0==y.indexOf("chr")?
w.chrToIndex[y.substring(3)]=a:w.chrToIndex["chr"+y]=a;w.indexToChr.push(y);c=c+8+e}if(w.indices)return m(w)}var w=new q;w.data=c;w.bai=e;w.indexChunks=r;var H=w.indexChunks?w.indexChunks.minBlockIndex:1E9;if(w.indexChunks){e=w.indexChunks.chunks;w.indices=[];for(var f=0;f<e.length;f++)w.indices[f]=null;w.data.slice(0,H).fetch(F)}else w.bai.fetch(function(f){var b,e,A;if(f){var D=new Uint8Array(f),y=t(D,0);if(y!=g)f=m(null,"Not a BAI file, magic=0x"+y.toString(16));else{y=t(D,4);w.indices=[];for(var G=
8,k=0;k<y;++k){var I=G;b=D;var p=A=I;e=t(b,p);for(var p=p+4,L=0;L<e;++L){t(b,p);var R=t(b,p+4),p=p+(8+16*R)}for(var L=t(b,p),p=p+4,R=1E9,Q=p,d=0;d<L;++d){var h=a(b,Q),Q=Q+8;if(h){b=h.block;0<h.offset&&(b+=65536);b<R&&(R=b);break}}p+=8*L;b=R;A=p-A;G+=A;H=Math.min(b,H);0<e&&(w.indices[k]=new Uint8Array(f,I,G-I))}f=!0}}else f="Couldn't access BAI";!0!==f?w.bai.url&&"undefined"===typeof v?(w.bai.url=w.data.url.replace(/.bam$/,".bai"),l(c,w.bai,r,m,!0)):m(null,f):w.data.slice(0,H).fetch(F)})}function h(){}
if("undefined"!==typeof d){d("./spans");s=d("./bin");var t=s.readInt,z=s.readShort,B=s.readByte,c=s.readFloat;d=d("./lh3utils");var a=d.readVob,b=d.unbgzf,e=d.reg2bins,m=d.Chunk}var p=21840194,g=21578050;d={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};q.prototype.blocksForRange=function(b,c,g){var r=this.indices[b];
if(!r)return[];b=e(c,g);for(var p=[],v=0;v<b.length;++v)p[b[v]]=!0;b=[];for(var w=[],v=t(r,0),H=4,f=0;f<v;++f){var E=t(r,H),C=t(r,H+4),H=H+8;if(p[E])for(var J=0;J<C;++J){var A=a(r,H),D=a(r,H+8);(4681>E?w:b).push(new m(A,D));H+=16}else H+=16*C}v=t(r,H);p=null;c=Math.min(c>>14,v-1);g=Math.min(g>>14,v-1);for(v=c;v<=g;++v)(c=a(r,H+4+8*v))&&(!p||c.block<p.block||c.offset<p.offset)&&(p=c);r=[];if(null!=p)for(v=0;v<w.length;++v)g=w[v],g.maxv.block>=p.block&&g.maxv.offset>=p.offset&&r.push(g);w=r;r=[];for(v=
0;v<w.length;++v)r.push(w[v]);for(v=0;v<b.length;++v)r.push(b[v]);r.sort(function(f,A){var k=f.minv.block-A.minv.block;return 0!=k?k:f.minv.offset-A.minv.offset});b=[];if(0<r.length){w=r[0];for(v=1;v<r.length;++v)g=r[v],g.minv.block==w.maxv.block?w=new m(w.minv,g.maxv):(b.push(w),w=g);b.push(w)}return b};q.prototype.fetch=function(a,c,e,g,r){function p(){if(J>=f.length)return g(C);if(A){var a=new Uint8Array(A),a=m.readBamRecords(a,f[J].minv.offset,C,c,e,v,r);A=null;++J;return a?g(C):p()}var y=f[J],
a=y.minv.block;m.data.slice(a,y.maxv.block+65536-a).fetch(function(f){A=b(f,y.maxv.block-y.minv.block+1);return p()})}var m=this;r=r||{};var v=this.chrToIndex[a],f;if(void 0===v)f=[];else{if(null===this.indices[v]&&this.indexChunks.chunks[v]){var E=this.indexChunks.chunks[v];return this.bai.slice(E[0],E[1]).fetch(function(f){f=new Uint8Array(f);this.indices[v]=f;return this.fetch(a,c,e,g,r)}.bind(this))}(f=this.blocksForRange(v,c,e))||g(null,"Error in index fetch")}var C=[],J=0,A;p()};var v="=ACxGxxxTxxxxxxN".split(""),
r="MIDNSHP=X???????".split("");q.prototype.readBamRecords=function(a,b,e,g,p,m,w){for(;;){var H=t(a,b),H=b+H+4;if(H>=a.length)return!1;var f=new h,E=t(a,b+4),C=t(a,b+8),J=t(a,b+12),A=(J&65280)>>8,D=J&255,J=t(a,b+16),y=(J&4294901760)>>16,G=J&65535,J=t(a,b+20),k=t(a,b+24),I=t(a,b+28);t(a,b+32);f.segment=this.indexToChr[E];f.flag=y;f.pos=C;f.mq=A;w.light&&(f.seqLength=J);if(!w.light){0<=k&&(f.nextSegment=this.indexToChr[k],f.nextPos=I);A="";for(C=0;C<D-1;++C)A+=String.fromCharCode(a[b+36+C]);f.readName=
A;b=b+36+D;D="";for(C=0;C<G;++C)A=t(a,b),D=D+(A>>4)+r[A&15],b+=4;f.cigar=D;G="";D=J+1>>1;for(C=0;C<D;++C)A=a[b+C],G+=v[(A&240)>>4],G.length<J&&(G+=v[A&15]);b+=D;f.seq=G;G="";for(C=0;C<J;++C)G+=String.fromCharCode(a[b+C]+33);b+=J;for(f.quals=G;b<H;){G=String.fromCharCode(a[b],a[b+1]);D=String.fromCharCode(a[b+2]);if("A"==D)D=String.fromCharCode(a[b+3]),b+=4;else if("i"==D||"I"==D)D=t(a,b+3),b+=7;else if("c"==D||"C"==D)D=a[b+3],b+=4;else if("s"==D||"S"==D)D=z(a,b+3),b+=5;else if("f"==D)D=c(a,b+3),b+=
7;else if("Z"==D||"H"==D)for(b+=3,D="";C=a[b++],0!=C;)D+=String.fromCharCode(C);else if("B"==D){D=String.fromCharCode(a[b+3]);C=t(a,b+4);if("i"==D||"I"==D||"f"==D)A=4,y="f"==D?c:t;else if("s"==D||"S"==D)A=2,y=z;else if("c"==D||"C"==D)A=1,y=B;else throw"Unknown array type "+D;b+=8;D=[];for(k=0;k<C;++k)D.push(y(a,b)),b+=A}else throw"Unknown type "+D;f[G]=D}}if(!g||f.pos<=p&&f.pos+J>=g)void 0!==m&&E!=m||e.push(f);if(f.pos>p)return!0;b=H}};"undefined"!==typeof u&&(u.exports={makeBam:n,BAM_MAGIC:p,BAI_MAGIC:g,
BamFlags:d})},{"./bin":4,"./lh3utils":24,"./spans":36}],2:[function(d,u,s){function q(a){this.type=a}function n(a,b){this.parser=a;this.sink=b}function l(a,b){this.parser=a;this.sink=b;this.wigState=null}if("undefined"!==typeof d){var h=d("./spans"),t=h.Range,z=h.union,B=h.intersection,h=d("./sourceadapters").registerParserFactory;u=d("./das");var c=u.DASStylesheet,a=u.DASStyle,b=u.DASGroup,e=d("./utils").shallowCopy}q.prototype.createSession=function(a){return"wig"==this.type?new l(this,a):new n(this,
a)};var m=/([^=]+)=(.+)/,p=/\s/,g=/^[0-9]+,[0-9]+,[0-9]+/;n.prototype.parse=function(a){var c=a.split(p);if(!(3>c.length)){var m=parseInt(c[1])+1;a=parseInt(c[2]);a={segment:c[0],min:m,max:a};3<c.length&&"."!==c[3]&&(a.label=c[3]);4<c.length&&(a.score=parseFloat(c[4]));5<c.length&&(a.orientation=c[5]);if(8<c.length){var l=c[8];g.test(l)&&(a.itemRgb="rgb("+l+")")}if(12<=c.length){var l=parseInt(c[6]),d=parseInt(c[7]),h=parseInt(c[9]),x=c[10].split(",").map(function(f){return parseInt(f)}),n=c[11].split(",").map(function(f){return parseInt(f)});
a.type="transcript";var w=new b;w.id=c[3];w.type="transcript";w.notes=[];a.groups=[w];if(12<c.length){var H=w=c[12];13<c.length&&(H=c[13]);c=new b;c.id=w;c.label=H;c.type="gene";a.groups.push(c)}c=null;for(w=0;w<h;++w)H=n[w]+m,H=new t(H,H+x[w]),c=c?z(c,H):H;n=c.ranges();for(m=0;m<n.length;++m)x=n[m],h=e(a),h.min=x.min(),h.max=x.max(),this.sink(h);if(d>l&&(l="+"==a.orientation?new t(l,d+3):new t(l-3,d),l=B(c,l)))for(a.type="translation",l=l.ranges(),m=d=0;m<l.length;++m)h=m,"-"==a.orientation&&(h=
l.length-m-1),x=l[h],h=e(a),h.min=x.min(),h.max=x.max(),a.readframe=d,x=x.max()-x.min(),d=(d+x)%3,this.sink(h)}else this.sink(a)}};n.prototype.flush=function(){};l.prototype.parse=function(a){a=a.split(p);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var c=m.exec(a[b]);c&&("chrom"==c[1]?this.chr=c[2]:"start"==c[1]?this.pos=parseInt(c[2]):"step"==c[1]?this.step=parseInt(c[2]):"span"==c[1]&&(this.span=parseInt(c[2])))}}else if("variableStep"==
a[0])for(this.wigState="variableStep",this.chr=null,b=this.span=1;b<a.length;++b)c=m.exec(a[b]),"chrom"==c[1]?this.chr=c[2]:"span"==c[1]&&(this.span=parseInt(c[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||
(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};l.prototype.flush=function(){};q.prototype.getStyleSheet=function(b){var e=new c;if("wig"==this.type){var g=new a;g.glyph="HISTOGRAM";g.BGCOLOR="blue";g.HEIGHT=30;e.pushStyle({type:"default"},null,g)}else g=new a,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="blue",g.HEIGHT=8,g.BUMP=!0,g.LABEL=!0,g.ZINDEX=20,e.pushStyle({type:"default"},null,g),g=new a,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="red",g.HEIGHT=
10,g.BUMP=!0,g.ZINDEX=20,e.pushStyle({type:"translation"},null,g),g=new a,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="white",g.HEIGHT=10,g.ZINDEX=10,g.BUMP=!0,g.LABEL=!0,e.pushStyle({type:"transcript"},null,g),g=new a,g.glyph="HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,e.pushStyle({type:"density"},null,g);return b(e)};h("bed",function(a){return new q(a)});h("wig",function(a){return new q(a)})},{"./das":10,"./sourceadapters":34,"./spans":36,"./utils":49}],3:[function(d,u,s){function q(a,
f){return a[f]+a[f+1]*P+a[f+2]*K+a[f+3]*x+a[f+4]*F}function n(){}function l(a,f,b,c){this.bwg=a;this.cirTreeOffset=f;this.cirTreeLength=b;this.isSummary=c}function h(a,f,b){var c=new n;c.data=a;c.name=b;c.data.slice(0,512).salted().fetch(function(a){if(!a)return f(null,"Couldn't fetch file");var A=new Uint8Array(a),b=new Int16Array(a);a=new Int32Array(a);var y=A[0]+P*A[1]+K*A[2]+x*A[3];if(y==v)c.type="bigwig";else if(y==O)c.type="bigbed";else return y==r||y==Q?f(null,"Currently don't support big-endian BBI files"):
f(null,"Not a supported format, magic=0x"+y.toString(16));c.version=b[2];c.numZoomLevels=b[3];c.chromTreeOffset=q(A,8);c.unzoomedDataOffset=q(A,16);c.unzoomedIndexOffset=q(A,24);c.fieldCount=b[16];c.definedFieldCount=b[17];c.asOffset=q(A,36);c.totalSummaryOffset=q(A,44);c.uncompressBufSize=a[13];c.extHeaderOffset=q(A,56);c.zoomLevels=[];for(b=0;b<c.numZoomLevels;++b){var y=a[6*b+16],g=q(A,24*b+72),k=q(A,24*b+80);c.zoomLevels.push({reduction:y,dataOffset:g,indexOffset:k})}c.readChromTree(function(){c.getAutoSQL(function(k){c.schema=
k;return f(c)})})},{timeout:5E3})}function t(a,f,b,c,g){this.bbi=a;this.type=f;this.fieldCount=b;this.offset=c;this.field=g}if("undefined"!==typeof d){s=d("./spans");var z=s.Range,B=s.union,c=s.intersection;s=d("./das");var a=s.DASFeature,b=s.DASGroup,e=d("./utils").shallowCopy,m=d("./bin").readInt;d=d("jszlib");var p=d.inflateBuffer,g=d.arrayCopy}var v=2291137574,r=654086024,O=2273964779,Q=3958540679,P=256,K=65536,x=16777216,F=4294967296,w=/^[0-9]+,[0-9]+,[0-9]+/;n.prototype.readChromTree=function(a){var f=
this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var b=this.unzoomedDataOffset,b=b+4-(b-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,b-this.chromTreeOffset).fetch(function(b){var c=new Uint8Array(b),A=new Int16Array(b),g=(new Int32Array(b))[2];q(c,16);var y=function(a){var k=c[a],b=A[a/2+1];a+=4;for(var e=0;e<b;++e)if(0==k){a+=g;var L=q(c,a);a+=8;L-=f.chromTreeOffset;y(L)}else{for(var L="",E=0;E<g;++E){var p=c[a++];0!=p&&(L+=String.fromCharCode(p))}E=c[a+3]<<24|c[a+2]<<16|
c[a+1]<<8|c[a+0];a+=8;f.chromsToIDs[L]=E;0==L.indexOf("chr")&&(f.chromsToIDs[L.substr(3)]=E);f.idsToChroms[E]=L;f.maxID=Math.max(f.maxID,E)}};y(32);a(f)})};l.prototype.readWigData=function(a,f,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.readWigDataById(a,f,b,c)};l.prototype.readWigDataById=function(a,f,b,c){var g=this;if(this.cirHeader){var A=[],e=0;Date.now();var y=function(k,A,c,g){return(0>a||k==a)&&A<=b&&c>=f},G=function(f,a){g.bwg.instrument&&console.log("level="+a+"; offset="+
f+"; time="+(Date.now()|0));e+=f.length;if(1==f.length&&48==f[0]-g.cirTreeOffset&&g.cachedCirRoot)I(g.cachedCirRoot,0,a),--e,0==e&&g.fetchFeatures(y,A,c);else{for(var b=4+32*g.cirBlockSize,G,E=0;E<f.length;++E){var p=new z(f[E],f[E]+b);G=G?B(G,p):p}b=G.ranges();for(G=0;G<b.length;++G)k(f,b[G],a)}},k=function(f,k,a,b){k.max();k.min();g.bwg.data.slice(k.min(),k.max()-k.min()).fetch(function(b){for(var G=0;G<f.length;++G)k.contains(f[G])&&(I(b,f[G]-k.min(),a),48==f[G]-g.cirTreeOffset&&0==f[G]-k.min()&&
(g.cachedCirRoot=b),--e,0==e&&g.fetchFeatures(y,A,c))})},I=function(k,c,g){var y=new Uint8Array(k),e=new Int16Array(k);k=new Int32Array(k);var I=y[c],e=e[c/2+1];c+=4;if(0!=I)for(I=0;I<e;++I){var p=c/4,D=k[p],r=k[p+1],C=k[p+2],p=k[p+3],m=q(y,c+16);g=q(y,c+24);(0>a||D<a||D==a&&r<=b)&&(0>a||C>a||C==a&&p>=f)&&A.push({offset:m,size:g});c+=32}else{for(var w=[],I=0;I<e;++I)p=c/4,D=k[p],r=k[p+1],C=k[p+2],p=k[p+3],m=q(y,c+16),(0>a||D<a||D==a&&r<=b)&&(0>a||C>a||C==a&&p>=f)&&w.push(m),c+=24;0<w.length&&G(w,
g+1)}};G([g.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(k){g.cirHeader=k;k=new Int32Array(g.cirHeader);g.cirBlockSize=k[1];g.readWigDataById(a,f,b,c)})};l.prototype.fetchFeatures=function(b,f,c){var e=this;f.sort(function(f,A){return(f.offset|0)-(A.offset|0)});if(0==f.length)c([]);else{var r=[],A=function(f,A,k,b){b||(b={});var c=new a;c._chromId=f;c.segment=e.bwg.idsToChroms[f];c.min=A;c.max=k;c.type=e.bwg.type;for(var g in b)c[g]=b[g];r.push(c)},D=function(){if(0==
f.length)Date.now(),c(r);else{var a=f[0];if(a.data)e.parseFeatures(a.data,A,b),f.splice(0,1),D();else{for(var G=a.offset,k=a.size,a=1;a<f.length&&f[a].offset==G+k;)k+=f[a].size,++a;e.bwg.data.slice(G,k).fetch(function(a){for(var A=0,b=0;A<k;){var c=f[b],y;0<e.bwg.uncompressBufSize?y=p(a,A+2,c.size-2):(y=new Uint8Array(c.size),g(new Uint8Array(a,A,c.size),0,y,0,c.size),y=y.buffer);c.data=y;A+=c.size;++b}D()})}}};D()}};l.prototype.parseFeatures=function(a,f,g){var p=new Uint8Array(a);if(this.isSummary)for(var r=
new Int16Array(a),A=new Int32Array(a),D=new Float32Array(a),p=a.byteLength/32,r=0;r<p;++r){a=A[8*r];var y=A[8*r+1],G=A[8*r+2],k=A[8*r+3],I=D[8*r+5],m=D[8*r+6];g(a,y+1,G)&&(k={type:"bigwig",score:m/k,maxScore:I},"bigbed"==this.bwg.type&&(k.type="density"),f(a,y+1,G,k))}else if("bigwig"==this.bwg.type)if(r=new Int16Array(a),A=new Int32Array(a),D=new Float32Array(a),a=A[0],I=A[1],m=A[3],k=A[4],y=p[20],p=r[11],3==y)for(r=0;r<p;++r){var L=D[r+6],A=I+r*m+1,y=I+r*m+k;g(a,A,y)&&f(a,A,y,{score:L})}else if(2==
y)for(r=0;r<p;++r)y=A[2*r+6]+1,G=y+k-1,L=D[2*r+7],g(a,y,G)&&f(a,y,G,{score:L});else if(1==y)for(r=0;r<p;++r)y=A[3*r+6]+1,G=A[3*r+7],L=D[3*r+8],y>G&&(y=G),g(a,y,G)&&f(a,y,G,{score:L});else console.log("Currently not handling bwgType="+y);else if("bigbed"==this.bwg.type)for(r=0,k=this.bwg.definedFieldCount,I=this.bwg.schema;r<p.length;){a=p[r+3]<<24|p[r+2]<<16|p[r+1]<<8|p[r+0];y=p[r+7]<<24|p[r+6]<<16|p[r+5]<<8|p[r+4];G=p[r+11]<<24|p[r+10]<<16|p[r+9]<<8|p[r+8];r+=12;for(L="";;)if(m=p[r++],0!=m)L+=String.fromCharCode(m);
else break;var m={},v;v=0<L.length?L.split("\t"):[];0<v.length&&3<k&&(m.label=v[0]);1<v.length&&4<k&&(L=parseInt(v[1]),isNaN(L)||(m.score=L));2<v.length&&5<k&&(m.orientation=v[2]);5<v.length&&8<k&&(L=v[5],w.test(L)&&(m.itemRgb="rgb("+L+")"));if(v.length>k-3&&I)for(L=k-3;L<v.length;++L)m[I.fields[L+3].name]=v[L];if(g(a,y+1,G,v))if(12>k)f(a,y+1,G,m);else{var L=v[3]|0,l=v[4]|0,x=v[6]|0,h=v[7].split(","),d=v[8].split(",");m.exonFrames&&(D=m.exonFrames.split(","),m.exonFrames=void 0);m.type="transcript";
var t=new b;for(A in m)t[A]=m[A];t.id=v[0];t.segment=this.bwg.idsToChroms[a];t.min=y+1;t.max=G;t.notes=[];m.groups=[t];if(9<v.length){var n=G=m.geneName||v[9];10<v.length&&(n=v[10]);m.geneName2&&(n=m.geneName2);v=e(t);v.id=G;v.label=n;v.type="gene";m.groups.push(v)}G=[];for(v=0;v<x;++v)t=(d[v]|0)+y,t=new z(t,t+(h[v]|0)),G.push(t);h=B(G);x=h.ranges();for(y=0;y<x.length;++y)G=x[y],f(a,G.min()+1,G.max(),m);if(l>L&&(y="+"==m.orientation?new z(L,l+3):new z(L-3,l),y=c(h,y))){m.type="translation";L=y.ranges();
for(h=l=0;L[0].min()>x[h].max();)h++;for(y=0;y<L.length;++y)x=y,"-"==m.orientation&&(x=L.length-y-1),G=L[x],m.readframe=l,D&&(x=parseInt(D[x+h]),"number"===typeof x&&0<=x&&2>=x&&(m.readframe=x,m.readframeExplicit=!0)),x=G.max()-G.min(),l=(l+x)%3,f(a,G.min()+1,G.max(),m)}}}else throw Error("Don't know what to do with "+this.bwg.type);};l.prototype.getFirstAdjacent=function(a,f,b,c){a=this.bwg.chromsToIDs[a];if(void 0===a)return c([]);this.getFirstAdjacentById(a,f,b,c)};l.prototype.getFirstAdjacentById=
function(a,f,b,c){var g=this;if(this.cirHeader){var A=null,e=-1,y=-1,G=0;Date.now();var k=function(k,f){G+=k.length;for(var a=4+32*g.cirBlockSize,A,b=0;b<k.length;++b){var c=new z(k[b],k[b]+a);A=A?B(A,c):c}a=A.ranges();for(A=0;A<a.length;++A)I(k,a[A],f)},I=function(k,y,e,I){y.max();y.min();g.bwg.data.slice(y.min(),y.max()-y.min()).fetch(function(I){for(var r=0;r<k.length;++r)if(y.contains(k[r])&&(p(I,k[r]-y.min(),e),--G,0==G)){if(!A)return 0<b&&(0!=a||0<f)?g.getFirstAdjacentById(0,0,b,c):0>b&&(a!=
g.bwg.maxID||1E9>f)?g.getFirstAdjacentById(g.bwg.maxID,1E9,b,c):c([]);g.fetchFeatures(function(k,A,c,g){return 0>b&&(k<a||c<f)||0<b&&(k>a||A>f)},[A],function(k){for(var f=null,a=-1,A=-1,g=0;g<k.length;++g){var y=k[g],e=y._chromId,I=y.min,G=y.max;if(null==f||0>b&&(e>a||G>A)||0<b&&(e<a||I<A))f=y,A=0>b?G:I,a=e}return null!=f?c([f]):c([])})}})},p=function(c,I,G){var p=new Uint8Array(c),r=new Int16Array(c);c=new Int32Array(c);var m=p[I],r=r[I/2+1];I+=4;if(0!=m)for(m=0;m<r;++m){var C=I/4,w=c[C],v=c[C+1],
x=c[C+2],l=c[C+3],C=q(p,I+16);G=q(p,I+24);(0>b&&(w<a||w==a&&v<=f)||0<b&&(x>a||x==a&&l>=f))&&!/_random/.exec(g.bwg.idsToChroms[w])&&(null==A||0>b&&(x>e||x==e&&l>y)||0<b&&(w<e||w==e&&v<y))&&(A={offset:C,size:G},y=0>b?l:v,e=0>b?x:w);I+=32}else{for(var h=p=-1,m=0;m<r;++m){C=I/4;w=c[C];v=c[C+1];x=c[C+2];l=c[C+3];C=c[C+4]<<32|c[C+5];if(0>b&&(w<a||w==a&&v<=f)&&x>=a||0<b&&(x>a||x==a&&l>=f)&&w<=a)if(0>p||l>h)p=C,h=0>b?l:v;I+=24}0<=p&&k([p],G+1)}};k([g.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(k){g.cirHeader=k;k=new Int32Array(g.cirHeader);g.cirBlockSize=k[1];g.getFirstAdjacentById(a,f,b,c)})};n.prototype.readWigData=function(a,f,b,c){this.getUnzoomedView().readWigData(a,f,b,c)};n.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new l(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};n.prototype.getZoomedView=function(a){a=this.zoomLevels[a];
a.view||(a.view=new l(this,a.indexOffset,4E3,!0));return a.view};n.prototype._tsFetch=function(a,f,b,c,g){var A=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var e=[],y=this.topLevelReductionCache,G=0;G<y.length;++G)y[G]._chromId==f&&e.push(y[G]);return g(e)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(k){A.topLevelReductionCache=k;return A._tsFetch(a,f,b,c,g)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(f,
b,c,g)};n.prototype.thresholdSearch=function(a,f,b,c,g){function A(){if(0==y.length)return g(null);y.sort(function(k,f){var a=k.zoom-f.zoom;if(0!=a)return a;a=k.chrOrd-f.chrOrd;return 0!=a?a:k.min-f.min*b});var k=y.splice(0,1)[0];e._tsFetch(k.zoom,k.chr,k.min,k.max,function(a){var e=0<b?0:3E8;k.fromRef&&(e=f);for(var G=0;G<a.length;++G){var p=a[G],r;r=void 0!=p.maxScore?p.maxScore:p.score;if(0<b){if(r>c)if(0>k.zoom){if(p.min>e)return g(p)}else p.max>e&&y.push({chr:k.chr,chrOrd:k.chrOrd,zoom:k.zoom-
2,min:p.min,max:p.max,fromRef:k.fromRef})}else if(r>c)if(0>k.zoom){if(p.max<e)return g(p)}else p.min<e&&y.push({chr:k.chr,chrOrd:k.chrOrd,zoom:k.zoom-2,min:p.min,max:p.max,fromRef:k.fromRef})}A()})}b=0>b?-1:1;var e=this;a=this.chromsToIDs[a];for(var y=[{chrOrd:0,chr:a,zoom:e.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],G=1;G<=this.maxID+1;++G){var k=(a+b*G)%(this.maxID+1);0>k&&(k+=this.maxID+1);y.push({chrOrd:G,chr:k,zoom:e.zoomLevels.length-1,min:0,max:3E8})}A()};n.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);
this.data.slice(this.asOffset,2048).fetch(function(f){var b=new Uint8Array(f);f="";for(var c=0;c<b.length&&0!=b[c];++c)f+=String.fromCharCode(b[c]);var b=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,g=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(f);if(g){c={declType:g[1],name:g[2],comment:g[4],fields:[]};f=f.substring(g[0]);for(g=b.exec(f);null!=g;g=b.exec(f))c.fields.push({type:g[1],name:g[2],comment:g[4]});return a(c)}})};n.prototype.getExtraIndices=function(a){var f=this;if(4>this.version||0==this.extHeaderOffset||
"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(b){if(!b)return a(null,"Couldn't fetch extension header");var c=new Uint8Array(b),g=new Int16Array(b);new Int32Array(b);var A=g[1];b=q(c,4);if(0==A)return a(null);f.data.slice(b,20*A).fetch(function(b){if(!b)return a(null,"Couldn't fetch index info");var c=new Uint8Array(b),g=new Int16Array(b);new Int32Array(b);b=[];for(var k=0;k<A;++k){var e=g[10*k],p=g[10*k+1],r=q(c,20*k+4),e=new t(f,e,p,r,g[10*k+8]);b.push(e)}a(b)})})};
t.prototype.lookup=function(a,f){var b=this;this.bbi.data.slice(this.offset,32).fetch(function(c){function g(k){b.bbi.data.slice(k,4+e*(y+p)).fetch(function(k){var A=new Uint8Array(k),c=new Uint16Array(k);new Uint32Array(k);c=c[1];k=4;if(0==A[0]){for(var e=null,r=0;r<c;++r){for(var D="",w=0;w<y;++w){var C=A[k++];0!=C&&(D+=String.fromCharCode(C))}w=q(A,k);k+=8;if(0>a.localeCompare(D)&&e){g(e);return}e=w}g(e)}else{for(r=0;r<c;++r){D="";for(w=0;w<y;++w)C=A[k++],0!=C&&(D+=String.fromCharCode(C));if(D==
a)return c=q(A,k),A=m(A,k+8),b.bbi.getUnzoomedView().fetchFeatures(function(k,f,A,c){if(c&&c.length>b.field-3)return c[b.field-3]==a},[{offset:c,size:A}],f);k+=p}return f([])}})}var A=new Uint8Array(c);new Int16Array(c);c=new Int32Array(c);var e=c[1],y=c[2],p=c[3];q(A,16);g(b.offset+32)})};"undefined"!==typeof u&&(u.exports={makeBwg:h,BIG_BED_MAGIC:O,BIG_WIG_MAGIC:v})},{"./bin":4,"./das":10,"./spans":36,"./utils":49,jszlib:65}],4:[function(d,u,s){function q(a){this.blob=a}function n(a,b,c,e){e||("object"===
typeof b?(e=b,b=void 0):e={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=e}function l(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}function h(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function t(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function z(a,b){return a[b+1]<<8|a[b]}function B(a,b){return a[b]}function c(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof d)var a=d("./utils").shallowCopy,
b=d("./sha1").b64_sha1;q.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new q(c)};q.prototype.salted=function(){return this};q.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(c){a(l(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var c=b.readAsArrayBuffer(this.blob);a(c)}catch(e){a(null,e)}};n.prototype.slice=
function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,e=this.end,c=c&&a?c+a:a||c;return new n(this.url,c,b&&c?c+b-1:e||b-1,this.opts)};var e=0,m=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");n.prototype.fetchAsText=function(a){try{var c=new XMLHttpRequest,v=this.url;(m||this.opts.salt)&&0>v.indexOf("?")&&(v=v+"?salt="+b(""+Date.now()+","+ ++e));c.open("GET",v,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";c.setRequestHeader("Range","bytes="+
this.start+"-"+this.end)}c.onreadystatechange=function(){if(4==c.readyState)return 200==c.status||206==c.status?a(c.responseText):a(null)};this.opts.credentials&&(c.withCredentials=!0);c.send("")}catch(r){return a(null)}};n.prototype.salted=function(){var b=a(this.opts);b.salt=!0;return new n(this.url,this.start,this.end,b)};n.prototype.fetch=function(a,c){var v=this;c=c||{};var r=c.attempt||1,h=c.truncatedLength;if(3<r)return a(null);try{var d;c.timeout&&!this.opts.credentials&&(d=setTimeout(function(){console.log("timing out "+
x);t.abort();return a(null,"Timeout")},c.timeout));var t=new XMLHttpRequest,n,x=this.url;(m||this.opts.salt)&&0>x.indexOf("?")&&(x=x+"?salt="+b(""+Date.now()+","+ ++e));t.open("GET",x,!0);t.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";t.setRequestHeader("Range","bytes="+this.start+"-"+this.end);n=this.end-this.start+1}t.responseType="arraybuffer";t.onreadystatechange=function(){if(4==t.readyState){d&&clearTimeout(d);if(200==t.status||
206==t.status){if(t.response){var b=t.response.byteLength;return!n||n==b||h&&b==h?a(t.response):v.fetch(a,{attempt:r+1,truncatedLength:b})}if(t.mozResponseArrayBuffer)return a(t.mozResponseArrayBuffer);b=t.responseText;return!n||n==b.length||h&&b.length==h?a(l(t.responseText)):v.fetch(a,{attempt:r+1,truncatedLength:b.length})}return v.fetch(a,{attempt:r+1})}};this.opts.credentials&&(t.withCredentials=!0);t.send("")}catch(B){return a(null)}};(function(a){var b=new ArrayBuffer(8),c=new Uint8Array(b),
e=new Float32Array(b);a.readFloat=function(a,b){c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3];return e[0]}})(this);"undefined"!==typeof u&&(u.exports={BlobFetchable:q,URLFetchable:n,readInt:t,readIntBE:c,readInt64:h,readShort:z,readByte:B,readFloat:this.readFloat})},{"./sha1":33,"./utils":49}],5:[function(d,u,s){function q(l){var t="bp";1E9<l?(l/=1E9,t="Gb"):1E6<l?(l/=1E6,t="Mb"):1E3<l&&(l/=1E3,t="kb");return""+Math.round(l)+t}if("undefined"!==typeof d){var n=d("./cbrowser").Browser,l=d("./utils").makeElement,
h=d("./numformats").formatLongInt,t=d("./zoomslider");d("./tier-edit");d("./export-config");d("./export-ui");d("./export-image");d("./svg-export");d("./session")}n.prototype.initUI=function(d,n){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(l("link","",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var c=this;c.disableDefaultFeaturePopup||this.addFeatureListener(function(a,k,f,b){c.featurePopup(a,
k,f,b)});d.classList.add("dalliance");var a=c.toolbar=l("div",null,{className:"btn-toolbar toolbar"}),b=c.coordSystem.speciesName+" "+c.nameForCoordSystem(c.coordSystem);this.setDocumentTitle&&(document.title=b+" :: dalliance");var e=l("input","",{className:"loc-field"});c.makeTooltip(e,"Enter a genomic location or gene name");var m=l("p","",{className:"loc-status"}),p=l("a",[l("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),g=new t;c.makeTooltip(g,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");
var v=l("a",[l("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),r=l("a",[l("i",null,{className:"fa fa-eraser"})],{className:"btn"}),O=l("a",[l("i",null,{className:"fa fa-plus"})],{className:"btn"}),Q=l("a",[l("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),P=l("a",[l("i",null,{className:"fa fa-print"})],{className:"btn"});l("a",[l("i",null,{className:"fa fa-refresh"})],{className:"btn"});var K=l("a",[l("i",null,{className:"fa fa-cogs"})],{className:"btn"}),x=l("a",[l("i",
null,{className:"fa fa-question"})],{className:"btn"}),F=l("a",[l("i",null,{className:"fa fa-road"})],{className:"btn"});c.makeTooltip(F,"Configure currently selected track(s) (E)");var w=l("a",[l("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),H=l("a",[l("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),f=l("div",null,{className:"btn-group pull-right"});this.noTrackAdder||f.appendChild(O);this.noTrackEditor||f.appendChild(F);this.noExport||
f.appendChild(P);this.noOptions||f.appendChild(K);this.noHelp||f.appendChild(x);this.setUiMode=function(a){this.uiMode=a;var k={help:x,add:O,opts:K,"export":P,tier:F},f;for(f in k)f==a?k[f].classList.add("active"):k[f].classList.remove("active")};this.noLeapButtons||a.appendChild(H);f.firstChild&&a.appendChild(f);this.noLeapButtons||a.appendChild(w);this.noTitle||a.appendChild(l("div",l("h4",b,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(l("div",[e,m],{className:"btn-group loc-group"}));
this.noClearHighlightsButton||a.appendChild(r);this.noZoomSlider||a.appendChild(l("div",[p,l("span",g,{className:"btn"}),v],{className:"btn-group"}));this.toolbarBelow?(d.appendChild(n),d.appendChild(a)):(d.appendChild(a),d.appendChild(n));var E=Math.log(2)/Math.log(10),C=Math.log(5)/Math.log(10),J=function(a){var k=(a/c.zoomExpt+Math.log(c.zoomBase))/Math.log(10);a=k|0;k-=a;return((0.01>k?a:k<=E+0.01?a+E:k<=C+0.01?a+C:a+1)*Math.log(10)-Math.log(c.zoomBase))*c.zoomExpt},A=function(a){g.addLabel(a,
q(Math.exp(a/c.zoomExpt)*c.zoomBase))};this.addViewListener(function(a,k,f,b,y){e.value=a+":"+h(k)+".."+h(f);g.min=y.min|0;g.max=y.max|0;y.isSnapZooming?(g.value=y.alternate,g.value2=y.current,g.active=2):(g.value=y.current,g.value2=y.alternate,g.active=1);y.current==y.min?p.classList.add("disabled"):p.classList.remove("disabled");y.current==y.max?v.classList.add("disabled"):v.classList.remove("disabled");g.removeLabels();a=y.min;y=y.max;k=y-a;A(J(a));A(J(a+1*k/3));A(J(a+2*k/3));A(J(y));c.storeStatus&&
c.storeViewStatus();r.style.display=0<c.highlights.length?"inline-block":"none"});this.addTierListener(function(){c.storeStatus&&c.storeTierStatus()});e.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),c.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),c.search(e.value,function(a){m.textContent=a?""+a:""})},!1);var D;O.addEventListener("click",function(a){D&&D.displayed?c.removeAllPopups():D=c.showTrackAdder(a)},!1);c.makeTooltip(O,
"Add a new track from the registry or an indexed file. (A)");p.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(-10)},!1);c.makeTooltip(p,"Zoom in (+)");v.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(10)},!1);c.makeTooltip(v,"Zoom out (-)");g.addEventListener("change",function(a){a=2==g.active;a!=c.isSnapZooming&&(c.savedZoom=c.zoomSliderValue-c.zoomMin,c.isSnapZooming=a);a=1==g.active?g.value:g.value2;c.zoomSliderValue=
1*a;c.zoom(Math.exp(1*a/c.zoomExpt))},!1);Q.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);c.makeTooltip(Q,"Favourite regions");P.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.openExportPanel()},!1);c.makeTooltip(P,"Export publication-quality SVG. (X)");K.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleOptsPopup(a)},!1);c.makeTooltip(K,"Configure options.");x.addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();c.toggleHelpPopup(a)});c.makeTooltip(x,"Help; Keyboard shortcuts. (H)");F.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]])},!1);w.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?-1:1,!1)},!1);c.makeTooltip(w,function(a){a=c.getSelectedTier();var k;0<=a&&(k=c.tiers[a]);return k&&k.featureSource&&c.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold?
'Jump to the next region with a score above the threshold in the selected track "'+(k.config.name||k.dasSource.name)+'"" (ctrl+LEFT)':k&&k.featureSource&&c.sourceAdapterIsCapable(k.featureSource,"leap")?'Jump to the next feature in the selected track "'+(k.config.name||k.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});H.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?1:-1,!1)},!1);c.makeTooltip(H,function(a){a=c.getSelectedTier();var k;0<=a&&(k=c.tiers[a]);return k&&k.featureSource&&
c.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(k.config.name||k.dasSource.name)+'"" (ctrl+RIGHT)':k&&k.featureSource&&c.sourceAdapterIsCapable(k.featureSource,"leap")?'Jump to the next feature in the selected track "'+(k.config.name||k.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});c.addTierSelectionListener(function(){var a=c.getSelectedTier(),k;0<=a&&(k=
c.tiers[a]);a=!1;k&&k.featureSource&&(c.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold?a=!0:c.sourceAdapterIsCapable(k.featureSource,"leap")&&(a=!0));w.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";H.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});r.addEventListener("click",function(a){c.clearHighlights()},!1);c.makeTooltip(r,"Clear highlights (C)");c.addTierSelectionWrapListener(function(a){0>a&&(c.setSelectedTier(null),
e.focus())});c.addTierSelectionListener(function(a){"tier"===c.uiMode&&(0==a.length?(c.hideToolPanel(),c.manipulatingTier=null,c.uiMode="none"):(a=c.tiers[a[0]],a!=c.manipulatingTier&&c.openTierPanel(a)))});var y=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),c.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),c.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==c.selectedTiers.length&&
c.openTierPanel(c.tiers[c.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),c.openExportPanel();else if(67==a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),c.clearHighlights()};d.addEventListener("focus",function(a){d.addEventListener("keydown",y,!1)},!1);d.addEventListener("blur",function(a){d.removeEventListener("keydown",y,!1)},!1);d.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==c.uiMode&&(a.preventDefault(),a.stopPropagation(),
c.setUiMode("none"),c.hideToolPanel(),c.selectedTiers&&0<c.selectedTiers.length&&c.browserHolder.focus())},!1)};n.prototype.showToolPanel=function(t,h){var c=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var a;a=h?t:l("div",t,{},{overflowY:"auto",width:"100%"});var b=l("div",l("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});b.addEventListener("click",function(a){c.hideToolPanel();c.setUiMode("none")},!1);this.makeTooltip(b,"Close tool panel (ESC)");
this.activeToolPanel=l("div",[b,a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();c=this};n.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};n.prototype.toggleHelpPopup=function(t){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(t=l("iframe",null,{scrolling:"yes",seamless:"seamless",
src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(t,!1),this.setUiMode("help"))};n.prototype.toggleOptsPopup=function(t){var h=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{t=l("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var c=l("table");c.cellPadding=5;var a=l("input","",{type:"checkbox",checked:h.reverseScrolling});a.addEventListener("change",
function(b){h.reverseScrolling=a.checked;h.storeStatus()},!1);c.appendChild(l("tr",[l("td","Reverse trackpad scrolling",{align:"right"}),l("td",a)]));var b=l("input","",{type:"checkbox",checked:h.reverseKeyScrolling});b.addEventListener("change",function(a){h.reverseKeyScrolling=b.checked;h.storeStatus()},!1);c.appendChild(l("tr",[l("td","Reverse scrolling buttons and keys",{align:"right"}),l("td",b)]));var e=l("select");e.appendChild(l("option","Left",{value:"left"}));e.appendChild(l("option","Center",
{value:"center"}));e.appendChild(l("option","Right",{value:"right"}));e.appendChild(l("option","None",{value:"none"}));e.value=h.rulerLocation;e.addEventListener("change",function(a){h.rulerLocation=e.value;h.positionRuler();for(a=0;a<h.tiers.length;++a)h.tiers[a].paintQuant();h.storeStatus()},!1);c.appendChild(l("tr",[l("td","Vertical guideline",{align:"right"}),l("td",e)]));var m=l("input","",{type:"checkbox",checked:h.singleBaseHighlight});m.addEventListener("change",function(a){h.singleBaseHighlight=
m.checked;h.positionRuler();h.storeStatus()},!1);m.setAttribute("id","singleBaseHightlightButton");c.appendChild(l("tr",[l("td","Display and highlight current genome location",{align:"right"}),l("td",m)]));t.appendChild(c);c=l("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});c.addEventListener("click",function(a){h.reset()},!1);t.appendChild(c);this.showToolPanel(t);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,
"./export-ui":16,"./numformats":26,"./session":32,"./svg-export":38,"./tier-edit":44,"./utils":49,"./zoomslider":52}],6:[function(d,u,s){function q(a,f,b){this.min=f;this.max=b;this.chr=a}function n(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=
[];this.cookieKey="browser";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=
0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new c;this.defaultSources=[];this.mappableSources={};this.registry=null;this.noRegistryTabs=!0;this.hubs=[];this.hubObjects=[];this.sourceCache=new B;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.httpCanaryURL=
"http://www.biodalliance.org/http-canary.txt";this.httpWarningURL="//www.biodalliance.org/https.html";this.initListeners=[];this.baseColors=a.baseColors?a.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");for(var f in a)this[f]=a[f];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&
(this.prefix=a.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(a=window.location.hostname,window.location.port&&(a+=":"+window.location.port),this.prefix="//"+a+this.prefix);0===this.prefix.indexOf("//")&&(a=window.location.protocol,"http:"!=a&&"https:"!=a&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");
if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var b=this;if("complete"===document.readyState)b.realInit();else{var e=function(a){window.removeEventListener("load",e,!1);b.realInit()};window.addEventListener("load",e,!1)}}function l(a,f,b){if(b)for(var c=0;c<f.length;++c)f[c].mapping=b;a.set(f)}function h(a,f,b,c){c=c||[];for(var k=a.length-1;0<=k;--k){var e=a[k];if(!e.notSelectable&&e.min()<=f&&e.max()>=f&&(!e.minY||
!(b<e.minY()||b>e.maxY()))){e.feature?c.push(e.feature):e.group&&c.push(e.group);if(e.glyphs)return h(e.glyphs,f,b,c);if(e.glyph)return h([e.glyph],f,b,c);break}}return c}function t(a,f){var b=this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=f;this.worker.onmessage=function(a){var k=b.callbacks[a.data.tag];k&&(k(a.data.result,a.data.error),delete b.callbacks[a.data.tag])}}function z(a){var f=a.resolveURL(a.workerPath);0==f.indexOf("//")&&(f="https:"==window.location.protocol?"https:"+
f:"http:"+f);var b=new Blob(['importScripts("'+f+"?version="+O+'");'],{type:"application/javascript"});return new x(function(f,k){var c=new Worker(URL.createObjectURL(b));c.onmessage=function(k){"init"===k.data.tag&&(console.log("Worker initialized"),f(new t(a,c)))};c.onerror=function(a){k(a.message)}})}function B(){this.sourcesByURI={}}if("undefined"!==typeof d){s=d("./utils");var c=s.Observed,a=s.makeElement,b=s.removeChildren,e=s.miniJSONify,m=s.shallowCopy,p=s.textXHR,g=d("./tier").DasTier,v=
d("./sha1").hex_sha1,r=d("./thub").connectTrackHub,O=d("./version");s=d("./numformats");var Q=s.formatQuantLabel,P=s.formatLongInt,K=d("./chainset").Chainset,x=d("es6-promise").Promise;s=d("./sourcecompare");var F=s.sourcesAreEqual,w=s.sourcesAreEqualModuloStyle,H=s.sourceDataURI}n.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};n.prototype.destroy=function(){window.removeEventListener("resize",this.resizeListener,!1)};n.prototype.realInit=function(){var f=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");
else{this.wasInitialized=!0;var c=navigator.userAgent||"dummy";0<=c.indexOf("Trident")&&0<=c.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(c=0;c<this.sources.length;++c){var e=this.sources[c];e&&this.defaultSources.push(e)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var g=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");
this.browserHolder=a("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);b(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=a("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=a("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=
a("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=a("span","",{className:"loc-single-base"});c=a("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(a,k,b,c,e,g,y){k=Math.round((y+g)/2);f.locSingleBase.appendChild(document.createTextNode(a+":"+P(k)));f.locSingleBase.removeChild(f.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=a("div",[c,this.pinnedTierHolder,
this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=a("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(a("span",["Powered by ",a("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+O],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);this.resizeListener=function(a){g.resizeViewer()};window.addEventListener("resize",this.resizeListener,!1);this.ruler=
a("div",null,{className:"guideline"});this.ruler2=a("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var k in this.chainConfigs)c=this.chainConfigs[k],c instanceof K&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[k]=new K(c);if(0<this.maxWorkers){k=[];for(c=0;c<this.maxWorkers;++c)k.push(z(this));
k=x.all(k)}else k=x.resolve([]);this.fetchWorkers=null;this.nextWorker=0;k.then(function(a){console.log("Booted "+a.length+" workers");g.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if("none"!=window.getComputedStyle(g.browserHolderHolder).display&&0<g.tierHolder.getBoundingClientRect().width)setTimeout(function(){g.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(g.browserHolderHolder).display&&0<g.tierHolder.getBoundingClientRect().width&&
(clearInterval(a),g.realInit2())},300)})}};n.prototype.realInit2=function(){var f=this;b(this.tierHolder);b(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-
this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var k=a.wheelDeltaX/5;f.reverseScrolling||(k=-k);f.move(k)}a.wheelDeltaY&&(k=a.wheelDeltaY,f.reverseScrolling&&(k=-k),f.tierHolder.scrollTop+=k)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(a){a.stopPropagation();a.preventDefault();1==a.axis?0!=a.detail&&(a=a.detail/4,f.reverseScrolling&&(a=-a),f.move(a)):(a=a.detail,
f.reverseScrolling||(a=-a),f.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("touchstart",function(a){return f.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return f.touchMoveHandler(a)},!1);this.tierHolderHolder.addEventListener("touchend",function(a){return f.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(a){return f.touchCancelHandler(a)},!1);var c=function(a){if(13==a.keyCode){var k=!1;for(a=
0;a<f.tiers.length;++a){var b=f.tiers[a];b.wantedLayoutHeight&&b.wantedLayoutHeight!=b.layoutHeight&&(b.layoutHeight=b.wantedLayoutHeight,b.clipTier(),k=!0)}k&&f.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)f.isSnapZooming?(f.isSnapZooming=!1,k=(f.savedZoom||20)+f.zoomMin):(f.isSnapZooming=!0,k=(f.savedZoom||0)+f.zoomMin),f.savedZoom=f.zoomSliderValue-f.zoomMin,f.zoomSliderValue=k,f.zoom(Math.exp(1*k/f.zoomExpt)),a.stopPropagation(),a.preventDefault();else if(85==a.keyCode)"opts"===f.uiMode&&
(k=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=!k),f.singleBaseHighlight=!f.singleBaseHighlight,f.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),a.preventDefault(),f.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),f.scrollArrowKey(a,1);else if(38==a.keyCode||87==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=f.getSelectedTier(),
0>a||(k=f.tiers[a],a=k.forceHeight||k.subtiers[0].height,40<=a&&k.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=f.getSelectedTier(),!(0>a)&&(k=f.tiers[a],k.quantLeapThreshold)){var b=k.subtiers[0].height,c=k.subtiers[0].quant;c&&(a=1*c.min,c=1*c.max,b=(c-a)/b,k.mergeConfig({quantLeapThreshold:a+((Math.round((k.quantLeapThreshold-a)/b)|0)+1)*b}),k.notify("Threshold: "+Q(k.quantLeapThreshold)))}}else if(a.altKey){if(c=f.selectedTiers.length,0!=c){a=f.selectedTiers[0];for(var e=!0,k=
[],b=0;b<f.selectedTiers.length;++b)k.push(f.tiers[f.selectedTiers[b]]),0<b&&1!=f.selectedTiers[b]-f.selectedTiers[b-1]&&(e=!1);if(!(e&&0>=a)){for(b=f.selectedTiers.length-1;0<=b;--b)f.tiers.splice(f.selectedTiers[b],1);f.selectedTiers.splice(0,c);a=e?a-1:a;for(b=0;b<k.length;++b)f.tiers.splice(a+b,0,k[b]),f.selectedTiers.push(a+b);f.withPreservedSelection(f._ensureTiersGrouped);f.markSelectedTiers();f.notifyTierSelection();f.reorderTiers();f.notifyTier()}}}else if(a=f.getSelectedTier(),0<a){if(f.setSelectedTier(a-
1),a=f.tiers[f.getSelectedTier()],k=a.row.offsetTop,a=k+a.row.offsetHeight,k<f.tierHolder.scrollTop||a>f.tierHolder.scrollTop+f.tierHolder.offsetHeight)f.tierHolder.scrollTop=k}else f.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=f.getSelectedTier(),0>a||(k=f.tiers[a],a=k.forceHeight||k.subtiers[0].height,k.mergeConfig({height:a+10}));else if(a.ctrlKey||a.metaKey){if(a=f.getSelectedTier(),!(0>a)&&(k=f.tiers[a],k.quantLeapThreshold&&
(b=k.subtiers[0].height,c=k.subtiers[0].quant)))a=1*c.min,c=1*c.max,b=(c-a)/b,c=Math.round((k.quantLeapThreshold-a)/b)|0,1<c&&(k.mergeConfig({quantLeapThreshold:a+(c-1)*b}),k.notify("Threshold: "+Q(k.quantLeapThreshold)))}else if(a.altKey){if(c=f.selectedTiers.length,0!=c){a=f.selectedTiers[0];for(var g=0,k=[],b=0;b<f.selectedTiers.length;++b)k.push(f.tiers[f.selectedTiers[b]]),0<b&&(g+=f.selectedTiers[b]-f.selectedTiers[b-1]-1);e=0==g;if(!(e&&a+c>=f.tiers.length)){for(b=f.selectedTiers.length-1;0<=
b;--b)f.tiers.splice(f.selectedTiers[b],1);f.selectedTiers.splice(0,c);a=e?a+1:a+g;for(b=0;b<k.length;++b)f.tiers.splice(a+b,0,k[b]),f.selectedTiers.push(a+b);f.withPreservedSelection(function(){f._ensureTiersGrouped(!0)});f.markSelectedTiers();f.notifyTierSelection();f.reorderTiers();f.notifyTier()}}}else{if(a=f.getSelectedTier(),a<f.tiers.length-1&&(f.setSelectedTier(a+1),a=f.tiers[f.getSelectedTier()],k=a.row.offsetTop,a=k+a.row.offsetHeight,k<f.tierHolder.scrollTop||a>f.tierHolder.scrollTop+f.tierHolder.offsetHeight))f.tierHolder.scrollTop=
Math.min(k,a-f.tierHolder.offsetHeight)}else if(187==a.keyCode||61==a.keyCode)a.stopPropagation(),a.preventDefault(),f.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),f.zoomStep(10);else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=f.getSelectedTier(),0>a||(b=f.tiers[a],b.infoVisible?(b.infoElement.style.display="none",b.updateHeight(),b.infoVisible=!1):(b.infoElement.style.display="block",b.updateHeight(),b.infoVisible=!0));
else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),a.preventDefault(),a=0;a<f.tiers.length;++a)b=f.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===k&&(k=!b.bumped),b.mergeConfig({bumped:k}));else a.ctrlKey||a.metaKey||(a.stopPropagation(),a.preventDefault(),a=f.getSelectedTier(),0>a||(b=f.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===k&&(k=!b.bumped),b.mergeConfig({bumped:k}))));else if(77==a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||
a.metaKey)&&1<f.selectedTiers.length&&f.mergeSelectedTiers();else if(68==a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=f.getSelectedTier(),0>a||f.addTier(f.tiers[a].dasSource)}else if(80==a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){k=[];for(a=0;a<f.selectedTiers.length;++a)k.push(f.tiers[f.selectedTiers[a]]);for(a=0;a<k.length;++a)k[a].mergeConfig({pinned:!k[a].pinned})}};this.browserHolder.addEventListener("focus",function(a){f.browserHolder.addEventListener("keydown",
c,!1)},!1);this.browserHolder.addEventListener("blur",function(a){f.browserHolder.removeEventListener("keydown",c,!1)},!1);this.hPopupHolder=a("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var e=0;e<this.sources.length;++e){var g=this.sources[e];if(g){var k={};this.restoredConfigs&&(k=this.restoredConfigs[e]);g.disabled||this.makeTier(g,k)}}f._ensureTiersGrouped();
f.arrangeTiers();f.reorderTiers();f.refresh();f.setSelectedTier(1);f.positionRuler();(e=this.getSequenceSource())&&e.getSeqInfo(this.chr,function(a){f.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var m in this.chains)this.queryRegistry(m,!0);if(this.hubs)for(m=0;m<this.hubs.length;++m)e=this.hubs[m],"string"==typeof e&&(e={url:e}),function(a){r(a.url,function(k,b){if(b)console.log(b);else{var c;if(c=a.genome?k.genomes[a.genome]:k.genomes[f.coordSystem.ucscName])a.mapping&&(c.mapping=a.mapping),
f.hubObjects.push(c)}},a)}(e);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(m=0;m<this.initListeners.length;++m)try{this.initListeners[m].call(this)}catch(p){console.log(p)}};n.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=
this.scale)};n.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var f=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&f!=this.touchOriginX&&this.move(f-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=f;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){f=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(f!=this.zoomLastSep){a=(a.touches[0].pageX+
a.touches[1].pageX)/2;var b=this.viewStart+a/this.scale|0;this.scale=f/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=b-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=f}};n.prototype.touchEndHandler=function(a){};n.prototype.touchCancelHandler=function(a){};n.prototype.makeTier=function(a,f){try{return this.realMakeTier(a,f)}catch(b){console.log("Error initializing",a),console.log(b.stack||b)}};n.prototype.realMakeTier=function(a,f){var b=this,c=null;
this.tierBackgroundColors&&(c=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var k=new g(this,a,f,c);k.oorigin=this.viewStart;var e=!1,r,m,p,E=function(a,f){var c=k.subtiers;if(c){var e=0;for(f-=k.padding;e<c.length&&f>c[e].height&&e<c.length-1;)f=f-c[e].height-k.padding,++e;if(!(e>=c.length))return c=c[e].glyphs,a-=(k.glyphCacheOrigin-b.viewStart)*b.scale,h(c,a,f)}},w=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=m&&(b.move(a-m,!0),m=a);b.isDragging=
!0},C=function(a){window.removeEventListener("mousemove",w,!0);window.removeEventListener("mouseup",C,!0);b.move(a.clientX-m)};k.viewport.addEventListener("mousedown",function(a){b.browserHolder.focus();a.preventDefault();k.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",w,!0);window.addEventListener("mouseup",C,!0);r=m=a;b.isDragging=!1},!1);k.viewport.addEventListener("mousemove",function(a){var f=k.row.getBoundingClientRect(),c=a.clientX-f.left,A=a.clientY-f.top,f=E(c,
A);k.row.style.cursor=f&&0<f.length?"pointer":"default";p&&clearTimeout(p);e||(p=setTimeout(function(){var f=E(c,A);f&&0<f.length&&b.notifyFeatureHover(a,f[f.length-1],f,k)},1E3))});var l=null;k.viewport.addEventListener("mouseup",function(a){var f=k.row.getBoundingClientRect(),c=a.clientX-f.left,f=a.clientY-f.top,e=E(c,f);e&&0<e.length&&!b.isDragging&&(l?(clearTimeout(l),l=null,b.featureDoubleClick(e,c,f)):l=setTimeout(function(){l=null;b.notifyFeature(a,e[e.length-1],e,k)},500));if(b.isDragging&&
c!=r&&k.sequenceSource){var f=b.viewStart+c/b.scale,A=b.viewStart+r/b.scale;f<A?(c=f|0,f=A|0):(c=A|0,f|=0);b.notifyRegionSelect(b.chr,c,f)}b.isDragging=!1},!1);k.viewport.addEventListener("mouseout",function(a){e=!1});k.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<b.tiers.length;++a)if(b.tiers[a]===k){b.removeTier({index:a});break}},!1);k.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=-1;
for(var f=0;f<b.tiers.length;++f)if(b.tiers[f]===k){a=f;break}0<=a&&(f=b.selectedTiers.indexOf(a),0<=f?b.selectedTiers.splice(f,1):(b.selectedTiers.push(a),b.selectedTiers.sort()),b.markSelectedTiers(),b.notifyTierSelection(),0<b.selectedTiers.length?b.browserHolder.focus():b.notifyTierSelectionWrap(-1))}else{for(f=0;f<b.tiers.length;++f)if(b.tiers[f]===k&&(b.browserHolder.focus(),1!=b.selectedTiers.length||b.selectedTiers[0]!=f)){b.setSelectedTier(f);return}k.infoVisible?(k.infoElement.style.display=
"none",k.updateHeight(),k.infoVisible=!1):(k.infoElement.style.display="block",k.updateHeight(),k.infoVisible=!0)}},!1);k.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var f;k.dasSource.collapseSuperGroups&&(void 0===f&&(f=!k.bumped),k.mergeConfig({bumped:f}))},!1);var x,v,t,d,n,O=!1,na=function(a){var f=k.label;a.stopPropagation();a.preventDefault();if(!x){v=k.pinned?b.pinnedTierHolder:b.tierHolder;t=v.scrollHeight-v.offsetHeight;x=f.cloneNode(!0);x.style.cursor=
"pointer";v.appendChild(x);f.style.visibility="hidden";for(var c=0;c<b.tiers.length;++c)if(b.tiers[c]===k){d=c;break}n=a.clientY}var e=v.getBoundingClientRect();x.style.left=f.getBoundingClientRect().left-e.left+"px";x.style.top=a.clientY-e.top+v.scrollTop-10+"px";f=a.clientY-e.top+v.scrollTop;for(c=0;c<b.tiers.length;++c)if(e=b.tiers[c],!(e.pinned^k.pinned)&&(e=e.row.getBoundingClientRect(),f-=e.bottom-e.top,0>f)){if(c<d&&a.clientY<n||c>d&&a.clientY>n){b.withPreservedSelection(function(){b.tiers.splice(d,
1);b.tiers.splice(c,0,k);b._ensureTiersGrouped(c>d)});for(f=0;f<b.tiers.length;++f)b.tiers[f]==k&&(d=f);n=a.clientY;b.reorderTiers();v.appendChild(x);O=!0}break}x.offsetTop<v.scrollTop?v.scrollTop-=v.scrollTop-x.offsetTop:x.offsetTop+x.offsetHeight>v.scrollTop+v.offsetHeight&&(v.scrollTop=Math.min(v.scrollTop+(x.offsetTop+x.offsetHeight)-(v.scrollTop+v.offsetHeight),t))},q=function(a){var f=k.label;a.stopPropagation();a.preventDefault();x&&(x.style.cursor="auto",v.removeChild(x),x=null,f.style.visibility=
"visible");document.removeEventListener("mousemove",na,!1);document.removeEventListener("mouseup",q,!1);if(O){for(a=0;a<b.tiers.length;++a)if(b.tiers[a]==k){b.setSelectedTier(a);break}b.notifyTier()}};k.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();O=!1;document.addEventListener("mousemove",na,!1);document.addEventListener("mouseup",q,!1)},!1);this.tiers.push(k);k.init();k.currentlyHeight=50;this.updateHeight();k.updateLabel();this.withPreservedSelection(b._ensureTiersGrouped);
k._updateFromConfig();this.reorderTiers();return k};n.prototype.reorderTiers=function(){b(this.tierHolder);b(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,f=[],c=[],e=0;e<this.tiers.length;++e){var k=this.tiers[e];k.pinned&&!this.disablePinning?(f.push(k),this.pinnedTierHolder.appendChild(this.tiers[e].row),a=!0):(c.push(k),this.tierHolder.appendChild(this.tiers[e].row))}this.withPreservedSelection(function(){this.tiers.splice(0,
this.tiers.length);for(var a=0;a<f.length;++a)this.tiers.push(f[a]);for(a=0;a<c.length;++a)this.tiers.push(c[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};n.prototype.withPreservedSelection=function(a){for(var f=[],b=0;b<this.selectedTiers.length;++b)f.push(this.tiers[this.selectedTiers[b]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=f.indexOf(this.tiers[a])&&
this.selectedTiers.push(a)};n.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};n.prototype._ensureTiersGrouped=function(a){for(var f={},b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.dasSource.tierGroup&&pusho(f,c.dasSource.tierGroup,c)}var k=[];a&&this.tiers.reverse();for(b=0;b<this.tiers.length;++b)if(c=this.tiers[b],c.dasSource.tierGroup){var e=f[c.dasSource.tierGroup];if(e){a&&e.reverse();for(var g=0;g<e.length;++g)k.push(e[g]);f[c.dasSource.tierGroup]=null}}else k.push(c);
a&&k.reverse();this.tiers.splice(0,this.tiers.length);for(g=0;g<k.length;++g)this.tiers.push(k[g])};n.prototype.arrangeTiers=function(){for(var f=[],b={},c=0;c<this.tiers.length;++c){var e=this.tiers[c];e.pinned&&(f.push(e),e.dasSource.tierGroup&&pusho(b,e.dasSource.tierGroup,e))}for(c=0;c<this.tiers.length;++c)e=this.tiers[c],e.pinned||(f.push(e),e.dasSource.tierGroup&&pusho(b,e.dasSource.tierGroup,e));for(var k in b){var e=b[k],g=this.tierGroups[k];g||(g={element:a("div",a("span",k,{className:"tier-group-label"}),
{className:"tier-group"})},this.tierGroups[k]=g);g.element.parentNode&&g.element.parentNode.removeChild(g.element);for(var r=e[0].pinned?this.pinnedTierHolder:this.tierHolder,m=1E7,p=0,c=0;c<e.length;++c)var E=e[c].row,m=Math.min(m,E.offsetTop),p=Math.max(p,E.offsetTop+E.offsetHeight);g.element.style.top=m+"px";g.element.style.left="0px";g.element.style.height=p-m+"px";r.appendChild(g.element)}if(this.tierBackgroundColors)for(c=0;c<f.length;++c)e=f[c],e.setBackground(this.tierBackgroundColors[c%this.tierBackgroundColors.length]),
e.label.style.left=e.dasSource.tierGroup?"18px":"2px",e.background=this.tierBackgroundColors[c%this.tierBackgroundColors.length]};n.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,f=1E3/this.scale|0,b=(this.viewStart+this.viewEnd)/2,c=b-this.origin;this.origin=b;this.scaleAtLastRedraw=this.scale;for(b=0;b<this.tiers.length;++b){var k=c;this.tiers[b].originHaxx&&(k+=this.tiers[b].originHaxx);this.tiers[b].originHaxx=k}c=this.targetQuantRes/this.scale;b=Math.max(1,(this.viewStart|
0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);k=Math.max(1,(this.viewStart|0)-f);f=Math.min((this.viewEnd|0)+f,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var e=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new C(this.tiers,this.chr,k,f,c,e)}(e=this.knownSpace.bestCacheOverlapping(this.chr,b,a))&&e.min<=b&&e.max>=a?(this.drawnStart=Math.max(e.min,k),this.drawnEnd=
Math.min(e.max,f)):(this.drawnStart=k,this.drawnEnd=f);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,c);this.drawOverlays();this.positionRuler()};n.prototype.queryRegistry=function(a,f){if(this.registry){var b,g;a?(b=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new c),g=this.mappableSources[a]):(b=this.coordSystem,g=this.availableSources);var k=v(e(b));if(f){var r=localStorage["dalliance.registry."+k+".last_queried"];if(r)try{if(l(g,JSON.parse(localStorage["dalliance.registry."+
k+".sources"]),a),432E5>(Date.now()|0)-(r|0))return}catch(m){console.log("Bad registry cache: "+m)}}r=this.registry;if(0==r.indexOf("//")){var p=window.location.protocol;"https:"!=p&&"http:"!=p&&(r="http:"+r)}(new J(r)).sources(function(f){for(var c=[],e=0;e<f.length;++e){var r=f[e];if(r.coords&&0!=r.coords.length){var m=r.coords[0];m.taxon==b.taxon&&m.auth==b.auth&&m.version==b.version&&c.push(r)}}localStorage["dalliance.registry."+k+".sources"]=JSON.stringify(c);localStorage["dalliance.registry."+
k+".last_queried"]=""+Date.now();l(g,c,a)},function(a){},b)}};n.prototype.move=function(a,f){var b=this.viewEnd-this.viewStart,c=this.viewStart-1*a/this.scale,k=c+b;f||(0<this.currentSeqMax&&k>this.currentSeqMax&&(k=this.currentSeqMax,c=this.viewEnd-b),1>c&&(c=1,k=c+b));this.setLocation(null,c,k,null,f)};n.prototype.zoomStep=function(a){var f=1*this.zoomSliderValue;a=f+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=f&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};
n.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);
this.notifyLocation();this.refresh()};n.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};n.prototype.resizeViewer=function(a){var f=this.tierHolder.getBoundingClientRect().width|0;if(0!=f){var b=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=f|0;b!=
this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,f=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-
f+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+f-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};n.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};n.prototype.addTier=function(a){a=m(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();
return a};n.prototype.removeTier=function(a,f){var b=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)b=a.index;else for(var c=0;c<this.tiers.length;++c)if(F(a,this.tiers[c].dasSource)){b=c;break}if(0>b)throw"Couldn't find requested tier";c=this.tiers[b];this.tiers.splice(b,1);for(var k=[],e=0;e<this.selectedTiers.length;++e){var g=this.selectedTiers[e];g<b?k.push(g):g>b&&k.push(g-1)}this.selectedTiers=k;this.markSelectedTiers();c.destroy();this.knownSpace&&(this.knownSpace.featureCache[c]=
null);this.reorderTiers();this.notifyTier()};n.prototype.removeAllTiers=function(){var a=this;this.selectedTiers=[];this.markSelectedTiers();this.tiers.forEach(function(f){f.destroy();a.knownSpace&&(a.knownSpace.featureCache[f]=null)});this.tiers.length=0;this.reorderTiers();this.notifyTier()};n.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};n.prototype._getSequenceSource=function(){for(var a=0;a<
this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||b.twoBitURI||b.twoBitBlob)return b.twoBitURI||b.twoBitBlob?new f(b):new E(b)}};n.prototype.setLocation=function(a,f,b,c,k){if("number"!==typeof f)throw Error("minimum must be a number (got "+JSON.stringify(f)+")");if("number"!==typeof b)throw Error("maximum must be a number (got "+JSON.stringify(b)+
")");if(f>b){var e=f;f=b;b=e}else f===b&&(b+=1);c||(c=function(a){if(a)throw a;});var g=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,f,b,null,c,k);var r=this.getSequenceSource();if(!r)return c("Need a sequence source");var m=a||this.chr;r.getSeqInfo(m,function(e){if(e)return g._setLocation(a,f,b,e,c,k);var p;p=0==m.indexOf("chr")?m.substr(3):"chr"+m;r.getSeqInfo(p,function(e){return!e&&a?c("Couldn't find sequence '"+a+"'"):e?g._setLocation(p,f,b,e,c,k):g._setLocation(null,
f,b,null,c,k)})})};n.prototype._setLocation=function(a,f,b,c,k,e){var g=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(g=!0),this.chr=a,this.currentSeqMax=c.length);f=parseFloat(f);b=parseFloat(b);a=Math.max(10,b-f+1);e||(e=this.currentSeqMax,0>=e&&(e=1E12),1>f&&(f=1,b=f+a-1),b>e&&(b=e,f=Math.max(1,b-a+1)));this.viewStart=f;this.viewEnd=b;f=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);e=1E-6<Math.abs(f-this.scale);this.scale=f;b=this.zoomSliderValue;this.zoomSliderValue=
f=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(e||g){for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left="5000px",this.tiers[g].overlay.style.left="5000px";this.refresh();this.savedZoom?(f-=this.zoomMin,b-=this.zoomMin,g=f-this.savedZoom,Math.abs(f-b)>Math.abs(g)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=b)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left=""+((-((this.viewStart-
this.tiers[g].norigin)*this.scale)|0)-1E3)+"px",this.tiers[g].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return k()};n.prototype.setCenterLocation=function(a,f){var b=(this.viewEnd-this.viewStart)/2;this.setLocation(a,f-b,f+b)};n.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,f=0;f<this.tiers.length;++f)"none"!==this.tiers[f].loaderButton.style.display&&++a;0==a&&(a=Date.now()|
0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};n.prototype.addInitListener=function(a){this.initListeners.push(a)};n.prototype.addFeatureListener=function(a,f){this.featureListeners.push(a)};n.prototype.removeFeatureListener=function(a,f){var b=arrayIndexOf(this.featureListeners,a);0<=b&&this.featureListeners.splice(b,1)};n.prototype.notifyFeature=function(a,f,b,c){for(var k=0;k<this.featureListeners.length;++k)try{if(this.featureListeners[k](a,f,b,c))break}catch(e){console.log(e.stack)}};
n.prototype.addFeatureHoverListener=function(a,f){this.featureHoverListeners.push(a)};n.prototype.removeFeatureHoverListener=function(a,f){var b=arrayIndexOf(this.featureHoverListeners,a);0<=b&&this.featureHoverListeners.splice(b,1)};n.prototype.notifyFeatureHover=function(a,f,b,c){for(var k=0;k<this.featureHoverListeners.length;++k)try{this.featureHoverListeners[k](a,f,b,c)}catch(e){console.log(e.stack)}};n.prototype.addViewListener=function(a,f){this.viewListeners.push(a)};n.prototype.removeViewListener=
function(a,f){var b=arrayIndexOf(this.viewListeners,a);0<=b&&this.viewListeners.splice(b,1)};n.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),f=this.viewEnd|0;0<this.currentSeqMax&&f>this.currentSeqMax&&(f=this.currentSeqMax);for(var b=0;b<this.viewListeners.length;++b)try{this.viewListeners[b](this.chr,a,f,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},
this.viewStart,this.viewEnd)}catch(c){console.log(c.stack)}};n.prototype.addTierListener=function(a){this.tierListeners.push(a)};n.prototype.removeTierListener=function(a){a=arrayIndexOf(this.tierListeners,a);0<=a&&this.tierListeners.splice(a,1)};n.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(f){console.log(f.stack)}};n.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};n.prototype.removeRegionSelectListener=
function(a){a=arrayIndexOf(this.regionSelectListeners,a);0<=a&&this.regionSelectListeners.splice(a,1)};n.prototype.notifyRegionSelect=function(a,f,b){for(var c=0;c<this.regionSelectListeners.length;++c)try{this.regionSelectListeners[c](a,f,b)}catch(k){console.log(k.stack)}};n.prototype.highlightRegion=function(a,f,b){var c=this;if(a==this.chr)return this._highlightRegion(a,f,b);var k=this.getSequenceSource();if(!k)throw"Need a sequence source";k.getSeqInfo(a,function(e){if(e)return c._highlightRegion(a,
f,b);var g;g=0==a.indexOf("chr")?a.substr(3):"chr"+a;k.getSeqInfo(g,function(a){if(a)return c._highlightRegion(g,f,b)})})};n.prototype._highlightRegion=function(a,f,b){for(var c=0;c<this.highlights.length;++c){var k=this.highlights[c];if(k.chr==a&&k.min==f&&k.max==b)return}this.highlights.push(new q(a,f,b));c=this.viewStart-1E3/this.scale;k=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&f<k&&b>c&&this.drawOverlays();this.notifyLocation()};n.prototype.clearHighlights=function(){this.highlights=
[];this.drawOverlays();this.notifyLocation()};n.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};n.prototype.featuresInRegion=function(a,f,b){var c=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var k=this.tiers[a].currentFeatures||[],e=0;e<k.length;++e){var g=k[e];g.min<=b&&g.max>=f&&c.push(g)}return c};n.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};n.prototype.setSelectedTier=
function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};n.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var f=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?f.classList.add("active"):f.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};n.prototype.addTierSelectionListener=
function(a){this.tierSelectionListeners.push(a)};n.prototype.removeTierSelectionListener=function(a){a=arrayIndexOf(this.tierSelectionListeners,a);0<=a&&this.tierSelectionListeners.splice(a,1)};n.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(f){console.log(f.stack)}};n.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};n.prototype.removeTierSelectionWrapListener=
function(a){a=arrayIndexOf(this.tierSelectionWrapListeners,a);0<=a&&this.tierSelectionWrapListeners.splice(a,1)};n.prototype.notifyTierSelectionWrap=function(a){for(var f=0;f<this.tierSelectionWrapListeners.length;++f)try{this.tierSelectionWrapListeners[f](a)}catch(b){console.log(b.stack)}};n.prototype.positionRuler=function(){var a="none",f="",b="";"center"==this.rulerLocation?(a="block",f=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",f="0px"):"right"==this.rulerLocation?
(a="block",b="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=f;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/
2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var c=0;c<this.tiers.length;++c){var k=this.tiers[c],e=k.quantOverlay,g;k.subtiers&&0<k.subtiers.length&&(g=k.subtiers[0].quant);e&&(e.style.display=g?a:"none",e.style.left=f,e.style.right=b)}};n.prototype.featureDoubleClick=
function(a,f,b){if(a&&0!=a.length&&(b=a[a.length-1],b.min&&b.max)){var c=((b.min|0)-(this.viewStart|0))*this.scale,k=(b.max-b.min+1)*this.scale;a=((b.min|0)+(b.max|0))/2;10<k&&(f=1*(f-c)/k,0.3>f?a=b.min|0:0.7<f&&(a=(b.max|0)+1));f=this.viewEnd-this.viewStart;this.setLocation(null,a-f/2,a+f/2)}};n.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};n.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};n.prototype.updateHeight=function(){for(var a=
0,f=0;f<this.tiers.length;++f)a+=this.tiers[f].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="-webkit-flex";this.browserHolder.style.display="flex"};n.prototype.scrollArrowKey=function(a,f){this.reverseKeyScrolling&&(f=-f);if(a.ctrlKey||a.metaKey){var b=!1;a.shiftKey&&(b=!0);this.leap(f,b)}else if(1<this.scale){var b=(this.viewStart+this.viewEnd)/2,b=b-Math.round(b),c=1;a.shiftKey&&(c*=
10);0<f?(c=-c-b,0<b&&(c+=1)):(c-=b,0>b&&(c-=1));this.setLocation(null,this.viewStart+c,this.viewEnd+c)}else this.move(a.shiftKey?100*f:25*f)};n.prototype.leap=function(a,f){var b=this,c=(b.viewStart+b.viewEnd+1)/2|0;0<a&&1>=b.viewStart?c-=1E8:0>a&&b.viewEnd>=b.currentSeqMax&&(c+=1E8);var k=b.getSelectedTier();0>k||((k=b.tiers[k])&&(k.featureSource&&this.sourceAdapterIsCapable(k.featureSource,"quantLeap")&&"number"==typeof k.quantLeapThreshold||k.featureSource&&this.sourceAdapterIsCapable(k.featureSource,
"leap"))?k.findNextFeature(b.chr,c,-a,f,function(k){if(k){var e=k.min,g=k.max;f&&(0<a?e>c+1?g=e:(g++,e=g):g<c-1?(g++,e=g):g=e);var r=b.viewEnd-b.viewStart+1;parseFloat(r/2)==parseInt(r/2)&&r--;e=(e+g-r)/2+1;b.setLocation(k.segment,e,e+r-1)}else alert("no next feature")}):this.move(100*a))};n.prototype.nameForCoordSystem=function(a){var f=null,b=null;this.assemblyNamePrimary&&(f=""+a.auth,"undefined"!==typeof a.version&&(f+=a.version));this.assemblyNameUcsc&&(b=a.ucscName);return null!=f&&null!=b?
f+"/"+b:f||b||"unknown"};n.prototype.makeLoader=function(f){var b=1<window.devicePixelRatio;return 20>(f||16)?a("img",null,{src:this.resolveURL("$$img/spinner_"+(b?16:32)+".gif"),width:"16",height:"16"}):a("img",null,{src:this.resolveURL("$$img/spinner_"+(b?24:48)+".gif"),width:"24",height:"24"})};n.prototype.canFetchPlainHTTP=function(){var a=this;if(!this._plainHTTPPromise){var f=this.getWorker();this._plainHTTPPromise=f?new x(function(b,c){f.postCommand({command:"textxhr",uri:a.httpCanaryURL},
function(a,f){a?b(!0):b(!1)})}):new x(function(f,b){p(a.httpCanaryURL,function(a,b){a?f(!0):f(!1)},{timeout:2E3})})}return this._plainHTTPPromise};n.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};t.prototype.postCommand=function(a,f,b){var c="x"+ ++this.tagSeed;a.tag=c;this.callbacks[c]=f;this.worker.postMessage(a,b)};if("undefined"!==
typeof u){u.exports={Browser:n};d("./browser-ui");d("./track-adder");d("./feature-popup");d("./tier-actions");d("./domui");d("./search");u=d("./sourceadapters");var f=u.TwoBitSequenceSource,E=u.DASSequenceSource,C=d("./kspace").KnownSpace,J=d("./das").DASRegistry}B.prototype.get=function(a){var f=this.sourcesByURI[H(a)];if(f)for(var b=0;b<f.configs.length;++b)if(w(f.configs[b],a))return f.sources[b]};B.prototype.put=function(a,f){var b=H(a),c=this.sourcesByURI[b];c||(c={configs:[],sources:[]},this.sourcesByURI[b]=
c);c.configs.push(a);c.sources.push(f)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":26,"./search":30,"./sha1":33,"./sourceadapters":34,"./sourcecompare":35,"./thub":42,"./tier":45,"./tier-actions":43,"./track-adder":46,"./utils":49,"./version":51,"es6-promise":53}],7:[function(d,u,s){function q(a,b,c,g){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=c,this.coords=g):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,
this.coords=e(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new l(this.uri,this.credentials):"alias"==this.type?new B(a):new n(this.uri,this.srcTag,this.destTag)}function n(a,b,e){this.source=new c(a);this.srcTag=b;this.destTag=e}function l(a,b){var c=this;this.uri=a;this.credentials=b;this.bwg=new v(function(a,b){g(new p(c.uri,{credentials:c.credentials}),
function(c,e){c?a(c):b(e)})});this.bwg.then(function(a,b){b&&console.log(b)})}function h(a){return parseInt(a)}function t(a){return 0==a.indexOf("chr")?a.substr(3):a}function z(a){var b={srcChr:t(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:t(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},c=a.srcStarts.split(",").map(h),e=a.destStarts.split(",").map(h);a=a.blockLens.split(",").map(h);for(var g=0;g<c.length;++g)b.blocks.push([c[g],e[g],
a[g]]);return b}function B(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var c=a[b];if(!(2>c.length)){for(var e=[],g=0;g<c.length-1;++g)e.push(c[g]);this.forwardAliases[c[c.length-1]]=e}}}if("undefined"!==typeof d){s=d("./das");var c=s.DASSource,a=s.DASSegment;s=d("./utils");var b=s.pusho,e=s.shallowCopy,m=d("./cigar").parseCigar,p=d("./bin").URLFetchable,g=d("./bigwig").makeBwg,v=d("es6-promise").Promise}q.prototype.exportConfig=function(){return{uri:this.uri,
srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};q.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],e=0;e<c.length;++e){var g=c[e];if(b>=g.srcMin&&b<=g.srcMax){var m;m="-"==g.srcOri?g.srcMax-b:b-g.srcMin;for(var p=g.blocks,w=0;w<p.length;++w){var v=p[w],f=v[0],E=v[1],v=v[2];if(m>=f&&m<=f+v)return c=m-f,{seq:g.destChr,pos:"-"==g.destOri?g.destMax-E-c:c+E+g.destMin,flipped:g.srcOri!=g.destOri}}}}return null};q.prototype.mapSegment=
function(a,b,c){a=this.chainsBySrc[a]||[];for(var e=[],g=0;g<a.length;++g){var m=a[g];if(c>=m.srcMin&&b<=m.srcMax){var p,w;"-"==m.srcOri?(p=m.srcMax-c,w=m.srcMax-b):(p=b-m.srcMin,w=c-m.srcMin);for(var v=m.blocks,f=0;f<v.length;++f){var E=v[f],C=E[0],l=E[1],E=E[2];if(w>=C&&p<=C+E){var t={segment:m.destChr,flipped:"-"==m.srcOri^"-"==m.destOri};"-"==m.destOri?(p>=C?t.max=m.destMax-l-p+C:(t.max=m.destMax-l,t.partialMax=C-p),w<=C+E?t.min=m.destMax-l-w+C:(t.min=m.destMax-l-E,t.partialMin=w-C-E)):(p>=C?
t.min=m.destMin+l+p-C:(t.min=m.destMin+l,t.partialMin=C-p),w<=C+E?t.max=m.destMin+l+w-C:(t.max=m.destMin+l+E,t.partialMax=w-C-E));e.push(t)}}}}return e};q.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],e=0;e<c.length;++e){var g=c[e];if(b>=g.destMin&&b<=g.destMax){var m;m="-"==g.srcOri?g.destMax-b:b-g.destMin;for(var p=g.blocks,w=0;w<p.length;++w){var v=p[w],f=v[0],E=v[1],v=v[2];if(m>=E&&m<=E+v)return c=m-E,e=c+f+g.srcMin,e="-"==g.destOri?g.srcMax-f-c:c+f+g.srcMin,{seq:g.srcChr,
pos:e,flipped:g.srcOri!=g.destOri}}}}return null};q.prototype.sourceBlocksForRange=function(c,e,g,m){for(var p=this,v=e/this.granularity|0,l=g/this.granularity|0,w=!1,t=v;t<=l;++t){var f=c+"_"+t;2!=this.fetchedTiles[f]&&(w=!0,1!=this.fetchedTiles[f]&&(this.fetchedTiles[f]=1))}if(w)this.postFetchQueues[c]||this.chainFetcher.fetchChains(c,v*this.granularity,(l+1)*this.granularity-1).then(function(a){p.chainsByDest||(p.chainsByDest[c]=[]);for(var f=0;f<a.length;++f){var b=a[f],k=p.chainsBySrc[b.srcChr];
if(k){for(var e=!1,g=0;g<k.length;++g){var m=k[g];if(m.srcMin==b.srcMin&&m.srcMax==b.srcMax){e=!0;break}}e||k.push(b)}else p.chainsBySrc[b.srcChr]=[b];if(k=p.chainsByDest[b.destChr]){e=!1;for(g=0;g<k.length;++g)if(m=k[g],m.destMin==b.destMin&&m.destMax==b.destMax){e=!0;break}e||k.push(b)}else p.chainsByDest[b.destChr]=[b]}for(a=v;a<=l;++a)p.fetchedTiles[c+"_"+a]=2;if(p.postFetchQueues[c]){a=p.postFetchQueues[c];for(f=0;f<a.length;++f)a[f]();p.postFetchQueues[c]=null}}).catch(function(a){console.log(a)}),
b(this.postFetchQueues,c,function(){p.sourceBlocksForRange(c,e,g,m)});else{w=[];t=this.chainsByDest[c]||[];for(f=0;f<t.length;++f){var E=t[f];if(e<=E.destMax&&g>=E.destMin){var C,h;"-"==E.srcOri?(C=E.destMax-g,h=E.destMax-e):(C=e-E.destMin,h=g-E.destMin);for(var d=E.blocks,n=0;n<d.length;++n){var y=d[n],q=y[0],k=y[1],I=y[2];h>=k&&C<=k+I&&(y=Math.max(C,k)-k,k=Math.min(h,k+I)-k,"-"==E.destOri?w.push(new a(E.srcChr,E.srcMax-q-k,E.srcMax-q-y)):w.push(new a(E.srcChr,E.srcMin+y+q,E.srcMin+k+q)))}}}m(w)}};
n.prototype.fetchChains=function(a,b,c){var e=this;return new v(function(b,c){e.source.alignments(a,{},function(a){for(var c=[],g=0;g<a.length;++g)for(var f=a[g],p=0;p<f.blocks.length;++p){for(var r=f.blocks[p],v,l,t=0;t<r.segments.length;++t){var h=r.segments[t],d=f.objects[h.object];d.dbSource===e.srcTag?v=h:d.dbSource===e.destTag&&(l=h)}if(v&&l){for(var r={srcChr:f.objects[v.object].accession,srcMin:v.min|0,srcMax:v.max|0,srcOri:v.strand,destChr:f.objects[l.object].accession,destMin:l.min|0,destMax:l.max|
0,destOri:l.strand,blocks:[]},t=m(v.cigar),h=m(l.cigar),k=d=0,I=0,x=0;I<t.length&&x<h.length;)if("M"==t[I].op&&"M"==h[x].op){var n=Math.min(t[I].cnt,h[x].cnt);r.blocks.push([d,k,n]);t[I].cnt==n?++I:t[I].cnt-=n;h[x].cnt==n?++x:h[x]-=n;d+=n;k+=n}else"I"==t[I].op?k+=t[I++].cnt:"I"==h[x].op&&(d+=h[x++].cnt);c.push(r)}}b(c)})})};l.prototype.fetchChains=function(a,b,c){return this.bwg.then(function(e,g){if(!e)throw Error("No BWG");return new v(function(g,m){e.getUnzoomedView().readWigData(a,b,c,function(a){g(a.map(z))})})})};
B.prototype.fetchChains=function(a,b,c){b=[];c=this.forwardAliases[a]||[];for(var e=0;e<c.length;++e)b.push({srcChr:c[e],srcMin:1,srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return v.resolve(b)};"undefined"!==typeof u&&(u.exports={Chainset:q})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":49,"es6-promise":53}],8:[function(d,u,s){function q(l){for(var h=[],t;null!=(t=n.exec(l));){var d=t[1];0==d.length&&(d=1);h.push({cnt:d|0,op:t[2]})}return h}
var n=/([0-9]*)([MIDS])/g;"undefined"!==typeof u&&(u.exports={parseCigar:q})},{}],9:[function(d,u,s){function q(a,b,c,m){this.red=a|0;this.green=b|0;this.blue=c|0;m&&(this.name=m)}function n(a){a="00"+a.toString(16);return a.substring(a.length-2)}function l(a){var b=z[a];b||((b=B.exec(a))?b=new q("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(b=c.exec(a))?b=new q(b[1]|0,b[2]|0,b[3]|0,a):(console.log("couldn't handle color: "+a),b=z.black),z[a]=b);return b}function h(a,b,c){for(var m=[],p=0;p<c.length;++p)m.push(l(c[p]));
c=[];p=0;a:for(;p<a;++p){for(var g=b[0]+1*p/(a-1)*(b[b.length-1]-b[0]),v=0;v<b.length-1;++v)if(g>=b[v]&&g<=b[v+1]){var g=(g-b[v])/(b[v+1]-b[v]),r=m[v],v=m[v+1],v=(new q(r.red*(1-g)+v.red*g|0,r.green*(1-g)+v.green*g|0,r.blue*(1-g)+v.blue*g|0)).toSvgString();c.push(v);continue a}throw"Bad step";}return c}function t(a,b,c,m){return m?h(a,[0,0.5,1],[b,c,m]):h(a,[0,1],[b,c])}q.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};q.prototype.toHexString=
function(){return"#"+n(this.red)+n(this.green)+n(this.blue)};var z={red:new q(255,0,0,"red"),green:new q(0,255,0,"green"),blue:new q(0,0,255,"blue"),yellow:new q(255,255,0,"yellow"),white:new q(255,255,255,"white"),black:new q(0,0,0,"black"),gray:new q(180,180,180,"gray"),grey:new q(180,180,180,"grey"),lightskyblue:new q(135,206,250,"lightskyblue"),lightsalmon:new q(255,160,122,"lightsalmon"),hotpink:new q(255,105,180,"hotpink")},B=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,c=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;
"undefined"!==typeof u&&(u.exports={makeColourSteps:h,makeGradient:t,dasColourForName:l})},{}],10:[function(d,u,s){function q(a,b,f,c){this.name=a;this.start=b;this.end=f;this.description=c}function n(a,b){var f;"string"==typeof a?(this.uri=a,f=b||{}):f=a||{};for(var c in f)"function"!=typeof f[c]&&(this[c]=f[c]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function l(){}function h(a,b){return a.taxon==
b.taxon&&a.auth==b.auth&&a.version==b.version}function t(a,b,f,c,e){this.name=a;this.start=b;this.end=f;this.alphabet=c;this.seq=e}function z(){}function B(a){a&&(this.id=a)}function c(a,b){this.desc=a;this.uri=b}function a(a){this.type=a;this.objects={};this.blocks=[]}function b(){this.styles=[]}function e(){}function m(a,b){b=b||{};this.uri=a;this.opts=b}function p(a,b){var f=a.getElementsByTagName(b);if(0<f.length&&f[0].firstChild){f=f[0];if(1==f.childNodes.length)return f.firstChild.nodeValue;
for(var c="",e=0;e<f.childNodes.length;++e)c+=f.childNodes[e].nodeValue;return c}return null}function g(a){for(var b=[],f=a.getElementsByTagName("LINK"),e=0;e<f.length;++e){var g=f[e];g.parentNode==a&&b.push(new c(g.firstChild?g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return b}function v(a){var b=[];a=a.getElementsByTagName("NOTE");for(var f=0;f<a.length;++f)a[f].firstChild&&b.push(a[f].firstChild.nodeValue);return b}function r(a,b,f,c){if(window.XDomainRequest){var e=new XDomainRequest;
e.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(e.responseText);b(a)};e.open("get",a);e.send("")}else try{var e=new XMLHttpRequest,g=setTimeout(function(){console.log("timing out "+a);e.abort();b(null,e)},5E3);e.ontimeout=function(){console.log("timeout on "+a)};e.onreadystatechange=function(){4==e.readyState&&(clearTimeout(g),(200<=e.status||0==e.status)&&b(e.responseXML,e))};e.open("get",a,!0);e.timeout=5E3;f&&(e.withCredentials=!0);c&&e.setRequestHeader("X-DAS-Authorisation",
c);e.overrideMimeType("text/xml");e.setRequestHeader("Accept","application/xml,*/*");e.send("")}catch(m){b(null,e,m)}}function O(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function Q(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function P(a){var b=K(a);b.styles=[];for(var f=0;f<a.styles.length;++f){var c=b.styles[f]=K(a.styles[f]);c._methodRE=c._labelRE=c._typeRE=void 0;c.style=K(c.style);c.style.id=void 0;c.style._gradient=void 0}return b}if("undefined"!==typeof d){s=
d("./utils");var K=s.shallowCopy,x=s.pusho,F=d("./color").makeColourSteps}q.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};q.prototype.isBounded=function(){return this.start&&this.end};q.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};n.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var f=[];b=b.getElementsByTagName("SEGMENT");
for(var c=0;c<b.length;++c){var e=b[c],g=e.getAttribute("id"),m=e.getAttribute("size"),p;m?(p=1,m|=0):((p=e.getAttribute("start"))&&(p|=0),(m=e.getAttribute("stop"))&&(m|=0));var r=null;e.firstChild&&(r=e.firstChild.nodeValue);f.push(new q(g,p,m,r))}a(f)})};n.prototype.sequence=function(a,b){var f=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(f,function(a){if(a){var f=[];a=a.getElementsByTagName("SEQUENCE");for(var c=0;c<a.length;++c){var e=a[c],g=e.getAttribute("id"),m=e.getAttribute("start"),
p=e.getAttribute("stop"),k=null;if(e.firstChild)for(var e=e.firstChild.nodeValue,k="",r=0;;){var v=e.indexOf("\n",r);if(0<=v)k+=e.substring(r,v).toUpperCase(),r=v+1;else{k+=e.substring(r).toUpperCase();break}}f.push(new t(g,m,p,"DNA",k))}b(f)}else b([])})};n.prototype.features=function(a,b,f){b=b||{};var c;if(this.features_uri)c=this.features_uri;else{var e=[];if(a)e.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)e.push("group_id="+a);else for(var m=0;m<a.length;++m)e.push("group_id="+
a[m]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),m=0;m<a.length;++m)e.push("adjacent="+a[m]);if(b.type)if("string"==typeof b.type)e.push("type="+b.type);else for(a=0;a<b.type.length;++a)e.push("type="+b.type[a]);b.maxbins&&e.push("maxbins="+b.maxbins);0<e.length?c=this.dasBaseURI+"features?"+e.join(";"):f([],"No filters specified")}this.doCrossDomainRequest(c,function(a,b){if(a){for(var c=[],e={},k=a.getElementsByTagName("SEGMENT"),m=0;m<k.length;++m){var r=k[m],E=r.getAttribute("id");
e[E]={min:r.getAttribute("start"),max:r.getAttribute("stop")};for(var r=r.getElementsByTagName("FEATURE"),t=0;t<r.length;++t){var l=r[t],h=new z;h.segment=E;h.id=l.getAttribute("id");h.label=l.getAttribute("label");var d=p(l,"START"),C=p(l,"END");(d|0)>(C|0)?(h.min=C|0,h.max=d|0):(h.min=d|0,h.max=C|0);d=l.getElementsByTagName("TYPE");0<d.length&&(d=d[0],d.firstChild&&(h.type=d.firstChild.nodeValue),h.typeId=d.getAttribute("id"),h.typeCv=d.getAttribute("cvId"));h.type=p(l,"TYPE");!h.type&&h.typeId&&
(h.type=h.typeId);h.method=p(l,"METHOD");(d=p(l,"ORIENTATION"))||(d="0");h.orientation=d;h.score=p(l,"SCORE");h.links=g(l);h.notes=v(l);d=l.getElementsByTagName("GROUP");for(C=0;C<d.length;++C){var x=d[C],w=new B;w.type=x.getAttribute("type");w.id=x.getAttribute("id");w.links=g(x);w.notes=v(x);h.groups?h.groups.push(w):h.groups=Array(w)}if(h.notes)for(d=0;d<h.notes.length;++d)C=h.notes[d],0==C.indexOf("Genename=")&&(x=new B,x.type="gene",x.id=C.substring(9),h.groups?h.groups.push(x):h.groups=Array(x));
d=l.getElementsByTagName("PART");if(0<d.length){x=[];for(C=0;C<d.length;++C)x.push(d[C].getAttribute("id"));h.parts=x}d=l.getElementsByTagName("PARENT");if(0<d.length){l=[];for(C=0;C<d.length;++C)l.push(d[C].getAttribute("id"));h.parents=l}c.push(h)}}f(c,void 0,e)}else f([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){f([],a)})};n.prototype.alignments=function(b,c,f){var e=this.dasBaseURI+"alignment?query="+b;this.doCrossDomainRequest(e,function(b){if(b){var c=
[];b=b.getElementsByTagName("alignment");for(var g=0;g<b.length;++g){for(var m=b[g],r=new a(m.getAttribute("alignType")),v=m.getElementsByTagName("alignObject"),k=0;k<v.length;++k){var l=v[k],l={id:l.getAttribute("intObjectId"),accession:l.getAttribute("dbAccessionId"),version:l.getAttribute("objectVersion"),dbSource:l.getAttribute("dbSource"),dbVersion:l.getAttribute("dbVersion")};r.objects[l.id]=l}m=m.getElementsByTagName("block");for(v=0;v<m.length;++v){for(var l=m[v],k={order:l.getAttribute("blockOrder"),
segments:[]},l=l.getElementsByTagName("segment"),h=0;h<l.length;++h){var t=l[h],t={object:t.getAttribute("intObjectId"),min:t.getAttribute("start"),max:t.getAttribute("end"),strand:t.getAttribute("strand"),cigar:p(t,"cigar")};k.segments.push(t)}r.blocks.push(k)}c.push(r)}f(c)}else f([],"Failed request "+e)})};b.prototype.pushStyle=function(a,b,f){a||(a={type:"default"});a=K(a);b&&(a.zoom=b);a.style=f;this.styles.push(a)};n.prototype.stylesheet=function(a,c){var f,g=this.credentials;this.stylesheet_uri?
(f=this.stylesheet_uri,g=!1):f=this.dasBaseURI+"stylesheet";r(f,function(f){if(f){var g=new b;f=f.getElementsByTagName("TYPE");for(var m=0;m<f.length;++m){var p=f[m],r={};r.type=p.getAttribute("id");r.label=p.getAttribute("label");r.method=p.getAttribute("method");for(var p=p.getElementsByTagName("GLYPH"),l=0;l<p.length;++l){var k=p[l],v=k.getAttribute("zoom"),h;a:{if(k.hasChildNodes()){k=k.firstChild;do{if(k.nodeType==Node.ELEMENT_NODE){h=k;break a}k=k.nextSibling}while(null!=k)}h=null}k=new e;k.glyph=
h.localName;for(h=h.firstChild;h;){if(h.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==h.localName){var t=k,d=h.localName,E,x=h;E=(E=x.getAttribute("steps"))?E|0:50;for(var n=[],q=[],x=x.getElementsByTagName("STOP"),B=0;B<x.length;++B){var O=x[B];n.push(1*O.getAttribute("score"));q.push(O.firstChild.nodeValue)}E=F(E,n,q);t[d]=E}else k[h.localName]=h.firstChild.nodeValue;h=h.nextSibling}g.pushStyle(r,v,k)}}a(g)}else c&&c()},g)};m.prototype.sources=function(a,b,f){f||(f={});var c=[];f.taxon&&c.push("organism="+
f.taxon);f.auth&&c.push("authority="+f.auth);f.version&&c.push("version="+f.version);f=this.uri;0<c.length&&(f=f+"?"+c.join("&"));r(f,function(f){if(!f&&b)b();else{var c=[];f=f.getElementsByTagName("SOURCE");for(var e=0;e<f.length;++e){var g=f[e],m=g.getElementsByTagName("VERSION");if(!(1>m.length)){for(var p=m[0],k=p.getElementsByTagName("COORDINATES"),m=[],r=0;r<k.length;++r){var h=k[r],v=new l;v.auth=h.getAttribute("authority");v.taxon=h.getAttribute("taxid");v.version=h.getAttribute("version");
m.push(v)}for(var k=[],h=p.getElementsByTagName("CAPABILITY"),t,r=0;r<h.length;++r)v=h[r],k.push(v.getAttribute("type")),"das1:features"==v.getAttribute("type")&&(t=v.getAttribute("query_uri"),t=t.substring(0,t.length-8));r={};p=p.getElementsByTagName("PROP");for(h=0;h<p.length;++h)x(r,p[h].getAttribute("name"),p[h].getAttribute("value"));t&&(g=new n(t,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),desc:g.getAttribute("description"),coords:m,props:r,capabilities:k}),c.push(g))}}a(c)}})};
n.prototype.doCrossDomainRequest=function(a,b,f){var c;this.xUser&&(c="Basic "+btoa(this.xUser+":"+this.xPass));try{return r(a,b,this.credentials,c)}catch(e){if(f)f(e);else throw e;}};"undefined"!==typeof u&&(u.exports={DASGroup:B,DASFeature:z,DASStylesheet:b,DASStyle:e,DASSource:n,DASSegment:q,DASRegistry:m,DASSequence:t,DASLink:c,isDasBooleanTrue:O,isDasBooleanNotFalse:Q,copyStylesheet:P,coordsMatch:h})},{"./color":9,"./utils":49}],11:[function(d,u,s){function q(h,d,n){function c(){n?(a.className=
"fa fa-caret-down",d.style.display="table"):(a.className="fa fa-caret-right",d.style.display="none")}var a=l("i");c();a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();n=!n;c()},!1);h=l("h6",[a," ",h],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return l("div",[h,d],{})}if("undefined"!==typeof d){var n=d("./cbrowser").Browser;d=d("./utils");var l=d.makeElement,h=d.removeChildren}n.prototype.removeAllPopups=function(){h(this.hPopupHolder);
h(this.popupHolder)};n.prototype.makeTooltip=function(h,d){var n=!1,c=this,a=null,b;b=function(c){n=!1;a&&(clearTimeout(a),a=null);h.removeEventListener("mouseout",b,!1)};var e=function(b){var p=b.clientX+window.scrollX,g=b.clientY+window.scrollY;a||(a=setTimeout(function(){var b;b="function"===typeof d?d():d;var m=l("div",[l("div",null,{className:"tooltip-arrow"}),l("div",b,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(g+20)+"px",left:""+Math.max(p-30,20)+
"px"});c.hPopupHolder.appendChild(m);var q;q=function(a){try{c.hPopupHolder.removeChild(m)}catch(b){}window.removeEventListener("mousemove",q,!1);n&&null!=h.offsetParent&&e(a)};window.addEventListener("mousemove",q,!1);a=null},1E3))};h.addEventListener("mouseover",function(a){n=!0;h.addEventListener("mouseout",b,!1);e(a)},!1);h.addEventListener("DOMNodeRemovedFromDocument",function(b){n=!1;a&&(clearTimeout(a),a=null)},!1)};n.prototype.popit=function(h,d,n,c){var a=this;c||(c={});h||(h={});var b=c.width||
200,e;h.clientX?(c=h.clientX,e=h.clientY):(c=500,e=50);c+=document.documentElement.scrollLeft||document.body.scrollLeft;e+=document.documentElement.scrollTop||document.body.scrollTop;var m=window.innerWidth,p=e,g=Math.min(c-b/2-4,m-b-30),v=l("div");v.className="popover fade "+(h.clientX?"bottom ":"")+"in";v.style.display="block";v.style.position="absolute";v.style.top=""+p+"px";v.style.left=""+g+"px";v.style.width=b+"px";276<b&&(v.style.maxWidth=b+"px");v.appendChild(l("div",null,{className:"arrow"}));
if(d){var r=l("button","",{className:"close"});r.innerHTML="&times;";r.addEventListener("mouseover",function(a){r.style.color="red"},!1);r.addEventListener("mouseout",function(a){r.style.color="black"},!1);r.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();a.removeAllPopups()},!1);h=l("h4",[l("span",d,null,{maxWidth:"200px"}),r],{},{paddingLeft:"10px",paddingRight:"10px"});var q,Q,P,K;P=function(a){a.stopPropagation();a.preventDefault();g+=a.clientX-q;8>g&&(g=8);g>m-b-32&&
(g=m-b-26);p+=a.clientY-Q;p=Math.max(10,p);v.style.top=""+p+"px";v.style.left=""+Math.min(g,m-b-10)+"px";q=a.clientX;Q=a.clientY};K=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",P,!1);window.removeEventListener("mouseup",K,!1)};h.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();q=a.clientX;Q=a.clientY;window.addEventListener("mousemove",P,!1);window.addEventListener("mouseup",K,!1)},!1);v.appendChild(h)}v.appendChild(l("div",
n,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(v);var x={node:v,displayed:!0};v.addEventListener("DOMNodeRemoved",function(a){a.target==v&&(x.displayed=!1)},!1);return x};"undefined"!==typeof u&&(u.exports={makeTreeTableSection:q})},{"./cbrowser":6,"./utils":49}],12:[function(d,u,s){function q(l,d){0>l.indexOf("?")&&(l+="?soft=true");return new h(function(h,c){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(300<=a.status)c("Error code "+
a.status);else{var b=JSON.parse(a.response);h(d?b:b.location)}};a.open("GET",l,!0);a.setRequestHeader("Accept","application/json");a.responseType="text";a.send("")})}function n(h){this.rawurl=h}function l(h,l,d,c){c||("object"===typeof l?(c=l,l=void 0):c={});this.url="string"===typeof h?new n(h):h;this.start=l||0;d&&(this.end=d);this.opts=c}if("undefined"!==typeof d)var h=d("es6-promise").Promise;n.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=
q(this.rawurl,!0).then(function(h){return h.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};l.prototype.slice=function(h,d){if(0>h)throw"Bad slice "+h;var n=this.start,c=this.end,n=n&&h?n+h:h||n;return new l(this.url,n,d&&n?n+d-1:c||d-1,this.opts)};l.prototype.fetchAsText=function(h){var l=this,d=new XMLHttpRequest;l.url.getURLPromise().then(function(c){d.open("GET",c,!0);if(l.end){if(1E8<l.end-l.start)throw"Monster fetch!";d.setRequestHeader("Range","bytes="+l.start+
"-"+l.end)}d.onreadystatechange=function(){if(4==d.readyState)return 200==d.status||206==d.status?h(d.responseText):h(null)};l.opts.credentials&&(d.withCredentials=!0);d.send("")}).catch(function(c){console.log(c);return h(null)})};l.prototype.salted=function(){return this};l.prototype.fetch=function(h,l,d){var c=this;l=l||1;if(3<l)return h(null);c.url.getURLPromise().then(function(a){var b=new XMLHttpRequest,e;b.open("GET",a,!0);b.overrideMimeType("text/plain; charset=x-user-defined");if(c.end){if(1E8<
c.end-c.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+c.start+"-"+c.end);e=c.end-c.start+1}b.responseType="arraybuffer";b.onreadystatechange=function(){if(4==b.readyState){if(200==b.status||206==b.status){if(b.response){var a=b.response.byteLength;return!e||e==a||d&&a==d?h(b.response):c.fetch(h,l+1,a)}if(b.mozResponseArrayBuffer)return h(b.mozResponseArrayBuffer);a=b.responseText;if(!e||e==a.length||d&&a.length==d){if(a=b.responseText){for(var p=new Uint8Array(a.length),g=0;g<p.length;++g)p[g]=
a.charCodeAt(g);a=p.buffer}else a=null;return h(a)}return c.fetch(h,l+1,a.length)}return c.fetch(h,l+1)}};c.opts.credentials&&(b.withCredentials=!0);b.send("")}).catch(function(a){console.log(a)})};"undefined"!==typeof u&&(u.exports={lookupEncodeURI:q,EncodeFetchable:l})},{"es6-promise":53}],13:[function(d,u,s){function q(c){l.call(this);this.source=c;this.base=c.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var a=window.location.protocol;"http:"!=a&&"https:"!=a&&(this.base="http:"+this.base)}this.species=
c.species||"human";this.type="string"===typeof c.type?[c.type]:c.type||["regulatory"]}if("undefined"!==typeof d){u=d("./sourceadapters");var n=u.registerSourceAdapterFactory,l=u.FeatureSourceBase;d=d("./das");var h=d.DASStylesheet,t=d.DASStyle,z=d.DASFeature,B=d.DASGroup}q.prototype=Object.create(l.prototype);q.prototype.constructor=q;q.prototype.getStyleSheet=function(c){var a=new h,b=new t;b.glyph="__NONE";0<=this.type.indexOf("exon")&&a.pushStyle({type:"transcript"},null,b);(0<=this.type.indexOf("exon")||
0<=this.type.indexOf("transcript"))&&a.pushStyle({type:"gene"},null,b);b=new t;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=10;a.pushStyle({type:"cds"},null,b);b=new t;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:".+_UTR_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"missense_variant"},null,b);b=new t;b.glyph=
"TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"splice_.+_variant"},null,b);b=new t;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"regulatory_region_variant"},null,b);b=new t;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="rgb(50,80,255)";b.STROKECOLOR="black";a.pushStyle({type:"variation"},null,b);b=new t;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR=
"red";a.pushStyle({type:"indel",method:".+_UTR_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"missense_variant"},null,b);b=new t;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"splice_.+_variant"},null,b);b=new t;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",
method:"regulatory_region_variant"},null,b);b=new t;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";b.STROKECOLOR="black";a.pushStyle({type:"indel"},null,b);b=new t;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="orange";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;a.pushStyle({type:"default"},null,b);return c(a)};q.prototype.getScales=function(){return[]};q.prototype.fetch=function(c,a,b,e,m,p,g){var h=this;a=this.base+"/overlap/region/"+this.species+"/"+c+":"+a+"-"+b;
b=[];for(e=0;e<this.type.length;++e)b.push("feature="+this.type[e]);b.push("content-type=application/json");a=a+"?"+b.join(";");var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(h.busy--,h.notifyActivity(),300<=r.status){var a="Error code "+r.status;try{var b=JSON.parse(r.response);b.error&&(a=b.error)}catch(e){}g(a,null)}else{for(var a=JSON.parse(r.response),b=[],m=0;m<a.length;++m){var p=a[m],l=[],d=new z;d.segment=c;d.min=p.start|0;d.max=p.end|0;d.type=p.feature_type||
"unknown";d.id=p.ID;if(p.Parent){var t=new B;t.id=p.Parent;d.groups=[t]}p.strand&&(0>p.strand?d.orientation="-":0<p.strand&&(d.orientation="+"));p.consequence_type&&(d.method=p.consequence_type);p.alt_alleles&&(l.push("Alleles="+p.alt_alleles.join("/")),1<p.alt_alleles.length&&(p.alt_alleles[1].length!=p.alt_alleles[0].length||"-"==p.alt_alleles[1])&&(d.type="indel"));0<l.length&&(d.notes=l);b.push(d)}g(null,b)}};h.busy++;h.notifyActivity();r.open("GET",a,!0);r.responseType="text";r.send("")};n("ensembl",
function(c){return{features:new q(c)}})},{"./das":10,"./sourceadapters":34}],14:[function(d,u,s){if("undefined"!==typeof d)var q=d("./cbrowser").Browser,n=d("./utils").shallowCopy,l=d("./sha1").hex_sha1,h=d("./das").copyStylesheet;q.prototype.exportFullConfig=function(h){h={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+l(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(h.prefix=this.prefix);
return h};q.prototype.exportChains=function(){var h={},l=this.chains||{},d;for(d in l)h[d]=l[d].exportConfig();return h};q.prototype.exportSourceConfig=function(l){l=[];for(var d=0;d<this.tiers.length;++d){var q=this.tiers[d],c=n(q.dasSource);c.noPersist||(c.coords=void 0,c.props=void 0,c.disabled||(c.disabled=void 0),q.config.stylesheet?(c.style=h(q.config.stylesheet).styles,c.stylesheet_uri=void 0):c.style&&(c.style=h({styles:c.style}).styles),"string"===typeof q.config.name&&(c.name=q.config.name),
void 0!==q.config.height&&(c.forceHeight=q.config.height),void 0!==q.config.forceMin&&(c.forceMin=q.config.forceMin),q.config.forceMinDynamic&&(c.forceMinDynamic=q.config.forceMinDynamic),void 0!==q.config.forceMax&&(c.forceMax=q.config.forceMax),void 0!==q.config.bumped&&(c.bumped=q.config.bumped),q.config.forceMaxDynamic&&(c.forceMaxDynamic=q.config.forceMaxDynamic),l.push(c))}return l};q.prototype.exportPageTemplate=function(h){h=h||{};return'<html>\n  <head>\n    <script language="javascript" src="'+
this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(h),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":49}],15:[function(d,u,s){if("undefined"!==typeof d)var q=d("./cbrowser").Browser,n=d("./glyphs").OverlayLabelCanvas,l=d("./numformats").formatQuantLabel,
h=d("./sequence-draw").drawSeqTierGC;q.prototype.exportImage=function(d){d=d||{};for(var q=this.featurePanelWidth,B=0,c=0;c<this.tiers.length;++c){0<c&&(B+=3);var a=this.tiers[c];void 0!==a.layoutHeight&&(B+=a.layoutHeight)}var b=d.resolutionMultiplier||1,c=(q+200)*b|0,a=B*b|0,B=makeElement("canvas",null,{width:c,height:a}),e=B.getContext("2d");e.fillStyle="white";e.fillRect(0,0,c,a);e.scale(b,b);for(c=b=0;c<this.tiers.length;++c){var a=this.tiers[c],m=(a.glyphCacheOrigin-this.viewStart)*this.scale,
p=new n;e.save();e.translate(0,b);e.save();e.beginPath();e.moveTo(200,0);e.lineTo(200+q,0);e.lineTo(200+q,a.layoutHeight);e.lineTo(200,a.layoutHeight);e.closePath();e.clip();e.translate(200,0);e.save();e.translate(m,0);a.subtiers?a.paintToContext(e,p,m+1E3):h(a,a.currentSequence,e);e.restore();e.save();e.translate(m,0);p.draw(e,-m,q-m);e.restore();e.restore();for(var p=!1,g=0,v=a.subtiers||[],r=0;r<v.length;++r){var O=v[r];if(O.quant){var p=!0,Q=O.quant,P=O.height,K=2;40<P&&(K=1+(P/20|0));var P=P/
(K-1),x=(Q.max-Q.min)/(K-1);e.beginPath();e.moveTo(205,g);e.lineTo(200,g);e.lineTo(200,g+O.height);e.lineTo(205,g+O.height);for(var F=1;F<K-1;++F){var w=F*P;e.moveTo(200,g+w);e.lineTo(203,g+w)}e.strokeStyle="black";e.strokeWidth=2;e.stroke();e.fillStyle="black";var F=l(Q.max),s=g+7;e.fillText(F,197-e.measureText(F).width,s);F=l(Q.min);s=g+O.height;e.fillText(F,197-e.measureText(F).width,s);for(F=1;F<K-1;++F)w=F*P,s=l(1*Q.max-F*x),w=g+w+3,e.fillText(s,197-e.measureText(s).width,w)}g+=O.height+3}g=
"string"===typeof a.config.name?a.config.name:a.dasSource.name;v=e.measureText(g).width;e.fillStyle="black";e.fillText(g,200-(p?22:12)-v,(a.layoutHeight+6)/2);e.restore();b+=a.layoutHeight+3}if(d.highlights){e.save();e.beginPath();e.moveTo(200,0);e.lineTo(200+q,0);e.lineTo(200+q,b);e.lineTo(200,b);e.closePath();e.clip();e.translate(200+m,0);m=q=this.viewStart;c=this.viewEnd;for(a=0;a<this.highlights.length;++a)P=this.highlights[a],(P.chr===this.chr||P.chr==="chr"+this.chr)&&P.min<c&&P.max>m&&(e.globalAlpha=
this.defaultHighlightAlpha,e.fillStyle=this.defaultHighlightFill,e.fillRect((P.min-q)*this.scale,0,(P.max-P.min)*this.scale,b));e.restore()}q=-1;"center"==d.ruler?q=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==d.ruler?q=200:"right"==d.ruler&&(q=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=q&&(e.strokeStyle="blue",e.beginPath(),e.moveTo(q,0),e.lineTo(q,b),e.stroke());return B.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(d,
u,s){if("undefined"!==typeof d){var q=d("./cbrowser").Browser;d=d("./utils");var n=d.makeElement,l=d.removeChildren}q.prototype.openExportPanel=function(){var h=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var d=n("div",null,{className:"export-form"}),q=n("select");q.appendChild(n("option","SVG",{value:"svg"}));q.appendChild(n("option","Image",{value:"png"}));q.appendChild(n("option","Dalliance config",{value:"config"}));q.appendChild(n("option","Dalliance sources",
{value:"sources"}));q.appendChild(n("option","Dalliance page",{value:"page"}));q.value="svg";q.addEventListener("change",function(a){l(e);r()},!1);d.appendChild(n("p",["Export as: ",q]));var B=n("input",null,{type:"checkbox",checked:this.exportHighlights});B.addEventListener("change",function(a){h.exportHighlights=B.checked;h.storeStatus()},!1);var c=n("input",null,{type:"checkbox",checked:this.exportRuler});c.addEventListener("change",function(a){h.exportRuler=c.checked;h.storeStatus()},!1);var a=
n("input",null,{type:"text",value:"1.0"}),b=n("button","Export",{className:"btn btn-primary"});b.addEventListener("click",function(b){l(e);var g,m,p,r;if("svg"===q.value)g=URL.createObjectURL(h.makeSVG({highlights:B.checked,ruler:c.checked?h.rulerLocation:"none"})),m="SVG",p="image/svg",r="dalliance-view.svg";else if("png"===q.value){p=parseFloat(a.value);if(0.1>p||10<p){alert("bad scale "+p);return}g=h.exportImage({highlights:B.checked,ruler:c.checked?h.rulerLocation:"none",resolutionMultiplier:p});
m="Image";p="image/png";r="dalliance-view.png"}else"config"===q.value?(p=JSON.stringify(h.exportFullConfig(),null,2),m=new Blob([p],{type:"text/plain"}),g=URL.createObjectURL(m),m="Configuration",p="text/plain",r="dalliance-config.json"):"sources"===q.value?(p=JSON.stringify(h.exportSourceConfig(),null,2),m=new Blob([p],{type:"text/plain"}),g=URL.createObjectURL(m),m="Source array",p="text/plain",r="dalliance-sources.json"):"page"===q.value&&(m=h.exportPageTemplate(),p="text/html",m=new Blob([m],
{type:p}),g=URL.createObjectURL(m),m="Page template",r="dalliance-view.html");g&&(b=n("a","[Download]",{href:g,download:r,type:p}),p=n("a","[Preview in browser]",{href:g,type:p,target:"_new"}),e.appendChild(n("p",[""+m+" created: ",b,p])))},!1);h.addViewListener(function(){l(e)});h.addTierListener(function(){l(e)});var e=n("p",""),m=n("tr",[n("th","Include highlights",{},{width:"200px",textAlign:"right"}),n("td",B)]),p=n("tr",[n("th","Include vertical guideline"),n("td",c)]),g=n("tr",[n("th","Scale multiplier"),
n("td",a)]),v=n("table",[m,p,g]),r=function(){var a=q.value;m.style.display="svg"==a||"png"==a?"table-row":"none";p.style.display="svg"==a||"png"==a?"table-row":"none";g.style.display="png"==a?"table-row":"none"};r();d.appendChild(v);d.appendChild(b);d.appendChild(e);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(d,this.svgHolder);this.activeToolPanel=d;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":49}],17:[function(d,u,s){u=d("./cbrowser");s=d("./chainset");var q=
d("./sourceadapters"),n=d("./utils"),l=d("./das");d=d("./sourcecompare");window.Browser=u.Browser;window.sourcesAreEqual=d.sourcesAreEqual;window.Chainset=s.Chainset;window.makeElement=n.makeElement;window.dalliance_registerSourceAdapterFactory=q.registerSourceAdapterFactory;window.dalliance_registerParserFactory=q.registerParserFactory;window.dalliance_makeParser=q.makeParser;window.DASSequence=l.DASSequence;window.DASFeature=l.DASFeature;window.DASGroup=l.DASGroup;window.DASStylesheet=l.DASStylesheet;
window.DASStyle=l.DASStyle;window.DASSource=l.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./sourcecompare":35,"./utils":49}],18:[function(d,u,s){function q(){this.glyphs=[];this.height=0;this.quant=null}function n(b){Date.now();Y=b.viewport.getContext("2d");a(b);b.padding="number"===typeof b.dasSource.padding?b.dasSource.padding:aa;var f=[],k={},e={},g;for(g in b.ungroupedFeatures)for(var m=b.ungroupedFeatures[g],p=0;p<m.length;++p){var r=m[p];if(!r.parts){var d=b.styleForFeature(r);
if(d)if("LINEPLOT"==d.glyph)c(k,d.id,r),e[d.id]=d;else{var v=h(r,0,d,b);v&&f.push(v)}}}for(var E in k)g=k[E],d=e[E],"LINEPLOT"==d.glyph&&f.push(t(g,d,b));if(b.dasSource.collapseSuperGroups&&!b.bumped)for(var C in b.superGroups){k=b.superGroups[C];b.groups[C]=B(b.groups[C]);b.groups[C].isSuperGroup=!0;e={};E=1E10;m=-1E10;p=null;for(v=0;v<k.length;++v)if(g=b.groupedFeatures[k[v]]){for(d=0;d<g.length;++d)r=g[d],c(e,r.type,r),E=Math.min(r.min,E),m=Math.max(r.max,m),r.segment&&!p&&(p=r.segment);if(b.groups[C]&&
!b.groups[C].links||0==b.groups[C].links.length)b.groups[C].links=b.groups[k[0]].links;delete b.groupedFeatures[k[v]]}b.groups[C].max=m;b.groups[C].min=E;b.groups[C].segment=p;for(var n in e){g=e[n];E=g[0];m=null;for(d=0;d<g.length;++d)r=g[d],r=new S(r.min,r.max),m=m?L(m,r):r;m=m.ranges();for(p=0;p<m.length;++p){for(var I=m[p],x=((I.max()|0)-(I.min()|0)+1)*k.length,w=0,d=0;d<g.length;++d)if(r=g[d],(r.min|0)<=I.max()&&(r.max|0)>=I.min())var A=Math.max(r.min|0,I.min()),r=Math.min(r.max|0,I.max()),w=
w+(r-A+1);var r=new R,y;for(y in E)r[y]=E[y];r.min=I.min();r.max=I.max();r.label&&1<k.length&&(r.label+=" ("+k.length+" vars)");r.visualWeight=1*w/x;c(b.groupedFeatures,C,r)}}delete b.superGroups[C]}y=[];for(var J in b.groupedFeatures)y.push(J);y.sort(function(a,f){var c=b.groupedFeatures[a][0].score-b.groupedFeatures[f][0].score;return 0<c?-1:0==c?0:1});n={};for(r=0;r<y.length;++r)if(J=y[r],v=l(b.groupedFeatures[J],0,b.groups[J],b,b.dasSource.collapseSuperGroups&&!b.bumped?"collapsed_gene":"tent"))v.group=
b.groups[J],n[J]=v;for(C in b.superGroups){k=b.superGroups[C];J=[];E=1E10;m=-1E10;for(y=0;y<k.length;++y)r=n[k[y]],n[k[y]]=null,r&&(J.push(r),E=Math.min(E,r.min()),m=Math.max(m,r.max()));for(y=0;y<J.length;++y)r=J[y],f.push(new Q(r,E,m))}for(v in n)(r=n[v])&&f.push(r);C=new q;J=[];n=b.subtierMax||b.dasSource.subtierMax||b.browser.defaultSubtierMax;y=!1;r=0;a:for(;r<f.length;++r)if(v=f[r],v.bump&&(b.bumped||b.dasSource.collapseSuperGroups)){for(k=0;k<J.length;++k)if(e=J[k],e.hasSpaceFor(v)){e.add(v);
continue a}J.length>=n?y=!0:(e=new q,e.add(v),J.push(e))}else C.add(v);0<C.glyphs.length&&(J=[C].concat(J));for(k=0;k<J.length;++k)e=J[k],e.quant&&e.glyphs.unshift(new D(e.height));for(k=0;k<J.length;++k)e=J[k],e.glyphs.sort(function(a,b){return(a.zindex||0)-(b.zindex||0)});b.subtiers=J;b.glyphCacheOrigin=b.browser.viewStart;y?b.updateStatus("Bumping limit exceeded, use the track editor to see more features"):b.updateStatus()}function l(a,b,f,c,k){k=c.styleForFeature(f);var g,m=!1,r=[];b=null;for(var d=
0;d<a.length;++d){var l=a[d];l.orientation&&null==b&&(b=l.orientation);!g&&l.label&&(g=l.label);var v=c.styleForFeature(l);v&&!l.parts&&(V(v.LABEL)&&(m=!0),(l=h(l,0,v,c,null,!0))&&r.push(l))}if(0==r.length)return null;a="flat";k&&"LINE"===k.glyph||(c.dasSource.collapseSuperGroups&&!c.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-"));c=null;if(g&&m||k&&(V(k.LABEL)||V(k.LABELS)))c=f.label||g;f=new e(r,a);c&&("+"===b?c=">"+c:"-"===b&&(c="<"+c),f=new p(Y,f,
c,!1));f.bump=!0;return f}function h(a,c,k,m,h,d){function l(a,b,f){var c=null;if(a.currentSequence){var k=a.currentSequence.start|0,e=a.currentSequence.end|0;if(k<=f&&e>=b){for(var g=Math.max(b,k),e=Math.min(f,e),c=a.currentSequence.seq.substr(g-k,e-g+1);b<g;)c="N"+c,g--;for(;f>e;)c+="N",e++}}return c}var n=m.browser.scale,q=m.browser.viewStart,t=k.glyph||"BOX",B=a.min,D=a.max,s=a.orientation,z=a.score,L=a.label||a.id,R=(B-q)*n,S=Math.max((D-q+1)*n,R+1),u=m.forceHeight||k.HEIGHT||h||12,X=u*=1,q=
k.BUMP&&V(k.BUMP),U;if("CROSS"===t||"EX"===t||"TRIANGLE"===t||"DOT"===t||"SQUARE"===t||"STAR"===t||"PLIMSOLL"===t){var W=k.FGCOLOR||"black",N=k.BGCOLOR||"none",B=k.STROKECOLOR;k.BGITEM&&a.itemRgb?W=a.itemRgb:V(k.COLOR_BY_SCORE2)&&(n=k.BGGRAD||k._gradient,n||(n=I(50,k.COLOR1,k.COLOR2,k.COLOR3),k._gradient=n),u=a.score2,void 0==u&&W||(X=k.MIN2?1*k.MIN2:0,D=(1*(u||0)-X)/((k.MAX2?1*k.MAX2:1)-X)*n.length|0,0>D&&(D=0),D>=n.length&&(D=n.length-1),W=n[D]));u=m.forceHeight||k.HEIGHT||h||12;X=u*=1;D=k.SIZE||
u;k.RSIZE&&(D=1*k.RSIZE*u);k.STROKETHRESHOLD&&D<1*k.STROKETHRESHOLD&&(B=null);D*=1;u=(R+S)/2;n=D/2;"EX"===t?B=new v(u,D,W):"TRIANGLE"===t?B=new r(u,D,k.DIRECTION||"N",k.LINEWIDTH||D,W,B):"DOT"===t?B=new O(u,D,W,B):"PLIMSOLL"===t?B=new G(u,D,0.2*D,W,B):"SQUARE"===t?B=new b(u-n,0,D,D,W,B):"STAR"===t?(t=5,k.POINTS&&(t=k.POINTS|0),B=new y(u,n,t,W,B)):B=new g(u,D,W);N&&"none"!=N&&5<S-R&&(R=new b(R,0,S-R,D,N),B=new e([R,B]));if(V(k.SCATTER)){N=m.quantMin(k);(D=m.quantMax(k))||(D=0>N?0:10);N||(N=0);m=(1*
z-N)/(D-N);z=-1*N/(D-N);if(0>m||1<m)return null;m>=z?(u=Math.max(1,(m-z)*X),c=c+(1-z)*X-u):(u=Math.max(1,(m-z)*X),c+=(1-z)*X);U={min:N,max:D};R=0;S="undefined"!==typeof a.forceLabel?a.forceLabel:k.LABEL;ha(S)&&L&&!d&&(B=new p(Y,B,L,!0,null,"above"==S?"above":"below"),"above"==S&&(R=B.textHeight+2),d=!0);B=new J(B,0,c-n-R,X)}}else if("HISTOGRAM"===t||"GRADIENT"===t&&"undefined"!==z)N=m.quantMin(k),(D=m.quantMax(k))||(D=0>N?0:10),N||(N=0),1*z<1*N&&(z=N),1*z>1*D&&(z=D),m=(1*z-N)/(D-N),z=-1*N/(D-N),"HISTOGRAM"===
t&&(m>=z?(u=(m-Math.max(0,z))*X,c=c+(1-Math.max(0,z))*X-u):(u=(Math.max(0,z)-m)*X,c+=(1-Math.max(0,z))*X),U={min:N,max:D}),W=k.FGCOLOR||null,N=k.BGCOLOR||k.COLOR1||"green",k.BGITEM&&a.itemRgb&&(N=a.itemRgb),z=k.ALPHA?1*k.ALPHA:null,k.BGGRAD&&(n=k.BGGRAD,D=m*n.length|0,0>D&&(D=0),D>=n.length&&(D=n.length-1),N=n[D]),k.COLOR2&&(n=k._gradient,n||(n=I(50,k.COLOR1,k.COLOR2,k.COLOR3),k._gradient=n),D=m*n.length|0,0>D&&(D=0),D>=n.length&&(D=n.length-1),N=n[D]),B=new b(R,c,S-R,u,N,W,z),B=new J(B,0,0,X);else if("HIDDEN"===
t)B=new Q(null,R,S),d=!0;else if("ARROW"===t)m=k.FGCOLOR||"purple",c=V(k.PARALLEL),X=V(k.SOUTHWEST),z=V(k.NORTHEAST),B=new w(R,S,u,m,c,X,z);else if("ANCHORED_ARROW"===t)W=k.FGCOLOR||"none",N=k.BGCOLOR||"green",B=new P(R,S,u,N,W,s),B.bump=!0;else if("SPAN"===t)W=k.FGCOLOR||"black",B=new K(R,S,u,W);else if("LINE"===t)W=k.FGCOLOR||"black",B=new x(R,S,u,k.STYLE||"solid",s,W);else if("PRIMERS"===t)W=k.FGCOLOR||"black",N=k.BGCOLOR||"red",B=new F(R,S,u,N,W);else if("TEXT"===t)m=k.STRING||"text",N=k.FGCOLOR||
"black",B=new f(Y,R,S,u,N,m);else if("TOOMANY"===t)W=k.FGCOLOR||"gray",N=k.BGCOLOR||"orange",B=new H(R,S,u,N,W);else if("POINT"===t)u=m.forceHeight||k.HEIGHT||30,N=m.quantMin(k),D=m.quantMax(k),m=(1*z-N)/(D-N),c=1*u/(D-N)*(z-1*N)|0,U={min:N,max:D},N=k.FGCOLOR||k.COLOR1||"black",k.COLOR2&&(n=k._gradient,n||(n=I(50,k.COLOR1,k.COLOR2,k.COLOR3),k._gradient=n),D=m*n.length|0,0>D&&(D=0),D>=n.length&&(D=n.length-1),N=n[D]),B=new A((R+S)/2,u-c,u,N);else if("__SEQUENCE"===t){z=t=a.seq;N=W=a.quals;c=V(k.__INSERTIONS);
X=[];if(a.cigar){h=$(a.cigar);for(var N=z="",aa=s=0;aa<h.length;++aa){var ca=h[aa];if("M"==ca.op)z+=t.substr(s,ca.cnt),N+=W.substr(s,ca.cnt),s+=ca.cnt;else if("D"==ca.op)for(var ja=0;ja<ca.cnt;++ja)z+="-",N+="Z";else if("I"==ca.op){var da=t.substr(s,ca.cnt),ja=new r(R+z.length*n,5,"S",5,m.browser.baseColors.I);c&&(ja=new p(Y,ja,da,!1,"center","above","7px sans-serif"));ja.feature={label:"Insertion: "+da,type:"insertion",method:"insertion"};X.push(ja);s+=ca.cnt}else"S"==ca.op?s+=ca.cnt:console.log("unknown cigop"+
ca.op)}}n=l(m,B,D);if(z&&n&&("mismatch"===k.__SEQCOLOR||"mismatch-all"===k.__SEQCOLOR)){B=[];D="-"===a.orientation?",":".";for(t=0;t<z.length;++t)B.push(z[t]==n[t]?D:z[t]);z=B.join("")}B="-"===a.orientation?k._minusColor||"lightskyblue":k._plusColor||"lightsalmon";k.__disableQuals&&(N=!1);B=new E(m.browser.baseColors,B,R,S,u,z,n,k.__SEQCOLOR,N,!V(k.__CLEARBG));c&&(B=new J(B,0,7));0<X.length&&(X.splice(0,0,B),B=new e(X))}else if("__INSERTION"===t)ja=new r(R,5,"S",5,m.browser.baseColors.I),B=new p(Y,
ja,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),1<S-R&&(N=k.BGCOLOR||k.COLOR1||"green",R=new b(R,5,S-R,u,N,W),B=new e([R,B]));else{if("__NONE"===t)return null;W=k.FGCOLOR||null;N=k.BGCOLOR||k.COLOR1||"green";k.BGITEM&&a.itemRgb&&(N=a.itemRgb);n=(S-R)/(D-B);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!m.dasSource.collapseSuperGroups||m.bumped)&&0.5<=n?(n=l(m,B,D),B=new C(R,S,u,N,n,
a.orientation,a.readframe)):B=new b(R,0,S-R,u,N,W)}(V(k.LABEL)||a.forceLabel)&&L&&!d&&(B=new p(Y,B,L,!1));q&&(B.bump=!0);B.feature=a;U&&(B.quant=U);k.ZINDEX&&(B.zindex=k.ZINDEX|0);return B}function t(a,b,f){var c=f.browser.viewStart,k=f.browser.scale,e=f.forceHeight||b.HEIGHT||30,g=f.quantMin(b);f=f.quantMax(b);for(var p=1*e/(f-g),r=b.FGCOLOR||b.COLOR1||"black",h=[],d=0;d<a.length;++d){var l=a[d],v=e-((l.score-1*g)*p|0);h.push((((l.min|0)+(l.max|0))/2-c)*k);h.push(v)}a=new m(h,r,e);a.quant={min:g,
max:f};b.ZINDEX&&(a.zindex=b.ZINDEX|0);return a}if("undefined"!==typeof d){var z=d("./utils"),B=z.shallowCopy,c=z.pusho,z=d("./tier").DasTier,a=d("./features").sortFeatures;s=d("./glyphs");var b=s.BoxGlyph,e=s.GroupGlyph,m=s.LineGraphGlyph,p=s.LabelledGlyph,g=s.CrossGlyph,v=s.ExGlyph,r=s.TriangleGlyph,O=s.DotGlyph,Q=s.PaddedGlyph,P=s.AArrowGlyph,K=s.SpanGlyph,x=s.LineGlyph,F=s.PrimersGlyph,w=s.ArrowGlyph,H=s.TooManyGlyph,f=s.TextGlyph,E=s.SequenceGlyph,C=s.AminoAcidGlyph,J=s.TranslatedGlyph,A=s.PointGlyph,
D=s.GridGlyph,y=s.StarGlyph,G=s.PlimsollGlyph,k=s.OverlayLabelCanvas,I=d("./color").makeGradient;s=d("./spans");var S=s.Range,L=s.union;s=d("./das");var R=s.DASFeature,V=s.isDasBooleanTrue,ha=s.isDasBooleanNotFalse,$=d("./cigar").parseCigar,U=d("./numformats").formatQuantLabel}var aa=3;q.prototype.indexFor=function(a){a=a.min();for(var b=0,f=this.glyphs.length;f>b;){var c=(b+f)/2|0;if(c>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[c].min()?f=c:b=c+1}return f};q.prototype.add=function(a){var b=
this.indexFor(a);this.glyphs.splice(b,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};q.prototype.hasSpaceFor=function(a){var b=this.indexFor(a);return 0<b&&this.glyphs[b-1].max()>=a.min()||b<this.glyphs.length&&this.glyphs[b].min()<=a.max()?!1:!0};var Y;z.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,b=this.subtiers;if(b){var f=this.browser.featurePanelWidth+2E3;a&&(f*=2);var c=this.viewport.width|0;c<f-50&&(this.viewport.width=
c=f);for(var f=this.padding,e=0;e<b.length;++e)f=f+b[e].height+this.padding;e=f=Math.max(f+6,this.browser.minTierHeight);a&&(e*=2);e!=this.viewport.height&&(this.viewport.height=e);Math.max(f,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+c/2+"px":""+c+"px";this.viewport.style.height=""+f+"px";this.layoutHeight=Math.max(f,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;b=this.viewport.getContext("2d");b.clearRect(0,
0,c,e);b.save();a&&b.scale(2,2);c=this.browser.viewStart-1E3/this.browser.scale;e=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var g=this.knownCoverage.ranges(),m=0;m<g.length;++m){var p=g[m];0==m?p.min()>c&&a.push({min:c,max:p.min()-1}):a.push({min:g[m-1].max()+1,max:p.min()-1});m==g.length-1&&p.max()<e&&a.push({min:p.max()+1,max:e})}if(0<a.length)for(b.fillStyle="gray",c=0;c<a.length;++c)e=a[c],g=(e.min-this.browser.viewStart)*this.browser.scale+1E3,b.fillRect(g,0,
(e.max-this.browser.viewStart)*this.browser.scale+1E3-g,f);f=new k;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;b.translate(a,this.padding);f.translate(0,this.padding);this.paintToContext(b,f,a);this.overlayLabelCanvas=0<f.glyphs.length?f:null;b.restore();this.drawOverlay();this.paintQuant()}};z.prototype.paintToContext=function(a,b,f){var c=this.subtiers,k=this.viewport.width|0;a.save();for(var e=0;e<c.length;++e){for(var g=null,m=c[e].glyphs,p=0;p<m.length;++p){var r=
m[p];r.min()<k-f&&r.max()>-f&&(r=m[p],r.draw(a,b),r.quant&&(g=r.quant))}a.translate(0,c[e].height+this.padding);b.translate(0,c[e].height+this.padding)}a.restore();g&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(b=c[0].height*(1-(this.quantLeapThreshold-g.min)/(g.max-g.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,b),a.lineTo(k+1E3,b),a.stroke(),a.restore())};z.prototype.paintQuant=function(){if(this.quantOverlay){var a=
this.browser.retina&&1<window.devicePixelRatio,b;this.subtiers&&0<this.subtiers.length&&(b=this.subtiers[0].quant);if(b){var f=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var c=this.quantOverlay.getContext("2d");a&&c.scale(2,2);a=2;40<f&&(a=1+(f/20|0));var k=(f+2*this.padding)/
(a-1),e=(b.max-b.min)/(a-1);c.fillStyle="white";c.globalAlpha=0.6;"right"==this.browser.rulerLocation?c.fillRect(20,0,30,f+2*this.padding):c.fillRect(0,0,30,f+2*this.padding);c.globalAlpha=1;c.strokeStyle="black";c.lineWidth=1;c.beginPath();if("right"==this.browser.rulerLocation){c.moveTo(42,this.padding);c.lineTo(50,this.padding);c.lineTo(50,f+this.padding);c.lineTo(42,f+this.padding);for(var g=1;g<a-1;++g){var m=g*k;c.moveTo(50,m);c.lineTo(45,m)}}else for(c.moveTo(8,this.padding),c.lineTo(0,this.padding),
c.lineTo(0,f+this.padding),c.lineTo(8,f+this.padding),g=1;g<a-1;++g)m=g*k,c.moveTo(0,m),c.lineTo(5,m);c.stroke();c.fillStyle="black";if("right"==this.browser.rulerLocation)for(c.textAlign="right",c.fillText(U(b.max),41,8),c.fillText(U(b.min),41,f+this.padding),g=1;g<a-1;++g)m=g*k,c.fillText(U(1*b.max-g*e),41,m+3);else for(c.textAlign="left",c.fillText(U(b.max),9,8),c.fillText(U(b.min),9,f+this.padding),g=1;g<a-1;++g)m=g*k,c.fillText(U(1*b.max-g*e),9,m+3)}else this.quantOverlay.style.display="none"}};
z.prototype.styleForFeature=function(a){var b=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var f=null,c=this.stylesheet.styles,k=0;k<c.length;++k){var e=c[k];if(!(e.zoom&&e.zoom!=b||e.orientation&&e.orientation!=a.orientation)){var g=e._labelRE;g&&g.test||(g=new RegExp("^"+e.label+"$"),e._labelRE=g);if(!e.label||g.test(a.label))if(g=e._methodRE,g&&g.test||(g=new RegExp("^"+e.method+"$"),e._methodRE=g),!e.method||g.test(a.method)){if(e.type)if("default"==e.type){f||(f=e.style);
continue}else if(g=e._typeRE,g&&g.test||(g=new RegExp("^"+e.type+"$"),e._typeRE=g),!g.test(a.type))continue;return e.style}}}return f};z.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};z.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==
typeof u&&(u.exports={drawFeatureTier:n})},{"./cigar":8,"./color":9,"./das":10,"./features":20,"./glyphs":21,"./numformats":26,"./spans":36,"./tier":45,"./utils":49}],19:[function(d,u,s){function q(c,a,b){var e=h(b.type,a.type),m=h(b.label,a.label,b.id,a.id);m&&0!=m.indexOf("__dazzle")&&(e=e+": "+m);this.hit=c;this.feature=a;this.group=b;this.title=e;this.sections=[]}function n(c,a){var b=[];if(c)for(var e=0;e<c.length;++e)t(b,c[e]);if(a)for(e=0;e<a.length;++e)t(b,a[e]);return b}if("undefined"!==
typeof d){var l=d("./cbrowser").Browser;d=d("./utils");var h=d.pick,t=d.pushnew,z=d.makeElement}var B=/^([A-Za-z_-]+)=(.+)/;l.prototype.addFeatureInfoPlugin=function(c){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(c)};q.prototype.setTitle=function(c){this.title=c};q.prototype.add=function(c,a){"string"===typeof a&&(a=z("span",a));this.sections.push({label:c,info:a})};l.prototype.featurePopup=function(c,a,b,e){var m=b.length;a=0<=--m?b[m]:{};var p=0<=--m?b[m]:
{};b=new q(b,a,p);b.tier=e;for(var m=this.featureInfoPlugins||[],g=0;g<m.length;++g)try{m[g](a,b)}catch(h){console.log(h.stack||h)}m=e.featureInfoPlugins||[];for(g=0;g<m.length;++g)try{m[g](a,b)}catch(r){console.log(r.stack||r)}this.removeAllPopups();e=z("table",null,{className:"table table-striped table-condensed"});e.style.width="100%";e.style.margin="0px";m=0;a.method&&(g=z("tr",[z("th","Method"),z("td",a.method)]),e.appendChild(g),++m);g=p.segment?p:a;g=z("tr",[z("th","Location"),z("td",g.segment+
":"+g.min+"-"+g.max,{},{minWidth:"200px"})]);e.appendChild(g);++m;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||(g=z("tr",[z("th","Score"),z("td",""+a.score)]),e.appendChild(g),++m);(g=n(p.links,a.links))&&0<g.length&&(g=z("tr",[z("th","Links"),z("td",g.map(function(a){return z("div",z("a",a.desc,{href:a.uri,target:"_new"}))}))]),e.appendChild(g),++m);a=n(p.notes,a.notes);for(p=0;p<a.length;++p){var g="Note",d=a[p],l=d.match(B);l&&(g=l[1],d=l[2]);g=z("tr",[z("th",g),z("td",d)]);
e.appendChild(g);++m}for(a=0;a<b.sections.length;++a)m=b.sections[a],e.appendChild(z("tr",[z("th",m.label),z("td",m.info)]));this.popit(c,b.title||"Feature",e,{width:450})}},{"./cbrowser":6,"./utils":49}],20:[function(d,u,s){function q(h){for(var d=h.browser.drawnStart,q=h.browser.drawnEnd,B={},c={},a={},b={},e={},m={},p={},g={},v=[],r,O,Q,P=function(){Q={};for(var a=0;a<h.currentFeatures.length;++a){var b=h.currentFeatures[a];b.id&&(Q[b.id]=b)}},s=function(a){var b=[];if(a.parents)for(var f=0;f<
a.parents.length;++f){var c=a.parents[f],e=Q[c];e&&"SO:0000704"==e.typeCv&&pushnew(b,c)}return b},x=0;x<h.currentFeatures.length;++x){var F=h.currentFeatures[x];if(!F.parts){var w=F.min<=q&&F.max>=d;if(F.min&&F.max){if(F.score&&"."!=F.score&&"-"!=F.score){var u=1*F.score;if(!r||u<r)r=u;if(!O||u>O)O=u}var u=[],f=null;if(F.groups)for(var E=0;E<F.groups.length;++E){var C=F.groups[E],J=C.id;if("gene"==C.type)f=J,m[J]=C;else if("translation"!=C.type){n(c,J,F);m[J]=C;u.push(J);C=b[J];if(!C||F.min<C)b[J]=
F.min;C=e[J];if(!C||F.max>C)e[J]=F.max}}if(F.parents)for(Q||P(),E=0;E<F.parents.length;++E){var A=F.parents[E],D=Q[A];if(D){D.parts||(D.parts=[F]);l(c,A,D);n(c,A,F);m[A]||(m[A]={type:D.type,id:D.id,label:D.label||D.id});u.push(A);C=b[A];if(!C||F.min<C)b[A]=F.min;C=e[A];if(!C||F.max>C)e[A]=F.max;C=s(D);0<C.length&&(f=C[0],A=Q[C[0]],m[C[0]]={type:A.type,id:A.id,label:A.label||A.id},h.dasSource.collapseSuperGroups||(h.dasSource.collapseSuperGroups=!0))}}if(0==u.length)w&&n(B,F.type,F);else if(f)for(C=
0;C<u.length;++C)J=u[C],l(p,f,J),g[J]=f}else v.push(F)}}for(J in c)v=m[J],"number"!==typeof v.min&&(v.min=b[J]),"number"!==typeof v.max&&(v.max=e[J]),e[J]>=d&&b[J]<=q&&(a[J]=c[J]);h.ungroupedFeatures=B;h.groupedFeatures=a;h.groups=m;h.superGroups=p;h.groupsToSupers=g;r&&(0<r?r=0:0>O&&(O=0),h.currentFeaturesMinScore=r,h.currentFeaturesMaxScore=O)}if("undefined"!==typeof d){d=d("./utils");var n=d.pusho,l=d.pushnewo}"undefined"!==typeof u&&(u.exports={sortFeatures:q})},{"./utils":49}],21:[function(d,
u,s){function q(a,b){this._stroke=a;this._fill=b}function n(a,b,f,c,e,g,m,p){this.x=a;this.y=b;this._width=f;this._height=c;this.fill=e;this.stroke=g;this._alpha=m;this._radius=p||0}function l(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();for(var f=[],c=0;c<a.length;++c){var e=a[c];f.push(new J(e.min(),e.max()));this.h=Math.max(this.h,e.height())}this.coverage=C(f)}function h(a,b,f){this.points=a;this.color=b;this._height=f||50}function t(a,b,f,c,e,g,m){this.glyph=b;this.text=f;this.anchor=
e||"left";this.align=g||"below";m&&(this.font=m);this.font&&(a.save(),a.font=this.font);f=a.measureText(f);this.font&&a.restore();this.textLen=f.width;this.textHeight=5;this.bump=b.bump;this.measured=!c}function z(a,b,f){this._x=a;this._height=b;this._stroke=f}function B(a,b,f){this._x=a;this._height=b;this._stroke=f}function c(a,b,f,c,e,g){q.call(this,g,e);this._x=a;this._height=b;this._dir=f;this._width=c}function a(a,b,f,c){this._x=a;this._height=b;this._fill=f;this._stroke=c}function b(a,b,f){this.glyph=
a;this._min=b;this._max=f;a&&(this.bump=a.bump)}function e(a,b,f,c,e,g){q.call(this,e,c);this._min=a;this._max=b;this._height=f;this._ori=g}function m(a,b,f,c){q.call(this,c,null);this._min=a;this._max=b;this._height=f}function p(a,b,f,c,e,g){this._min=a;this._max=b;this._height=f;this._style=c;this._strand=e;this._stroke=g}function g(a,b,f,c,e){this._min=a;this._max=b;this._height=f;this._fill=c;this._stroke=e}function v(a,b,f,c,e,g,m){q.call(this,null,c);this._min=a;this._max=b;this._height=f;this._color=
c;this._parallel=e;this._sw=g;this._ne=m}function r(a,b,f,c,e){this._min=a;this._max=b;this._height=f;this._fill=c;this._stroke=e}function O(a,b,f,c,e,g){this._min=b;this._max=f;this._height=c;this._fill=e;this._string=g;this._textLen=a.measureText(g).width}function Q(a,b,f){var c={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[f.toLowerCase()];f=c?[f,c]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":f[b%2]}function P(a){var b=
{A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var f=[],c=0;c<a.length;++c){var e=a.substr(c,1).toUpperCase();f.push(e in b?b[e]:"N")}return f.join("")}function K(a,b,f,c,e,g,m){this._min=a;this._max=b;this._height=f;this._fill=c;this._seq=e;this._orientation=g;this._readframe=m}function x(a,b,f,c){this.glyph=a;this._height=c;this._x=b;this._y=f}function F(a,b,f,c){this._x=a;this._y=b;this._height=f;this._fill=c}function w(a){this._height=a||50}function H(a,b,f,c,e){q.call(this,e,
c);this._x=a;this._r=b;this._points=f}function f(a,b,f,c,e){this._x=a;this._height=b;this._overhang=f;this._fill=c;this._stroke=e;this._hh=b/2}function E(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof d){s=d("./spans");var C=s.union,J=s.Range;s=d("./utils");var A=s.makeElementNS,D=s.AMINO_ACID_TRANSLATION;d=d("./svg-utils");var y=d.NS_SVG,G=d.SVGPath}q.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,
a.stroke())};q.prototype.toSVG=function(){var a=new G;this.drawPath(a);return A(y,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};q.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};n.prototype.draw=function(a){var b=this._radius;0<b?(a.beginPath(),a.moveTo(this.x+b,this.y),a.lineTo(this.x+this._width-b,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b),a.lineTo(this.x+this._width,this.y+this._height-
b),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,b),a.lineTo(this.x+b,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b),a.lineTo(this.x,this.y+b),a.arcTo(this.x,this.y,this.x+b,this.y,b),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),
this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};n.prototype.toSVG=function(){var a=A(y,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};n.prototype.min=function(){return this.x};
n.prototype.max=function(){return this.x+this._width};n.prototype.height=function(){return this.y+this._height};l.prototype.drawConnectors=function(a){for(var b=this.coverage.ranges(),f=1;f<b.length;++f){var c=b[f],e=b[f-1];if(e&&c.min()>e.max()){var e=e.max(),c=c.min(),g=(e+c)/2;"hat+"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(g,0),a.lineTo(c,this.h/2)):"hat-"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(g,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(e,this.h/2),
a.lineTo(c,this.h/2),4<c-e&&(a.moveTo(g-2,this.h/2-3),a.lineTo(g+2,this.h/2),a.lineTo(g-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(c,this.h/2),4<c-e&&(a.moveTo(g+2,this.h/2-3),a.lineTo(g-2,this.h/2),a.lineTo(g+2,this.h/2+3))):(a.moveTo(e,this.h/2),a.lineTo(c,this.h/2))}}};l.prototype.draw=function(a,b){for(var f=0;f<this.glyphs.length;++f)this.glyphs[f].draw(a,b);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};l.prototype.toSVG=function(){for(var a=
A(y,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());b=new G;this.drawConnectors(b);0<b.toPathData().length&&(b=A(y,"path",null,{d:b.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(b));return a};l.prototype.min=function(){return this.coverage.min()};l.prototype.max=function(){return this.coverage.max()};l.prototype.height=function(){return this.h};h.prototype.min=function(){return this.points[0]};h.prototype.max=function(){return this.points[this.points.length-
2]};h.prototype.height=function(){return this._height};h.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b+=2){var f=this.points[b],c=this.points[b+1];0==b?a.moveTo(f,c):a.lineTo(f,c)}a.stroke();a.restore()};h.prototype.toSVG=function(){for(var a=new G,b=0;b<this.points.length;b+=2){var f=this.points[b],c=this.points[b+1];0==b?a.moveTo(f,c):a.lineTo(f,c)}return A(y,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,
strokeWidth:"2px"})};t.prototype.toSVG=function(){var a=this.glyph.toSVG(),b={};"above"==this.align?(a=A(y,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return A(y,"g",[a,A(y,"text",this.text,b)])};t.prototype.min=function(){return this.glyph.min()};t.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),
1*this.glyph.min()+this.textLen+10):this.glyph.max()};t.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};t.prototype.draw=function(a,b){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();b.registerGlyph(this)};t.prototype.drawOverlay=function(a,b,f){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?f=(this.glyph.min()+this.glyph.max()-
this.textLen)/2:(f=this.glyph.min(),f<b&&(f=Math.min(b,this.glyph.max()-this.textLen)));a.fillText(this.text,f,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};z.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};z.prototype.toSVG=function(){var a=this._height/2,b=new G;b.moveTo(this._x,0);b.lineTo(this._x,
this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return A(y,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};z.prototype.min=function(){return this._x-this._height/2};z.prototype.max=function(){return this._x+this._height/2};z.prototype.height=function(){return this._height};B.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=
this._stroke;a.lineWidth=1;a.stroke()};B.prototype.toSVG=function(){var a=this._height/2,b=new G;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return A(y,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};B.prototype.min=function(){return this._x-this._height/2};B.prototype.max=function(){return this._x+this._height/2};B.prototype.height=function(){return this._height};c.prototype=Object.create(q.prototype);
c.prototype.drawPath=function(a){var b=this._height/2,f=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-f,0),a.lineTo(this._x+f,0)):"W"===this._dir?(a.moveTo(this._x+f,b),a.lineTo(this._x-f,0),a.lineTo(this._x-f,this._height)):"E"===this._dir?(a.moveTo(this._x-f,b),a.lineTo(this._x+f,0),a.lineTo(this._x+f,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+f,this._height),a.lineTo(this._x-f,this._height));a.closePath()};c.prototype.min=function(){return this._x-this._height/
2};c.prototype.max=function(){return this._x+this._height/2};c.prototype.height=function(){return this._height};a.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=function(){var a=this._height/2;return A(y,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=
function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};b.prototype.draw=function(a,b){this.glyph&&this.glyph.draw(a,b)};b.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():A(y,"g")};b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this.glyph?this.glyph.height():1};e.prototype=Object.create(q.prototype);e.prototype.min=
function(){return this._min};e.prototype.max=function(){return this._max};e.prototype.height=function(){return this._height};e.prototype.drawPath=function(a){var b=this._max,f=this._min,c=this._height,e=0,g=0,m=this._height+2,p=0.333333*this._height;this._ori&&("+"===this._ori?g=0.5*this._height:"-"===this._ori&&(e=0.5*this._height));b-f<m&&(f=(b+f-m)/2,b=f+m);a.moveTo(f+e,0+p);a.lineTo(b-g,0+p);a.lineTo(b-g,0);a.lineTo(b,0+this._height/2);a.lineTo(b-g,0+c);a.lineTo(b-g,0+p+p);a.lineTo(f+e,0+p+p);
a.lineTo(f+e,0+c);a.lineTo(f,0+c/2);a.lineTo(f+e,0);a.lineTo(f+e,0+p)};m.prototype=Object.create(q.prototype);m.prototype.min=function(){return this._min};m.prototype.max=function(){return this._max};m.prototype.height=function(){return this._height};m.prototype.drawPath=function(a){var b=this._min,f=this._max,c=this._height,e=c/2;a.moveTo(b,e);a.lineTo(f,e);a.moveTo(b,0);a.lineTo(b,c);a.moveTo(f,0);a.lineTo(f,c)};p.prototype.min=function(){return this._min};p.prototype.max=function(){return this._max};
p.prototype.height=function(){return this._height};p.prototype.drawPath=function(a){var b=this._min,f=this._max,c=this._height,e=c/2;"hat"===this._style?(a.moveTo(b,e),a.lineTo((b+f)/2,"-"===this._strand?c:0)):a.moveTo(b,e);a.lineTo(f,e)};p.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};p.prototype.toSVG=function(){var a=new G;this.drawPath(a);a={d:a.toPathData(),
stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return A(y,"path",null,a)};g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};g.prototype.height=function(){return this._height};g.prototype.drawStemPath=function(a){var b=this._max,f=this._height/2;a.moveTo(this._min,f);a.lineTo(b,f)};g.prototype.drawTrigsPath=function(a){var b=this._min,f=this._max,c=this._height,e=c/2;a.moveTo(b,0);a.lineTo(b+c,e);a.lineTo(b,c);a.lineTo(b,0);a.moveTo(f,
0);a.lineTo(f-c,e);a.lineTo(f,c);a.lineTo(f,0)};g.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};g.prototype.toSVG=function(){var a=new G;this.drawStemPath(a);var b=new G;this.drawTrigsPath(b);return A(y,"g",[A(y,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),A(y,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};v.prototype=Object.create(q.prototype);v.prototype.min=
function(){return this._min};v.prototype.max=function(){return this._max};v.prototype.height=function(){return this._height};v.prototype.drawPath=function(a){var b=this._min,f=this._max,c=this._height;if(this._parallel){var e=c/2,g=0.4*c;this._sw?(a.moveTo(b+e,c-g),a.lineTo(b+e,c),a.lineTo(b,e),a.lineTo(b+e,0),a.lineTo(b+e,g)):(a.moveTo(b,c-g),a.lineTo(b,g));this._ne?(a.lineTo(f-e,g),a.lineTo(f-e,0),a.lineTo(f,e),a.lineTo(f-e,c),a.lineTo(f-e,c-g)):(a.lineTo(f,g),a.lineTo(f,c-g))}else{var e=(b+f)/
2,g=0.4*(f-b),m=c/3;this._ne?(a.moveTo(b+g,m),a.lineTo(b,m),a.lineTo(e,0),a.lineTo(f,m),a.lineTo(f-g,m)):(a.moveTo(b+g,0),a.lineTo(f-g,0));this._sw?(a.lineTo(f-g,c-m),a.lineTo(f,c-m),a.lineTo(e,c),a.lineTo(b,c-m),a.lineTo(b+g,c-m)):(a.lineTo(f-g,c),a.lineTo(b+g,c))}a.closePath()};r.prototype.min=function(){return this._min};r.prototype.max=function(){return this._max};r.prototype.height=function(){return this._height};r.prototype.toSVG=function(){return A(y,"rect",null,{x:this._min,y:0,width:this._max-
this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};r.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b+=3)a.moveTo(this._min,b),a.lineTo(this._max,b);a.stroke()}};O.prototype.min=function(){return this._min};O.prototype.max=function(){return Math.max(this._max,
this._min+this._textLen)};O.prototype.height=function(){return this._height};O.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};O.prototype.toSVG=function(){return A(y,"text",this._string,{x:this._min,y:this._height-4})};K.prototype.min=function(){return this._min};K.prototype.max=function(){return this._max};K.prototype.height=function(){return this._height};K.prototype.draw=function(a){var b=this._seq,f=this._fill;if(b){var c=(this._max-this._min+
1)/b.length,e=(3-this._readframe)%3,g=(b.length-e)%3,e="+"==this._orientation?e:g;0<e&&(a.fillStyle=f,a.fillRect(this._min,0,c*e,this._height));for(;e<b.length;e+=3){g=b.substr(e,3).toUpperCase();"-"==this._orientation&&(g=P(g));var m=g in D?D[g]:"?",f=3==g.length?Q(m,e,this._fill):this._fill;a.fillStyle=f;a.fillRect(this._min+e*c,0,c*g.length,this._height);8<=c&&3==g.length&&(a.fillStyle="white",a.fillText(m,this._min+(e+1)*c,this._height))}}};K.prototype.toSVG=function(){var a=A(y,"g"),b=this._seq,
f=this._fill;if(!b)return a;var c=(this._max-this._min+1)/b.length,e=(3-this._readframe)%3,g=(b.length-e)%3,e="+"==this._orientation?e:g;for(0<e&&a.appendChild(A(y,"rect",null,{x:this._min,y:0,width:c*e,height:this._height,fill:f}));e<b.length;e+=3){g=b.substr(e,3).toUpperCase();"-"==this._orientation&&(g=P(g));var m=g in D?D[g]:"?",f=3==g.length?Q(m,e,this._fill):this._fill;a.appendChild(A(y,"rect",null,{x:this._min+e*c,y:0,width:c*g.length,height:this._height,fill:f}));8<=c&&3==g.length&&a.appendChild(A(y,
"text",m,{x:this._min+(e+1)*c,y:this._height,fill:"white"}))}return a};(function(a){function b(a,f,c,e,g,k,m,p,r,h){this.baseColors=a;this._strandColor=f;this._min=c;this._max=e;this._height=g;this._seq=k;this._ref=m;this._scheme=p;this._quals=r;this._fillbg=h}var f=1<window.devicePixelRatio,c={},e=/^[ACGT-]$/;b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this._height};b.prototype.alphaForQual=function(a){return 0.1+
0.9*Math.max(0,Math.min(1*a/30,1))};b.prototype.draw=function(a){var b=this._seq,g=this._ref,k="mismatch-all"===this._scheme,m=b?b.length:this._max-this._min+1,p=(this._max-this._min+1)/m;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=p||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var r=0;r<m;++r){var h=b?b.substr(r,1).toUpperCase():"N";if(e.test(h)||8<=p){var d=this.baseColors[h];if(this._quals){var l=this._quals.charCodeAt(r)-
33,v=a.globalAlpha;a.globalAlpha=this.alphaForQual(l)}d||(l=g?g.substr(r,1).toUpperCase():"N",d="N"==h||"N"==l?"gray":this._strandColor,k&&(h=l));a.fillStyle=d;l=e.test(h);!this._fillbg&&8<=p&&l||a.fillRect(this._min+r*p,0,p,this._height);if(8<=p&&l){var l=d+"_"+h,n=c[l];if(!n){n=document.createElement("canvas");f?(n.width=16,n.height=20):(n.width=8,n.height=10);var E=n.getContext("2d");f&&E.scale(2,2);E.fillStyle=this._fillbg?"black":d;d=E.measureText(h).width;E.fillText(h,0.5*(8-d),8);c[l]=n}f?
a.drawImage(n,this._min+r*p+0.5*(p-8),0,8,10):a.drawImage(n,this._min+r*p+0.5*(p-8),0)}this._quals&&(a.globalAlpha=v)}}};b.prototype.toSVG=function(){for(var a=this._seq,b=this._ref,f="mismatch-all"===this._scheme,c=(this._max-this._min+1)/this._seq.length,g=A(y,"g"),k=0;k<a.length;++k){var m=a?a.substr(k,1).toUpperCase():"N",p=this.baseColors[m];if(!p){var r=b?b.substr(k,1).toUpperCase():"N",p="N"==m||"N"==r?"gray":this._strandColor;f&&(m=r)}r=1;this._quals&&(r=this._quals.charCodeAt(k)-33,r=this.alphaForQual(r));
var h=e.test(m);!this._fillbg&&8<=c&&h||g.appendChild(A(y,"rect",null,{x:this._min+k*c,y:0,width:c,height:this._height,fill:p,fillOpacity:r}));8<=c&&h&&g.appendChild(A(y,"text",m,{x:this._min+(0.5+k)*c,y:8,textAnchor:"middle",fill:this._fillbg?"black":p,fillOpacity:r}))}return g};a.SequenceGlyph=b})(this);x.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};x.prototype.min=function(){return this.glyph.min()+this._x};x.prototype.max=function(){return this.glyph.max()+
this._x};x.prototype.minY=function(){return this._y};x.prototype.maxY=function(){return this._y+this.glyph.height()};x.prototype.draw=function(a,b){a.save();a.translate(this._x,this._y);this.glyph.draw(a,b);a.restore()};x.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};F.prototype.min=function(){return this._x-2};F.prototype.max=function(){return this._x+2};F.prototype.height=function(){return this._height};F.prototype.draw=
function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};F.prototype.toSVG=function(){return A(y,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};w.prototype.notSelectable=!0;w.prototype.min=function(){return-1E5};w.prototype.max=function(){return 1E5};w.prototype.height=function(){return this._height};w.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=
0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);a.stroke();a.restore()};w.prototype.toSVG=function(){for(var a=new G,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);return A(y,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};H.prototype=Object.create(q.prototype);H.prototype.min=function(){return this._x-this._r};H.prototype.max=function(){return this._x+this._r};H.prototype.height=function(){return 2*this._r};H.prototype.drawPath=function(a){for(var b=
this._x,f=this._r,c=this._r,e=0;e<this._points;++e){var g=6.28*e/this._points,m=b+c*Math.sin(g),g=f-c*Math.cos(g);0==e?a.moveTo(m,g):a.lineTo(m,g);g=6.28*(e+0.5)/this._points;m=b+0.4*c*Math.sin(g);g=f-0.4*c*Math.cos(g);a.lineTo(m,g)}a.closePath()};f.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=
this._stroke,a.stroke())};f.prototype.toSVG=function(){var a=this._hh;return A(y,"g",[A(y,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),A(y,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};f.prototype.min=function(){return this._x-this._hh};f.prototype.max=function(){return this._x+this._hh};f.prototype.height=function(){return this._height};E.prototype.translate=function(a,b){this.ox+=a;this.oy+=b};E.prototype.registerGlyph=
function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};E.prototype.draw=function(a,b,f){for(var c=0;c<this.glyphs.length;++c){var e=this.glyphs[c];a.save();a.translate(e.x,e.y);e.glyph.drawOverlay(a,b,f);a.restore()}};"undefined"!==typeof u&&(u.exports={BoxGlyph:n,GroupGlyph:l,LineGraphGlyph:h,LabelledGlyph:t,CrossGlyph:z,ExGlyph:B,TriangleGlyph:c,DotGlyph:a,PaddedGlyph:b,AArrowGlyph:e,SpanGlyph:m,LineGlyph:p,PrimersGlyph:g,ArrowGlyph:v,TooManyGlyph:r,TextGlyph:O,SequenceGlyph:this.SequenceGlyph,
AminoAcidGlyph:K,TranslatedGlyph:x,GridGlyph:w,StarGlyph:H,PointGlyph:F,PlimsollGlyph:f,OverlayLabelCanvas:E})},{"./spans":36,"./svg-utils":39,"./utils":49}],22:[function(d,u,s){function q(d,h){this.base=d;this.query=h}if("undefined"!==typeof d)var n=d("./das").DASFeature;q.prototype.features=function(d,h,t){url=this.base+"/features/"+d.name;h=[];this.query&&h.push(this.query);d.isBounded&&(h.push("start="+d.start),h.push("end="+d.end));0<h.length&&(url=url+"?"+h.join("&"));var q=new XMLHttpRequest;
q.onreadystatechange=function(){if(4==q.readyState)if(300<=q.status)t(null,"Error code "+q.status);else{var h=JSON.parse(q.response).features,c=[];for(fi=0;fi<h.length;++fi){var a=h[fi],b=new n;b.segment=d.name;b.min=(a.start|0)+1;b.max=a.end|0;a.name&&(b.label=a.name);b.type=a.type||"unknown";c.push(b)}t(c)}};q.open("GET",url,!0);q.responseType="text";q.send("")};"undefined"!==typeof u&&(u.exports={JBrowseStore:q})},{"./das":10}],23:[function(d,u,s){function q(){var a=this;this.reqs=[];this.awaitedFeatures=
{};this.requestsIssued=new x(function(b,c){a.notifyRequestsIssued=b})}function n(a,b,c,f,e,g,m){this.chr=a;this.min=b;this.max=c;this.coverage=m;this.scale=f;this.features=e||[];this.status=g}function l(a,b,c,f,e,g){this.tierMap=a;this.chr=b;this.min=c;this.max=f;this.scale=e;this.seqSource=g||new p;this.viewCount=0;this.featureCache={};this.latestViews={}}function h(a,b,c){for(var f=[],e={},g=0;g<a.length;++g){var m=a[g];m.min&&m.max?m.groups&&0<m.groups.length?z(e,m.groups[0].id,m):m.min<=c&&m.max>=
b&&f.push(m):f.push(m)}for(var p in e){a=e[p];for(var r=1E11,h=-1E11,g=0;g<a.length;++g)m=a[g],r=Math.min(r,m.min),h=Math.max(h,m.max);if(r<=c||h>=b)for(g=0;g<a.length;++g)f.push(a[g])}return f}if("undefined"!==typeof d){s=d("./utils");var t=s.Awaited,z=s.pusho;s=d("./sourceadapters");var B=s.MappedFeatureSource,c=s.CachingFeatureSource,a=s.BWGFeatureSource,b=s.RemoteBWGFeatureSource,e=s.BAMFeatureSource,m=s.RemoteBAMFeatureSource,p=s.DummySequenceSource,g=s.DummyFeatureSource,v=d("./overlay").OverlayFeatureSource;
s=d("./spans");var r=s.Range,O=s.intersection;s=d("./sample");var Q=s.downsample,P=s.getBaseCoverage,K=d("./das").DASSequence,x=d("es6-promise").Promise}q.prototype.addRequest=function(a){this.reqs.push(a)};q.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};n.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};l.prototype.cancel=function(){this.cancelled=!0};l.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?
a:null};l.prototype.viewFeatures=function(a,b,c,f){if(f!=f)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=c;this.scale=f;this.pool&&this.pool.abortAll();this.pool=new q;this.awaitedSeq=new t;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};l.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};
l.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,f=!1,e,g=0;g<a.length;++g)try{this.startFetchesFor(a[g],c)&&(f=!0)}catch(m){e=a[g],e.currentFeatures=[],e.currentSequence=null,e.draw(),e.updateHeight(),e.updateStatus(m),console.log("Error fetching tier source"),console.log(m),e=m}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var p=this.min,r=this.max;if(this.cs&&this.cs.start<=p&&this.cs.end>=r)return a=this.cs.start==p&&this.cs.end==r?this.cs:new K(this.cs.name,p,
r,this.cs.alphabet,this.cs.seq.substring(p-this.cs.start,r+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,p,r,this.pool,function(a,f){if(f){if(!b.cs||p<=b.cs.start&&r>=b.cs.end||p>=b.cs.end||r<=b.cs.start||r-p>b.cs.end-b.cs.start)b.cs=f;c.provide(f)}else console.log("Sequence loading failed",a),c.provide(null)})}if(e)throw e;};l.prototype.startFetchesFor=function(a,b){var c=this,f=this.viewCount,e=a.getSource()||new g,m=a.needsSequence(this.scale),p=c.featureCache[a],d=a.getActiveStyleFilters(this.scale),
l;d&&(l=d.typeList());var v=this.chr,t=this.min,k=this.max;if(void 0===l)return!1;if(p&&p.chr===this.chr&&p.min<=t&&p.max>=k){var q=p.features;if(p.min<t||p.max>k)q=h(q,t,k);c.provision(a,p.chr,O(p.coverage,new r(t,k)),p.scale,l,q,p.status,m?b:null);q=e.getScales();if(p.scale<=this.scale||!q)return m}e.instrument&&console.log("Starting  fetch "+f+" ("+t+", "+k+")");e.fetch(v,t,k,this.scale,l,this.pool,function(g,h,d,q){e.instrument&&console.log("Finishing fetch "+f);var x=c.latestViews[a]||-1;if(!(c.cancelled||
x>f)){q||(q=new r(t,k));if(!p||t<p.min||k>p.max)c.featureCache[a]=new n(v,t,k,d,h,g,q);c.latestViews[a]=f;c.provision(a,v,q,d,l,h,g,m?b:null)}},d);return m};l.prototype.provision=function(g,p,r,f,h,d,l,n){l&&(g.currentFeatures=[],g.currentSequence=null,g.draw(),g.updateHeight());g.updateStatus(l);if(!l){for(var t=l=!1,q=g.getSource();B.prototype.isPrototypeOf(q)||c.prototype.isPrototypeOf(q)||v.prototype.isPrototypeOf(q);)q=v.prototype.isPrototypeOf(q)?q.sources[0]:q.source;if(a.prototype.isPrototypeOf(q)||
b.prototype.isPrototypeOf(q)||e.prototype.isPrototypeOf(q)||m.prototype.isPrototypeOf(q))l=!0;q.opts&&(q.opts.forceReduction||q.opts.noDownsample)||l&&h&&1==h.length&&0<=h.indexOf("density")&&(d=Q(d,this.scale));h&&1==h.length&&0<=h.indexOf("base-coverage")&&(t=!0);n?n.await(function(a){t&&(d=P(d,a,g.browser.baseColors));g.viewFeatures(p,r,f,d,a)}):g.viewFeatures(p,r,f,d)}};"undefined"!==typeof u&&(u.exports={KnownSpace:l})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,"./spans":36,
"./utils":49,"es6-promise":53}],24:[function(d,u,s){function q(a,b){this.block=a;this.offset=b}function n(a,b){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),m=a[b+1]<<8|a[b];return 0==c&&0==m?null:new q(c,m)}function l(a,b){b=Math.min(b||1,a.byteLength-50);for(var e=[],m=[0],p=0;m[0]<b;){var g=new Uint8Array(a,m[0],12),g=g[11]<<8|g[10],g=B(a,12+g+m[0],Math.min(65536,a.byteLength-12-g-m[0]),m);m[0]+=8;p+=g.byteLength;e.push(g)}if(1==e.length)return e[0];
m=new Uint8Array(p);for(g=p=0;g<e.length;++g){var h=new Uint8Array(e[g]);c(h,0,m,p,h.length);p+=h.length}return m.buffer}function h(a,b){this.minv=a;this.maxv=b}function t(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}function z(a,b){var c,m=[];--b;m.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)m.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)m.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)m.push(c);for(c=585+(a>>17);c<=
585+(b>>17);++c)m.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)m.push(c);return m}if("undefined"!==typeof d){d=d("jszlib");var B=d.inflateBuffer,c=d.arrayCopy}q.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof u&&(u.exports={unbgzf:l,readVob:n,reg2bin:t,reg2bins:z,Chunk:h})},{jszlib:65}],25:[function(d,u,s){function q(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function n(c){this.source=c;t.call(this);this.storeHolder=new z;this.parser=h(c.payload);
if(!this.parser)throw"Unsupported memstore payload: "+c.payload;var a=this;this._load(function(b,c){if(b){for(var m=new q,p=[],g=b.split("\n"),h=a.parser.createSession(function(a){p.push(a)}),r=0;r<g.length;++r){var d=g[r];0<d.length&&h.parse(d)}h.flush();m.addFeatures(p);a.storeHolder.provide(m)}else a.error=c||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof d){u=d("./sourceadapters");var l=u.registerSourceAdapterFactory,h=u.makeParser,t=u.FeatureSourceBase;d("./das");d=d("./utils");
var z=d.Awaited,B=d.textXHR}q.prototype.addFeatures=function(c){for(var a={},b=0;b<c.length;++b){var e=c[b],m=e.segment||e.chr,p=this.featuresByChr[m];p||(p=[],this.featuresByChr[m]=p);p.push(e);a[m]=!0;e=e.max-e.min+1;e>this.maxLength&&(this.maxLength=e)}for(m in a)p=this.featuresByChr[m],p.sort(function(a,b){var c=a.min-b.min;return 0!=c?c:a.max-b.max});this.chrRing=null};q.prototype._indexFor=function(c,a){for(var b=0,e=c.length;e>b;){var m=(b+e)/2|0;if(m>=c.length)return c.length;a<c[m].min?e=
m:b=m+1}return e};q.prototype.fetch=function(c,a,b){var e=this.featuresByChr[c];e||(e=0==c.indexOf("chr")?this.featuresByChr[c.substring(3)]:this.featuresByChr["chr"+c]);if(!e)return[];var m=Math.max(0,this._indexFor(e,a-this.maxLength-1));c=Math.min(e.length-1,this._indexFor(e,b));for(var p=[];m<=c;++m){var g=e[m];g.min<=b&&g.max>=a&&p.push(g)}return p};q.prototype.findNextFeature=function(c,a,b){if(null==this.chrRing){this.chrRing=[];for(c in this.featuresByChr)this.chrRing.push(c);this.chrRing.sort()}var e=
this.featuresByChr[c];e||(c=0==c.indexOf("chr")?c.substring(3):"chr"+c,e=this.featuresByChr[c]);if(!e)return null;var m=Math.max(0,Math.min(this._indexFor(e,a),e.length-1));if(0<b){for(;m<e.length;){var p=e[m++];if(p.min>a)return p}c=this.chrRing.indexOf(c)+1;c>=this.chrRing.length&&(c=0);return this.findNextFeature(this.chrRing[c],0,b)}for(;0<=m;)if(p=e[m--],p.max<a)return p;c=this.chrRing.indexOf(c)-1;0>c&&(c=this.chrRing.length-1);return this.findNextFeature(this.chrRing[c],1E10,b)};n.prototype=
Object.create(t.prototype);n.prototype._load=function(c){if(this.source.blob){var a=new FileReader;a.onloadend=function(){return c(a.result,a.error)};a.readAsText(this.source.blob)}else{if(this.source.credentials)var b={credentials:this.source.credentials};B(this.source.uri,c,b)}};n.prototype.fetch=function(c,a,b,e,m,p,g){var h=this;this.storeHolder.await(function(e){return e?(e=e.fetch(c,a,b),g(null,e,1E8)):g(h.error)})};n.prototype.getStyleSheet=function(c){this.parser&&this.parser.getStyleSheet&&
this.parser.getStyleSheet(c)};n.prototype.getDefaultFIPs=function(c){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(c)};n.prototype.getScales=function(){return 1E8};n.prototype.findNextFeature=function(c,a,b,e){var m=this;this.storeHolder.await(function(p){return p?e(p.findNextFeature(c,a,b)):e(null,m.error)})};n.prototype.capabilities=function(){return{leap:!0}};l("memstore",function(c){return{features:new n(c)}})},{"./das":10,"./sourceadapters":34,"./utils":49}],26:[function(d,
u,s){function q(d){return(d|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function n(d){d=""+d;var h=d.indexOf(".");if(0>h)return d;var n=2;"-"==d.substring(0,1)&&++n;return h>=n?d.substring(0,h):d.substring(0,h+2)}"undefined"!==typeof u&&(u.exports={formatLongInt:q,formatQuantLabel:n})},{}],27:[function(d,u,s){function q(d,c){this.sources=d;this.opts=c||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var a=0;a<this.sources.length;++a)this.initN(a);
"function"===typeof c.merge?this.merge=c.merge:"concat"==c.merge?this.merge=h:"alternates"==c.merge?(this.merge=h,this.filterDispatchOnMethod=!0):this.merge=l}function n(h,c,a){this.source=h;this.callback=c;this.sources=a;this.count=a.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function l(h){for(var c=[],a=1;a<h.length;++a){for(var b={},e=h[a],m=0;m<e.length;++m)b[this.keyForFeature(e[m])]=e[m];c.push(b)}a=[];h=h[0];for(m=0;m<h.length;++m){for(var p=
h[m],g=0;g<c.length;++g)if(b=c[g],e=b[this.keyForFeature(p)])for(var d in e)"score"===d?p.score2=e.score:"min"!==d&&"max"!==d&&"segment"!==d&&"_cachedStyle"!==d&&(p[d]=e[d]);a.push(p)}return a}function h(h,c){for(var a=[],b=0;b<h.length;++b)for(var e=h[b],m=c[b].name,p=0;p<e.length;++p){var g=e[p];g.method=m;a.push(g)}return a}if("undefined"!==typeof d){d=d("./utils");var t=d.shallowCopy,z=d.arrayIndexOf}q.prototype.initN=function(h){var c=this.sources[h],a=this;this.business[h]=0;c.addActivityListener&&
c.addActivityListener(function(b){a.business[h]=b;a.notifyActivity()});c.addChangeListener&&c.addChangeListener(function(){a.notifyChange()});c.addReadinessListener&&c.addReadinessListener(function(b){a.readiness[h]=b;a.notifyReadiness()})};q.prototype.addReadinessListener=function(h){this.readinessListeners.push(h);this.notifyReadinessListener(h)};q.prototype.removeReadinessListener=function(h){h=z(this.readinessListeners,h);0<=h&&this.readinessListeners.splice(h,1)};q.prototype.notifyReadiness=
function(){for(var h=0;h<this.readinessListeners.length;++h)this.notifyReadinessListener(this.readinessListeners[h])};q.prototype.notifyReadinessListener=function(h){for(var c=null,a=0;a<this.readiness.length;++a)if(null!=this.readiness[a]){c=this.readiness[a];break}try{h(c)}catch(b){console.log(b)}};q.prototype.addActivityListener=function(h){this.activityListeners.push(h)};q.prototype.removeActivityListener=function(h){h=z(this.activityListeners,h);0<=h&&this.activityListeners.splice(h,1)};q.prototype.notifyActivity=
function(){for(var h=0,c=0;c<this.business.length;++c)h+=this.business[c];for(c=0;c<this.activityListeners.length;++c)try{this.activityListeners[c](h)}catch(a){console.log(a)}};q.prototype.addChangeListener=function(h){this.changeListeners.push(h)};q.prototype.removeChangeListener=function(h){h=z(this.changeListeners,h);0<=h&&this.changeListeners.splice(h,1)};q.prototype.notifyChange=function(){for(var h=0;h<this.changeListeners.length;++h)try{this.changeListeners[h](this.busy)}catch(c){console.log(c)}};
q.prototype.getScales=function(){return this.sources[0].getScales()};q.prototype.getStyleSheet=function(h){return this.sources[0].getStyleSheet(h)};q.prototype.capabilities=function(){var h={},c=this.sources[0];c.capabilities&&(h=t(c.capabilities()));for(c=1;c<this.sources.length;++c){var a=this.sources[c];a.capabilities&&(a=a.capabilities(),a.search&&(h.search=a.search))}return h};q.prototype.search=function(h,c){for(var a=0;a<this.sources.length;++a){var b;b=this.sources[a];b=b.capabilities?b.capabilities().search:
!1;if(b)return this.sources[a].search(h,c)}};q.prototype.fetch=function(h,c,a,b,e,m,p,g){var d;if(this.filterDispatchOnMethod){d=[];for(var r=g.list(),l=0;l<this.sources.length;++l)for(var q=this.sources[l],t=0;t<r.length;++t){var z=r[t];if(!z.method||z.method==q.name){d.push(q);break}}}else d=this.sources;p=new n(this,p,d);for(l=0;l<d.length;++l)this.fetchN(p,l,d[l],h,c,a,b,e,m,g)};q.prototype.fetchN=function(h,c,a,b,e,m,p,g,d,r){a.fetch(b,e,m,p,g,d,function(a,b,e){return h.completed(c,a,b,e)},r)};
q.prototype.quantFindNextFeature=function(h,c,a,b,e){return this.sources[0].quantFindNextFeature(h,c,a,b,e)};q.prototype.findNextFeature=function(h,c,a,b){return this.sources[0].findNextFeature(h,c,a,b)};n.prototype.completed=function(h,c,a,b){if(null==this.scale||0==h)this.scale=b;if(this.returns[h])throw"Multiple returns for source "+h;this.returns[h]=!0;this.returnCount++;this.features[h]=a;c&&(this.statuses[h]=c,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){h="";
for(c=0;c<this.count;++c)if(a=this.statuses[c])0<h.length&&(h+=", "),h+=a;return this.callback(h,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};q.prototype.getDefaultFIPs=function(h){for(var c=0;c<this.sources.length;++c){var a=this.sources[c];a.getDefaultFIPs&&a.getDefaultFIPs(h)}};q.prototype.keyForFeature=function(h){return""+h.min+".."+h.max};"undefined"!==typeof u&&(u.exports={OverlayFeatureSource:q})},{"./utils":49}],28:[function(d,u,s){function q(p,
g,d){var r=/^\w+\s[0-9]+\s[0-9]+.*$/,O=/([^=]+)=\"?([^\"]+)\"?/,Q=/^##\s*fileformat=VCFv4\..+/;(p.blob?new h(p.blob):"encode"==p.transport?new m(p.uri):new l(p.uri,{credentials:p.credentials})).slice(0,65536).salted().fetch(function(m,h){if(!m)return d||(p.credentials=!0,q(p,g,!0)),g(p,"Couldn't fetch data");var l=new Uint8Array(m),s=(new Uint32Array(m,0,1))[0];if(s==z||s==B){p.tier_type="bwg";l=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(l=l.exec(p.uri||p.blob.name))p.name=l[1];return g(p,null)}if(s==
b)return p.tier_type="bai",g(p,null);if(31==l[0]||139==l[1]){l=c(m);l=new Uint8Array(l);s=t(l,0);if(s==a){p.tier_type="bam";l=/\/?([^/]+?)(.bam)?$/;if(l=l.exec(p.uri||p.blob.name))p.name=l[1];return g(p,null)}if(s==e)return p.tier_type="tabix-index",g(p,null);if(1768301347==s){p.tier_type="tabix";p.payload="vcf";l=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(l=l.exec(p.uri||p.blob.name))p.name=l[1];return g(p,null)}console.log("magic = "+s.toString(16));return g(p,"Unsupported format")}l=String.fromCharCode.apply(null,
l).split("\n");if(0<l.length&&Q.test(l[0]))return p.tier_type="memstore",p.payload="vcf",l=/\/?([^/]+?)(.vcf)?$/,(l=l.exec(p.uri||p.blob.name))&&!p.name&&(p.name=l[1]),g(p,null);for(var w=0;w<l.length;++w)if(s=l[w].replace("\r",""),0!=s.length&&0!=s.indexOf("browser")){if(0==s.indexOf("track")){l="bed";s=s.split(/\s/);for(w=1;w<s.length;++w){var u=O.exec(s[w]);u&&("type"==u[1]&&"wiggle_0"==u[2]?l="wig":"name"==u[0]&&(p.name=u[2]))}n(p,l);return g(p,null)}if(0==s.indexOf("fixedStep")||0==s.indexOf("variableStep"))return n(p,
"wig"),g(p,null);if(r.test(s))return n(p,null),g(p,null);break}return g(p,"Unsupported format")},{timeout:1500})}function n(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof d){s=d("./bin");var l=s.URLFetchable,h=s.BlobFetchable,t=s.readInt;s=d("./bigwig");var z=s.BIG_WIG_MAGIC,B=s.BIG_BED_MAGIC,c=d("./lh3utils").unbgzf;s=d("./bam");var a=s.BAM_MAGIC,b=s.BAI_MAGIC,e=d("./tabix").TABIX_MAGIC,
m=d("./encode").EncodeFetchable}"undefined"!==typeof u&&(u.exports={probeResource:q})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":41}],29:[function(d,u,s){function q(a){return b[a%b.length]*Math.pow(10,a/b.length|0)}function n(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=c;this.features=[]}function l(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function h(a,b){for(var c=0;q(c+1)<b;)++c;for(var c=q(c),g=[],h=
-1E10,r=1E10,d=0;d<a.length;++d){var l=a[d];if(l.groups&&0<l.groups.length)return a;for(var t=l.min/c|0,s=l.max/c|0,h=Math.max(h,s),r=Math.min(r,t);t<=s;++t){var x=g[t];x||(x=new n(c,t*c,(t+1)*c-1),g[t]=x);x.feature(l)}}d=[];for(t=r;t<=h;++t)if(x=g[t])l=new B,l.segment=a[0].segment,l.min=t*c+1,l.max=(t+1)*c,l.score=x.score(),l.type="density",d.push(l);Date.now();return d}function t(a){this._pos=a;this._bases={};this._totalCount=0}function z(b,m,h){for(var g,d,r=null,l=null,n=[],q=0;q<b.length;++q){var s=
b[q];if(s.groups&&0<s.groups.length)return b;g=s.seq;var x=s.quals,z=c(s.cigar),w=[];d=[];for(var u=0,f=0;f<z.length;++f){var E=z[f];if("M"==E.op)w.push(g.substr(u,E.cnt)),d.push(x.substr(u,E.cnt)),u+=E.cnt;else if("D"==E.op)for(var C=0;C<E.cnt;++C)w.push("-"),d.push("Z");else"I"==E.op?u+=E.cnt:"S"==E.op?u+=E.cnt:console.log("unknown cigop"+E.op)}g=w.join("");d=d.join("");w=g;u=d;f=s.orientation;E=s.min||0;s=s.max||0;d=0;for(g=E;g<=s;++g)z=n[g],z||(z=new t(g),n[g]=z),x=w.charAt(d),C=u.charCodeAt(d)-
33,z.recordBase(x,C,f),d++;r=r?Math.min(r,E):E;l=l?Math.max(l,s):s}s=r;q=l;d=[];if(m&&(g=m.start|0,z=m.end|0,g<=q&&z>=s)){x=Math.max(s,g);z=Math.min(q,z);for(w=0;w<x-s;w++)d.push("N");d.push(m.seq.substr(x-g,z-x+1));for(w=0;w<q-z;w++)d.push("N")}m=d.join("");q=[];d=0;for(g=r;g<=l;++g){if(z=n[g])if(s=new B,s.segment=b[0].segment,s.min=z.pos(),s.max=s.min,s.notes=[],s.notes=s.notes.concat(z.infoList()),s.type="base-coverage",s.suppressScore=!0,m)for(r=m.charAt(d),s.notes.unshift("Ref="+r),z=z.baseScoreList(r,
0.2),w=0;w<z.length;w++){x=z[w].base;u=z[w].score;f=a(s);f.score=u;if(1<z.length||x!=r)f.itemRgb=h[x];q.push(f)}else q.push(s);d++}return q}if("undefined"!==typeof d)var B=d("./das").DASFeature,c=d("./cigar").parseCigar,a=d("./utils").shallowCopy;var b=[1,2,5];n.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(l);for(var b=-1E10,c=0,g=0,h=1;h<a.length;++h){var r=a[h],d=Math.max(r.min,this.min),r=Math.min(r.max,this.max),g=g+(r-
d+1);d>b?(c+=r-d+1,b=r):r>b&&(c+=r-b,b=r)}return 0<c?1*g/c:0};n.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};t.prototype.recordBase=function(a,b,c){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[c]++;else{var g={"+":0,"-":0};g[c]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:g}}this._totalCount++};t.prototype.totalCount=function(){return this._totalCount};t.prototype.pos=function(){return this._pos};t.prototype.infoList=
function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());for(var c in this._bases){var g=this._bases[c],h=g.cnt,r=g.strandCnt["+"],d=g.strandCnt["-"],g=g.totalQual/h,h=[c,"=",h," (",(100*h/b).toFixed(0),"%, ",r," +, ",d," -, Qual: ",g.toFixed(0),")"];a.push(h.join(""))}return a};t.prototype.baseScoreList=function(a,b){var c=[],g=this._totalCount,h=b*g,r;for(r in this._bases){var d=this._bases[r].cnt;d<h||r==a||(c.push({base:r,score:g}),g-=d)}c.push({base:a,score:g});return c};"undefined"!==
typeof u&&(u.exports={downsample:h,getBaseCoverage:z})},{"./cigar":8,"./das":10,"./utils":49}],30:[function(d,u,s){function q(h,d){var c=parseFloat(h.replace(/,/g,""));return"k"===d||"K"===d?1E3*c|0:"m"==d||"M"===d?1E6*c|0:c|0}if("undefined"!==typeof d)var n=d("./cbrowser").Browser,l=d("./bin").URLFetchable,h=d("./trix").connectTrix;var t=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;n.prototype.search=function(d,n){var c=this,a=t.exec(d);if(a){var b=a[1],e;if(a[6])e=
q(a[2],a[3]),a=q(a[6],a[7]);else{var m=this.viewEnd-this.viewStart+1;e=q(a[2],a[3])-m/2|0;a=e+m-1}this.setLocation(b,e,a,n)}else{if(!d||0==d.length)return!1;var p=0,g=!1,v=function(a,b){--p;if(b)return n(b);a||(a=[]);for(var e=5E8,m=-1E8,h=null,r=0;r<a.length;++r){var l=a[r];null==h&&(h=l.segment);e=Math.min(e,l.min);m=Math.max(m,l.max)}if(h)g=!0,c.highlightRegion(h,e,m),r=Math.max(2500,0.3*(m-e+1)|0),c.setLocation(h,e-r,m+r,n);else if(0==p&&!g)return n("no match for '"+d+"'")},r=function(a,b){b.lookup(d,
function(b,c){if(null==b||2>b.length)return a.featureSource.search(d,v);var e=b[1].split(",")[0];return a.featureSource.search(e,v)})};if(this.searchEndpoint)return p=1,this.doDasSearch(c.searchEndpoint,d,v);for(b=0;b<this.tiers.length;++b)(function(a){c.sourceAdapterIsCapable(a.featureSource,"search")?a.dasSource.trixURI?(++p,a.trix?r(a,a.trix):h(new l(a.dasSource.trixURI),new l(a.dasSource.trixURI+"x"),function(b){a.trix=b;r(a,b)})):(++p,a.featureSource.search(d,v)):a.dasSource.provides_search&&
(++p,c.doDasSearch(a.dasSource,d,v))})(this.tiers[b])}};n.prototype.doDasSearch=function(h,d,c){h.features(null,{group:d,type:"transcript"},function(a){a||(a=[]);for(var b=[],e=0;e<a.length;++e){var m=a[e];m.label.toLowerCase()==d.toLowerCase()&&b.push(m)}return c(b)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":47}],31:[function(d,u,s){function q(b,e){e||(e=c);for(var m=a.length;b*a[m%a.length]*Math.pow(10,m/a.length|0)<e;)++m;return a[m%a.length]*Math.pow(10,m/a.length|0)}function n(a,c){var m=a.viewport.getContext("2d"),
h=a.browser.retina&&1<window.devicePixelRatio,g=a.browser.featurePanelWidth+2E3;h&&(g*=2);var d=a.viewport.width|0;d<g-50&&(a.viewport.width=d=g);g=50;c&&c.seq&&(g+=25);var r=g;h&&(r*=2);a.viewport.height=r;a.viewport.style.height=""+g+"px";a.viewport.style.width=h?""+d/2+"px":""+d+"px";a.layoutHeight=g;a.updateHeight();a.background&&(m.fillStyle=a.background,m.fillRect(0,0,d,a.viewport.height));h&&m.scale(2,2);m.translate(1E3,0);l(a,c,m);a.norigin=a.browser.viewStart;a.viewportHolder.style.left=
"-1000px"}function l(a,c,m){var h=a.browser.scale,g=a.browser.viewStart-1E3/h|0,d=a.browser.viewEnd+2E3/h,r=a.browser.currentSeqMax,l=d;0<r&&r<d&&(l=r);for(var n=q(h),s=Math.max(0,(g/n|0)*n),r=a.browser.viewStart;s<=l;)m.fillStyle=0==s/n%2?"white":"black",m.strokeStyle="black",m.fillRect((s-r)*h,8,n*h,3),m.strokeRect((s-r)*h,8,n*h,3),m.fillStyle="black",m.fillText(t(s),(s-r)*h,22),s+=n;if(c&&c.seq)for(;g<=d;++g)g>=c.start&&g<=c.end&&(l=c.seq.substr(g-c.start,1).toUpperCase(),(n=a.browser.baseColors[l])||
(n="gray"),m.fillStyle=n,8<=h?(n=m.measureText(l).width,m.fillText(l,(g-r)*h+0.5*(h-n),52)):m.fillRect((g-r)*h,42,h,12))}function h(a,c){var m=a.browser.scale,h=a.browser.viewStart-1E3/m|0,g=a.browser.viewEnd+2E3/m,d=a.browser.currentSeqMax,r=g;0<d&&d<g&&(r=d);for(var l=q(m),n=Math.max(0,(h/l|0)*l),d=a.browser.viewStart,s=z(B,"g",[],{fontSize:"8pt"});n<=r;)s.appendChild(z(B,"rect",null,{x:(n-d)*m,y:8,width:l*m,height:3,fill:0==n/l%2?"white":"black",stroke:"black"})),s.appendChild(z(B,"text",t(n),
{x:(n-d)*m,y:28,fill:"black",stroke:"none"})),n+=l;if(c&&c.seq)for(;h<=g;++h)h>=c.start&&h<=c.end&&(r=c.seq.substr(h-c.start,1).toUpperCase(),(l=a.browser.baseColors[r])||(l="gray"),8<=m?s.appendChild(z(B,"text",r,{x:(0.5+h-d)*m,y:52,textAnchor:"middle",fill:l})):s.appendChild(z(B,"rect",null,{x:(h-d)*m,y:42,width:m,height:12,fill:l})));return s}if("undefined"!==typeof d){s=d("./utils");var t=s.formatLongInt,z=s.makeElementNS,B=d("./svg-utils").NS_SVG,t=d("./numformats").formatLongInt}var c=100,a=
[1,2,5],B="http://www.w3.org/2000/svg";"undefined"!==typeof u&&(u.exports={drawSeqTier:n,drawSeqTierGC:l,svgSeqTier:h})},{"./numformats":26,"./svg-utils":39,"./utils":49}],32:[function(d,u,s){if("undefined"!=typeof d){var q=d("./cbrowser").Browser;u=d("./sourcecompare");var n=u.sourceDataURI,l=u.sourcesAreEqual,h=d("./version"),t=d("./utils").miniJSONify,z=d("./sha1").hex_sha1}q.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+
this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+
this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};q.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};q.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+
this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};q.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var d=[],c=0;c<this.tiers.length;++c){var a=this.tiers[c];a.dasSource.noPersist||d.push({source:a.dasSource,config:a.config||
{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(d);d={};c=[];for(a=0;a<this.hubObjects.length;++a){var b=this.hubObjects[a],e={url:b.hub.url,genome:b.genome};b.credentials&&(e.credentials=b.credentials);b.mapping&&(e.mapping=b.mapping);d[e.url]=!0;c.push(e)}for(a=0;a<this.hubs.length;++a)e=this.hubs[a],"string"===typeof e&&(e={url:e}),d[e.url]||c.push(e);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(c);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=
this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=h.CONFIG}};
q.prototype.restoreStatus=function(){if(!this.noPersist){var d=localStorage["dalliance."+this.cookieKey+".version"];if(h.CONFIG==(d?d|0:-100)){var d=localStorage["dalliance."+this.cookieKey+".configHash"]||"",c=z(t({sources:this.sources,hubs:this.hubs}));if(c!=d)localStorage["dalliance."+this.cookieKey+".configHash"]=c;else{d={};for(c=0;c<this.sources.length;++c){var a=this.sources[c];if(a){var b=n(a),e=d[b];e||(d[b]=e=[]);e.push(a)}}if(!this.noPersistView&&(c=localStorage["dalliance."+this.cookieKey+
".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,e=localStorage["dalliance."+this.cookieKey+".view-end"]|0,c&&a&&e)){this.chr=c;this.viewStart=a;this.viewEnd=e;if(c=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=c|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];c=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof c||isNaN(c)||(this.savedZoom=c)}this.reverseScrolling=
(c=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==c;this.reverseKeyScrolling=(c=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==c;this.singleBaseHighlight=(c=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==c;if(c=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=c;if(c=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===c;if(c=localStorage["dalliance."+this.cookieKey+
".export-highlights"])this.exportHighlights="true"===c;if(c=localStorage["dalliance."+this.cookieKey+".sources"]){var m=JSON.parse(c);this.sources=[];this.restoredConfigs=[];for(c=0;c<m.length;++c)for(a=this.sources[c]=m[c].source,this.restoredConfigs[c]=m[c].config,b=n(a),e=d[b]||[],b=0;b<e.length;++b){var p=e[b];if(l(a,p))for(var g in p)p.hasOwnProperty(g)&&("function"===typeof p[g]||p[g]instanceof Blob)&&(a[g]=p[g])}}if(g=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(g);
return!0}}}};q.prototype.reset=function(){for(var h=this.tiers.length-1;0<=h;--h)this.removeTier({index:h},!0);for(h=0;h<this.defaultSources.length;++h)this.defaultSources[h].disabled||this.addTier(this.defaultSources[h]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./sourcecompare":35,"./utils":49,"./version":51}],33:[function(d,u,s){function q(c){c=l(h(c));for(var a=z?"0123456789ABCDEF":"0123456789abcdef",
b="",e,m=0;m<c.length;m++)e=c.charCodeAt(m),b+=a.charAt(e>>>4&15)+a.charAt(e&15);return b}function n(c){c=l(h(c));for(var a="",b=c.length,e=0;e<b;e+=3)for(var m=c.charCodeAt(e)<<16|(e+1<b?c.charCodeAt(e+1)<<8:0)|(e+2<b?c.charCodeAt(e+2):0),d=0;4>d;d++)a=8*e+6*d>8*c.length?a+B:a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>6*(3-d)&63);return a}function l(c){for(var a=Array(c.length>>2),b=0;b<a.length;b++)a[b]=0;for(b=0;b<8*c.length;b+=8)a[b>>5]|=(c.charCodeAt(b/8)&
255)<<24-b%32;c=8*c.length;a[c>>5]|=128<<24-c%32;a[(c+64>>9<<4)+15]=c;c=Array(80);for(var b=1732584193,e=-271733879,m=-1732584194,h=271733878,g=-1009589776,d=0;d<a.length;d+=16){for(var r=b,l=e,n=m,q=h,s=g,x=0;80>x;x++){if(16>x)c[x]=a[d+x];else{var z=c[x-3]^c[x-8]^c[x-14]^c[x-16];c[x]=z<<1|z>>>31}var z=b<<5|b>>>27,w;w=20>x?e&m|~e&h:40>x?e^m^h:60>x?e&m|e&h|m&h:e^m^h;z=t(t(z,w),t(t(g,c[x]),20>x?1518500249:40>x?1859775393:60>x?-1894007588:-899497514));g=h;h=m;m=e<<30|e>>>2;e=b;b=z}b=t(b,r);e=t(e,l);
m=t(m,n);h=t(h,q);g=t(g,s)}a=[b,e,m,h,g];c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>24-b%32&255);return c}function h(c){for(var a="",b=-1,e,m;++b<c.length;)e=c.charCodeAt(b),m=b+1<c.length?c.charCodeAt(b+1):0,55296<=e&&56319>=e&&56320<=m&&57343>=m&&(e=65536+((e&1023)<<10)+(m&1023),b++),127>=e?a+=String.fromCharCode(e):2047>=e?a+=String.fromCharCode(192|e>>>6&31,128|e&63):65535>=e?a+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|e&63):2097151>=e&&(a+=String.fromCharCode(240|
e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|e&63));return a}function t(c,a){var b=(c&65535)+(a&65535);return(c>>16)+(a>>16)+(b>>16)<<16|b&65535}var z=0,B="";"undefined"!==typeof u&&(u.exports={b64_sha1:n,hex_sha1:q})},{}],34:[function(d,u,s){function q(a,b){ka[a]=b}function n(a,b){la[a]=b}function l(a){if(la[a])return la[a](a)}function h(a){var b=this;this.source=a;this.cfsid="cfs"+ ++ma;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){b.cfsid="cfs"+ ++ma})}function t(){this.busy=
0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function z(a){this.dasSource=new E(a);this.busy=0;this.activityListeners=[]}function B(a){this.dasSource=new E(a);this.awaitedEntryPoints=new K;var b=this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}function c(a){var b=this;this.source=a;this.twoBit=new K;if(a.twoBitURI)a=new y(a.twoBitURI);else if(a.twoBitBlob)a=new G(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");k(a,function(a,
f){f?console.log(f):b.twoBit.provide(a)})}function a(a){t.call(this);var b=this;this.readiness="Connecting";this.bwgSource=this.opts=a;b.bwgHolder=new K;if(this.opts.preflight){var f=fa[this.opts.preflight];if(!f){f=new K;fa[this.opts.preflight]=f;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?f.provide("success"):f.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials=!0);c.send("")}f.await(function(a){"success"===
a&&b.init()})}else b.init()}function b(a,b){t.call(this);this.worker=b;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new K;this.init()}function e(a,b){if(!(a.flag&L.SEGMENT_UNMAPPED)){var f;f=a.seq?a.seq.length:a.seqLength;if(a.cigar){f=0;for(var c=ha(a.cigar),e=0;e<c.length;++e){var g=c[e];if("M"==g.op||"D"==g.op)f+=g.cnt}}c=new J;c.min=a.pos+1;c.max=a.pos+f;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;c.orientation=
a.flag&L.REVERSE_COMPLEMENT?"-":"+";c.bamRecord=a;b&&a.flag&L.MULTIPLE_SEGMENTS&&(c.groups=[{id:a.readName,type:"readpair"}]);return c}}function m(a){t.call(this);var b=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new K;if(this.opts.preflight){var f=fa[this.opts.preflight];if(!f){f=new K;fa[this.opts.preflight]=f;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?f.provide("success"):f.provide("failure"))};
c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials="true");c.send("")}f.await(function(a){"success"===a&&b.init()})}else b.init()}function p(a,b){t.call(this);this.bamSource=a;this.worker=b;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new K;this.init()}function g(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}function v(){}function r(){}function O(a){this.store=new U(a.jbURI,
a.jbQuery)}if("undefined"!==typeof d){var Q=d("./cbrowser").Browser,P=d("./tier").DasTier;s=d("./utils");var K=s.Awaited,x=s.arrayIndexOf,F=s.shallowCopy,w=s.resolveUrlToPage;s=d("./das");var H=s.DASStylesheet,f=s.DASStyle,E=s.DASSource,C=s.DASSegment,J=s.DASFeature,A=s.DASSequence,D=s.DASLink;s=d("./bin");var y=s.URLFetchable,G=s.BlobFetchable,k=d("./twoBit").makeTwoBit,I=d("./bigwig").makeBwg;s=d("./bam");var S=s.makeBam,L=s.BamFlags;s=d("./spans");var R=s.Range,V=s.union,ha=d("./cigar").parseCigar,
$=d("./overlay").OverlayFeatureSource,U=d("./jbjson").JBrowseStore,aa=d("./chainset").Chainset;d("./style");var Y=d("./encode").EncodeFetchable}var ka={},la={};P.prototype.initSources=function(){var a=this,b=this.browser.createSources(this.dasSource);this.featureSource=b.features||new v;this.sequenceSource=b.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};Q.prototype.createSources=function(f){var e=this.sourceCache.get(f);
if(e)return e;var k,d;if("sequence"==f.tier_type||f.twoBitURI||f.twoBitBlob)d=f.twoBitURI||f.twoBitBlob?new c(f):new B(f);else if(f.tier_type&&ka[f.tier_type])d=(0,ka[f.tier_type])(f),k=d.features,d=d.sequence;else if(f.bwgURI||f.bwgBlob)k=(k=this.getWorker())?new b(f,k):new a(f);else if(f.bamURI||f.bamBlob)k=(k=this.getWorker())?new p(f,k):new m(f);else if(f.jbURI)k=new O(f);else if(f.uri||f.features_uri)k=new z(f);if(f.overlay){e=[];k&&e.push(new h(k));for(k=0;k<f.overlay.length;++k){var r=this.createSources(f.overlay[k]);
r&&r.features&&e.push(r.features)}k=new $(e,f)}f.sequenceAliases&&(k=new g(k,new aa({type:"alias",sequenceAliases:f.sequenceAliases})));f.mapping&&(k=new g(k,this.chains[f.mapping]));f.name&&k&&!k.name&&(k.name=f.name);null!=k&&(k=new h(k));if(null!=k||null!=d)e={features:k,sequence:d},this.sourceCache.put(f,e);return e};P.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||
this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new z(this.dasSource):this.getSource()).getStyleSheet(a)};var ma=0;h.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};h.prototype.removeReadinessListener=function(a){if(this.source.removeReadinessListener)return this.source.removeReadinessListener(a)};h.prototype.search=function(a,b){if(this.source.search)return this.source.search(a,
b)};h.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};h.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};h.prototype.getScales=function(){return this.source.getScales()};h.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};h.prototype.removeActivityListener=function(a){this.source.removeActivityListener&&this.source.removeActivityListener(a)};h.prototype.addChangeListener=
function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};h.prototype.removeChangeListener=function(a){this.source.removeChangeListener&&this.source.removeChangeListener(a)};h.prototype.findNextFeature=function(a,b,f,c){this.source.findNextFeature(a,b,f,c)};h.prototype.quantFindNextFeature=function(a,b,f,c,e){this.source.quantFindNextFeature(a,b,f,c,e)};h.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};h.prototype.fetch=function(a,
b,f,c,e,g,k,m){if(!g)throw Error("Fetch pool is null");var h=this,d=this.cfsid,r=g.awaitedFeatures[d];if(r&&r.started){if(r.styleFilters.doesNotContain(m)){h.source.fetch(a,b,f,c,e,g,k,m);return}}else r?r.styleFilters.addAll(m):(r=new K,r.styleFilters=m,g.awaitedFeatures[d]=r,g.requestsIssued.then(function(){r.started=!0;h.source.fetch(a,b,f,c,r.styleFilters.typeList(),g,function(a,b,f,c){r.res||r.provide({status:a,features:b,scale:f,coverage:c})},r.styleFilters)}).catch(function(a){console.log(a)}));
r.await(function(a){k(a.status,a.features,a.scale,a.coverage)})};t.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};t.prototype.removeReadinessListener=function(a){a=x(this.readinessListeners,a);0<=a&&this.readinessListeners.splice(a,1)};t.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(b){console.log(b)}};t.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
t.prototype.removeActivityListener=function(a){a=x(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};t.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};t.prototype.getScales=function(){return null};t.prototype.fetch=function(a,b,f,c,e,g,k){return k(null,[],1E9)};t.prototype.getStyleSheet=function(a){var b=new H,c=new f;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},
null,c);return a(b)};z.prototype.addActivityListener=function(a){this.activityListeners.push(a)};z.prototype.removeActivityListener=function(a){a=x(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,1)};z.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};z.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};
z.prototype.fetch=function(a,b,f,c,e,g,k){if(e&&0==e.length)k(null,[],c);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return k(null,this.cachedStaticFeatures,this.cachedStaticScale);var m=!1!==this.dasSource.maxbins;e={type:e};m&&(e.maxbins=1+((f-b)/c|0));var h=this;h.busy++;h.notifyActivity();this.dasSource.features(new C(a,b,f),e,function(a,b){h.busy--;h.notifyActivity();var f=c;m||(f=0.1);!b&&h.dasSource.dasStaticFeatures&&
(h.cachedStaticFeatures=a,h.cachedStaticScale=f);k(b,a,f)})}};z.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,f,c){if(this.dasSource.capabilities&&0<=x(this.dasSource.capabilities,"das1:adjacent-feature")){var e=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(b|0)+":"+(0<f?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=b;thisTier.dasSource.features(null,a,function(a){e.dasAdjLock=
!1;0<a.length&&null!=a[0]&&c(a[0])})}};B.prototype.fetch=function(a,b,f,c,e){this.dasSource.sequence(new C(a,b,f),function(a){return 1==a.length?e(null,a[0]):e("Didn't get sequence")})};B.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(f){for(var c=0;c<f.length;++c)if(f[c].name==a)return b({length:f[c].end});return b()})};c.prototype.fetch=function(a,b,f,c,e){this.twoBit.await(function(c){c.fetch(a,b,f,function(c,g){if(g)return e(g,null);var k=new A(a,b,f,"DNA",c);return e(null,
k)})})};c.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(f){f.getSeq(a)?f.getSeq(a).length(function(a){b({length:a})}):b()})};z.prototype.getScales=function(){return[]};var fa={};a.prototype=Object.create(t.prototype);a.prototype.init=function(){var a=this,b;b=(b=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?new Y(b,{credentials:this.opts.credentials}):new y(b,{credentials:this.opts.credentials}):new G(this.bwgSource.bwgBlob);I(b,function(b,f){f?(a.error=
f,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(b),a.readiness=null,a.notifyReadiness(),"bigbed"==b.type&&b.getExtraIndices(function(b){a.extraIndices=b}))})};a.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var b=0;b<this.extraIndices.length;++b)a.search.push(this.extraIndices[b].field)}return a};a.prototype.fetch=function(a,
b,f,c,e,g,k){var m=this;this.bwgHolder.await(function(g){if(null==g)return k(m.error||"Can't access binary file",null,null);var h;h=!e||0==e.length||0<=x(e,"density");m.opts.clientBin&&(h=!1);if("bigwig"==g.type||h||"undefined"!==typeof m.opts.forceReduction){h=-1;for(var d=0;d<g.zoomLevels.length;++d)if(g.zoomLevels[d].reduction<=c)h=d;else break;"undefined"!==typeof m.opts.forceReduction&&(h=m.opts.forceReduction);h=0>h?g.getUnzoomedView():g.getZoomedView(h)}else h=g.getUnzoomedView();m.busy++;
m.notifyActivity();h.readWigData(a,b,f,function(a){m.busy--;m.notifyActivity();var c=1E9;if("bigwig"===g.type){var e=(f-b)/a.length/2;e<c&&(c=e)}if(m.opts.link)for(e=0;e<a.length;++e){var h=a[e];h.label&&(h.links=[new D("Link",m.opts.link.replace(/\$\$/,h.label))])}k(null,a,c)})})};a.prototype.quantFindNextFeature=function(a,b,f,c,e){var g=this;g.busy++;g.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,f,c,function(a,b){g.busy--;g.notifyActivity();return e(a,b)})};a.prototype.findNextFeature=
function(a,b,f,c){var e=this;e.busy++;e.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,f,function(a){e.busy--;e.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};a.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],f=0;f<a.zoomLevels.length;++f)b.push(a.zoomLevels[f].reduction);return b}return null};a.prototype.search=function(a,b){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,b):b(null,"No indices available")};
a.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(b){b&&b.schema&&b.definedFieldCount<b.schema.fields.length&&a(function(a,f){for(var c=0;c<f.hit.length;++c)if(f.hit[c].isSuperGroup)return;for(c=b.definedFieldCount;c<b.schema.fields.length;++c){var e=b.schema.fields[c];f.add(e.comment,a[e.name])}})})};a.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new H;if("bigbed"==b.type){var e=
new f;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=20;c.pushStyle({type:"bigbed"},null,e);e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;c.pushStyle({type:"translation"},null,e);e=new f;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;c.pushStyle({type:"transcript"},null,e);e=new f;e.glyph="HISTOGRAM";e.COLOR1="white";e.COLOR2="black";e.HEIGHT=30;c.pushStyle({type:"density"},
null,e)}else e=new f,e.glyph="HISTOGRAM",e.COLOR1="white",e.COLOR2="black",e.HEIGHT=30,c.pushStyle({type:"default"},null,e);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};b.prototype=Object.create(t.prototype);b.prototype.init=function(){var a=this,b=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,f=this.bwgSource.blob||this.bwgSource.bwgBlob,c=function(b,f){a.readiness=null;a.notifyReadiness();b?a.worker.postCommand({command:"meta",connection:b},function(f,c){c?(a.error=
c,a.keyHolder.provide(null)):(a.meta=f,a.keyHolder.provide(b))}):(a.error=f,a.keyHolder.provide(null))};f?this.worker.postCommand({command:"connectBBI",blob:f},c):this.worker.postCommand({command:"connectBBI",uri:w(b),transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},c)};b.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var b=0;b<this.meta.extraIndices.length;++b)a.search.push(this.meta.extraIndices[b].field)}return a};
b.prototype.fetch=function(a,b,f,c,e,g,k){var m=this;m.busy++;m.notifyActivity();this.keyHolder.await(function(g){if(!g)return m.busy--,m.notifyActivity(),k(m.error||"Can't access binary file",null,null);var h=-1,d=!e||0==e.length||0<=x(e,"density");m.opts.clientBin&&(d=!1);if("bigwig"==m.meta.type||d||"undefined"!==typeof m.opts.forceReduction){for(d=1;d<m.meta.zoomLevels.length;++d)if(m.meta.zoomLevels[d]<=c)h=d-1;else break;"undefined"!==typeof m.opts.forceReduction&&(h=m.opts.forceReduction)}m.worker.postCommand({command:"fetch",
connection:g,chr:a,min:b,max:f,zoom:h},function(a,c){m.busy--;m.notifyActivity();var e=1E9;if("bigwig"===m.meta.type){var g=(f-b)/a.length/2;g<e&&(e=g)}if(m.opts.link)for(g=0;g<a.length;++g){var h=a[g];h.label&&(h.links=[new D("Link",m.opts.link.replace(/\$\$/,h.label))])}k(c,a,e)})})};b.prototype.quantFindNextFeature=function(a,b,f,c,e){var g=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:b,dir:f,threshold:c,under:!1},function(a,
b){console.log(a,b);g.busy--;g.notifyActivity();return e(a,b)})};b.prototype.findNextFeature=function(a,b,f,c){var e=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:b,dir:f},function(a,b){e.busy--;e.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};b.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};b.prototype.search=function(a,b){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return b(null,
"No indices available");var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){f.busy--;f.notifyActivity();b(a,c)})};b.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var b=this;this.keyHolder.await(function(f){var c=b.meta;c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,b){for(var f=0;f<b.hit.length;++f)if(b.hit[f].isSuperGroup)return;
for(f=c.definedFieldCount;f<c.schema.fields.length;++f){var e=c.schema.fields[f];b.add(e.comment,a[e.name])}})})};b.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(c){c=b.meta;if(!c)return a(null,"bbi error");var e=new H;if("bigbed"==c.type){var g=new f;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="blue";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=20;e.pushStyle({type:"bigbed"},null,g);g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="red";g.HEIGHT=10;g.BUMP=!0;g.ZINDEX=20;e.pushStyle({type:"translation"},
null,g);g=new f;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="white";g.HEIGHT=10;g.ZINDEX=10;g.BUMP=!0;g.LABEL=!0;e.pushStyle({type:"transcript"},null,g);g=new f;g.glyph="HISTOGRAM";g.COLOR1="white";g.COLOR2="black";g.HEIGHT=30;e.pushStyle({type:"density"},null,g)}else g=new f,g.glyph="HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,e.pushStyle({type:"default"},null,g);12==c.definedFieldCount&&14<=c.fieldCount&&(e.geneHint=!0);return a(e)})};m.prototype=Object.create(t.prototype);m.prototype.init=
function(){var a=this,b,f;this.bamSource.bamBlob?(b=new G(this.bamSource.bamBlob),f=new G(this.bamSource.baiBlob)):(b=new y(this.bamSource.bamURI,{credentials:this.opts.credentials}),f=new y(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));S(b,f,null,function(b,f){a.readiness=null;a.notifyReadiness();b?a.bamHolder.provide(b):(a.error=f,a.bamHolder.provide(null))})};m.prototype.fetch=function(a,b,f,c,g,k,m){var h=g&&1==g.length&&"density"==g[0],d=this;d.busy++;
d.notifyActivity();this.bamHolder.await(function(c){if(!c)return d.busy--,d.notifyActivity(),m(d.error||"Couldn't fetch BAM");c.fetch(a,b,f,function(a,b){d.busy--;d.notifyActivity();if(b)m(b,null,null);else{for(var f=[],c=0;c<a.length;++c){var g=e(a[c],d.opts.bamGroup);g&&f.push(g)}m(null,f,1E9)}},{light:h})})};m.prototype.getScales=function(){return 1E9};m.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new H;var c=new f;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";
c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new f;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};p.prototype=Object.create(t.prototype);p.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,f=this.bamSource.indexUri||this.bamSource.baiURI||b+".bai",c=this.bamSource.bamBlob||this.bamSource.blob,e=this.bamSource.baiBlob||
this.bamSource.indexBlob,g=function(b,f){a.readiness=null;a.notifyReadiness();b?a.keyHolder.provide(b):(a.error=f,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBAM",blob:c,indexBlob:e},g):this.worker.postCommand({command:"connectBAM",uri:w(b),indexUri:w(f),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},g)};p.prototype.fetch=function(a,b,f,c,g,k,m){var h=g&&1==g.length&&"density"==g[0],d=this;d.busy++;d.notifyActivity();this.keyHolder.await(function(c){if(!c)return d.busy--,
d.notifyActivity(),m(d.error||"Couldn't fetch BAM");d.worker.postCommand({command:"fetch",connection:c,chr:a,min:b,max:f,opts:{light:h}},function(a,b){d.busy--;d.notifyActivity();if(b)m(b,null,null);else{for(var f=[],c=0;c<a.length;++c){var g=e(a[c],d.opts.bamGroup);g&&f.push(g)}m(null,f,1E9)}})})};p.prototype.getScales=function(){return 1E9};p.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new H;var c=new f;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},
"low",c);b.pushStyle({type:"density"},"medium",c);c=new f;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};g.prototype.addActivityListener=function(a){this.activityListeners.push(a)};g.prototype.removeActivityListener=function(a){a=x(this.activityListeners,a);0<=a&&this.activityListeners.splice(a,0)};g.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
g.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};g.prototype.getScales=function(){return this.source.getScales()};g.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};g.prototype.simplifySegments=function(a,b){if(0==a.length)return a;a.sort(function(a,b){var f=a.name-b.name;return f?f:(f=a.start-b.start)?f:a.end-b.end});for(var f=[],c=a[0],e=0;e<a.length;++e){var g=a[e];g.name!=c.name||g.start>c.end+b?(f.push(c),c=g):
c=new C(c.name,Math.min(c.start,g.start),Math.max(c.end,g.end))}f.push(c);return f};g.prototype.fetch=function(a,b,f,c,e,g,k,m){var h=this,d=f-b+1;h.busy++;h.notifyActivity();this.mapping.sourceBlocksForRange(a,b,f,function(a){if(0==a.length)h.busy--,h.notifyActivity(),k("No mapping available for this regions",[],c);else{a=h.simplifySegments(a,Math.max(100,0.05*d));var b=[],f=null,r=a.length,p;a.map(function(a){h.source.fetch(a.name,a.start,a.end,c,e,g,function(c,e,g){c&&!p&&(p=c);if(e)for(c=0;c<
e.length;++c){var m=e[c],d=m.segment;0==d.indexOf("chr")&&(d=d.substr(3));d=h.mapping.mapSegment(d,m.min,m.max);if(0==d.length)m.parts&&0<m.parts.length&&b.push(m);else for(var l=0;l<d.length;++l){var n=d[l],q=F(m);q.segment=n.segment;q.min=n.min;q.max=n.max;n.partialMin&&(q.partialMin=n.partialMin);n.partialMax&&(q.partialMax=n.partialMax);n.flipped&&("-"==m.orientation?q.orientation="+":"+"==m.orientation&&(q.orientation="-"));b.push(q)}}e=h.mapping.mapPoint(a.name,a.start);c=h.mapping.mapPoint(a.name,
a.end);e&&c&&(e=new R(e.pos,c.pos),f=f?V(f,e):e);--r;0==r&&(h.busy--,h.notifyActivity(),k(p,b,g,f))},m)})}})};v.prototype.getScales=function(){return null};v.prototype.fetch=function(a,b,f,c,e,g,k){return k(null,[],1E9)};v.prototype.getStyleSheet=function(a){var b=new H,c=new f;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};r.prototype.fetch=function(a,b,f,c,e){return e(null,null)};O.prototype.getScales=function(){return null};O.prototype.getStyleSheet=
function(a){var b=new H,c=new f;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};O.prototype.fetch=function(a,b,c,f,e,g,k){e&&0==e.length?k(null,[],f):this.store.features(new C(a,b,c),{},function(a,b){k(b,a,1E5)})};Q.prototype.sourceAdapterIsCapable=function(a,b){return a.capabilities?a.capabilities()[b]:!1};"undefined"!==typeof u&&(u.exports={FeatureSourceBase:t,TwoBitSequenceSource:c,DASSequenceSource:B,
MappedFeatureSource:g,CachingFeatureSource:h,BWGFeatureSource:a,RemoteBWGFeatureSource:b,BAMFeatureSource:m,RemoteBAMFeatureSource:p,DummyFeatureSource:v,DummySequenceSource:r,registerSourceAdapterFactory:q,registerParserFactory:n,makeParser:l},d("./ensembljson"),d("./tabix-source"),d("./memstore"),d("./bedwig"),d("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,
"./spans":36,"./style":37,"./tabix-source":40,"./tier":45,"./twoBit":48,"./utils":49,"./vcf":50}],35:[function(d,u,s){function q(h){return h.uri?h.uri:h.blob?"file:"+h.blob.name:h.bwgBlob?"file:"+h.bwgBlob.name:h.bamBlob?"file:"+h.bamBlob.name:h.twoBitBlob?"file:"+h.twoBitBlob.name:h.bwgURI||h.bamURI||h.jbURI||h.twoBitURI||"https://www.biodalliance.org/magic/no_uri"}function n(h){return h.stylesheet_uri?h.stylesheet_uri:"sequence"==h.tier_type||h.twoBitURI||h.twoBitBlob?"https://www.biodalliance.org/magic/sequence":
q(h)}function l(h,d){if(q(h)!=q(d)||h.mapping!=d.mapping||h.tier_type!=d.tier_type)return!1;if(h.overlay){if(!d.overlay||d.overlay.length!=h.overlay.length)return!1;for(var n=0;n<h.overlay.length;++n)if(!l(h.overlay[n],d.overlay[n]))return!1}else if(d.overlay)return!1;return!0}function h(d,l){if(q(d)!=q(l)||n(d)!=n(l)||d.mapping!=l.mapping||d.tier_type!=l.tier_type)return!1;if(d.overlay){if(!l.overlay||l.overlay.length!=d.overlay.length)return!1;for(var s=0;s<d.overlay.length;++s)if(!h(d.overlay[s],
l.overlay[s]))return!1}else if(l.overlay)return!1;return!0}"undefined"!==typeof u&&(u.exports={sourcesAreEqual:h,sourcesAreEqualModuloStyle:l,sourceDataURI:q,sourceStyleURI:n})},{}],36:[function(d,u,s){function q(c,a){if("number"!=typeof c||"number"!=typeof a)throw"Bad range "+c+","+a;this._min=c;this._max=a}function n(c){c=c.sort(B);var a=[],b=c.shift();c.forEach(function(c){c._min<=b._max?c._max>b._max&&(b._max=c._max):(a.push(b),b=c)});a.push(b);this._ranges=a}function l(c,a){c instanceof n||(c instanceof
Array||(c=[c]),c=new n(c));a&&c.insertRange(a);return c}function h(c,a){for(var b=c.ranges(),e=a.ranges(),h=b.length,d=e.length,g=0,l=0,r=[];g<h&&l<d;){c=b[g];a=e[l];var t=Math.max(c.min(),a.min()),s=Math.min(c.max(),a.max());s>=t&&r.push(new q(t,s));c.max()>a.max()?++l:++g}return 0==r.length?null:1==r.length?r[0]:new n(r)}function t(c){var a=0;c=c.ranges();for(var b=0;b<c.length;++b)var e=c[b],a=a+(e.max()-e.min()+1);return a}function z(c,a){return c.min()<a.min()?-1:c.min()>a.min()?1:c.max()<a.max()?
-1:a.max()>c.max()?1:0}function B(c,a){return c._min<a._min?-1:c._min>a._min?1:c._max<a._max?-1:a._max>c._max?1:0}q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};q.prototype.contains=function(c){return c>=this._min&&c<=this._max};q.prototype.isContiguous=function(){return!0};q.prototype.ranges=function(){return[this]};q.prototype._pushRanges=function(c){c.push(this)};q.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};n.prototype.min=function(){return this._ranges[0].min()};
n.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};n.prototype.lower_bound=function(c){var a=this.ranges();if(c>this.max())return a.length;if(c<this.min())return 0;for(var b=0,e=a.length-1;b<=e;){var h=Math.floor((b+e)/2);if(c>a[h]._max)b=h+1;else if(c<a[h]._min)e=h-1;else return h}return b};n.prototype.contains=function(c){var a=this.lower_bound(c);return a<this._ranges.length&&this._ranges[a].contains(c)?!0:!1};n.prototype.insertRange=function(c){var a=this.lower_bound(c._min);
if(a===this._ranges.length)this._ranges.push(c);else{var b=this.ranges();if(c._max<b[a]._min)this._ranges.splice(a,0,c);else{b[a]._min<c._min&&(c._min=b[a]._min);for(var e=a+1;e<b.length&&b[e]._min<=c._max;)e++;e--;b[e]._max>c._max&&(c._max=b[e]._max);this._ranges.splice(a,e-a+1,c)}}};n.prototype.isContiguous=function(){return 1<this._ranges.length};n.prototype.ranges=function(){return this._ranges};n.prototype._pushRanges=function(c){for(var a=0;a<this._ranges.length;++a)c.push(this._ranges[a])};
n.prototype.toString=function(){for(var c="",a=0;a<this._ranges.length;++a)0<a&&(c+=","),c+=this._ranges[a].toString();return c};"undefined"!==typeof u&&(u.exports={Range:q,union:l,intersection:h,coverage:t,rangeOver:z,_rangeOrder:B})},{}],37:[function(d,u,s){function q(d,h,n){this.type=d;this.method=h;this.label=n}function n(d){this._filters={};if(d)for(var h=0;h<d.length;++h)this.add(d[h])}q.prototype.equals=function(d){return this.type==d.type&&this.method==d.method&&this.label==d.label};q.prototype.toString=
function(){var d=[];this.type&&d.push("type="+this.type);this.method&&d.push("method="+this.method);this.label&&d.push("label="+this.label);return"StyleFilter<"+d.join(";")+">"};n.prototype.add=function(d){var h=d.toString();this._filters[h]||(this._filters[h]=d,this._list=null)};n.prototype.addAll=function(d){d=d.list();for(var h=0;h<d.length;++h)this.add(d[h])};n.prototype.doesNotContain=function(d){d=d.list();for(var h=0;h<d.length;++h)if(!this._filters[h.toString()])return!0;return!1};n.prototype.list=
function(){if(!this._list){this._list=[];for(var d in this._filters)this._filters.hasOwnProperty(d)&&this._list.push(this._filters[d])}return this._list};n.prototype.typeList=function(){for(var d=[],h=this.list(),n=0;n<h.length;++n){var q=h[n].type;if(!q||"default"==q)return null;0>d.indexOf(q)&&d.push(q)}return d};"undefined"!==typeof u&&(u.exports={StyleFilter:q,StyleFilterSet:n})},{}],38:[function(d,u,s){if("undefined"!==typeof d){var q=d("./cbrowser").Browser,n=d("./utils").makeElementNS,l=d("./version"),
h=d("./sequence-draw").svgSeqTier;u=d("./svg-utils");var t=u.NS_SVG,z=u.NS_XLINK,B=u.SVGPath,c=d("./numformats").formatQuantLabel}q.prototype.makeSVG=function(a){a=a||{};var b=a.minTierHeight||20,e=document.implementation.createDocument(t,"svg",null),m=n(t,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});e.documentElement.appendChild(m);var d=n(t,"a",n(t,"text","Graphics from Dalliance "+l,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));
d.setAttribute("xmlns:xlink",z);d.setAttribute("xlink:href","http://www.biodalliance.org/");m.appendChild(d);d=n(t,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});d=n(t,"clipPath",d,{id:"featureClip"});m.appendChild(d);for(var d=70,g=n(t,"g",null,{}),q=0;q<this.tiers.length;++q){var r=this.tiers[q],s=n(t,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),u=n(t,"g"),P=d,K=n(t,"rect",null,{x:0,y:P,width:"10000",height:50,fill:r.background});s.appendChild(K);if(r.sequenceSource){var x=
h(r,r.currentSequence);s.appendChild(n(t,"g",x,{transform:"translate(200, "+d+")"}));d+=80}else{if(!r.subtiers)continue;for(var x=(r.glyphCacheOrigin-this.viewStart)*this.scale,F=!1,w=0;w<r.subtiers.length;++w){for(var d=d+3,H=r.subtiers[w],f=[],E=0;E<H.glyphs.length;++E)f.push(H.glyphs[E].toSVG());s.appendChild(n(t,"g",f,{transform:"translate("+(200+x)+", "+d+")"}));if(H.quant){var F=!0,f=H.quant,C=H.height,E=2;40<C&&(E=1+(C/20|0));var C=C/(E-1),J=(f.max-f.min)/(E-1),A=new B;A.moveTo(205,d);A.lineTo(200,
d);A.lineTo(200,d+H.height);A.lineTo(205,d+H.height);for(var D=1;D<E-1;++D){var y=D*C;A.moveTo(200,d+y);A.lineTo(203,d+y)}u.appendChild(n(t,"path",null,{d:A.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));u.appendChild(n(t,"text",c(f.max),{x:197,y:d+7,textAnchor:"end"}));u.appendChild(n(t,"text",c(f.min),{x:197,y:d+H.height,textAnchor:"end"}));for(D=1;D<E-1;++D)y=D*C,u.appendChild(n(t,"text",c(1*f.max-D*J),{x:197,y:d+y+3,textAnchor:"end"}))}d+=H.height+3}d-P<b&&(d=P+b)}u.appendChild(n(t,
"text","string"===typeof r.config.name?r.config.name:r.dasSource.name,{x:200-(F?20:12),y:(d+P+8)/2,fontSize:"10pt",textAnchor:"end"}));K.setAttribute("height",d-P);g.appendChild(n(t,"g",[s,u]))}if(a.highlights)for(b=this.highlights||[],F=0;F<b.length;++F)C=b[F],(C.chr==this.chr||C.chr=="chr"+this.chr)&&C.min<this.viewEnd&&C.max>this.viewStart&&(q=(Math.max(C.min,this.viewStart)-this.viewStart)*this.scale,r=(Math.min(C.max,this.viewEnd)-this.viewStart)*this.scale,g.appendChild(n(t,"rect",null,{x:200+
q,y:70,width:r-q,height:d-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));b=-1;"center"==a.ruler?b=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?b=200:"right"==a.ruler&&(b=200+(this.viewEnd-this.viewStart)*this.scale);0<=b&&g.appendChild(n(t,"line",null,{x1:b,y1:70,x2:b,y2:d,stroke:"blue"}));m.appendChild(g);e.documentElement.setAttribute("width",this.featurePanelWidth+20+200);e.documentElement.setAttribute("height",d+50);return new Blob([(new XMLSerializer).serializeToString(e)],
{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":39,"./utils":49,"./version":51}],39:[function(d,u,s){function q(){this.ops=[]}q.prototype.moveTo=function(d,l){this.ops.push("M "+d+" "+l)};q.prototype.lineTo=function(d,l){this.ops.push("L "+d+" "+l)};q.prototype.closePath=function(){this.ops.push("Z")};q.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof u&&(u.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",
SVGPath:q})},{}],40:[function(d,u,s){function q(a){h.call(this);this.readiness="Connecting";this.source=a;this.tabixHolder=new B;var b=this,e=l(a.payload);if(e)this.parser=e;else throw"Unsuported tabix payload "+a.payload;var d;this.source.blob?(a=new z(this.source.blob),d=new z(this.source.indexBlob)):(a=new t(this.source.uri,{credentials:this.source.credentials}),d=new t(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));c(a,d,function(a,c){b.tabixHolder.provide(a);
a.fetchHeader(function(a,b){if(a){for(var c=e.createSession(function(){}),g=0;g<a.length;++g)c.parse(a[g]);c.flush()}});b.readiness=null;b.notifyReadiness()})}if("undefined"!==typeof d){u=d("./sourceadapters");var n=u.registerSourceAdapterFactory,l=u.makeParser,h=u.FeatureSourceBase;u=d("./bin");var t=u.URLFetchable,z=u.BlobFetchable,B=d("./utils").Awaited,c=d("./tabix").connectTabix}q.prototype=Object.create(h.prototype);q.prototype.fetch=function(a,b,c,d,h,g,l){var r=this;r.busy++;r.notifyActivity();
this.tabixHolder.await(function(g){g.fetch(a,b,c,function(a,b){r.busy--;r.notifyActivity();for(var c=[],e=r.parser.createSession(function(a){c.push(a)}),g=0;g<a.length;++g)e.parse(a[g]);e.flush();l(null,c,1E9)})})};q.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};q.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};n("tabix",function(a){return{features:new q(a)}})},{"./bin":4,"./sourceadapters":34,
"./tabix":41,"./utils":49}],41:[function(d,u,s){function q(){}function n(a,b,c){var d=new q;d.data=a;d.tbi=b;d.tbi.fetch(function(a){if(!a)return c(null,"Couldn't access Tabix");a=z(a,a.byteLength);var b=new Uint8Array(a);if(h(b,0)!=l)return c(null,"Not a tabix index");var n=h(b,4);d.format=h(b,8);d.colSeq=h(b,12);d.colStart=h(b,16);d.colEnd=h(b,20);d.meta=h(b,24);d.skip=h(b,28);h(b,32);d.indices=[];var r=36;d.chrToIndex={};d.indexToChr=[];for(var q=0;q<n;++q){for(var s="";;){var u=b[r++];if(0==u)break;
s+=String.fromCharCode(u)}d.chrToIndex[s]=q;0==s.indexOf("chr")?d.chrToIndex[s.substring(3)]=q:d.chrToIndex["chr"+s]=q;d.indexToChr.push(s)}s=1E9;for(u=0;u<n;++u){for(var B=r,x=h(b,r),r=r+4,q=0;q<x;++q){h(b,r);var F=h(b,r+4),r=r+(8+16*F)}for(var F=h(b,r),w=r+=4,q=0;q<F;++q){var H=t(b,w),w=w+8;if(H){q=H.block;0<H.offset&&(q+=65536);q<s&&(s=q);break}}r+=8*F;0<x&&(d.indices[u]=new Uint8Array(a,B,r-B))}d.headerMax=s;c(d)},{timeout:5E3})}var l=21578324;if("undefined"!==typeof d){d("./spans");var h=d("./bin").readInt;
d=d("./lh3utils");var t=d.readVob,z=d.unbgzf,B=d.reg2bins,c=d.Chunk}q.prototype.blocksForRange=function(a,b,e){var d=this.indices[a];if(!d)return[];a=B(b,e);for(var l=[],g=0;g<a.length;++g)l[a[g]]=!0;a=[];for(var n=[],g=h(d,0),r=4,q=0;q<g;++q){var s=h(d,r),u=h(d,r+4),r=r+8;if(l[s])for(var z=0;z<u;++z){var x=t(d,r),F=t(d,r+8);(4681>s?n:a).push(new c(x,F));r+=16}else r+=16*u}g=h(d,r);l=null;b=Math.min(b>>14,g-1);e=Math.min(e>>14,g-1);for(g=b;g<=e;++g)(b=t(d,r+4+8*g))&&(!l||b.block<l.block||b.offset<
l.offset)&&(l=b);d=[];if(null!=l)for(g=0;g<n.length;++g)e=n[g],e.maxv.block>=l.block&&e.maxv.offset>=l.offset&&d.push(e);n=d;d=[];for(g=0;g<n.length;++g)d.push(n[g]);for(g=0;g<a.length;++g)d.push(a[g]);d.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});a=[];if(0<d.length){n=d[0];for(g=1;g<d.length;++g)e=d[g],e.minv.block==n.maxv.block?n=new c(n.minv,e.maxv):(a.push(n),n=e);a.push(n)}return a};q.prototype.fetch=function(a,b,c,d){function h(){if(q>=r.length)return d(n);
if(t){var a=new Uint8Array(t);g.readRecords(a,r[q].minv.offset,n,b,c,l);t=null;++q;return h()}var x=r[q],a=x.minv.block;g.data.slice(a,x.maxv.block+65536-a).fetch(function(a){t=z(a,x.maxv.block-x.minv.block+1);return h()})}var g=this;a=this.chrToIndex[a];if(void 0==a)return d([]);var l=this.indexToChr[a],r;void 0===a?r=[]:(r=this.blocksForRange(a,b,c))||d(null,"Error in index fetch");var n=[],q=0,t;h()};q.prototype.readRecords=function(a,b,c,d,h,g){a:for(;;){for(var l="";b<a.length;){var r=a[b++];
if(10==r){r=l.split("\t");if(r[this.colSeq-1]==g){var n=parseInt(r[this.colStart-1]),q=n;0<this.colEnd&&(q=parseInt(r[this.colEnd-1]));this.format&65536&&++n;n<=h&&q>=d&&c.push(l)}continue a}else l+=String.fromCharCode(r)}break}};q.prototype.fetchHeader=function(a){var b=this;b.data.slice(0,b.headerMax).fetch(function(c){if(!c)return a(null,"Fetch failed");c=new Uint8Array(z(c,c.byteLength));for(var d=0,h="",g=[];d<c.length;){var l=c[d++];if(10==l)if(h.charCodeAt(0)==b.meta)g.push(h),h="";else return a(g);
else h+=String.fromCharCode(l)}a(g)})};"undefined"!==typeof u&&(u.exports={connectTabix:n,TABIX_MAGIC:l})},{"./bin":4,"./lh3utils":24,"./spans":36}],42:[function(d,u,s){function q(a){this.genomes={};this.url=a}function n(){}function l(a){this.hub=a}function h(a,b,c){c=c||{};c.salt=!0;z(a,function(d,h){if(h)return b(null,h);var p=d.split(m),n=new q(a);c.credentials&&(n.credentials=c.credentials);for(var t=0;t<p.length-2;t+=3)n[p[t+1]]=p[t+2];if(n.genomesFile){var s=B(a,n.genomesFile);z(s,function(a,
g){if(g)return b(null,g);for(var f=a.split(e),d=0;d<f.length;++d){var h=f[d].split(m),p=new l(n);c.credentials&&(p.credentials=c.credentials);for(var q=0;q<h.length-2;q+=3)p[h[q+1]]=h[q+2];p.twoBitPath&&(p.twoBitPath=B(s,p.twoBitPath));p.genome&&p.trackDb&&(p.absURL=B(s,p.trackDb),n.genomes[p.genome]=p)}b(n)},c)}else b(null,"No genomesFile")},c)}function t(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==
typeof d){s=d("./utils");var z=s.textXHR,B=s.relativeURL,c=s.shallowCopy;d=d("./das");var a=d.DASStylesheet,b=d.DASStyle}var e=/\n\s*\n/,m=/(\w+) +(.+)\n?/,p=/subGroup[1-9]/;n.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};l.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);z(this.absURL,function(c,d){if(d)return a(null,d);c=c.replace("\\\n"," ");for(var h=[],l={},q=c.split(e),t=0;t<q.length;++t){var s=q[t].replace(/\#.*/g,
"").split(m),w=new n;w._db=b;for(var u=0;u<s.length-2;u+=3){var f=s[u+1],E=s[u+2];if(f.match(p)){w.subgroups||(w.subgroups={});for(var f=E.split(/\s/),E=f[0],C={name:f[1],tags:[],titles:[]},J=2;J<f.length;++J){var A=f[J].split(/=/);C.tags.push(A[0]);C.titles.push(A[1])}w.subgroups[E]=C}else if("subGroups"===f)for(f=E.split(/(\w+)=(\w+)/),w.sgm={},J=0;J<f.length-2;J+=3)w.sgm[f[J+1]]=f[J+2];else w[s[u+1]]=s[u+2]}w.track&&(w.type||w.container||w.view||w.bigDataUrl)&&(h.push(w),l[w.track]=w)}q=[];t=[];
for(f=0;f<h.length;++f)w=h[f],s=!0,w.parent&&(u=w.parent.split(/\s+/),(E=l[u[0]])?(w._parent=E,E.children||(E.children=[]),E.children.push(w),E&&(s=!1)):console.log("Couldn't find parent "+u[0]+"("+w.parent+")")),w.compositeTrack?t.push(w):s&&q.push(w);for(h=0;h<t.length;++h)if(l=t[h],l.children){w=!1;for(s=0;s<l.children.length;++s)f=l.children[s],f.view&&(f.shortLabel=l.shortLabel+": "+f.shortLabel,q.push(f),w=!0);w||q.push(l)}b._tracks=q;return a(b._tracks,null)},{credentials:this.credentials,
salt:!0})};n.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=B(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var e=b[c],d=e.toDallianceSource();a.overlay.push(d);if(d.style)for(var h=
0;h<d.style.length;++h){var m=d.style[h];m.method=e.shortLabel;"transparentOverlay"==this.aggregate&&(m.style.ALPHA=0.5);a.style.push(m)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){c=b.split(/\s+/);if("bigBed"==c[0]&&this.bigDataUrl)return b=c[1]|0,c="+"==c[2],a.bwgURI=B(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0]&&this.bigDataUrl)return a.bwgURI=
B(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0]&&this.bigDataUrl)return a.bamURI=B(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==c[0]&&this.bigDataUrl)return a.uri=B(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=
!0),a;console.log("Unsupported "+this.type)}};n.prototype.bigwigStyles=function(){var c=this.type;if(!c){for(c=this;c._parent&&!c.type;)c=c._parent;c=c.type}if(c){var c=c.split(/\s+/),e,d;3<=c.length&&(e=1*c[1],d=1*c[2]);var h;this.maxHeightPixels&&(c=this.maxHeightPixels.split(/:/),3==c.length?h=c[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));c="bars";this.graphTypeDefault&&(c=this.graphTypeDefault);var m="black",l=null;this.color&&(m="rgb("+this.color+")");this.altColor&&
(l="rgb("+this.altColor+")");var p=new a,n=new b;n.glyph="points"==c?"POINT":"HISTOGRAM";l?(n.COLOR1=m,n.COLOR2=l):n.BGCOLOR=m;n.HEIGHT=h||30;if(e||d)n.MIN=e,n.MAX=d;p.pushStyle({type:"default"},null,n);return p.styles}};n.prototype.bigbedStyles=function(){var e="on"==(""+this.get("itemRgb")).toLowerCase(),d=this.get("visibility")||"full",h=this.get("color"),h=h?"rgb("+h+")":"blue",m=new a,l=new b;l.glyph="BOX";l.FGCOLOR="black";l.BGCOLOR=h;l.HEIGHT="full"==d||"pack"==d?12:8;l.BUMP="full"==d||"pack"==
d;l.LABEL="full"==d||"pack"==d;l.ZINDEX=20;e&&(l.BGITEM=!0);(d=this.get("colorByStrand"))?(d=d.split(/\s+/),h=c(l),h.BGCOLOR="rgb("+d[0]+")",m.pushStyle({type:"bigwig",orientation:"+"},null,h),l=c(l),l.BGCOLOR="rgb("+d[1]+")",m.pushStyle({type:"bigwig",orientation:"-"},null,l)):m.pushStyle({type:"bigwig"},null,l);l=new b;l.glyph="BOX";l.FGCOLOR="black";e&&(l.BGITEM=!0);l.BGCOLOR="red";l.HEIGHT=10;l.BUMP=!0;l.ZINDEX=20;m.pushStyle({type:"translation"},null,l);e=new b;e.glyph="BOX";e.FGCOLOR="black";
e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;m.pushStyle({type:"transcript"},null,e);return m.styles};"undefined"!==typeof u&&(u.exports={connectTrackHub:h,THUB_COMPARE:t})},{"./das":10,"./utils":49}],43:[function(d,u,s){if("undefined"!==typeof d)var q=d("./cbrowser").Browser,n=d("./utils").shallowCopy;q.prototype.mergeSelectedTiers=function(){for(var d=[],h=[],q=0;q<this.selectedTiers.length;++q){var s=this.tiers[this.selectedTiers[q]];d.push(n(s.dasSource));for(var u=s.stylesheet.styles,
c=0;c<u.length;++c){var a=u[c],b=n(a);b.method=s.dasSource.name.replace(/[()+*?]/g,"\\$&");b._methodRE=null;b.style=n(a.style);void 0===b.style.ZINDEX&&(b.style.ZINDEX=q);s.forceMin&&(b.style.MIN=s.forceMin);s.forceMax&&(b.style.MAX=s.forceMax);h.push(b)}}this.addTier({name:"Merged",merge:"concat",overlay:d,noDownsample:!0,style:h});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":49}],44:[function(d,u,s){function q(a){for(var b=0;b<a.styles.length;++b){var c=a.styles[b].style;
if("__SEQUENCE"===c.glyph)return c}}if("undefined"!==typeof d){var n=d("./cbrowser").Browser,l=d("./utils").makeElement;u=d("./das");var h=u.isDasBooleanTrue,t=u.copyStylesheet,z=d("./color").dasColourForName,B=d("./sourcecompare").sourceDataURI}var c={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};n.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else if(a){var b=function(a){a.BGGRAD||(1==J?("LINEPLOT"==
a.glyph||c[a.glyph]?a.FGCOLOR=x.value:a.BGCOLOR=x.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=x.value,a.COLOR2=F.value,a.COLOR3=2<J?w.value:null),a._gradient=null,a._plusColor=H.value,a._minusColor=f.value)},e=function(b){for(var c=t(a.stylesheet),f=a.browser.zoomForCurrentScale(),e=0;e<c.styles.length;++e){var g=c.styles[e];g.zoom&&g.zoom!=f||b(g.style)}return c},d=function(c){a.mergeStylesheet(e(b))};this.manipulatingTier=a;var p=l("div",null,{className:"tier-edit"}),g=l("div","About '"+(a.config.Name||
a.dasSource.name)+"'",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});p.appendChild(g);var g=l("div",[l("p",a.dasSource.desc)]),n=[],r=B(a.dasSource);!r||0!=r.indexOf("http://")&&0!=r.indexOf("https://")&&0!=r.indexOf("//")||"https://www.biodalliance.org/magic/no_uri"===r||n.push(l("li",l("a","(Download data)",{href:r})));a.dasSource.mapping&&(r=this.chains[a.dasSource.mapping].coords,n.push(l("li","Mapped from "+r.auth+r.version)));0<n.length&&g.appendChild(l("ul",
n));p.appendChild(g);var s=l("span"," (styles for current zoom level)",null,{display:"none"}),g=l("div",["Edit",s],null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"});p.appendChild(g);var u=l("input",null,{type:"text"}),P=l("input",null,{type:"checkbox",disabled:this.disablePinning}),K=l("select");K.appendChild(l("option","Histogram",{value:"HISTOGRAM"}));K.appendChild(l("option","Line Plot",{value:"LINEPLOT"}));K.appendChild(l("option","Ribbon",{value:"GRADIENT"}));
K.appendChild(l("option","Scatter",{value:"SCATTER"}));var x=l("input",null,{type:"text",value:"#dd00dd"}),F=l("input",null,{type:"text",value:"#dd00dd"}),w=l("input",null,{type:"text",value:"#dd00dd"}),H=l("input",null,{type:"text",value:"#ffa07a"}),f=l("input",null,{type:"text",value:"#87cefa"});try{x.type=F.type=w.type="color",H.type=f.type="color"}catch(E){}var C=[x,F,w],g=l("i",null,{className:"fa fa-plus-circle"}),n=l("i",null,{className:"fa fa-minus-circle"}),J=1,r=l("td",C),A=function(a){J=
a;for(var b=0;b<a;++b)C[b].style.display="block";for(b=a;b<C.length;++b)C[b].style.display="none"};g.addEventListener("click",function(a){3>J&&(A(J+1),d(null))},!1);n.addEventListener("click",function(a){1<J&&(A(J-1),d(null))},!1);var D=l("input",null,{type:"text",value:"0.0"}),y=l("input",null,{type:"text",value:"10.0"}),G=l("input",null,{type:"checkbox"}),k=l("input",null,{type:"checkbox"}),I=l("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),S=l("input",null,{type:"text",value:a.quantLeapThreshold,
disabled:!I.checked}),L=l("input",null,{type:"text",value:"50"}),R=l("input",null,{type:"checkbox"}),V=l("input",null,{type:"text"}),ha=l("input",null,{type:"checkbox"}),$=null;0<a.stylesheet.styles.length&&($=a.stylesheet.styles[0].style);var U=function(){u.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;P.checked=a.pinned;a.forceHeight?L.value=""+a.forceHeight:$&&$.HEIGHT&&(L.value=""+$.HEIGHT);"number"==typeof a.quantLeapThreshold?(I.checked=!0,S.disabled=!1,parseFloat(S.value)!=
a.quantLeapThreshold&&(S.value=a.quantLeapThreshold)):(I.checked=!1,S.disabled=!0);V.value="number"==typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var b=null,c=!1,e=!1,e=a.browser.zoomForCurrentScale(),g=0,d=0;d<a.stylesheet.styles.length;++d){var m=a.stylesheet.styles[d];if(!m.zoom||m.zoom==e)if(++g,m=a.stylesheet.styles[d].style,b||(b=$=m),"LINEPLOT"==m.glyph||"HISTOGRAM"==m.glyph||"GRADIENT"==m.glyph||h(m.SCATTER))c||
(b=$=m),c=!0}if(!b)return;s.style.display=g==a.stylesheet.styles.length?"none":"inline";e=c&&1==g;c?(qa.style.display="table-row",ga.style.display="table-row",ua.style.display="none",T.style.display="none"):(qa.style.display="none",ga.style.display="none",ua.style.display="table-row",R.checked=h($.BUMP),V.disabled=!h($.BUMP),T.style.display="table-row",ha.checked=h($.LABEL));e?(na.style.display="table-row",ba.style.display="table-row"):(na.style.display="none",ba.style.display="none");g=1;b.COLOR1?
(x.value=z(b.COLOR1).toHexString(),b.COLOR2&&(F.value=z(b.COLOR2).toHexString(),b.COLOR3?(w.value=z(b.COLOR3).toHexString(),g=3):g=2)):"LINEPLOT"==b.glyph||"DOT"==b.glyph&&b.FGCOLOR?x.value=z(b.FGCOLOR).toHexString():b.BGCOLOR&&(x.value=z(b.BGCOLOR).toHexString());A(g);b._plusColor&&(H.value=z(b._plusColor).toHexString()||b._plusColor);b._minusColor&&(f.value=z(b._minusColor).toHexString()||b._minusColor);h(b.SCATTER)?K.value="SCATTER":K.value=b.glyph;var l,r;void 0!==b.MIN&&(g=parseFloat(b.MIN),
isNaN(g)||(l=g));a.forceMinDynamic||void 0===b.MIN&&void 0===a.forceMin?(G.checked=!1,D.disabled=!0):(G.checked=!0,D.disabled=!1);void 0!==b.MAX&&(g=parseFloat(b.MAX),isNaN(g)||(r=g));a.forceMaxDynamic||void 0===b.MAX&&void 0===a.forceMax?(k.checked=!1,y.disabled=!0):(k.checked=!0,y.disabled=!1);void 0!=a.forceMin&&(l=a.forceMin);void 0!=a.forceMax&&(r=a.forceMax);"number"==typeof l&&l!=parseFloat(D.value)&&(D.value=l);"number"==typeof r&&r!=parseFloat(y.value)&&(y.value=r);(b=q(a.stylesheet))?(Y.style.display=
"table-row",aa.checked="mismatch"===b.__SEQCOLOR,la.style.display="table-row",ka.checked=h(b.__INSERTIONS),fa.style.display="table-row",ma.checked=void 0===b.__disableQuals||!1===b.__disableQuals,console.log(b.__disableQuals)):(Y.style.display="none",la.style.display="none",fa.style.display="none");b&&aa.checked&&!e?(ra.style.display="table-row",oa.style.display="table-row"):(ra.style.display="none",oa.style.display="none")}c&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?ta.style.display=
"table-row":ta.style.display="none"},aa=l("input",null,{type:"checkbox"}),Y=l("tr",[l("th","Highlight mismatches & strands"),l("td",aa)]);aa.addEventListener("change",function(b){b=t(a.stylesheet);q(b).__SEQCOLOR=aa.checked?"mismatch":"base";a.mergeStylesheet(b)});var ka=l("input",null,{type:"checkbox"}),la=l("tr",[l("th","Show insertions"),l("td",ka)]);ka.addEventListener("change",function(b){b=t(a.stylesheet);q(b).__INSERTIONS=ka.checked?"yes":"no";a.mergeStylesheet(b)});var ma=l("input",null,{type:"checkbox"}),
fa=l("tr",[l("th","Reflect base quality as base color transparency"),l("td",ma)]);ma.addEventListener("change",function(b){b=t(a.stylesheet);var c=q(b);c.__disableQuals=!ma.checked;console.log(c.__disableQuals);a.mergeStylesheet(b)});var na=l("tr",[l("th","Style"),l("td",K)]),ba=l("tr",[l("th",["Colour(s)",g,n]),r]),ra=l("tr",[l("th","Plus Strand Color"),l("td",H)]),oa=l("tr",[l("th","Minus Strand Color"),l("td",f)]),qa=l("tr",[l("th","Min value"),l("td",[G," ",D])]),ga=l("tr",[l("th","Max value"),
l("td",[k," ",y])]),ta=l("tr",[l("th","Threshold leap:"),l("td",[I," ",S])]),ua=l("tr",[l("th","Bump overlaps"),l("td",[R," limit: ",V])]),T=l("tr",[l("th","Label features"),l("td",ha)]),g=l("table",[l("tr",[l("th","Name",{},{width:"150px",textAlign:"right"}),u]),l("tr",[l("th","Pin to top"),P]),l("tr",[l("th","Height"),l("td",L)]),na,ba,ra,oa,qa,ga,ta,ua,T,Y,la,fa]);U();p.appendChild(g);g=l("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});g.addEventListener("click",
function(b){a.setConfig({})},!1);p.appendChild(g);u.addEventListener("input",function(b){a.mergeConfig({name:u.value})},!1);P.addEventListener("change",function(b){a.mergeConfig({pinned:P.checked})},!1);for(g=0;g<C.length;++g)C[g].addEventListener("change",d,!1);H.addEventListener("change",d,!1);f.addEventListener("change",d,!1);K.addEventListener("change",function(c){c=e(function(a){"SCATTER"===K.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=K.value,a.SCATTER=void 0);b(a)});a.mergeStylesheet(c)},
!1);G.addEventListener("change",function(b){b={forceMinDynamic:!G.checked};D.disabled=!G.checked;var c=parseFloat(D.value);G.checked&&"number"==typeof c&&!isNaN(c)&&(b.forceMin=parseFloat(c));a.mergeConfig(b)});D.addEventListener("input",function(b){b=parseFloat(D.value);"number"!=typeof b||isNaN(b)||a.mergeConfig({forceMin:b})},!1);k.addEventListener("change",function(b){b={forceMaxDynamic:!k.checked};y.disabled=!k.checked;var c=parseFloat(y.value);k.checked&&"number"==typeof c&&!isNaN(c)&&(b.forceMax=
parseFloat(c));a.mergeConfig(b)});y.addEventListener("input",function(b){b=parseFloat(y.value);"number"!=typeof b||isNaN(b)||a.mergeConfig({forceMax:b})},!1);L.addEventListener("input",function(b){b=parseFloat(L.value);"number"!=typeof b||isNaN(b)||a.mergeConfig({height:Math.min(500,b|0)})},!1);var Z=function(){S.disabled=!I.checked;if(I.checked){var b=parseFloat(S.value);"number"!=typeof b||isNaN(b)||a.mergeConfig({quantLeapThreshold:parseFloat(S.value)})}else a.mergeConfig({quantLeapThreshold:null})};
I.addEventListener("change",function(a){Z()},!1);S.addEventListener("input",function(a){Z()},!1);ha.addEventListener("change",function(b){b=e(function(a){a.LABEL=ha.checked?"yes":"no"});a.mergeStylesheet(b)},!1);R.addEventListener("change",function(b){b=e(function(a){a.BUMP=R.checked?"yes":"no"});a.mergeStylesheet(b)},!1);V.addEventListener("input",function(b){b=parseInt(V.value);"number"==typeof b&&0<b&&a.mergeConfig({subtierMax:b})},!1);this.showToolPanel(p);this.setUiMode("tier");a.addTierListener(U);
var M=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=M&&(M=a.browser.scale,U())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./sourcecompare":35,"./utils":49}],45:[function(d,u,s){function q(a,b,c,e){this.config=c||{};this.id="tier"+ ++p;this.browser=a;this.dasSource=h(b);this.background=e;this.viewport=n("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=
n("div",this.viewport,{className:"viewport-holder_12_5"},{background:e,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=n("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=n("div","",{className:"notifier"});this.notifierHolder=n("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=n("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=
n("i",null,{className:"fa fa-times"});this.bumpButton=n("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=n("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=n("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(n("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(c=null,this.browser.chains[b.mapping]&&(c=this.browser.chains[b.mapping].coords.version),
c&&this.nameButton.appendChild(n("span",""+c,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=n("span",b.name);this.nameButton.appendChild(n("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=n("span",[this.nameButton],{className:"btn-group track-label"});
this.row=n("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});e||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var g=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&g.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&(this.readinessListener=function(a){g.notify(a,-1)},this.featureSource.addReadinessListener(this.readinessListener));this.featureSource&&this.featureSource.addActivityListener&&(this.activityListener=function(a){g.loaderButton.style.display=0<a?"inline-block":
"none";g.browser.pingActivity()},this.featureSource.addActivityListener(this.activityListener));this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof d){s=d("./utils");var n=s.makeElement,l=s.removeChildren,h=s.shallowCopy,t=s.miniJSONify,z=s.arrayIndexOf;s=d("./das");var B=s.DASStylesheet,c=s.DASStyle,a=d("./sha1").b64_sha1;s=d("./style");var b=s.StyleFilter,e=s.StyleFilterSet,m=d("./sourcecompare").sourceDataURI}var p=0;q.prototype.destroy=function(){this.featureSource.removeReadinessListener&&
this.featureSource.removeReadinessListener(this.readinessListener);this.featureSource.removeActivityListener&&this.featureSource.removeActivityListener(this.activityListener)};q.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};q.prototype.toString=function(){return this.id};q.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};q.prototype.init=function(){var a=this;a.dasSource.style?
(this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this)):(a.status="Fetching stylesheet",a.fetchStylesheet(function(b,e){if(e||!b){a.error="No stylesheet";b=new B;var g=new c;g.glyph="BOX";g.BGCOLOR="blue";g.FGCOLOR="black";b.pushStyle({type:"default"},null,g);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();a.browser.refreshTier(a)}))};q.prototype.setStylesheet=function(b){this.baseStylesheet=
h(b);for(b=0;b<this.baseStylesheet.styles.length;++b){var c=this.baseStylesheet.styles[b]=h(this.baseStylesheet.styles[b]);c._methodRE=c._labelRE=c._typeRE=null;c.style=h(c.style);c.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=a(t(this.baseStylesheet));this._updateFromConfig()};q.prototype.getSource=function(){return this.featureSource};q.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};q.prototype.getActiveStyleFilters=function(a){a=
this.browser.zoomForCurrentScale();if(this.stylesheet){for(var c=new e,g=this.stylesheet.styles,d=0;d<g.length;++d){var h=g[d];h.zoom&&h.zoom!=a||c.add(new b(h.type,h.method,h.label))}return c}};q.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};q.prototype.viewFeatures=function(a,b,c,e,g){this.currentFeatures=e;this.currentSequence=g;this.notifyFeaturesLoaded();this.knownChr=
a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};q.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?v(this,a):g(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};q.prototype.findNextFeature=function(a,b,c,e,g){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,g);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&
b<=this.knownCoverage.max()&&this.currentFeatures){for(var d=null,h=0;h<this.currentFeatures.length;++h){var m=this.currentFeatures[h];if(m.min&&m.max&&!(m.parents&&0<m.parents.length))if(0>c)if(1==e&&m.max>=b&&m.min<b){if(!d||m.min>d.min||m.min==d.min&&m.max<d.max)d=m}else m.max<b&&(!d||m.max>d.max||m.max==d.max&&m.min<d.min||m.min==d.mmin&&d.max>=b)&&(d=m);else if(1==e&&m.min<=b&&m.max>b){if(!d||m.max<d.max||m.max==d.max&&m.min>d.min)d=m}else m.min>b&&(!d||m.min<d.min||m.min==d.min&&m.max>d.max||
m.max==d.max&&d.min<=b)&&(d=m)}if(d)return g(d);b=0>c?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,b,c,g)}};q.prototype.trySourceFNF=function(a,b,c,e){var g=this;this.featureSource.findNextFeature(a,b,c,function(a){a||e(a);var b=g.browser.getSequenceSource();b||e(a);b.getSeqInfo(a.segment,function(b){b?e(a):g.trySourceFNF(a.segment,0<c?1E10:0,c,e)})})};q.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=
this.dasSource.collapseSuperGroups?"inline-block":"none"};q.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};q.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var c=this.overlay.getContext("2d");
b&&c.scale(2,2);var e=b=a.viewStart,g=a.viewEnd;if(this.overlayLabelCanvas){var d=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale;c.save();c.translate(d,0);var h=-d+2;this.dasSource.tierGroup&&(h+=15);this.overlayLabelCanvas.draw(c,h,a.featurePanelWidth-d);c.restore()}for(d=0;d<a.highlights.length;++d)h=a.highlights[d],(h.chr===a.chr||h.chr==="chr"+a.chr)&&h.min<g&&h.max>e&&(c.globalAlpha=a.defaultHighlightAlpha,c.fillStyle=a.defaultHighlightFill,c.fillRect((h.min-b)*a.scale,0,(h.max-
h.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="0px"};q.prototype.updateStatus=function(a){var b=this;a?(this.status=a,this._notifierToStatus(),m(this.dasSource),"https:"!==window.location.protocol||0!=m(this.dasSource).indexOf("http:")||this.checkedHTTP||(this.checkedHTTP=!0,this.browser.canFetchPlainHTTP().then(function(a){a||(b.warnHTTP=!0,b._notifierToStatus())}))):this.status&&(this.status=
null,this._notifierToStatus())};q.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c._notifierToStatus()},b)}}else this._notifierToStatus()};q.prototype._notifierOn=function(a,b){l(this.notifier);b?this.notifier.appendChild(n("span",[n("a","[HTTP Warning] ",{href:this.browser.httpWarningURL,target:"_blank"}),
a])):this.notifier.textContent=a;this.notifier.style.opacity=0.8};q.prototype._notifierOff=function(){this.notifier.style.opacity=0};q.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status,this.warnHTTP):this._notifierOff()};q.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};q.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};q.prototype.mergeConfig=
function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};q.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var c=this.config.height||this.dasSource.forceHeight;c!=this.forceHeight&&(this.forceHeight=c,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);c=void 0!=this.config.forceMin?this.config.forceMin:
this.dasSource.forceMin;this.forceMin!=c&&(this.forceMin=c,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);c=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=c&&(this.forceMax=c,a=!0);c=null;void 0!==this.config.quantLeapThreshold?c=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(c=this.dasSource.quantLeapThreshold);c!=this.quantLeapThreshold&&(this.quantLeapThreshold=
c,a=!0);c=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(c=this.config.stylesheet);c=c||this.baseStylesheet;this.stylesheet!==c&&(this.stylesheet=c,a=!0);c=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;c!==this.pinned&&(this.pinned=c,b=!0);c=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;c!=this.subtierMax&&(this.subtierMax=c,a=!0);c=void 0!==this.config.bumped?this.config.bumped:
void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;c!==this.bumped&&(this.bumped=c,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};q.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};q.prototype.clearTierListeners=function(){this.listeners=[]};q.prototype.addTierListener=function(a){this.listeners.push(a)};
q.prototype.removeTierListener=function(a){a=z(this.listeners,a);0<=a&&this.listeners.splice(a,1)};q.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};q.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};q.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};q.prototype.removeFeaturesLoadedListener=function(a){a=z(this.featuresLoadedListeners,
a);0<=a&&this.featuresLoadedListeners.splice(a,1)};q.prototype.notifyFeaturesLoaded=function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof u){u.exports={DasTier:q};var g=d("./feature-draw").drawFeatureTier,v=d("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./sequence-draw":31,"./sha1":33,"./sourcecompare":35,"./style":37,"./utils":49}],46:[function(d,u,s){function q(a,b){for(var c=
0;c<a.length;++c){var f=a[c];f===b?f.classList.add("active"):f.classList.remove("active")}}if("undefined"!==typeof d){var n=d("./cbrowser").Browser,l=d("./sourcecompare").sourcesAreEqual;u=d("./utils");var h=u.makeElement,t=u.removeChildren,z=u.Observed;u=d("./thub");var B=u.THUB_COMPARE,c=u.connectTrackHub,a=d("./domui").makeTreeTableSection,b=d("./probe").probeResource;u=d("./bin");var e=u.URLFetchable,m=u.BlobFetchable,p=u.readInt,g=d("./lh3utils").unbgzf,v=d("./bam").BAI_MAGIC,r=d("./tabix").TABIX_MAGIC;
u=d("./das");var O=u.DASSource,Q=u.DASSegment,P=u.DASRegistry,K=u.coordsMatch,x=d("./encode").EncodeFetchable}n.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(l(this.tiers[b].dasSource,a))return this.tiers[b];return!1};n.prototype.makeButton=function(a,b){var c=h("a",a,{href:"#"});b&&this.makeTooltip(c,b);return h("li",c)};n.prototype.showTrackAdder=function(d){function l(b){ea.style.display="none";ia.style.display="none";da.style.display="none";T=!1;t(M);for(var c=h("div",
null,{},{width:"100%"}),f=[],e=0;e<b.length;++e)f.push(b[e]);f.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});b=[];for(var g=[],e=0;e<f.length;++e){var d=f[e];d.children&&0<d.children.length&&"multiWig"!=d.container?b.push(d):g.push(d)}0<g.length&&b.push({shortLabel:"Others",priority:-1E8,children:g});b.sort(B);for(var m=[],f=0;f<b.length;++f){d=g=b[f];!d.dimensions&&d._parent&&d._parent.dimensions&&(d=d._parent);e={};if(d.dimensions)for(var p=
d.dimensions.split(/(\w+)=(\w+)/),n=0;n<p.length-2;n+=3)e[p[n+1]]=p[n+2];if(e.dimX&&e.dimY){for(var r=e.dimX,q=e.dimY,e=d.subgroups[r],p=d.subgroups[q],n={},E=0;E<g.children.length;++E){var C=g.children[E],d=C.sgm[r],s=C.sgm[q];n[d]||(n[d]={});n[d][s]=C}q=h("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});d=h("tr");d.appendChild(h("th",null,{},{width:"150px",height:"100px"}));for(s=0;s<e.titles.length;++s)r=h("th",h("div",e.titles[s],{},{transform:"rotate(-60deg)",
transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),d.appendChild(r);q.appendChild(d);for(var y=h("tbody",null,{className:"table table-striped table-condensed"}),A=0;A<p.titles.length;++A){var s=p.tags[A],v=h("tr");v.appendChild(h("th",p.titles[A]),{});for(var x=0;x<e.titles.length;++x){var d=e.tags[x],D=h("td");if(n[d]&&n[d][s]){d=n[d][s];E=d.toDallianceSource();
if(!E)continue;r=h("tr");C=h("td");C.style.textAlign="center";var w=h("input");w.type="checkbox";w.dalliance_source=E;sa&&(w.dalliance_mapping=sa);m.push(w);D.appendChild(w);w.addEventListener("change",function(a){a.target.checked?k.addTier(a.target.dalliance_source):k.removeTier(a.target.dalliance_source)})}v.appendChild(D)}y.appendChild(v)}q.appendChild(y);c.appendChild(a(g.shortLabel,q,0==f))}else{p=h("tbody",null,{className:"table table-striped table-condensed"});n=h("table",p,{className:"table table-striped table-condensed"},
{width:"100%",tableLayout:"fixed"});s=0;g.children.sort(B);for(e=0;e<g.children.length;++e)if(d=g.children[e],E=d.toDallianceSource())r=h("tr"),C=h("td",null,{},{width:"30px"}),C.style.textAlign="center",w=h("input"),w.type="checkbox",w.dalliance_source=E,sa&&(w.dalliance_mapping=sa),m.push(w),C.appendChild(w),w.addEventListener("change",function(a){a.target.checked?k.addTier(a.target.dalliance_source):k.removeTier(a.target.dalliance_source)}),r.appendChild(C),q=h("td"),q.appendChild(document.createTextNode(d.shortLabel)),
d.longLabel&&0<d.longLabel.length&&k.makeTooltip(q,d.longLabel),r.appendChild(q),p.appendChild(r),++s;1<b.length||"Others"!==g.shortLabel?c.appendChild(a(g.shortLabel,n,0==f)):c.appendChild(n)}}var u=function(){for(var a=0;a<m.length;++a){var b=m[a],c=k.currentlyActive(b.dalliance_source);c?(b.checked=!0,b.disabled=null!=c.sequenceSource):b.checked=!1}};u();k.addTierListener(function(a){u()});M.appendChild(c)}function n(){q(I,ma);T="bin";ea.style.display="none";ia.style.display="inline";da.style.display=
"none";t(M);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom URL-based data"));a.appendChild(h("p",["You can add indexed binary data hosted on an web server that supports CORS (",h("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(h("br"));a.appendChild(document.createTextNode("URL: "));ba=h("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},
{width:"100%"});a.appendChild(ba);a.appendChild(h("br"));a.appendChild(h("b","- or -"));a.appendChild(h("br"));a.appendChild(document.createTextNode("File: "));ga=h("input",null,{type:"file",multiple:"multiple"});a.appendChild(ga);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.'));M.appendChild(a);ba.focus()}function f(){q(I,fa);ea.style.display="none";ia.style.display="inline";da.style.display="none";T="hub-connect";ea.style.visibility="hidden";t(M);var a=
h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Connect to a track hub."));a.appendChild(h("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));ba=h("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(ba);M.appendChild(a);ba.focus()}function E(){q(I,la);ea.style.display="none";ia.style.display="inline";da.style.display="none";T="das";t(M);var a=h("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom DAS data"));a.appendChild(h("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(h("br"));ba=h("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(ba);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));
M.appendChild(a);ba.focus()}function C(){if(T)if("das"===T){var a=ba.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new O({name:"temporary",uri:a});X(a)}else if("bin"===T){var b=ga.files;if(b&&0<b.length){a=pa=[];T="multiple";for(var c=0;c<b.length;++c){var e=b[c];e&&a.push({blob:e})}for(c=0;c<a.length;++c)ca(a[c]);ja()}else a=ba.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport=
"encode"),W(b)}else if("reset"===T)E();else if("reset-bin"===T)n();else if("reset-hub"===T)f();else if("prompt-bai"===T)(b=ga.files)&&0<b.length&&b[0]?(Z.baiBlob=b[0],D(Z)):(b=Z,ea.style.display="none",ia.style.display="inline",da.style.display="inline",t(M),T="prompt-bai",M.appendChild(h("h2","Select an index file")),M.appendChild(h("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
M.appendChild(document.createTextNode("Index file: ")),ga=h("input",null,{type:"file"}),M.appendChild(ga),Z=b);else if("prompt-tbi"===T)(b=ga.files)&&0<b.length&&b[0]?(Z.indexBlob=b[0],y(Z)):(b=Z,ea.style.display="none",ia.style.display="inline",da.style.display="inline",t(M),T="prompt-tbi",M.appendChild(h("h2","Select an index file")),M.appendChild(h("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
M.appendChild(document.createTextNode("Index file: ")),ga=h("input",null,{type:"file"}),M.appendChild(ga),Z=b);else if("finalize"===T||"finalize-bin"===T)Z.name=ra.value,b=oa.value,Z.mapping="__default__"!=b?b:void 0,qa&&(Z.maxbins=qa.checked),1<ta.value.length&&1<ua.value.length&&(Z.xUser=ta.value,Z.xPass=ua.value),k.addTier(Z),"finalize-bin"==T?n():E();else if("hub-connect"===T)a=ba.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),s(a);else{if("multiple"===T){for(b=0;b<pa.length;++b)if(a=pa[b],
!a.hidden&&("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=wa(a)))a.noPersist=!0,k.addTier(a);n()}}else k.removeAllPopups()}function s(a,b,f){b=b||{};for(var e=0;e<k.hubObjects.length;++e){var g=k.hubObjects[e];if(g.hub.url==a){for(e=0;e<I.length;++e)I[e].hub==g&&q(I,I[e]);g.getTracks(function(a,b){b&&console.log(b);l(a)});return}}c(a,function(c,e){if(e){if(!f)return s(a,{credentials:!0},!0);t(M);M.appendChild(h("h2","Error connecting to track hub"));
M.appendChild(h("p",e));T="reset-hub"}else{var g=null,d=null,m;for(m in c.genomes){var p=null,n=!1;if(m==k.coordSystem.ucscName)n=!0;else for(var r in k.chains)m==k.chains[r].coords.ucscName&&(p=r,n=!0);n&&(n={url:a,genome:m},b.credentials&&(n.credentials=!0),p&&(n.mapping=p,c.genomes[m].mapping=p),k.hubs.push(n),k.hubObjects.push(c.genomes[m]),n=aa(c.genomes[m]),na.appendChild(n),p&&g||(g=c.genomes[m],d=n))}g?(k.notifyTier(),q(I,d),g.getTracks(function(a,b){l(a)})):(t(M),M.appendChild(h("h2","No data for this genome")),
M.appendChild(h("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),M.appendChild(h("p","coordSystem.ucscName = "+k.coordSystem.ucscName)),T="reset-hub")}},b)}function A(a,b){var c=a.uri;if(b){var f=/(.+)\/[^\/]+\/?/.exec(c);f&&(c=f[1]+"/sources")}(new P(c,{credentials:a.credentials})).sources(function(c){if(!c||0==c.length)return b?N(a):A(a,!0);var f=null;if(1==c.length)f=c[0];else for(var e=0;e<c.length;++e)if(c[e].uri===a.uri){f=
c[e];break}e=c=!1;if(f&&(a.name=f.name,a.desc=f.desc,a.maxbins=f.maxbins?!0:!1,f.capabilities&&(a.capabilities=f.capabilities),e=!0,f.coords&&1==f.coords.length))if(f=f.coords[0],K(f,k.coordSystem))c=!0;else if(k.chains)for(var g in k.chains)K(f,k.chains[g].coords)&&(a.mapping=g,c=!0);return N(a,c,e)},function(){return b?N(a):A(a,!0)})}function D(a){(a.baiBlob?new m(a.baiBlob):"encode"==a.transport?new x(a.bamURI+".bai"):new e(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(b){var c=
!1;b&&(b=new Uint8Array(b),c=p(b,0)==v);return c?N(a,!1,!1,!0):u("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function y(a){(a.indexBlob?new m(a.indexBlob):new e(a.uri+".tbi")).slice(0,65536).fetch(function(b){var c=!1;if(b){var f=new Uint8Array(b);if(31==f[0]||139==f[1])b=g(b),f=new Uint8Array(b),c=p(f,0)==r}return c?N(a,!1,!1,!0):u('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function u(a){ea.style.display="none";ia.style.display="inline";da.style.display="inline";t(M);a=a||"Custom data format not recognized";M.appendChild(h("h2","Error adding custom data"));M.appendChild(h("p",a));M.appendChild(h("p","Currently supported formats are bigBed, bigWig, and BAM."));T="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var k=this;d=h("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var I=[],S,L;if(!this.noRegistryTabs){var R=this.makeButton("Registry","Browse compatible datasources from the DAS registry");I.push(R);for(var V in this.mappableSources)(function(a){var b=k.makeButton(k.chains[a].srcTag,"Browse datasources mapped from "+k.chains[a].srcTag);I.push(b);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();q(I,b);S(k.mappableSources[a],a)},!1)})(V)}V={};for(var ha=0;ha<this.defaultSources.length;++ha){var $=
this.defaultSources[ha],U=$.group||"Defaults";V[U]?V[U].push($):V[U]=[$]}var aa=function(a){var b=a.hub,c=h("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),e=b.shortLabel||"Unknown";a.mapping&&(e=e+" ("+a.genome+")");var e=h("span",[e," ",c]),g=k.makeButton(e,b.longLabel);g.hub=a;I.push(g);g.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();q(I,g);t(M);b=k.makeLoader(24);b.style.marginLeft="auto";b.style.marginRight="auto";b.style.marginTop="100px";M.appendChild(h("div",
b,null,{textAlign:"center"}));ea.style.display="none";ia.style.display="none";da.style.display="none";a.getTracks(function(a,b){b&&console.log(b);l(a)})},!1);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=h("li",h("a","Remove hub")),e=h("li",h("a","Enable all")),d=h("li",h("a","Disable all")),m=h("ul",[c,e,d],{className:"dropdown-menu"},{display:"block"}),l=b.clientX;b=b.clientY;l+=document.documentElement.scrollLeft||document.body.scrollLeft;b+=document.documentElement.scrollTop||
document.body.scrollTop;m.style.position="absolute";m.style.top=""+(b+10)+"px";m.style.left=""+(l-30)+"px";k.hPopupHolder.appendChild(m);var p=function(a){console.log("cc");document.body.removeEventListener("click",p,!0);k.hPopupHolder.removeChild(m)};document.body.addEventListener("click",p,!0);c.addEventListener("click",function(b){for(b=0;b<k.hubObjects.length;++b)if(k.hubObjects[b].absURL==a.absURL){k.hubObjects.splice(b,1);break}for(b=0;b<k.hubs.length;++b){var c=k.hubs[b];"string"===typeof c&&
(c={url:c});if(c.url==a.hub.url&&!c.genome||c.genome==a.genome){k.hubs.splice(b,1);break}}k.notifyTier();na.removeChild(g);q(I,fa);f()},!1);e.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var c=0;c<a.length;++c){var f=a[c].toDallianceSource();k.currentlyActive(f)||k.addTier(f)}})},!1);d.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var c=0;c<a.length;++c){var f=a[c].toDallianceSource();k.currentlyActive(f)&&k.removeTier(f)}})},
!1)},!1);return g},Y=null,ka=null;for(U in V)(function(a,b){var c=k.makeButton(a,"Browse the default set of data for this browser");c.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();q(I,c);S(new z(b))},!1);I.push(c);Y||(Y=c,ka=b)})(U,V[U]);var la=this.makeButton("DAS","Add arbitrary DAS data");I.push(la);var ma=this.makeButton("Binary","Add data in bigwig or bigbed format");I.push(ma);for(U=0;U<this.hubObjects.length;++U)aa(this.hubObjects[U]);var fa=this.makeButton("+",
"Connect to a new track-hub");I.push(fa);var na=h("ul",I,{className:"nav nav-tabs"},{marginBottom:"0px"});d.appendChild(na);var ba,ra,oa,qa,ga,ta,ua,T=!1,Z=null,U=h("form",null,{},{display:"inline-block",width:"100%"});U.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();C();return!1},!0);var M=h("div");M.style.position="relative";M.style.overflow="scroll";U.appendChild(M);var sa,va;S=function(a,b){ea.style.display="none";ia.style.display="none";da.style.display="none";va&&
va.removeListener(L);sa=b;va=a;va.addListenerAndFire(L)};L=function(a){T=!1;var b=[];t(M);if(a){for(var c=h("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),f=h("table",c,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),e=0,g=[],d=0;d<a.length;++d)g.push(a[d]);g.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(d=0;d<g.length;++d){a=g[d];var m=h("tr"),l=h("td",null,{},{width:"30px"});
l.style.textAlign="center";if(!a.props||a.props.cors){var p=h("input");p.type="checkbox";p.dalliance_source=a;sa&&(p.dalliance_mapping=sa);l.appendChild(p);b.push(p);p.addEventListener("change",function(a){a.target.checked?k.addTier(a.target.dalliance_source):k.removeTier(a.target.dalliance_source)})}else l.appendChild(document.createTextNode("!")),k.makeTooltip(l,h("span",["This data source isn't accessible because it doesn't support ",h("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));m.appendChild(l);
l=h("td");l.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&k.makeTooltip(l,a.desc);m.appendChild(l);c.appendChild(m);++e}var n=function(){for(var a=0;a<b.length;++a){var c=b[a];k.currentlyActive(c.dalliance_source)?c.checked=!0:c.checked=!1}};n();k.addTierListener(function(a){n()});M.appendChild(f)}else M.appendChild(h("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};R&&R.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();q(I,R);S(k.availableSources)},!1);ma.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();n()},!1);fa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();f()},!1);la.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();E()},!1);var ia=h("button","Add",{className:"btn btn-primary"});ia.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();C()},!1);var X=function(a,b){var c=k.knownSpace;if(c){var f=
Math.max(c.min,(c.min+c.max-100)/2)|0,c=new Q(c.chr,f,Math.min(f+99,c.max));a.features(c,{},function(c,f){if(f)b?(t(M),M.appendChild(h("h2","Custom data not found")),M.appendChild(h("p","DAS uri: "+a.uri+" is not answering features requests")),T="reset"):(a.credentials=!0,X(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);A(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},wa=function(a){var b={name:a.name};a.credentials&&(b.credentials=a.credentials);a.mapping&&
"__default__"!=a.mapping&&(b.mapping=a.mapping);a.transport&&(b.transport=a.transport);if("bwg"==a.tier_type)return a.blob?b.bwgBlob=a.blob:a.uri&&(b.bwgURI=a.uri),b;if("bam"==a.tier_type)return a.blob?(b.bamBlob=a.blob,b.baiBlob=a.indexBlob):(b.bamURI=a.uri,b.baiURI=a.indexUri),b;if("tabix"==a.tier_type)return b.tier_type="tabix",b.payload=a.payload,a.blob?(b.blob=a.blob,b.indexBlob=a.indexBlob):(b.uri=a.uri,b.indexUri=a.indexUri),b;if("memstore"==a.tier_type)return b.tier_type="memstore",b.payload=
a.payload,a.blob?b.blob=a.blob:b.uri=a.uri,b},W=function(a){b(a,function(a,b){if(b){t(M);var c=h("div");c.appendChild(h("h2","Couldn't access custom data"));c.appendChild(h("p",""+b));M.appendChild(c);console.log(a);"https:"===window.location.protocol&&0==a.uri.indexOf("http:")&&k.canFetchPlainHTTP().then(function(a){a||c.appendChild(h("p",[h("strong","HTTP warning: "),"you may not be able to access HTTP resources from an instance of Biodalliance which you are accessing via HTTPS.",h("a","[More info]",
{href:k.httpWarningURL,target:"_blank"})]))});T="reset-bin"}else{var f=wa(a);return"bam"==a.tier_type?D(f):"tabix"==a.tier_type?y(f):N(f,!1,!1,!0)}})},N=function(a,b,c,f){ea.style.display="none";ia.style.display="inline";da.style.display="inline";t(M);M.appendChild(h("h2","Add custom data: step 2"));M.appendChild(document.createTextNode("Label: "));ra=h("input","",{value:a.name});M.appendChild(ra);ta=h("input","");ua=h("input","");M.appendChild(h("br"));M.appendChild(h("br"));M.appendChild(h("h4",
"Coordinate system: "));oa=h("select",null);oa.appendChild(h("option",k.nameForCoordSystem(k.coordSystem),{value:"__default__"}));if(k.chains)for(var e in k.chains)oa.appendChild(h("option",k.nameForCoordSystem(k.chains[e].coords),{value:e}));oa.value=a.mapping||"__default__";M.appendChild(oa);b?M.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):(M.appendChild(h("p",[h("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),
M.appendChild(h("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));f||(M.appendChild(document.createTextNode("Quantitative: ")),qa=h("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(qa.checked=a.maxbins),M.appendChild(qa),c?M.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):M.appendChild(h("p",[h("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&
M.appendChild(h("p",[h("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));ra.focus();T="bin"===T||"prompt-bai"===T||"prompt-tbi"===T?"finalize-bin":"finalize";Z=a},pa=null,ca=function(a){b(a,function(a,b){b&&(a.error=b);for(var c=[],f={},e={},g=0;g<pa.length;++g){var d=pa[g];"bam"!=d.tier_type||d.indexBlob||(f[d.blob.name]=d);"tabix"!=d.tier_type||d.indexBlob||(e[d.blob.name]=d)}for(g=0;g<pa.length;++g)if(d=pa[g],
"bai"===d.tier_type){var h=/(.+)\.bai$/.exec(d.blob.name);h&&f[h[1]]&&(f[h[1]].indexBlob=d.blob,c.push(g))}else"tabix-index"===d.tier_type&&(h=/(.+)\.tbi$/.exec(d.blob.name))&&e[h[1]]&&(e[h[1]].indexBlob=d.blob,c.push(g));for(f=c.length-1;0<=f;--f)pa.splice(c[f],1);ja()})},ja=function(){t(M);var a=!1,b=h("table",pa.filter(function(a){return!a.hidden}).map(function(b){h("tr").appendChild(h("td",b.name||b.blob.name));var c;c=b.error?h("span","Error",null,{color:"red"}):b.tier_type?b.payload||b.tier_type:
k.makeLoader(16);var f,e="unknown";"bwg"==b.tier_type||"memstore"==b.tier_type?e="okay":"bam"==b.tier_type?e=b.indexBlob?"okay":"needs-index":"tabix"==b.tier_type&&(e=b.indexBlob?"okay":"needs-index");if("okay"==e){f=h("select",null,null,{width:"150px"});f.appendChild(h("option",k.nameForCoordSystem(k.coordSystem),{value:"__default__"}));if(k.chains)for(var g in k.chains)f.appendChild(h("option",k.nameForCoordSystem(k.chains[g].coords),{value:g}));f.value=b.mapping||"__default__";f.addEventListener("change",
function(a){b.mapping=f.value;console.log(b)},!1)}else"needs-index"==e&&(f=h("span","Needs index",{},{color:"red"}),a=!0);return h("tr",[h("td",b.name||b.blob.name),h("td",c),h("td",f)])}),{className:"table table-striped table-condensed"});M.appendChild(b);if(a){M.appendChild(h("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
M.appendChild(document.createTextNode("Index file(s): "));var c=h("input",null,{type:"file",multiple:"multiple"});M.appendChild(c);c.addEventListener("change",function(a){console.log("fileset changed");a=c.files||[];for(var b=0;b<a.length;++b){var f=a[b];f&&(f={blob:f,hidden:!0},pa.push(f),ca(f))}},!1)}},da=h("button","Cancel",{className:"btn"});da.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===T?n():E()},!1);var ea=h("button","Refresh",{className:"btn"});
ea.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();k.queryRegistry(sa)},!1);this.makeTooltip(ea,"Click to re-fetch data from the DAS registry");V=h("div",[ia," ",da," ",ea]);V.style.margin="10px";U.appendChild(V);d.appendChild(U);S(k.availableSources);this.showToolPanel(d);this.setUiMode("add");Y&&(q(I,Y),S(new z(ka)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./sourcecompare":35,"./tabix":41,"./thub":42,
"./utils":49}],47:[function(d,u,s){function q(d,h,q){h.fetchAsText(function(h){if(!h)return q(null,"Couldn't fetch index-index");h=h.split(/(.+)([0-9A-F]{10})\n/);for(var s=[],c=[],a=1;a<h.length;a+=3)s.push(h[a]),c.push(parseInt(h[a+1],16));return q(new n(s,c,d))})}function n(d,h,n){this.keys=d;this.offsets=h;this.ix=n}n.prototype.lookup=function(d,h){for(var n,q=(d+"     ").substring(0,5).toLowerCase(),s=0;s<this.keys.length;++s)if(0>q.localeCompare(this.keys[s])){n=this.ix.slice(this.offsets[s-
1],this.offsets[s]-this.offsets[s-1]);break}n||(n=this.ix.slice(this.offsets[this.offsets.length-1]));n.fetchAsText(function(c){c=c.split("\n");for(var a=0;a<c.length;++a)if(0==c[a].indexOf(d.toLowerCase()+" "))return h(c[a].split(" "));return h(null)})};"undefined"!==typeof u&&(u.exports={connectTrix:q})},{}],48:[function(d,u,s){function q(){}function n(c,e){var g=new q;g.data=c;g.data.slice(0,12500).fetch(function(c){if(!c)return e(null,"Couldn't access data");var d=new Uint8Array(c);c=h(d,0);if(c==
a)g.readInt=h;else if(c==b)g.readInt=t;else return e(null,"Not a .2bit file, magic=0x"+c.toString(16));c=g.readInt(d,4);if(0!=c)return e(null,"Unsupported version "+c);g.seqCount=g.readInt(d,8);g.seqDict={};var m=16,n=0,q=0,s=function(){for(;n<g.seqCount;){var a=d[m];if(m+a+6>=d.length)return g.data.slice(q+m,12500).fetch(function(a){q+=m;m=0;d=new Uint8Array(a);s()});++m;for(var b="",c=1;c<=a;++c)b+=String.fromCharCode(d[m++]);a=g.readInt(d,m);m+=4;g.seqDict[b]=new l(g,a);++n}return e(g)};s()})}
function l(a,b){this.tbf=a;this.offset=b}if("undefined"!==typeof d){s=d("./bin");var h=s.readInt,t=s.readIntBE;d=d("./spans");var z=d.Range,B=d.union,c=d.intersection}var a=440477507,b=1126646042;q.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};q.prototype.fetch=function(a,b,c,e){var d=this.getSeq(a);if(d){if(c<=b)return e("");d.fetch(b,c,e)}else return e(null,"Couldn't find "+a)};l.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,
8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var e=null,g=0;g<b.nBlockCnt;++g)var d=b.tbf.readInt(c,4*g),h=b.tbf.readInt(c,4*(g+b.nBlockCnt)),d=new z(d,d+h-1),e=e?B(e,d):d;b.nBlocks=e;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+
b.mBlockCnt);return a()})})};var e=["T","C","A","G"];l.prototype.fetch=function(a,b,g){--a;--b;var d=this;this.init(function(h){if(h)return g(null,h);var l=a>>2;h=b+3>>2;if(0>l||h>d.seqLength)return g("Coordinates out of bounds: "+a+":"+b);d.tbf.data.slice(d.seqOffset+l,h-l).salted().fetch(function(h){function n(a){for(;s<=a;){var b=s&3,c=q[(s>>2)-l];t+=e[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++s}}if(null==h)return g("SeqFetch failed");var q=new Uint8Array(h);h=[];if(d.nBlocks){var r=c(new z(a,
b),d.nBlocks);r&&(h=r.ranges())}for(var t="",s=a,r=0;r<h.length;++r){var u=h[r];if(s>u.min())throw"N mismatch...";for(s<u.min()&&n(u.min()-1);s<=u.max();)t+="N",++s}s<=b&&n(b);return g(t)})})};l.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof u&&(u.exports={makeTwoBit:n})},{"./bin":4,"./spans":36}],49:[function(d,u,s){function q(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function n(a,b,c){a[b]?a[b].push(c):a[b]=
[c]}function l(a,b,c){var e=a[b];if(e){for(a=0;a<e.length;++a)if(e[a]==c)return;e.push(c)}else a[b]=[c]}function h(a,b,c,e){if(a)return a;if(b)return b;if(c)return c;if(e)return e}function q(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function t(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function z(a,b,c,e){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var g=0;g<b.length;++g){var d=b[g];d&&("string"==typeof d?d=document.createTextNode(d):
"number"==typeof d&&(d=document.createTextNode(""+d)),a.appendChild(d))}}if(c)for(var f in c)try{a[f]=c[f]}catch(h){throw console.log("error setting "+f),h;}if(e)for(f in e)a.style[f]=e[f];return a}function B(a,b,c,e){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var g=c[b];"string"==typeof g&&(g=document.createTextNode(g));a.appendChild(g)}if(e)for(var d in e){c=a;b=d;var g=e[d],f=O[b];if(!f){for(var f="",h=0;h<b.length;++h)var m=b.substring(h,h+1),l=m.toLowerCase(),
f=l!=m?f+"-"+l:f+m;O[b]=f}c.setAttribute(f,g)}return a}function c(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function a(b,c){if("undefined"===typeof b)return"undefined";if(null==b)return"null";if("string"==typeof b)return"'"+b+"'";if("number"==typeof b||"boolean"==typeof b)return""+b;if("object"==typeof b){if(b instanceof Array){for(var e=null,g=0;g<b.length;++g)e=(null==e?"":e+", ")+a(b[g],c);return"["+(e?e:"")+"]"}c=c||{};e=null;for(g in b)c[g]||void 0!=g&&"function"!=
typeof b[g]&&(e=(null==e?"":e+", ")+g+": "+a(b[g],c));return"{"+(e?e:"")+"}"}return typeof b}function b(a){var b={},c;for(c in a)b[c]=a[c];return b}function e(a){this.value=a;this.listeners=[]}function m(){this.queue=[]}function p(a,b,c){c&&c.salt&&(a=a+"?salt="+r(""+Date.now()+","+ ++Q));try{var e;c.timeout&&(e=setTimeout(function(){console.log("timing out "+a);g.abort();return b(null,"Timeout")},c.timeout));var g=new XMLHttpRequest;g.onreadystatechange=function(){4==g.readyState&&(e&&clearTimeout(e),
200>g.status||300<=g.status?b(null,"Error code "+g.status):b(g.responseText))};g.open("GET",a,!0);g.responseType="text";c&&c.credentials&&(g.withCredentials=!0);g.send("")}catch(d){b(null,"Exception "+d)}}function g(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}function v(a){return z("a",null,{href:a}).href}if("undefined"!==typeof d)var r=d("./sha1").b64_sha1;var O={};e.prototype.addListener=function(a){this.listeners.push(a)};
e.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};e.prototype.removeListener=function(a){var b=this.listeners;a=t(b,a);0<=a&&b.splice(a,1)};e.prototype.get=function(){return this.value};e.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};m.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};m.prototype.await=
function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var Q=0;d={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",
CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof u&&(u.exports={textXHR:p,relativeURL:g,resolveUrlToPage:v,shallowCopy:b,pusho:n,pushnew:q,pushnewo:l,arrayIndexOf:t,pick:h,makeElement:z,makeElementNS:B,removeChildren:c,miniJSONify:a,Observed:e,Awaited:m,AMINO_ACID_TRANSLATION:d})},{"./sha1":33}],50:[function(d,u,s){function q(){this.info=
[]}function n(a,c){this.parser=a;this.sink=c}if("undefined"!==typeof d){var l=d("./sourceadapters").registerParserFactory;d=d("./das");var h=d.DASStylesheet,t=d.DASStyle,z=d.DASFeature}var B=/([^;=]+)(=([^;]+))?;?/,c=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;q.prototype.createSession=function(a){return new n(this,a)};n.prototype.parse=function(b){if(0!=b.length)if("#"==b[0]){if(1<b.length&&"#"==b[1]&&(b=c.exec(b))){var e=b[1].split(a),d=null,h=null;for(b=0;b<e.length-1;b+=3){var g=e[b+1],
l=e[b+2].replace(/"/g,"");"ID"==g?d=l:"Description"==g&&(h=l)}d&&h&&this.parser.info.push({id:d,desc:h})}}else{e=b.split("\t");d=new z;d.segment=e[0];d.id=e[2];d.refAllele=e[3];d.altAlleles=e[4].split(",");d.min=parseInt(e[1]);d.max=d.min+d.refAllele.length-1;e=e[7].split(B);d.info={};for(b=0;b<e.length;b+=4)d.info[e[b+1]]=e[b+3];b=d.altAlleles[0];e=d.refAllele;b.length>e.length?(d.type="insertion",0==b.indexOf(e)?(d.insertion=b.substr(e.length),d.min+=e.length,d.max=d.min-1):d.insertion=b):d.type=
b.length<e.length?"deletion":"substitution";this.sink(d)}};n.prototype.flush=function(){};q.prototype.getStyleSheet=function(a){var c=new h,d=new t;d.glyph="__INSERTION";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"insertion"},null,d);d=new t;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(255, 60, 60)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"deletion"},null,d);d=new t;d.glyph="PLIMSOLL";d.BUMP="yes";
d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";c.pushStyle({type:"default"},null,d);return a(c)};q.prototype.getDefaultFIPs=function(a){var c=this;a(function(a,b){b.add("Ref. allele",a.refAllele);b.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var d=0;d<c.info.length;++d){var h=c.info[d],l=a.info[h.id];void 0!==l&&b.add(h.desc,l)}})};l("vcf",function(){return new q})},{"./das":10,"./sourceadapters":34}],51:[function(d,u,s){d={CONFIG:5,MAJOR:0,MINOR:13,
MICRO:6,PATCH:"",BRANCH:"",toString:function(){var d=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(d+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(d=d+"-"+this.BRANCH);return d}};"undefined"!==typeof u&&(u.exports=d)},{}],52:[function(d,u,s){function q(){function d(c){c=Math.min(c,b);p=c=Math.max(c,a);s.style.left=""+p+"px"}function h(c){c=Math.min(c,b);g=c=Math.max(c,a);u.style.left=""+g+"px"}var q=n("hr",null,{className:"slider-track"}),s=n("hr",null,{className:"slider-thumb active"}),
u=n("hr",null,{className:"slider-thumb"}),c=n("div",[q,s,u],{className:"slider"}),a=0,b=200,e=0,m=200,p=50,g=100,v=[];c.removeLabels=function(){for(var a=0;a<v.length;++a)c.removeChild(v[a]);v=[]};c.addLabel=function(d,g){var h=n("div",g,{className:"slider-label"},{left:""+(a+(d-e)*(b-a)/(m-e)|0)+"px"});c.appendChild(h);v.push(h)};var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1);Object.defineProperty(c,"value",{get:function(){return e+(p-a)*(m-e)/(b-a)},set:function(c){d(a+(c-
e)*(b-a)/(m-e))}});Object.defineProperty(c,"value2",{get:function(){return e+(g-a)*(m-e)/(b-a)},set:function(c){h(a+(c-e)*(b-a)/(m-e))}});Object.defineProperty(c,"active",{get:function(){return s.classList.contains("active")?1:2},set:function(a){1==a?(s.classList.add("active"),u.classList.remove("active")):(u.classList.add("active"),s.classList.remove("active"))}});Object.defineProperty(c,"min",{get:function(){return e},set:function(a){e=a}});Object.defineProperty(c,"max",{get:function(){return m},
set:function(a){m=a}});var O,Q,q=function(a){Q=this==s?1:2;Q!=c.active&&(c.active=Q,c.dispatchEvent(r));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",P,!1);window.addEventListener("mouseup",K,!1);O=a.clientX-(1==Q?p:g)};s.addEventListener("mousedown",q,!1);u.addEventListener("mousedown",q,!1);var P=function(a){1==Q?d(a.clientX-O):h(a.clientX-O);c.dispatchEvent(r)},K=function(a){window.removeEventListener("mousemove",P,!1);window.removeEventListener("mouseup",K,!1)};return c}
if("undefined"!==typeof d)var n=d("./utils").makeElement;"undefined"!==typeof u&&(u.exports=q)},{"./utils":49}],53:[function(d,u,s){u=d("./promise/promise").Promise;d=d("./promise/polyfill").polyfill;s.Promise=u;s.polyfill=d},{"./promise/polyfill":58,"./promise/promise":59}],54:[function(d,u,s){var q=d("./utils").isArray,n=d("./utils").isFunction;s.all=function(d){if(!q(d))throw new TypeError("You must pass an array to all.");return new this(function(h,q){function s(a){return function(b){u[a]=b;0===
--c&&h(u)}}var u=[],c=d.length,a;0===c&&h([]);for(var b=0;b<d.length;b++)(a=d[b])&&n(a.then)?a.then(s(b),q):(u[b]=a,0===--c&&h(u))})}},{"./utils":63}],55:[function(d,u,s){(function(d,n){function l(){return function(){d.nextTick(u)}}function h(){var a=0,b=new c(u),e=document.createTextNode("");b.observe(e,{characterData:!0});return function(){e.data=a=++a%2}}function t(){return function(){a.setTimeout(u,1)}}function u(){for(var a=0;a<b.length;a++){var c=b[a];(0,c[0])(c[1])}b=[]}var B="undefined"!==
typeof window?window:{},c=B.MutationObserver||B.WebKitMutationObserver,a="undefined"!==typeof n?n:void 0===this?window:this,b=[],e;e="undefined"!==typeof d&&"[object process]"==={}.toString.call(d)?l():c?h():t();s.asap=function(a,c){1===b.push([a,c])&&e()}}).call(this,d("/Users/thomas/Projects/dalliance/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"/Users/thomas/Projects/dalliance/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":64}],
56:[function(d,u,s){s.cast=function(d){return d&&"object"===typeof d&&d.constructor===this?d:new this(function(n){n(d)})}},{}],57:[function(d,u,s){var q={instrument:!1};s.config=q;s.configure=function(d,l){if(2===arguments.length)q[d]=l;else return q[d]}},{}],58:[function(d,u,s){(function(q){var n=d("./promise").Promise,l=d("./utils").isFunction;s.polyfill=function(){var d;d="undefined"!==typeof q?q:"undefined"!==typeof window&&window.document?window:self;"Promise"in d&&"cast"in d.Promise&&"resolve"in
d.Promise&&"reject"in d.Promise&&"all"in d.Promise&&"race"in d.Promise&&function(){var n;new d.Promise(function(d){n=d});return l(n)}()||(d.Promise=n)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":59,"./utils":63}],59:[function(d,u,s){function q(a){if(!g(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof q))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
this._subscribers=[];n(a,this)}function n(b,c){function f(a){B(c,a)}function e(b){a(c,b)}try{b(f,e)}catch(d){e(d)}}function l(b,c,f,e){var d=g(f),h,m,l,n;if(d)try{h=f(e),l=!0}catch(p){n=!0,m=p}else h=e,l=!0;z(c,h)||(d&&l?B(c,h):n?a(c,m):b===x?B(c,h):b===F&&a(c,h))}function h(a,b,c,e){a=a._subscribers;var d=a.length;a[d]=b;a[d+x]=c;a[d+F]=e}function t(a,b){for(var c,e,d=a._subscribers,g=a._detail,h=0;h<d.length;h+=3)c=d[h],e=d[h+b],l(b,c,e,g);a._subscribers=null}function z(b,e){var f=null,d;try{if(b===
e)throw new TypeError("A promises callback cannot return that same promise.");if(p(e)&&(f=e.then,g(f)))return f.call(e,function(a){if(d)return!0;d=!0;e!==a?B(b,a):c(b,a)},function(c){if(d)return!0;d=!0;a(b,c)}),!0}catch(h){if(d)return!0;a(b,h);return!0}return!1}function B(a,b){a===b?c(a,b):z(a,b)||c(a,b)}function c(a,c){a._state===P&&(a._state=K,a._detail=c,m.async(b,a))}function a(a,b){a._state===P&&(a._state=K,a._detail=b,m.async(e,a))}function b(a){t(a,a._state=x)}function e(a){t(a,a._state=F)}
var m=d("./config").config;d("./config");var p=d("./utils").objectOrFunction,g=d("./utils").isFunction;d("./utils");u=d("./cast").cast;var v=d("./all").all,r=d("./race").race,O=d("./resolve").resolve,Q=d("./reject").reject;d=d("./asap").asap;m.async=d;var P=void 0,K=0,x=1,F=2;q.prototype={constructor:q,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,e=new this.constructor(function(){});if(this._state){var d=arguments;m.async(function(){l(c._state,e,d[c._state-1],c._detail)})}else h(this,
e,a,b);return e},"catch":function(a){return this.then(null,a)}};q.all=v;q.cast=u;q.race=r;q.resolve=O;q.reject=Q;s.Promise=q},{"./all":54,"./asap":55,"./cast":56,"./config":57,"./race":60,"./reject":61,"./resolve":62,"./utils":63}],60:[function(d,u,s){var q=d("./utils").isArray;s.race=function(d){if(!q(d))throw new TypeError("You must pass an array to race.");return new this(function(l,h){for(var q,s=0;s<d.length;s++)(q=d[s])&&"function"===typeof q.then?q.then(l,h):l(q)})}},{"./utils":63}],61:[function(d,
u,s){s.reject=function(d){return new this(function(n,l){l(d)})}},{}],62:[function(d,u,s){s.resolve=function(d){return new this(function(n,l){n(d)})}},{}],63:[function(d,u,s){function q(d){return"function"===typeof d}d=Date.now||function(){return(new Date).getTime()};s.objectOrFunction=function(d){return q(d)||"object"===typeof d&&null!==d};s.isFunction=q;s.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)};s.now=d},{}],64:[function(d,u,s){function q(){}d=u.exports={};
d.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(d){return window.setImmediate(d)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var d=[];window.addEventListener("message",function(l){var h=l.source;h!==window&&null!==h||"process-tick"!==l.data||(l.stopPropagation(),0<d.length&&d.shift()())},!0);return function(l){d.push(l);window.postMessage("process-tick","*")}}return function(d){setTimeout(d,0)}}();d.title="browser";d.browser=
!0;d.env={};d.argv=[];d.on=q;d.once=q;d.off=q;d.emit=q;d.binding=function(d){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(d){throw Error("process.chdir is not supported");}},{}],65:[function(d,u,s){function q(){}function n(){this.was=[0]}function l(b,c,e){this.hufts=new Int32Array(3*a);this.window=new Uint8Array(e);this.end=e;this.checkfn=c;this.mode=v;this.reset(b,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=
new Int32Array(1);this.codes=new h;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new t}function h(){}function t(){}function z(a,b,c,e,d){if(0!=d){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&d==a.length)c.set(a,e);else if(H)a=a.subarray(b,b+d),c.set(a,e);else if(1==a.BYTES_PER_ELEMENT&&100<d)a=new Uint8Array(a.buffer,a.byteOffset+b,d),c.set(a,e);else for(var g=0;g<d;++g)c[e+g]=a[b+g]}}function B(a,d,g,h){a=d?g?new Uint8Array(a,d,g):new Uint8Array(a,d,a.byteLength-
d):new Uint8Array(a);g=new q;g.inflateInit(c,!0);g.next_in=a;g.next_in_index=0;g.avail_in=a.length;a=[];for(var l=0;;){var n=new Uint8Array(32E3);g.next_out=n;g.next_out_index=0;g.avail_out=n.length;var r=g.inflate(b);if(r!=e&&r!=m&&r!=p)throw g.msg;if(0!=g.avail_out){var t=new Uint8Array(n.length-g.avail_out);z(n,0,t,0,n.length-g.avail_out);n=t}a.push(n);l+=n.length;if(r==m||r==p)break}h&&(h[0]=(d||0)+g.next_in_index);if(1==a.length)return a[0].buffer;d=new Uint8Array(l);for(g=h=0;g<a.length;++g)l=
a[g],z(l,0,d,h,l.length),h+=l.length;return d.buffer}var c=15,a=1440,b=0,e=0,m=1,p=-5,g=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],v=0,r=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,
4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,
9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,
93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,
7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,
60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,
0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,
9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,
0,8,79,0,9,255],O=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],Q=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],K=[1,2,3,4,5,7,9,13,17,25,33,49,
65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];q.prototype.inflateInit=function(a,b){a||(a=c);b&&(b=!1);this.istate=new n;return this.istate.inflateInit(this,b?-a:a)};q.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};q.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};q.prototype.inflateSync=
function(){return istate.inflateSync(this)};q.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};n.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return e};n.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return e};n.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=
-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new l(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return e};n.prototype.inflate=function(a,b){var c,d;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?p:e;for(c=p;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>
4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+d)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(d&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=
3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=
0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==e&&(c=b);if(c!=m)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=
10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return m;case 13:return-3;default:return-2}};n.prototype.inflateSetDictionary=function(a,b,c){var d=0,g=c;if(null==a||
null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);g>=1<<a.istate.wbits&&(g=(1<<a.istate.wbits)-1,d=c-g);a.istate.blocks.set_dictionary(b,d,g);a.istate.mode=7;return e};var F=[0,0,255,255];n.prototype.inflateSync=function(a){var b,c,d;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return p;c=a.next_in_index;for(d=a.istate.marker;0!=b&&4>d;)a.next_in[c]==F[d]?
d++:d=0!=a.next_in[c]?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(4!=d)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return e};n.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];l.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);
this.mode=v;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};l.prototype.proc=function(a,b){var c,d,h,l,n,p,k;l=a.next_in_index;n=a.avail_in;d=this.bitb;h=this.bitk;p=this.write;for(k=p<this.read?this.read-p-1:this.end-p;;)switch(this.mode){case v:for(;3>h;){if(0!=n)b=e;else return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;d|=(a.next_in[l++]&255)<<h;h+=8}c=
d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;h-=3;c=h&7;d>>>=c;h-=c;this.mode=1;break;case 1:var q=new Int32Array(1),t=new Int32Array(1),s=[],u=[];c=t;var x=s,B=u;q[0]=9;c[0]=5;x[0]=r;B[0]=O;this.codes.init(q[0],t[0],s[0],0,u[0],0,a);d>>>=3;h-=3;this.mode=6;break;case 2:d>>>=3;h-=3;this.mode=3;break;case 3:return d>>>=3,h-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b)}break;
case 1:for(;32>h;){if(0!=n)b=e;else return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;d|=(a.next_in[l++]&255)<<h;h+=8}if((~d>>>16&65535)!=(d&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);this.left=d&65535;d=h=0;this.mode=0!=this.left?2:0!=this.last?7:v;break;case 2:if(0==n)return this.bitb=
d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=p,this.inflate_flush(a,b);if(0==k&&(p==end&&0!=read&&(p=0,k=p<this.read?this.read-p-1:this.end-p),0==k&&(this.write=p,b=this.inflate_flush(a,b),p=this.write,k=p<this.read?this.read-p-1:this.end-p,p==this.end&&0!=this.read&&(p=0,k=p<this.read?this.read-p-1:this.end-p),0==k)))return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);b=e;c=this.left;
c>n&&(c=n);c>k&&(c=k);z(a.next_in,l,this.window,p,c);l+=c;n-=c;p+=c;k-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?7:v;break;case 3:for(;14>h;){if(0!=n)b=e;else return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;d|=(a.next_in[l++]&255)<<h;h+=8}this.table=c=d&16383;if(29<(c&31)||29<(c>>5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-
a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);else for(k=0;k<c;k++)this.blens[k]=0;d>>>=14;h-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>h;){if(0!=n)b=e;else return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;d|=(a.next_in[l++]&255)<<h;h+=8}this.blens[w[this.index++]]=
d&7;d>>>=3;h-=3}for(;19>this.index;)this.blens[w[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=e)return b=c,-3==b&&(this.blens=null,this.mode=9),this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=p,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];h<c;){if(0!=n)b=e;else return this.bitb=d,this.bitk=h,a.avail_in=
n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;d|=(a.next_in[l++]&255)<<h;h+=8}c=this.hufts[3*(this.tb[0]+(d&g[c]))+1];t=this.hufts[3*(this.tb[0]+(d&g[c]))+2];if(16>t)d>>>=c,h-=c,this.blens[this.index++]=t;else{k=18==t?7:t-14;for(q=18==t?11:3;h<c+k;){if(0!=n)b=e;else return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;d|=(a.next_in[l++]&255)<<h;h+=8}d>>>=c;h-=c;q+=d&g[k];d>>>=
k;h-=k;k=this.index;c=this.table;if(k+q>258+(c&31)+(c>>5&31)||16==t&&1>k)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);t=16==t?this.blens[k-1]:0;do this.blens[k++]=t;while(0!=--q);this.index=k}}this.tb[0]=-1;q=new Int32Array(1);t=new Int32Array(1);s=new Int32Array(1);u=new Int32Array(1);q[0]=9;t[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+
(c&31),1+(c>>5&31),this.blens,q,t,s,u,this.hufts,a);if(c!=e)return-3==c&&(this.blens=null,this.mode=13),b=c,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);this.codes.init(q[0],t[0],this.hufts,s[0],this.hufts,u[0],a);this.mode=6;case 6:this.bitb=d;this.bitk=h;a.avail_in=n;a.total_in+=l-a.next_in_index;a.next_in_index=l;this.write=p;if((b=this.codes.proc(this,a,b))!=m)return this.inflate_flush(a,b);b=e;this.codes.free(a);l=a.next_in_index;
n=a.avail_in;d=this.bitb;h=this.bitk;p=this.write;k=p<this.read?this.read-p-1:this.end-p;if(0==this.last){this.mode=v;break}this.mode=7;case 7:this.write=p;b=this.inflate_flush(a,b);p=this.write;if(this.read!=this.write)return this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);mode=12;case 8:return b=m,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);case 9:return b=
-3,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);default:return b=-2,this.bitb=d,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b)}};l.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};l.prototype.set_dictionary=function(a,b,c){z(a,b,window,0,c);this.read=this.write=c};l.prototype.sync_point=function(){return 1==this.mode};l.prototype.inflate_flush=
function(a,b){var c,d,g;d=a.next_out_index;g=this.read;c=(g<=this.write?this.write:this.end)-g;c>a.avail_out&&(c=a.avail_out);0!=c&&b==p&&(b=e);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,c));z(this.window,g,a.next_out,d,c);d+=c;g+=c;g==this.end&&(g=0,this.write==this.end&&(this.write=0),c=this.write-g,c>a.avail_out&&(c=a.avail_out),0!=c&&b==p&&(b=e),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,
this.window,g,c)),z(this.window,g,a.next_out,d,c),d+=c,g+=c);a.next_out_index=d;this.read=g;return b};h.prototype.init=function(a,b,c,e,d,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=e;this.dtree=d;this.dtree_index=g;this.tree=null};h.prototype.proc=function(a,b,c){var d,h,l=0,n=0,p=0,k,q,r,p=b.next_in_index;k=b.avail_in;l=a.bitb;n=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=k&&(a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=
p-b.next_in_index,b.next_in_index=p,a.write=q,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),p=b.next_in_index,k=b.avail_in,l=a.bitb,n=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,c!=e)){this.mode=c==m?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(d=this.need;n<d;){if(0!=k)c=e;else return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,
c);k--;l|=(b.next_in[p++]&255)<<n;n+=8}d=3*(this.tree_index+(l&g[d]));l>>>=this.tree[d+1];n-=this.tree[d+1];h=this.tree[d];if(0==h){this.lit=this.tree[d+2];this.mode=6;break}if(0!=(h&16)){this.get=h&15;this.len=this.tree[d+2];this.mode=2;break}if(0==(h&64)){this.need=h;this.tree_index=d/3+this.tree[d+2];break}if(0!=(h&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";c=-3;a.bitb=l;a.bitk=n;b.avail_in=k;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,
c);case 2:for(d=this.get;n<d;){if(0!=k)c=e;else return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);k--;l|=(b.next_in[p++]&255)<<n;n+=8}this.len+=l&g[d];l>>=d;n-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(d=this.need;n<d;){if(0!=k)c=e;else return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);k--;l|=(b.next_in[p++]&
255)<<n;n+=8}d=3*(this.tree_index+(l&g[d]));l>>=this.tree[d+1];n-=this.tree[d+1];h=this.tree[d];if(0!=(h&16)){this.get=h&15;this.dist=this.tree[d+2];this.mode=4;break}if(0==(h&64)){this.need=h;this.tree_index=d/3+this.tree[d+2];break}this.mode=9;b.msg="invalid distance code";c=-3;a.bitb=l;a.bitk=n;b.avail_in=k;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,c);case 4:for(d=this.get;n<d;){if(0!=k)c=e;else return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,
b.next_in_index=p,a.write=q,a.inflate_flush(b,c);k--;l|=(b.next_in[p++]&255)<<n;n+=8}this.dist+=l&g[d];l>>=d;n-=d;this.mode=5;case 5:for(d=q-this.dist;0>d;)d+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,
c);a.window[q++]=a.window[d++];r--;d==a.end&&(d=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);c=e;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<n&&(n-=8,k++,p--);a.write=q;
c=a.inflate_flush(b,c);q=a.write;if(a.read!=a.write)return a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);this.mode=8;case 8:return c=m,a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);case 9:return c=-3,a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);default:return c=-2,a.bitb=l,a.bitk=n,b.avail_in=k,b.total_in+=
p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c)}};h.prototype.free=function(a){};h.prototype.inflate_fast=function(a,b,c,d,h,l,n,p){var k,q,r,t,s,u,v,w,x,B,F,H;u=p.next_in_index;v=p.avail_in;t=n.bitb;s=n.bitk;w=n.write;x=w<n.read?n.read-w-1:n.end-w;a=g[a];B=g[b];do{for(;20>s;)v--,t|=(p.next_in[u++]&255)<<s,s+=8;k=t&a;q=c;r=d;H=3*(r+k);if(0==(b=q[H]))t>>=q[H+1],s-=q[H+1],n.window[w++]=q[H+2],x--;else{do{t>>=q[H+1];s-=q[H+1];if(0!=(b&16)){b&=15;F=q[H+2]+(t&g[b]);t>>=b;for(s-=b;15>
s;)v--,t|=(p.next_in[u++]&255)<<s,s+=8;k=t&B;q=h;r=l;H=3*(r+k);b=q[H];do if(t>>=q[H+1],s-=q[H+1],0!=(b&16)){for(b&=15;s<b;)v--,t|=(p.next_in[u++]&255)<<s,s+=8;k=q[H+2]+(t&g[b]);t>>=b;s-=b;x-=F;if(w>=k)k=w-k,n.window[w++]=n.window[k++],n.window[w++]=n.window[k++],F-=2;else{k=w-k;do k+=n.end;while(0>k);b=n.end-k;if(F>b){F-=b;if(0<w-k&&b>w-k){do n.window[w++]=n.window[k++];while(0!=--b)}else z(n.window,k,n.window,w,b),w+=b;k=0}}do n.window[w++]=n.window[k++];while(0!=--F);break}else if(0==(b&64))k+=
q[H+2],k+=t&g[b],H=3*(r+k),b=q[H];else return p.msg="invalid distance code",F=p.avail_in-v,F=s>>3<F?s>>3:F,v+=F,u-=F,s-=F<<3,n.bitb=t,n.bitk=s,p.avail_in=v,p.total_in+=u-p.next_in_index,p.next_in_index=u,n.write=w,-3;while(1);break}if(0==(b&64)){if(k+=q[H+2],k+=t&g[b],H=3*(r+k),0==(b=q[H])){t>>=q[H+1];s-=q[H+1];n.window[w++]=q[H+2];x--;break}}else{if(0!=(b&32))return F=p.avail_in-v,F=s>>3<F?s>>3:F,v+=F,u-=F,s-=F<<3,n.bitb=t,n.bitk=s,p.avail_in=v,p.total_in+=u-p.next_in_index,p.next_in_index=u,n.write=
w,m;p.msg="invalid literal/length code";F=p.avail_in-v;F=s>>3<F?s>>3:F;v+=F;u-=F;s-=F<<3;n.bitb=t;n.bitk=s;p.avail_in=v;p.total_in+=u-p.next_in_index;p.next_in_index=u;n.write=w;return-3}}while(1)}}while(258<=x&&10<=v);F=p.avail_in-v;F=s>>3<F?s>>3:F;u-=F;n.bitb=t;n.bitk=s-(F<<3);p.avail_in=v+F;p.total_in+=u-p.next_in_index;p.next_in_index=u;n.write=w;return e};t.prototype.huft_build=function(b,c,d,g,h,l,m,n,k,q,r){var t,s,u,v,w,x,B,F,H;x=0;s=d;do this.c[b[c+x]]++,x++,s--;while(0!=s);if(this.c[0]==
d)return m[0]=-1,n[0]=0,e;w=n[0];for(u=1;15>=u&&0==this.c[u];u++);v=u;w<u&&(w=u);for(s=15;0!=s&&0==this.c[s];s--);q=s;w>s&&(w=s);n[0]=w;for(n=1<<u;u<s;u++,n<<=1)if(0>(n-=this.c[u]))return-3;if(0>(n-=this.c[s]))return-3;this.c[s]+=n;this.x[1]=u=0;x=1;for(B=2;0!=--s;)this.x[B]=u+=this.c[x],B++,x++;x=s=0;do 0!=(u=b[c+x])&&(this.v[this.x[u]++]=s),x++;while(++s<d);d=this.x[q];x=this.x[0]=s=0;c=-1;F=-w;for(H=B=this.u[0]=0;v<=q;v++)for(b=this.c[v];0!=b--;){for(;v>F+w;){c++;F+=w;H=q-F;H=H>w?w:H;if((t=1<<
(u=v-F))>b+1&&(t-=b+1,B=v,u<H))for(;++u<H&&!((t<<=1)<=this.c[++B]);)t-=this.c[B];H=1<<u;if(this.hn[0]+H>a)return-3;this.u[c]=B=this.hn[0];this.hn[0]+=H;0!=c?(this.x[c]=s,this.r[0]=u,this.r[1]=w,u=s>>>F-w,this.r[2]=B-this.u[c-1]-u,z(this.r,0,k,3*(this.u[c-1]+u),3)):m[0]=B}this.r[1]=v-F;x>=d?this.r[0]=192:r[x]<g?(this.r[0]=256>this.v[x]?0:96,this.r[2]=this.v[x++]):(this.r[0]=l[this.v[x]-g]+16+64,this.r[2]=h[this.v[x++]-g]);t=1<<v-F;for(u=s>>>F;u<H;u+=t)z(this.r,0,k,3*(B+u),3);for(u=1<<v-1;0!=(s&u);u>>>=
1)s^=u;s^=u;for(u=(1<<F)-1;(s&u)!=this.x[c];)c--,F-=w,u=(1<<F)-1}return 0!=n&&1!=q?p:e};t.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)e.msg="oversubscribed dynamic bit lengths tree";else if(a==p||0==b[0])e.msg="incomplete dynamic bit lengths tree",a=-3;return a};t.prototype.inflate_trees_dynamic=function(a,b,c,d,g,h,l,m,k){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,Q,P,
h,d,m,this.hn,this.v);if(h!=e||0==d[0])return-3==h?k.msg="oversubscribed literal/length tree":-4!=h&&(k.msg="incomplete literal/length tree",h=-3),h;this.initWorkArea(288);h=this.huft_build(c,a,b,0,K,x,l,g,m,this.hn,this.v);return h!=e||0==g[0]&&257<a?(-3==h?k.msg="oversubscribed distance tree":h==p?(k.msg="incomplete distance tree",h=-3):-4!=h&&(k.msg="empty distance tree with lengths",h=-3),h):e};t.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),
this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;z(this.c,0,this.u,0,15);z(this.c,0,this.x,0,16)};var H="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof u&&(u.exports={inflateBuffer:B,arrayCopy:z})},{}]},{},[17]);