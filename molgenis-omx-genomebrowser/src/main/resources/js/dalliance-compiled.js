var BAM_MAGIC=21840194,BAI_MAGIC=21578050;function BamFile(){}function Vob(a,b){this.block=a;this.offset=b}Vob.prototype.toString=function(){return""+this.block+":"+this.offset};function Chunk(a,b){this.minv=a;this.maxv=b}
function makeBam(a,b,c){var d=new BamFile;d.data=a;d.bai=b;d.bai.fetch(function(a){if(!a)return c(null,"Couldn't access BAI");var b=new Uint8Array(a),g=readInt(b,0);if(g!=BAI_MAGIC)return c(null,"Not a BAI file, magic=0x"+g.toString(16));g=readInt(b,4);d.indices=[];for(var h=8,k=1E9,l=0;l<g;++l){for(var m=h,n=readInt(b,h),h=h+4,p=0;p<n;++p){readInt(b,h);var r=readInt(b,h+4),h=h+(8+16*r)}for(var p=readInt(b,h),q=h+=4,s=0;s<p;++s)if(r=readVob(b,q),q+=8,r){q=r.block;0<r.offset&&(q+=65536);q<k&&(k=q);
break}h+=8*p;0<n&&(d.indices[l]=new Uint8Array(a,m,h-m))}d.data.slice(0,k).fetch(function(a){if(!a)return c(null,"Couldn't access BAM");a=unbgzf(a,a.byteLength);a=new Uint8Array(a);var b=readInt(a,0);if(b!=BAM_MAGIC)return c(null,"Not a BAM file, magic=0x"+b.toString(16));for(var e=readInt(a,4),g="",b=0;b<e;++b)g+=String.fromCharCode(a[b+8]);g=readInt(a,e+8);e+=12;d.chrToIndex={};d.indexToChr=[];for(b=0;b<g;++b){for(var f=readInt(a,e),h="",k=0;k<f-1;++k)h+=String.fromCharCode(a[e+4+k]);readInt(a,
e+f+4);d.chrToIndex[h]=b;0==h.indexOf("chr")?d.chrToIndex[h.substring(3)]=b:d.chrToIndex["chr"+h]=b;d.indexToChr.push(h);e=e+8+f}if(d.indices)return c(d)})})}
BamFile.prototype.blocksForRange=function(a,b,c){var d=this.indices[a];if(!d)return[];a=reg2bins(b,c);for(var e=[],f=0;f<a.length;++f)e[a[f]]=!0;a=[];for(var g=[],f=readInt(d,0),h=4,k=0;k<f;++k){var l=readInt(d,h),m=readInt(d,h+4),h=h+8;if(e[l])for(var n=0;n<m;++n){var p=readVob(d,h),r=readVob(d,h+8);(4681>l?g:a).push(new Chunk(p,r));h+=16}else h+=16*m}f=readInt(d,h);e=null;b=Math.min(b>>14,f-1);c=Math.min(c>>14,f-1);for(f=b;f<=c;++f)if((b=readVob(d,h+4+8*f))&&(!e||b.block<e.block||b.offset<e.offset))e=
b;d=[];if(null!=e)for(f=0;f<g.length;++f)c=g[f],c.maxv.block>=e.block&&c.maxv.offset>=e.offset&&d.push(c);g=d;d=[];for(f=0;f<g.length;++f)d.push(g[f]);for(f=0;f<a.length;++f)d.push(a[f]);d.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});a=[];if(0<d.length){g=d[0];for(f=1;f<d.length;++f)c=d[f],c.minv.block==g.maxv.block?g=new Chunk(g.minv,c.maxv):(a.push(g),g=c);a.push(g)}return a};
BamFile.prototype.fetch=function(a,b,c,d,e){function f(){if(m>=k.length)return d(l);if(n){var a=new Uint8Array(n);g.readBamRecords(a,k[m].minv.offset,l,b,c,h,e);n=null;++m;return f()}var r=k[m],a=r.minv.block;g.data.slice(a,r.maxv.block+65536-a).fetch(function(a){n=unbgzf(a,r.maxv.block-r.minv.block+1);return f()})}var g=this;e=e||{};var h=this.chrToIndex[a],k;void 0===h?k=[]:(k=this.blocksForRange(h,b,c))||d(null,"Error in index fetch");var l=[],m=0,n;f()};
var SEQRET_DECODER="=ACxGxxxTxxxxxxN".split(""),CIGAR_DECODER="MIDNSHP=X???????".split("");function BamRecord(){}
BamFile.prototype.readBamRecords=function(a,b,c,d,e,f,g){for(;;){var h=readInt(a,b),h=b+h+4;if(h>=a.length)return c;var k=new BamRecord,l=readInt(a,b+4),m=readInt(a,b+8),n=readInt(a,b+12),p=(n&65280)>>8,r=n&255,n=readInt(a,b+16),q=(n&4294901760)>>16,s=n&65535,n=readInt(a,b+20);readInt(a,b+24);readInt(a,b+28);readInt(a,b+32);k.segment=this.indexToChr[l];k.flag=q;k.pos=m;k.mq=p;g.light&&(k.seqLength=n);if(!g.light){p="";for(m=0;m<r-1;++m)p+=String.fromCharCode(a[b+36+m]);k.readName=p;b=b+36+r;m="";
for(r=0;r<s;++r)p=readInt(a,b),m=m+(p>>4)+CIGAR_DECODER[p&15],b+=4;k.cigar=m;s="";r=n+1>>1;for(m=0;m<r;++m)p=a[b+m],s+=SEQRET_DECODER[(p&240)>>4],s+=SEQRET_DECODER[p&15];b+=r;k.seq=s;s="";for(m=0;m<n;++m)s+=String.fromCharCode(a[b+m]+33);b+=n;for(k.quals=s;b<h;){s=String.fromCharCode(a[b],a[b+1]);m=String.fromCharCode(a[b+2]);if("A"==m)m=String.fromCharCode(a[b+3]),b+=4;else if("i"==m||"I"==m)m=readInt(a,b+3),b+=7;else if("c"==m||"C"==m)m=a[b+3],b+=4;else if("s"==m||"S"==m)m=readShort(a,b+3),b+=5;
else if("f"==m)m=readFloat(a,b+3),b+=7;else if("Z"==m||"H"==m){b+=3;for(m="";!(r=a[b++],0==r);)m+=String.fromCharCode(r)}else if("B"==m){m=String.fromCharCode(a[b+3]);r=readInt(a,b+4);if("i"==m||"I"==m||"f"==m)p=4,q="f"==m?readFloat:readInt;else if("s"==m||"S"==m)p=2,q=readShort;else if("c"==m||"C"==m)p=1,q=readByte;else throw"Unknown array type "+m;b+=8;for(var m=[],v=0;v<r;++v)m.push(q(a,b)),b+=p}else throw"Unknown type "+m;k[s]=m}}if(!d||k.pos<=e&&k.pos+n>=d)(void 0===f||l==f)&&c.push(k);b=h}};
(function(a){var b=new ArrayBuffer(8),c=new Uint8Array(b),d=new Float32Array(b);a.readFloat=function(a,b){c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3];return d[0]}})(this);function readInt64(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function readInt(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function readShort(a,b){return a[b+1]<<8|a[b]}function readByte(a,b){return a[b]}
function readVob(a,b){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),d=a[b+1]<<8|a[b];return 0==c&&0==d?null:new Vob(c,d)}
function unbgzf(a,b){b=Math.min(b||1,a.byteLength-50);for(var c=[],d=[0],e=0;d[0]<b;){var f=new Uint8Array(a,d[0],12),f=f[11]<<8|f[10],f=jszlib_inflate_buffer(a,12+f+d[0],Math.min(65536,a.byteLength-12-f-d[0]),d);d[0]+=8;e+=f.byteLength;c.push(f)}if(1==c.length)return c[0];d=new Uint8Array(e);for(f=e=0;f<c.length;++f){var g=new Uint8Array(c[f]);arrayCopy(g,0,d,e,g.length);e+=g.length}return d.buffer}
function reg2bin(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}var MAX_BIN=37449;function reg2bins(a,b){var c,d=[];--b;d.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)d.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)d.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)d.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)d.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)d.push(c);return d}"use strict";
var BIG_WIG_MAGIC=-2003829722,BIG_BED_MAGIC=-2021002517,BIG_WIG_TYPE_GRAPH=1,BIG_WIG_TYPE_VSTEP=2,BIG_WIG_TYPE_FSTEP=3,M1=256,M2=65536,M3=16777216,M4=4294967296,BED_COLOR_REGEXP=/^[0-9]+,[0-9]+,[0-9]+/;function bwg_readOffset(a,b){return a[b]+a[b+1]*M1+a[b+2]*M2+a[b+3]*M3+a[b+4]*M4}function BigWig(){}
BigWig.prototype.readChromTree=function(a){var b=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var c=this.unzoomedDataOffset,c=c+4-(c-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var e=new Uint8Array(c),f=new Int16Array(c),g=(new Int32Array(c))[2];bwg_readOffset(e,16);var h=function(a){var c=e[a],d=f[a/2+1];a+=4;for(var n=0;n<d;++n)if(0==c){a+=g;var p=bwg_readOffset(e,a);a+=8;p-=b.chromTreeOffset;h(p)}else{for(var p="",r=0;r<g;++r){var q=
e[a++];0!=q&&(p+=String.fromCharCode(q))}r=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a+0];a+=8;b.chromsToIDs[p]=r;0==p.indexOf("chr")&&(b.chromsToIDs[p.substr(3)]=r);b.idsToChroms[r]=p;b.maxID=Math.max(b.maxID,r)}};h(32);a(b)})};function BigWigView(a,b,c,d){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=c;this.isSummary=d}BigWigView.prototype.readWigData=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(void 0===a)return d([]);this.readWigDataById(a,b,c,d)};
BigWigView.prototype.readWigDataById=function(a,b,c,d){var e=this;if(this.cirHeader){var f=[],g=0;Date.now();var h=function(d,e,g,f){return(0>a||d==a)&&e<=c&&g>=b},k=function(a,b){e.bwg.instrument&&console.log("level="+b+"; offset="+a+"; time="+(Date.now()|0));g+=a.length;if(1==a.length&&48==a[0]-e.cirTreeOffset&&e.cachedCirRoot)m(e.cachedCirRoot,0,b),--g,0==g&&e.fetchFeatures(h,f,d);else{for(var c=4+32*e.cirBlockSize,k,s=0;s<a.length;++s){var v=new Range(a[s],a[s]+c);k=k?union(k,v):v}c=k.ranges();
for(k=0;k<c.length;++k)l(a,c[k],b)}},l=function(a,b,c,k){b.max();b.min();e.bwg.data.slice(b.min(),b.max()-b.min()).fetch(function(k){for(var l=0;l<a.length;++l)b.contains(a[l])&&(m(k,a[l]-b.min(),c),48==a[l]-e.cirTreeOffset&&0==a[l]-b.min()&&(e.cachedCirRoot=k),--g,0==g&&e.fetchFeatures(h,f,d))})},m=function(d,e,g){var h=new Uint8Array(d),l=new Int16Array(d);d=new Int32Array(d);var m=h[e],l=l[e/2+1];e+=4;if(0!=m)for(m=0;m<l;++m){var t=e/4,u=d[t],w=d[t+1],x=d[t+2],t=d[t+3],B=bwg_readOffset(h,e+16);
g=bwg_readOffset(h,e+24);(0>a||u<a||u==a&&w<=c)&&(0>a||x>a||x==a&&t>=b)&&f.push({offset:B,size:g});e+=32}else{for(var y=[],m=0;m<l;++m)t=e/4,u=d[t],w=d[t+1],x=d[t+2],t=d[t+3],B=bwg_readOffset(h,e+16),(0>a||u<a||u==a&&w<=c)&&(0>a||x>a||x==a&&t>=b)&&y.push(B),e+=24;0<y.length&&k(y,g+1)}};k([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(g){e.cirHeader=g;g=new Int32Array(e.cirHeader);e.cirBlockSize=g[1];e.readWigDataById(a,b,c,d)})};
BigWigView.prototype.fetchFeatures=function(a,b,c){var d=this;b.sort(function(a,b){return(a.offset|0)-(b.offset|0)});if(0==b.length)c([]);else{var e=[],f=function(a,b,c,g){g||(g={});var f=new DASFeature;f._chromId=a;f.segment=d.bwg.idsToChroms[a];f.min=b;f.max=c;f.type="bigwig";for(var p in g)f[p]=g[p];e.push(f)},g=function(){if(0==b.length)Date.now(),c(e);else{var h=b[0];if(h.data)d.parseFeatures(h.data,f,a),b.splice(0,1),g();else{for(var k=h.offset,l=h.size,h=1;h<b.length&&b[h].offset==k+l;)l+=
b[h].size,++h;d.bwg.data.slice(k,l).fetch(function(a){for(var c=0,e=0;c<l;){var f=b[e],h;0<d.bwg.uncompressBufSize?h=jszlib_inflate_buffer(a,c+2,f.size-2):(h=new Uint8Array(f.size),arrayCopy(new Uint8Array(a,c,f.size),0,h,0,f.size),h=h.buffer);f.data=h;c+=f.size;++e}g()})}}};g()}};
BigWigView.prototype.parseFeatures=function(a,b,c){var d=new Uint8Array(a);if(this.isSummary)for(var e=new Int16Array(a),f=new Int32Array(a),g=new Float32Array(a),d=a.byteLength/32,e=0;e<d;++e){a=f[8*e];var h=f[8*e+1],k=f[8*e+2],l=f[8*e+3],m=g[8*e+5],n=g[8*e+6];c(a,h+1,k)&&(l={type:"bigwig",score:n/l,maxScore:m},"bigbed"==this.bwg.type&&(l.type="density"),b(a,h+1,k,l))}else if("bigwig"==this.bwg.type)if(e=new Int16Array(a),f=new Int32Array(a),g=new Float32Array(a),a=f[0],h=f[1],m=f[3],l=f[4],k=d[20],
d=e[11],k==BIG_WIG_TYPE_FSTEP)for(e=0;e<d;++e)n=g[e+6],f=h+e*m+1,k=h+e*m+l,c(a,f,k)&&b(a,f,k,{score:n});else if(k==BIG_WIG_TYPE_VSTEP)for(e=0;e<d;++e)h=f[2*e+6]+1,k=h+l-1,n=g[2*e+7],c(a,h,k)&&b(a,h,k,{score:n});else if(k==BIG_WIG_TYPE_GRAPH)for(e=0;e<d;++e)h=f[3*e+6]+1,k=f[3*e+7],n=g[3*e+8],h>k&&(h=k),c(a,h,k)&&b(a,h,k,{score:n});else console.log("Currently not handling bwgType="+k);else if("bigbed"==this.bwg.type){f=0;e=this.bwg.definedFieldCount;for(l=this.bwg.schema;f<d.length;){a=d[f+3]<<24|d[f+
2]<<16|d[f+1]<<8|d[f+0];h=d[f+7]<<24|d[f+6]<<16|d[f+5]<<8|d[f+4];k=d[f+11]<<24|d[f+10]<<16|d[f+9]<<8|d[f+8];f+=12;for(n="";;)if(m=d[f++],0!=m)n+=String.fromCharCode(m);else break;var m={},p;p=0<n.length?n.split("\t"):[];0<p.length&&3<e&&(m.label=p[0]);1<p.length&&4<e&&(m.score=stringToInt(p[1]));2<p.length&&5<e&&(m.orientation=p[2]);5<p.length&&8<e&&(n=p[5],BED_COLOR_REGEXP.test(n)&&(m.itemRgb="rgb("+n+")"));if(p.length>e-3&&l)for(n=e-3;n<p.length;++n)m[l.fields[n+3].name]=p[n];if(c(a,h+1,k,p))if(12>
e)b(a,h+1,k,m);else{var n=p[3]|0,r=p[4]|0,q=p[6]|0,s=p[7].split(","),v=p[8].split(",");m.type="bb-transcript";var t=new DASGroup;for(g in m)t[g]=m[g];t.id=p[0];t.segment=this.bwg.idsToChroms[a];t.min=h+1;t.max=k;t.notes=[];m.groups=[t];if(9<p.length){var u=k=p[9];10<p.length&&(u=p[10]);p=shallowCopy(t);p.id=k;p.label=u;p.type="gene";m.groups.push(p)}k=[];for(p=0;p<q;++p)t=(v[p]|0)+h,t=new Range(t,t+(s[p]|0)),k.push(t);q=union(k);s=q.ranges();for(h=0;h<s.length;++h)k=s[h],b(a,k.min()+1,k.max(),m);
if(r>n&&(h=intersection(q,new Range(n,r)))){m.type="bb-translation";n=h.ranges();for(h=0;h<n.length;++h)k=n[h],b(a,k.min()+1,k.max(),m)}}}}else dlog("Don't know what to do with "+this.bwg.type)};BigWigView.prototype.getFirstAdjacent=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(void 0===a)return d([]);this.getFirstAdjacentById(a,b,c,d)};
BigWigView.prototype.getFirstAdjacentById=function(a,b,c,d){var e=this;if(this.cirHeader){var f=null,g=-1,h=-1,k=0;Date.now();var l=function(a,b){k+=a.length;for(var c=4+32*e.cirBlockSize,d,g=0;g<a.length;++g){var f=new Range(a[g],a[g]+c);d=d?union(d,f):f}c=d.ranges();for(d=0;d<c.length;++d)m(a,c[d],b)},m=function(g,h,l,m){h.max();h.min();e.bwg.data.slice(h.min(),h.max()-h.min()).fetch(function(m){for(var s=0;s<g.length;++s)if(h.contains(g[s])&&(n(m,g[s]-h.min(),l),--k,0==k)){if(!f)return 0<c&&(0!=
a||0<b)?e.getFirstAdjacentById(0,0,c,d):0>c&&(a!=e.bwg.maxID||1E9>b)?e.getFirstAdjacentById(e.bwg.maxID,1E9,c,d):d([]);e.fetchFeatures(function(d,e,g,f){return 0>c&&(d<a||g<b)||0<c&&(d>a||e>b)},[f],function(a){for(var b=null,e=-1,g=-1,f=0;f<a.length;++f){var h=a[f],k=h._chromId,l=h.min,m=h.max;if(null==b||0>c&&(k>e||m>g)||0<c&&(k<e||l<g))b=h,g=0>c?m:l,e=k}return null!=b?d([b]):d([])})}})},n=function(d,k,m){var n=new Uint8Array(d),v=new Int16Array(d);d=new Int32Array(d);var t=n[k],v=v[k/2+1];k+=4;
if(0!=t)for(t=0;t<v;++t){var u=k/4,w=d[u],x=d[u+1],B=d[u+2],y=d[u+3],u=bwg_readOffset(n,k+16);m=bwg_readOffset(n,k+24);if((0>c&&(w<a||w==a&&x<=b)||0<c&&(B>a||B==a&&y>=b))&&!/_random/.exec(e.bwg.idsToChroms[w]))if(null==f||0>c&&(B>g||B==g&&y>h)||0<c&&(w<g||w==g&&x<h))f={offset:u,size:m},h=0>c?y:x,g=0>c?B:w;k+=32}else{for(var A=n=-1,t=0;t<v;++t){u=k/4;w=d[u];x=d[u+1];B=d[u+2];y=d[u+3];u=d[u+4]<<32|d[u+5];if(0>c&&(w<a||w==a&&x<=b)&&B>=a||0<c&&(B>a||B==a&&y>=b)&&w<=a)if(0>n||y>A)n=u,A=0>c?y:x;k+=24}0<=
n&&l([n],m+1)}};l([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(g){e.cirHeader=g;g=new Int32Array(e.cirHeader);e.cirBlockSize=g[1];e.getFirstAdjacentById(a,b,c,d)})};BigWig.prototype.readWigData=function(a,b,c,d){this.getUnzoomedView().readWigData(a,b,c,d)};
BigWig.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new BigWigView(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};BigWig.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new BigWigView(this,a.indexOffset,4E3,!0));return a.view};function makeBwgFromURL(a,b,c){makeBwg(new URLFetchable(a,{credentials:c}),b,a)}
function makeBwgFromFile(a,b){makeBwg(new BlobFetchable(a),b,"file")}
function makeBwg(a,b,c){var d=new BigWig;d.data=a;d.name=c;d.data.slice(0,512).salted().fetch(function(a){if(!a)return b(null,"Couldn't fetch file");var c=new Uint8Array(a),g=new Int16Array(a);a=new Int32Array(a);a[0]==BIG_WIG_MAGIC?d.type="bigwig":a[0]==BIG_BED_MAGIC?d.type="bigbed":b(null,"Not a supported format");d.version=g[2];d.numZoomLevels=g[3];d.chromTreeOffset=bwg_readOffset(c,8);d.unzoomedDataOffset=bwg_readOffset(c,16);d.unzoomedIndexOffset=bwg_readOffset(c,24);d.fieldCount=g[16];d.definedFieldCount=
g[17];d.asOffset=bwg_readOffset(c,36);d.totalSummaryOffset=bwg_readOffset(c,44);d.uncompressBufSize=a[13];d.extHeaderOffset=bwg_readOffset(c,56);d.zoomLevels=[];for(g=0;g<d.numZoomLevels;++g){var h=a[6*g+16],k=bwg_readOffset(c,24*g+72),l=bwg_readOffset(c,24*g+80);d.zoomLevels.push({reduction:h,dataOffset:k,indexOffset:l})}d.readChromTree(function(){d.getAutoSQL(function(a){d.schema=a;return b(d)})})})}
BigWig.prototype._tsFetch=function(a,b,c,d,e){var f=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var g=[],h=this.topLevelReductionCache,k=0;k<h.length;++k)h[k]._chromId==b&&g.push(h[k]);return e(g)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(g){f.topLevelReductionCache=g;return f._tsFetch(a,b,c,d,e)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(b,c,d,e)};
BigWig.prototype.thresholdSearch=function(a,b,c,d,e){function f(){if(0==h.length)return e(null);h.sort(function(a,b){var d=a.zoom-b.zoom;if(0!=d)return d;d=a.chrOrd-b.chrOrd;return 0!=d?d:a.min-b.min*c});var a=h.splice(0,1)[0];g._tsFetch(a.zoom,a.chr,a.min,a.max,function(g){var k=0<c?0:3E8;a.fromRef&&(k=b);for(var l=0;l<g.length;++l){var q=g[l],s;s=void 0!=q.maxScore?q.maxScore:q.score;if(0<c){if(s>d)if(0>a.zoom){if(q.min>k)return e(q)}else q.max>k&&h.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,
min:q.min,max:q.max,fromRef:a.fromRef})}else if(s>d)if(0>a.zoom){if(q.max<k)return e(q)}else q.min<k&&h.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:q.min,max:q.max,fromRef:a.fromRef})}f()})}c=0>c?-1:1;var g=this;a=this.chromsToIDs[a];for(var h=[{chrOrd:0,chr:a,zoom:g.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],k=1;k<=this.maxID+1;++k){var l=(a+c*k)%(this.maxID+1);0>l&&(l+=this.maxID+1);h.push({chrOrd:k,chr:l,zoom:g.zoomLevels.length-1,min:0,max:3E8})}f()};
BigWig.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(b){var c=new Uint8Array(b);b="";for(var d=0;d<c.length&&0!=c[d];++d)b+=String.fromCharCode(c[d]);var c=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,e=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(b);if(e){d={declType:e[1],name:e[2],comment:e[4],fields:[]};b=b.substring(e[0]);for(e=c.exec(b);null!=e;e=c.exec(b))d.fields.push({type:e[1],name:e[2],comment:e[4]});return a(d)}})};
BigWig.prototype.getExtraIndices=function(a){var b=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(c){if(!c)return a(null,"Couldn't fetch extension header");var d=new Uint8Array(c),e=new Int16Array(c);new Int32Array(c);var f=e[1];c=bwg_readOffset(d,4);if(0==f)return a(null);b.data.slice(c,20*f).fetch(function(c){if(!c)return a(null,"Couldn't fetch index info");var d=new Uint8Array(c),e=new Int16Array(c);new Int32Array(c);
c=[];for(var l=0;l<f;++l){var m=e[10*l],n=e[10*l+1],p=bwg_readOffset(d,20*l+4),m=new BBIExtraIndex(b,m,n,p,e[10*l+8]);c.push(m)}a(c)})})};function BBIExtraIndex(a,b,c,d,e){this.bbi=a;this.type=b;this.fieldCount=c;this.offset=d;this.field=e}
BBIExtraIndex.prototype.lookup=function(a,b){var c=this;this.bbi.data.slice(this.offset,32).fetch(function(d){function e(d){c.bbi.data.slice(d,4+g*(h+k)).fetch(function(d){var g=new Uint8Array(d),f=new Uint16Array(d);new Uint32Array(d);f=f[1];d=4;if(0==g[0]){for(var l=null,q=0;q<f;++q){for(var s="",v=0;v<h;++v){var t=g[d++];0!=t&&(s+=String.fromCharCode(t))}v=bwg_readOffset(g,d);d+=8;if(0>a.localeCompare(s)&&l){e(l);return}l=v}e(l)}else{for(q=0;q<f;++q){s="";for(v=0;v<h;++v)t=g[d++],0!=t&&(s+=String.fromCharCode(t));
if(s==a)return f=bwg_readOffset(g,d),g=readInt(g,d+8),c.bbi.getUnzoomedView().fetchFeatures(function(b,d,e,g){if(g&&g.length>c.field-3)return g[c.field-3]==a},[{offset:f,size:g}],b);d+=k}return b([])}})}var f=new Uint8Array(d);new Int16Array(d);d=new Int32Array(d);var g=d[1],h=d[2],k=d[3];bwg_readOffset(f,16);e(c.offset+32)})};"use strict";function BlobFetchable(a){this.blob=a}
BlobFetchable.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new BlobFetchable(c)};BlobFetchable.prototype.salted=function(){return this};
BlobFetchable.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(c){a(bstringToBuffer(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var c=b.readAsArrayBuffer(this.blob);a(c)}catch(d){a(null,d)}};function URLFetchable(a,b,c,d){d||("object"===typeof b?(d=b,b=void 0):d={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=d}
URLFetchable.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,d=this.end,c=c&&a?c+a:a||c;return new URLFetchable(this.url,c,b&&c?c+b-1:d||b-1,this.opts)};var seed=0,isSafari=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");
URLFetchable.prototype.fetchAsText=function(a){var b=new XMLHttpRequest,c=this.url;if(isSafari||this.opts.salt)c=saltURL(c),c=c+"?salt="+b64_sha1(""+Date.now()+","+ ++seed);b.open("GET",c,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&(b.withCredentials=!0);b.send("")};
URLFetchable.prototype.salted=function(){var a=shallowCopy(this.opts);a.salt=!0;return new URLFetchable(this.url,this.start,this.end,a)};
URLFetchable.prototype.fetch=function(a,b,c){var d=this;b=b||1;if(3<b)return a(null);var e=new XMLHttpRequest,f,g=this.url;if(isSafari||this.opts.salt)g=g+"?salt="+b64_sha1(""+Date.now()+","+ ++seed);e.open("GET",g,!0);e.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";e.setRequestHeader("Range","bytes="+this.start+"-"+this.end);f=this.end-this.start+1}e.responseType="arraybuffer";e.onreadystatechange=function(){if(4==e.readyState){if(200==
e.status||206==e.status){if(e.response){var g=e.response.byteLength;return f&&f!=g&&(!c||g!=c)?d.fetch(a,b+1,g):a(e.response)}if(e.mozResponseArrayBuffer)return a(e.mozResponseArrayBuffer);g=e.responseText;return f&&f!=g.length&&(!c||g.length!=c)?d.fetch(a,b+1,g.length):a(bstringToBuffer(e.responseText))}return d.fetch(a,b+1)}};this.opts.credentials&&(e.withCredentials=!0);e.send("")};
function bstringToBuffer(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}"use strict";var NS_SVG="http://www.w3.org/2000/svg",NS_HTML="http://www.w3.org/1999/xhtml",NS_XLINK="http://www.w3.org/1999/xlink";function Region(a,b,c){this.min=b;this.max=c;this.chr=a}
function Browser(a){a||(a={});this.uiPrefix="//www.biodalliance.org/release-0.12/";this.sources=[];this.tiers=[];this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry="http://www.dasregistry.org/das/sources";this.coordSystem={speciesName:"Human",taxon:9606,auth:"NCBI",version:"36",ucscName:"hg18"};this.chains={};this.pageName=
"svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.zoomMin=10;this.zoomMax;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=
["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new Observed;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new SourceCache;this.useFetchWorkers=this.retina=!0;this.maxWorkers=0;this.assemblyNameUcsc=this.assemblyNamePrimary=!0;for(var b in a)this[b]=a[b];this.workerPath="$$js/fetchworker.js";var c=this;window.addEventListener("load",function(a){c.realInit()},!1)}
Browser.prototype.resolveURL=function(a){return a.replace("$$",this.uiPrefix)};
Browser.prototype.realInit=function(){if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(var a=0;a<this.sources.length;++a)this.defaultSources.push(this.sources[a]);this.restoreStatus&&(this.statusRestored=this.restoreStatus());var b=this;this.browserHolderHolder=document.getElementById(this.pageName);
this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=makeElement("div",null,{className:"dalliance dalliance-root",tabIndex:-1});removeChildren(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=makeElement("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=makeElement("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=makeElement("div",this.makeLoader(24),
{className:"tier-holder tier-holder-rest"});this.tierHolderHolder=makeElement("div",[this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"});this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=makeElement("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(makeElement("span",["Powered by ",makeElement("a","Dalliance",{href:"http://www.biodalliance.org/"})," "+VERSION],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",
function(a){b.resizeViewer()},!1);this.ruler=makeElement("div",null,{className:"guideline"});this.ruler2=makeElement("div",null,{className:"guideline"},{backgroundColor:"gray",opacity:"0.5",zIndex:899});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);if(0<this.maxWorkers)try{for(var a=[],c=0;c<this.maxWorkers;++c)a.push(new FetchWorker);this.fetchWorkers=a;this.nextWorker=0}catch(d){console.log(d)}if("none"!=window.getComputedStyle(this.browserHolderHolder).display)setTimeout(function(){b.realInit2()},
1);else var e=setInterval(function(){"none"!=window.getComputedStyle(b.browserHolderHolder).display&&(clearInterval(e),b.realInit2())},300)}};
Browser.prototype.realInit2=function(){var a=this;removeChildren(this.tierHolder);removeChildren(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/10/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);
this.tierHolderHolder.addEventListener("mousewheel",function(b){b.stopPropagation();b.preventDefault();if(b.wheelDeltaX){var c=b.wheelDeltaX/5;a.reverseScrolling||(c=-c);a.move(c)}b.wheelDeltaY&&(c=b.wheelDeltaY,a.reverseScrolling&&(c=-c),a.tierHolder.scrollTop+=c)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(b){b.stopPropagation();b.preventDefault();1==b.axis?0!=b.detail&&(b=b.detail/4,a.reverseScrolling&&(b=-b),a.move(b)):(b=b.detail,a.reverseScrolling||(b=-b),a.tierHolder.scrollTop+=
b)},!1);this.tierHolderHolder.addEventListener("touchstart",function(b){return a.touchStartHandler(b)},!1);this.tierHolderHolder.addEventListener("touchmove",function(b){return a.touchMoveHandler(b)},!1);this.tierHolderHolder.addEventListener("touchend",function(b){return a.touchEndHandler(b)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(b){return a.touchCancelHandler(b)},!1);var b=function(b){if(13==b.keyCode){var c=!1;for(b=0;b<a.tiers.length;++b){var d=a.tiers[b];d.wantedLayoutHeight&&
d.wantedLayoutHeight!=d.layoutHeight&&(d.layoutHeight=d.wantedLayoutHeight,d.clipTier(),c=!0)}c&&a.arrangeTiers()}else if(32==b.keyCode||32==b.charCode)a.isSnapZooming?(a.isSnapZooming=!1,c=(a.savedZoom||20)+a.zoomMin):(a.isSnapZooming=!0,c=(a.savedZoom||0)+a.zoomMin),a.savedZoom=a.zoomSliderValue-a.zoomMin,a.zoomSliderValue=c,a.zoom(Math.exp(1*c/a.zoomExpt)),a.snapZoomLockout=!0,b.stopPropagation(),b.preventDefault();else if(39==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,
-1);else if(37==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,1);else if(38==b.keyCode||87==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||(c=a.tiers[b],b=c.forceHeight||c.subtiers[0].height,40<=b&&c.mergeConfig({height:b-10}));else if(b.ctrlKey||b.metaKey){if(b=a.getSelectedTier(),!(0>b)&&(c=a.tiers[b],c.quantLeapThreshold)){var d=c.subtiers[0].height,e=c.subtiers[0].quant;e&&(b=1*e.min,e=1*e.max,d=(e-b)/d,c.mergeConfig({quantLeapThreshold:b+
((Math.round((c.quantLeapThreshold-b)/d)|0)+1)*d}),c.notify("Threshold: "+formatQuantLabel(c.quantLeapThreshold)))}}else if(b.altKey){if(e=a.selectedTiers.length,0!=e){b=a.selectedTiers[0];for(var f=!0,c=[],d=0;d<a.selectedTiers.length;++d)c.push(a.tiers[a.selectedTiers[d]]),0<d&&1!=a.selectedTiers[d]-a.selectedTiers[d-1]&&(f=!1);if(!(f&&0>=b)){for(d=a.selectedTiers.length-1;0<=d;--d)a.tiers.splice(a.selectedTiers[d],1);a.selectedTiers.splice(0,e);b=f?b-1:b;for(d=0;d<c.length;++d)a.tiers.splice(b+
d,0,c[d]),a.selectedTiers.push(b+d);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else if(b=a.getSelectedTier(),0<b){if(a.setSelectedTier(b-1),b=a.tiers[a.getSelectedTier()],c=b.row.offsetTop,b=c+b.row.offsetHeight,c<a.tierHolder.scrollTop||b>a.tierHolder.scrollTop+a.tierHolder.offsetHeight)a.tierHolder.scrollTop=c}else a.notifyTierSelectionWrap(-1);else if(40==b.keyCode||83==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||
(c=a.tiers[b],b=c.forceHeight||c.subtiers[0].height,c.mergeConfig({height:b+10}));else if(b.ctrlKey||b.metaKey){if(b=a.getSelectedTier(),!(0>b)&&(c=a.tiers[b],c.quantLeapThreshold&&(d=c.subtiers[0].height,e=c.subtiers[0].quant)))b=1*e.min,e=1*e.max,d=(e-b)/d,e=Math.round((c.quantLeapThreshold-b)/d)|0,1<e&&(c.mergeConfig({quantLeapThreshold:b+(e-1)*d}),c.notify("Threshold: "+formatQuantLabel(c.quantLeapThreshold)))}else if(b.altKey){if(e=a.selectedTiers.length,0!=e){b=a.selectedTiers[0];for(var n=
0,c=[],d=0;d<a.selectedTiers.length;++d)c.push(a.tiers[a.selectedTiers[d]]),0<d&&(n+=a.selectedTiers[d]-a.selectedTiers[d-1]-1);f=0==n;if(!(f&&b+e>=a.tiers.length)){for(d=a.selectedTiers.length-1;0<=d;--d)a.tiers.splice(a.selectedTiers[d],1);a.selectedTiers.splice(0,e);b=f?b+1:b+n;for(d=0;d<c.length;++d)a.tiers.splice(b+d,0,c[d]),a.selectedTiers.push(b+d);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else{if(b=a.getSelectedTier(),b<a.tiers.length-1&&(a.setSelectedTier(b+
1),b=a.tiers[a.getSelectedTier()],c=b.row.offsetTop,b=c+b.row.offsetHeight,c<a.tierHolder.scrollTop||b>a.tierHolder.scrollTop+a.tierHolder.offsetHeight))a.tierHolder.scrollTop=b-a.tierHolder.offsetHeight}else if(187==b.keyCode||61==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(-10);else if(189==b.keyCode||173==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(10);else if(73==b.keyCode||105==b.keyCode)b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(d=a.tiers[b],
d.infoVisible?(d.infoElement.style.display="none",d.updateHeight(),d.infoVisible=!1):(d.infoElement.style.display="block",d.updateHeight(),d.infoVisible=!0));else if(84==b.keyCode||116==b.keyCode)if(b.shiftKey){b.stopPropagation();b.preventDefault();for(b=0;b<a.tiers.length;++b)d=a.tiers[b],d.dasSource.collapseSuperGroups&&(void 0===c&&(c=!d.bumped),d.bumped=c,d.layoutWasDone=!1,d.draw(),d.updateLabel())}else!b.ctrlKey&&!b.metaKey&&(b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||
(d=a.tiers[b],d.dasSource.collapseSuperGroups&&(void 0===c&&(c=!d.bumped),d.bumped=c,d.layoutWasDone=!1,d.draw(),d.updateLabel())));else if(77==b.keyCode||109==b.keyCode)b.stopPropagation(),b.preventDefault(),(b.ctrlKey||b.metaKey)&&1<a.selectedTiers.length&&a.mergeSelectedTiers();else if(68==b.keyCode||100==b.keyCode){if(b.stopPropagation(),b.preventDefault(),b.ctrlKey||b.metaKey)b=a.getSelectedTier(),0>b||a.addTier(a.tiers[b].dasSource)}else if(80==b.keyCode||112==b.keyCode)if(b.ctrlKey||b.metaKey){c=
[];for(b=0;b<a.selectedTiers.length;++b)c.push(a.tiers[a.selectedTiers[b]]);for(b=0;b<c.length;++b)c[b].mergeConfig({pinned:!c[b].pinned})}};this.browserHolder.addEventListener("focus",function(c){a.browserHolder.addEventListener("keydown",b,!1)},!1);this.browserHolder.addEventListener("blur",function(c){a.browserHolder.removeEventListener("keydown",b,!1)},!1);this.hPopupHolder=makeElement("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");
document.body.appendChild(this.hPopupHolder);for(var c=0;c<this.sources.length;++c){var d=this.sources[c],e={};this.restoredConfigs&&(e=this.restoredConfigs[c]);d.disabled||this.makeTier(d,e)}a.arrangeTiers();a.refresh();a.setSelectedTier(1);a.positionRuler();(c=this.getSequenceSource())&&c.getSeqInfo(this.chr,function(b){a.currentSeqMax=b.length});this.queryRegistry();for(var f in this.chains)this.queryRegistry(f,!0);if(this.hubs)for(f=0;f<this.hubs.length;++f)c=this.hubs[f],"string"==typeof c&&
(c={url:c}),function(b){connectTrackHub(b.url,function(c,d){if(d)console.log(d);else{var e;if(e=b.genome?c.genomes[b.genome]:c.genomes[a.coordSystem.ucscName])b.mapping&&(e.mapping=b.mapping),a.hubObjects.push(e)}},b)}(c);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus()};
Browser.prototype.touchStartHandler=function(a){a.stopPropagation();a.preventDefault();this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};
Browser.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var b=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=b;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){b=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/
2;var c=this.viewStart+a/this.scale|0;this.scale=this.zoomInitialScale*(b/this.zoomInitialSep);this.viewStart=c-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};Browser.prototype.touchEndHandler=function(a){a.stopPropagation();a.preventDefault()};Browser.prototype.touchCancelHandler=function(a){};Browser.prototype.makeTier=function(a,b){try{this.realMakeTier(a,b)}catch(c){console.log(c.stack||c)}};
Browser.prototype.realMakeTier=function(a,b){var c=this,d=null;this.tierBackgroundColors&&(d=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var e=new DasTier(this,a,b,d);e.oorigin=this.viewStart;var f=!1,g,h,k,l=function(a,b){var d=e.subtiers;if(d){var f=0;for(b-=MIN_PADDING;f<d.length&&b>d[f].height&&f<d.length-1;)b=b-d[f].height-MIN_PADDING,++f;if(!(f>=d.length))return d=d[f].glyphs,a-=(e.glyphCacheOrigin-c.viewStart)*c.scale,glyphLookup(d,a,b)}},m=function(a){a.preventDefault();
a.stopPropagation();a=a.clientX;"sequence"!==e.dasSource.tier_type&&a!=h&&(c.move(a-h),h=a);c.isDragging=!0},n=function(a){window.removeEventListener("mousemove",m,!0);window.removeEventListener("mouseup",n,!0)};e.viewport.addEventListener("mousedown",function(a){c.browserHolder.focus();a.preventDefault();e.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",m,!0);window.addEventListener("mouseup",n,!0);g=h=a;c.isDragging=!1},!1);e.viewport.addEventListener("mousemove",function(a){var b=
e.row.getBoundingClientRect(),d=a.clientX-b.left,g=a.clientY-b.top;k&&clearTimeout(k);f||(k=setTimeout(function(){var b=l(d,g);b&&0<b.length&&c.notifyFeatureHover(a,b[b.length-1],b,e)},1E3))});var p=null;e.viewport.addEventListener("mouseup",function(a){var b=e.row.getBoundingClientRect(),d=a.clientX-b.left,b=a.clientY-b.top,f=l(d,b);f&&(0<f.length&&!c.isDragging)&&(p?(clearTimeout(p),p=null,c.featureDoubleClick(f,d,b)):p=setTimeout(function(){p=null;c.notifyFeature(a,f[f.length-1],f,e)},500));if(c.isDragging&&
d!=g&&"sequence"===e.dasSource.tier_type){var b=c.viewStart+d/c.scale,h=c.viewStart+g/c.scale;b<h?(d=b|0,b=h|0):(d=h|0,b|=0);c.notifyRegionSelect(c.chr,d,b)}c.isDragging=!1},!1);e.viewport.addEventListener("mouseout",function(a){f=!1});e.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<c.tiers.length;++a)if(c.tiers[a]===e){c.removeTier({index:a});break}},!1);e.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=
-1;for(var b=0;b<c.tiers.length;++b)if(c.tiers[b]===e){a=b;break}0<=a&&(b=c.selectedTiers.indexOf(a),0<=b?c.selectedTiers.splice(b,1):(c.selectedTiers.push(a),c.selectedTiers.sort()),c.markSelectedTiers(),c.notifyTierSelection(),0<c.selectedTiers.length?c.browserHolder.focus():c.notifyTierSelectionWrap(-1))}else{for(b=0;b<c.tiers.length;++b)if(c.tiers[b]===e&&(c.browserHolder.focus(),1!=c.selectedTiers.length||c.selectedTiers[0]!=b)){c.setSelectedTier(b);return}e.infoVisible?(e.infoElement.style.display=
"none",e.updateHeight(),e.infoVisible=!1):(e.infoElement.style.display="block",e.updateHeight(),e.infoVisible=!0)}},!1);e.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var b;e.dasSource.collapseSuperGroups&&(void 0===b&&(b=!e.bumped),e.bumped=b,e.layoutWasDone=!1,e.draw(),e.updateLabel())},!1);var r,q,s,v,t,u=!1,w=function(a){var b=e.label;a.stopPropagation();a.preventDefault();if(!r){q=e.pinned?c.pinnedTierHolder:c.tierHolder;s=q.scrollHeight-q.offsetHeight;
r=b.cloneNode(!0);r.style.cursor="pointer";q.appendChild(r);b.style.visibility="hidden";for(var d=0;d<c.tiers.length;++d)if(c.tiers[d]===e){v=d;break}t=a.clientY}var f=q.getBoundingClientRect();r.style.left=b.getBoundingClientRect().left-f.left+"px";r.style.top=a.clientY-f.top+q.scrollTop-10+"px";b=a.clientY-f.top+q.scrollTop;for(d=0;d<c.tiers.length;++d)if(f=c.tiers[d],!(f.pinned^e.pinned)&&(f=f.row.getBoundingClientRect(),b-=f.bottom-f.top,0>b)){if(d<v&&a.clientY<t||d>v&&a.clientY>t)c.withPreservedSelection(function(){c.tiers.splice(v,
1);c.tiers.splice(d,0,e)}),v=d,t=a.clientY,c.reorderTiers(),q.appendChild(r),u=!0;break}r.offsetTop<q.scrollTop?q.scrollTop-=q.scrollTop-r.offsetTop:r.offsetTop+r.offsetHeight>q.scrollTop+q.offsetHeight&&(q.scrollTop=Math.min(q.scrollTop+(r.offsetTop+r.offsetHeight)-(q.scrollTop+q.offsetHeight),s))},x=function(a){var b=e.label;a.stopPropagation();a.preventDefault();r&&(r.style.cursor="auto",q.removeChild(r),r=null,b.style.visibility=null);document.removeEventListener("mousemove",w,!1);document.removeEventListener("mouseup",
x,!1);if(u){for(a=0;a<c.tiers.length;++a)if(c.tiers[a]==e){c.setSelectedTier(a);break}c.notifyTier()}};e.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();u=!1;document.addEventListener("mousemove",w,!1);document.addEventListener("mouseup",x,!1)},!1);this.tiers.push(e);e.init();e.currentlyHeight=50;this.updateHeight();e.updateLabel();e.featureSource&&e.featureSource.addActivityListener&&e.featureSource.addActivityListener(function(a){e.loaderButton.style.display=
0<a?"inline-block":"none";c.pingActivity()});e._updateFromConfig();this.reorderTiers()};
Browser.prototype.reorderTiers=function(){removeChildren(this.tierHolder);removeChildren(this.pinnedTierHolder);for(var a=!1,b=[],c=[],d=0;d<this.tiers.length;++d){var e=this.tiers[d];e.pinned?(b.push(e),this.pinnedTierHolder.appendChild(this.tiers[d].row),a=!0):(c.push(e),this.tierHolder.appendChild(this.tiers[d].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<b.length;++a)this.tiers.push(b[a]);for(a=0;a<c.length;++a)this.tiers.push(c[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):
this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};Browser.prototype.withPreservedSelection=function(a){for(var b=[],c=0;c<this.selectedTiers.length;++c)b.push(this.tiers[this.selectedTiers[c]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=b.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};Browser.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};
Browser.prototype.arrangeTiers=function(){for(var a=[],b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.pinned&&a.push(c)}for(b=0;b<this.tiers.length;++b)c=this.tiers[b],c.pinned||a.push(c);if(this.tierBackgroundColors)for(b=0;b<a.length;++b)c=a[b],c.background=this.tierBackgroundColors[b%this.tierBackgroundColors.length]};
Browser.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,c=(this.viewStart+this.viewEnd)/2,d=c-this.origin;this.origin=c;this.scaleAtLastRedraw=this.scale;for(c=0;c<this.tiers.length;++c){var e=d;this.tiers[c].originHaxx&&(e+=this.tiers[c].originHaxx);this.tiers[c].originHaxx=e}d=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);e=Math.max(1,(this.viewStart|
0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var f=this.getSequenceSource();this.knownSpace=new KnownSpace(this.tiers,this.chr,e,b,d,f)}(f=this.knownSpace.bestCacheOverlapping(this.chr,c,a))&&f.min<=c&&f.max>=a?(this.drawnStart=Math.max(f.min,e),this.drawnEnd=Math.min(f.max,b)):(this.drawnStart=e,this.drawnEnd=b);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,d);this.drawOverlays()};
function setSources(a,b,c){if(c)for(var d=0;d<b.length;++d)b[d].mapping=c;a.set(b)}
Browser.prototype.queryRegistry=function(a,b){var c,d;a?(c=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new Observed),d=this.mappableSources[a]):(c=this.coordSystem,d=this.availableSources);var e=hex_sha1(miniJSONify(c));if(b){var f=localStorage["dalliance.registry."+e+".last_queried"];if(f)try{if(setSources(d,JSON.parse(localStorage["dalliance.registry."+e+".sources"]),a),432E5>(Date.now()|0)-(f|0))return}catch(g){console.log("Bad registry cache: "+g)}}(new DASRegistry(this.registry)).sources(function(b){for(var f=
[],g=0;g<b.length;++g){var m=b[g];if(m.coords&&0!=m.coords.length){var n=m.coords[0];n.taxon!=c.taxon||(n.auth!=c.auth||n.version!=c.version)||f.push(m)}}localStorage["dalliance.registry."+e+".sources"]=JSON.stringify(f);localStorage["dalliance.registry."+e+".last_queried"]=""+Date.now();setSources(d,f,a)},function(a){},c)};
Browser.prototype.move=function(a){var b=this.viewEnd-this.viewStart;this.viewStart-=a/this.scale;this.viewEnd=this.viewStart+b;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b);1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b);this.notifyLocation();for(a=0;a<this.tiers.length;++a)this.tiers[a].viewport.style.left=""+((-((this.viewStart-this.tiers[a].norigin)*this.scale)|0)-1E3)+"px",this.tiers[a].overlay.style.left=
""+((-((this.viewStart-this.tiers[a].oorigin)*this.scale)|0)-1E3)+"px";this.spaceCheck()};Browser.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue;a=b+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=b&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};
Browser.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-
this.viewStart);this.refresh()};Browser.prototype.spaceCheck=function(a){!this.knownSpace||this.knownSpace.chr!==this.chr?this.refresh():(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh())};
Browser.prototype.resizeViewer=function(a){var b=this.tierHolder.getBoundingClientRect().width|0;if(0!=b){var c=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=b|0;c!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/10/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/
c,b=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};
Browser.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};Browser.prototype.addTier=function(a){a=shallowCopy(a);a.disabled=!1;this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier()};
function sourceDataURI(a){return a.uri?a.uri:a.blob?"file:"+a.blob.name:a.bwgBlob?"file:"+a.bwgBlob.name:a.bamBlob?"file:"+a.bamBlob.name:a.bwgURI||a.bamURI||a.jbURI||a.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function sourceStyleURI(a){return a.stylesheet_uri?a.stylesheet_uri:"sequence"==a.tier_type?"http://www.biodalliance.org/magic/sequence":sourceDataURI(a)}
function sourcesAreEqual(a,b){if(sourceDataURI(a)!=sourceDataURI(b)||sourceStyleURI(a)!=sourceStyleURI(b)||a.mapping!=b.mapping||a.tier_type!=b.tier_type)return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var c=0;c<a.overlay.length;++c)if(!sourcesAreEqual(a.overlay[c],b.overlay[c]))return!1}else if(b.overlay)return!1;return!0}
Browser.prototype.removeTier=function(a,b){var c=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)c=a.index;else for(var d=0;d<this.tiers.length;++d)if(sourcesAreEqual(a,this.tiers[d].dasSource)){c=d;break}if(0>c)throw"Couldn't find requested tier";this.tiers.splice(c,1);for(var d=[],e=0;e<this.selectedTiers.length;++e){var f=this.selectedTiers[e];f<c?d.push(f):f>c&&d.push(f-1)}this.selectedTiers=d;this.markSelectedTiers();this.reorderTiers();this.notifyTier()};
Browser.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};Browser.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||b.twoBitURI)return b.twoBitURI?new TwoBitSequenceSource(b):new DASSequenceSource(b)}};
Browser.prototype.setLocation=function(a,b,c,d){d||(d=function(a){if(a)throw a;});var e=this;if(!a||a==this.chr)return this._setLocation(null,b,c,null,d);var f=this.getSequenceSource();if(!f)return d("Need a sequence source");f.getSeqInfo(a,function(g){if(g)return e._setLocation(a,b,c,g,d);var h;h=0==a.indexOf("chr")?a.substr(3):"chr"+a;f.getSeqInfo(h,function(f){return f?e._setLocation(h,b,c,f,d):d("Couldn't find sequence '"+a+"'")})})};
Browser.prototype._setLocation=function(a,b,c,d,e){var f=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(f=!0),this.chr=a,this.currentSeqMax=d.length);b|=0;c|=0;a=Math.max(10,c-b+1);1>b&&(b=1,c=b+a-1);c>this.currentSeqMax&&(c=this.currentSeqMax,b=Math.max(1,c-a+1));this.viewStart=b;this.viewEnd=c;b=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);a=1E-4<Math.abs(b-this.scale);this.scale=b;c=this.zoomSliderValue;this.zoomSliderValue=b=this.zoomExpt*Math.log((this.viewEnd-
this.viewStart+1)/this.zoomBase);if(a||f){for(f=0;f<this.tiers.length;++f)this.tiers[f].viewport.style.left="5000px",this.tiers[f].overlay.style.left="5000px";this.refresh();this.savedZoom?(b-=this.zoomMin,c-=this.zoomMin,f=b-this.savedZoom,Math.abs(b-c)>Math.abs(f)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=c)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(f=0;f<this.tiers.length;++f)this.tiers[f].viewport.style.left=""+((-((this.viewStart-this.tiers[f].norigin)*this.scale)|0)-
1E3)+"px",this.tiers[f].overlay.style.left=""+((-((this.viewStart-this.tiers[f].oorigin)*this.scale)|0)-1E3)+"px";this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return e()};
Browser.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,b=0;b<this.tiers.length;++b)"none"!==this.tiers[b].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};Browser.prototype.addFeatureListener=function(a,b){this.featureListeners.push(a)};
Browser.prototype.notifyFeature=function(a,b,c,d){for(var e=0;e<this.featureListeners.length;++e)try{if(this.featureListeners[e](a,b,c,d))break}catch(f){console.log(f.stack)}};Browser.prototype.addFeatureHoverListener=function(a,b){this.featureHoverListeners.push(a)};Browser.prototype.notifyFeatureHover=function(a,b,c,d){for(var e=0;e<this.featureHoverListeners.length;++e)try{this.featureHoverListeners[e](a,b,c,d)}catch(f){console.log(f.stack)}};Browser.prototype.addViewListener=function(a,b){this.viewListeners.push(a)};
Browser.prototype.notifyLocation=function(){for(var a=0;a<this.viewListeners.length;++a)try{this.viewListeners[a](this.chr,this.viewStart|0,this.viewEnd|0,this.zoomSliderValue,{current:this.zoomSliderValue,min:this.zoomMin,max:this.zoomMax})}catch(b){console.log(b.stack)}};Browser.prototype.addTierListener=function(a){this.tierListeners.push(a)};Browser.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(b){console.log(b.stack)}};
Browser.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};Browser.prototype.notifyRegionSelect=function(a,b,c){for(var d=0;d<this.regionSelectListeners.length;++d)try{this.regionSelectListeners[d](a,b,c)}catch(e){console.log(e.stack)}};
Browser.prototype.highlightRegion=function(a,b,c){var d=this;if(a==this.chr)return this._highlightRegion(a,b,c);var e=this.getSequenceSource();if(!e)throw"Need a sequence source";e.getSeqInfo(a,function(f){if(f)return d._highlightRegion(a,b,c);var g;g=0==a.indexOf("chr")?a.substr(3):"chr"+a;e.getSeqInfo(g,function(a){if(a)return d._highlightRegion(g,b,c)})})};
Browser.prototype._highlightRegion=function(a,b,c){for(var d=0;d<this.highlights.length;++d){var e=this.highlights[d];if(e.chr==a&&e.min==b&&e.max==c)return}this.highlights.push(new Region(a,b,c));d=this.viewStart-1E3/this.scale;e=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&(b<e&&c>d)&&this.drawOverlays();this.notifyLocation()};Browser.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};
Browser.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};Browser.prototype.featuresInRegion=function(a,b,c){var d=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var e=this.tiers[a].currentFeatures||[],f=0;f<e.length;++f){var g=e[f];g.min<=c&&g.max>=b&&d.push(g)}return d};Browser.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};
Browser.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};Browser.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?b.classList.add("active"):b.classList.remove("active")}0<this.selectedTiers.length&&this.browserHolder.focus()};Browser.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};
Browser.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(b){console.log(b.stack)}};Browser.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};Browser.prototype.notifyTierSelectionWrap=function(a){for(var b=0;b<this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(c){console.log(c.stack)}};
Browser.prototype.positionRuler=function(){var a="none",b="",c="";"center"==this.rulerLocation?(a="block",b=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",b="0px"):"right"==this.rulerLocation?(a="block",c="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=b;this.ruler.style.right=c;this.ruler2.style.display="center"==this.rulerLocation?"none":"block";this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var d=0;d<this.tiers.length;++d){var e=this.tiers[d],
f=e.quantOverlay,g;e.subtiers&&0<e.subtiers.length&&(g=e.subtiers[0].quant);f&&(f.style.display=g?a:"none",f.style.left=b,f.style.right=c)}};Browser.prototype.featureDoubleClick=function(a,b,c){if(a&&0!=a.length&&(c=a[a.length-1],c.min&&c.max)){var d=((c.min|0)-(this.viewStart|0))*this.scale,e=(c.max-c.min+1)*this.scale;a=((c.min|0)+(c.max|0))/2;10<e&&(b=1*(b-d)/e,0.3>b?a=c.min|0:0.7<b&&(a=(c.max|0)+1));b=this.viewEnd-this.viewStart;this.setLocation(null,a-b/2,a+b/2)}};
Browser.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};Browser.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};Browser.prototype.updateHeight=function(){for(var a=0,b=0;b<this.tiers.length;++b)a+=this.tiers[b].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px"};
Browser.prototype.scrollArrowKey=function(a,b){this.reverseKeyScrolling&&(b=-b);if(a.ctrlKey||a.metaKey){var c=!1;a.shiftKey&&(c=!0);this.leap(b,c)}else this.move(a.shiftKey?100*b:25*b)};
Browser.prototype.leap=function(a,b){var c=this,d=(c.viewStart+c.viewEnd+1)/2|0,e=c.getSelectedTier();0>e||((e=c.tiers[e])&&(e.featureSource&&sourceAdapterIsCapable(e.featureSource,"quantLeap")&&"number"==typeof e.quantLeapThreshold||e.featureSource&&sourceAdapterIsCapable(e.featureSource,"leap"))?e.findNextFeature(c.chr,d,-a,b,function(e){if(e){var g=e.min,h=e.max;b&&(0<a?g>d+1?h=g:(h++,g=h):h<d-1?(h++,g=h):h=g);var k=c.viewEnd-c.viewStart+1;parseFloat(k/2)==parseInt(k/2)&&k--;g=(g+h-k)/2+1;c.setLocation(e.segment,
g,g+k-1)}else alert("no next feature")}):this.move(100*a))};function glyphLookup(a,b,c,d){d=d||[];for(var e=a.length-1;0<=e;--e){var f=a[e];if(!f.notSelectable&&(f.min()<=b&&f.max()>=b)&&(!f.minY||!(c<f.minY()||c>f.maxY()))){f.feature?d.push(f.feature):f.group&&d.push(f.group);if(f.glyphs)return glyphLookup(f.glyphs,b,c,d);if(f.glyph)return glyphLookup([f.glyph],b,c,d);break}}return d}
Browser.prototype.nameForCoordSystem=function(a){var b=null,c=null;this.assemblyNamePrimary&&(b=""+a.auth,"undefined"!==typeof a.version&&(b+=a.version));this.assemblyNameUcsc&&(c=a.ucscName);return null!=b&&null!=c?b+"/"+c:b||c||"unknown"};
Browser.prototype.makeLoader=function(a){var b=1<window.devicePixelRatio;return 20>(a||16)?makeElement("img",null,{src:this.uiPrefix+"img/spinner_"+(b?16:32)+".gif",width:"16",height:"16"}):makeElement("img",null,{src:this.uiPrefix+"img/spinner_"+(b?24:48)+".gif",width:"24",height:"24"})};Browser.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};
function FetchWorker(){var a=this;this.worker=new Worker("js/fetchworker.js");this.tagSeed=0;this.callbacks={};this.worker.onmessage=function(b){var c=a.callbacks[b.data.tag];c&&(c(b.data.result,b.data.error),delete a.callbacks[b.data.tag])}}FetchWorker.prototype.postCommand=function(a,b,c){var d="x"+ ++this.tagSeed;a.tag=d;this.callbacks[d]=b;this.worker.postMessage(a,c)};"use strict";var TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;
Browser.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};function FeatureInfo(a,b,c){var d=pick(c.type,b.type),e=pick(c.label,b.label,c.id,b.id);e&&0!=e.indexOf("__dazzle")&&(d=d+": "+e);this.hit=a;this.feature=b;this.group=c;this.title=d;this.sections=[]}FeatureInfo.prototype.setTitle=function(a){this.title=a};
FeatureInfo.prototype.add=function(a,b){"string"===typeof b&&(b=makeElement("span",b));this.sections.push({label:a,info:b})};
Browser.prototype.featurePopup=function(a,b,c,d){var e=c.length;b=0<=--e?c[e]:{};var f=0<=--e?c[e]:{};c=new FeatureInfo(c,b,f);c.tier=d;for(var e=this.featureInfoPlugins||[],g=0;g<e.length;++g)try{e[g](b,c)}catch(h){console.log(h.stack||h)}e=d.featureInfoPlugins||[];for(g=0;g<e.length;++g)try{e[g](b,c)}catch(k){console.log(k.stack||k)}this.removeAllPopups();d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";e=0;b.method&&(g=makeElement("tr",
[makeElement("th","Method"),makeElement("td",b.method)]),d.appendChild(g),++e);g=f.segment?f:b;g=makeElement("tr",[makeElement("th","Location"),makeElement("td",g.segment+":"+g.min+"-"+g.max)]);d.appendChild(g);++e;void 0!==b.score&&(null!==b.score&&"-"!=b.score)&&(g=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+b.score)]),d.appendChild(g),++e);if((g=maybeConcat(f.links,b.links))&&0<g.length)g=makeElement("tr",[makeElement("th","Links"),makeElement("td",g.map(function(a){return makeElement("div",
makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(g),++e;b=maybeConcat(f.notes,b.notes);for(f=0;f<b.length;++f){var g="Note",l=b[f],m=l.match(TAGVAL_NOTE_RE);m&&(g=m[1],l=m[2]);g=makeElement("tr",[makeElement("th",g),makeElement("td",l)]);d.appendChild(g);++e}for(b=0;b<c.sections.length;++b)e=c.sections[b],d.appendChild(makeElement("tr",[makeElement("th",e.label),makeElement("td",e.info)]));this.popit(a,c.title||"Feature",d,{width:400})};"use strict";
function Chainset(a,b,c,d){this.uri=a;this.srcTag=b;this.destTag=c;this.coords=d;this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={}}(function(a){var b=RegExp("([0-9]*)([MIDS])","g");a.parseCigar=function(a){for(var d=[],e;null!=(e=b.exec(a));){var f=e[1];0==f.length&&(f=1);d.push({cnt:f|0,op:e[2]})}return d}})(this);
Chainset.prototype.fetchChainsTo=function(a){var b=this;(new DASSource(this.uri)).alignments(a,{},function(c){b.chainsByDest[a]||(b.chainsByDest[a]=[]);for(var d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.blocks.length;++f){for(var g=e.blocks[f],h,k,l=0;l<g.segments.length;++l){var m=g.segments[l],n=e.objects[m.object];n.dbSource===b.srcTag?h=m:n.dbSource===b.destTag&&(k=m)}if(h&&k){for(var g={srcChr:e.objects[h.object].accession,srcMin:h.min|0,srcMax:h.max|0,srcOri:h.strand,destChr:e.objects[k.object].accession,
destMin:k.min|0,destMax:k.max|0,destOri:k.strand,blocks:[]},l=parseCigar(h.cigar),m=parseCigar(k.cigar),p=n=0,r=0,q=0;r<l.length&&q<m.length;)if("M"==l[r].op&&"M"==m[q].op){var s=Math.min(l[r].cnt,m[q].cnt);g.blocks.push([n,p,s]);l[r].cnt==s?++r:l[r].cnt-=s;m[q].cnt==s?++q:m[q]-=s;n+=s;p+=s}else"I"==l[r].op?p+=l[r++].cnt:"I"==m[q].op&&(n+=m[q++].cnt);pusho(b.chainsBySrc,g.srcChr,g);pusho(b.chainsByDest,g.destChr,g)}}if(b.postFetchQueues[a]){c=b.postFetchQueues[a];for(d=0;d<c.length;++d)c[d]();b.postFetchQueues[a]=
null}})};Chainset.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.srcMin&&b<=e.srcMax){var f;f="-"==e.srcOri?e.srcMax-b:b-e.srcMin;for(var g=e.blocks,h=0;h<g.length;++h){var k=g[h],l=k[0],m=k[1],k=k[2];if(f>=l&&f<=l+k)return c=f-l,{seq:e.destChr,pos:"-"==e.destOri?e.destMax-m-c:c+m+e.destMin,flipped:e.srcOri!=e.destOri}}}}return null};
Chainset.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.destMin&&b<=e.destMax){var f;f="-"==e.srcOri?e.destMax-b:b-e.destMin;for(var g=e.blocks,h=0;h<g.length;++h){var k=g[h],l=k[0],m=k[1],k=k[2];if(f>=m&&f<=m+k)return c=f-m,d=c+l+e.srcMin,d="-"==e.destOri?e.srcMax-l-c:c+l+e.srcMin,{seq:e.srcChr,pos:d,flipped:e.srcOri!=e.destOri}}}}return null};
Chainset.prototype.sourceBlocksForRange=function(a,b,c,d){if(this.chainsByDest[a]){for(var e=[],f=this.chainsByDest[a]||[],g=0;g<f.length;++g){var h=f[g];if(b<=h.destMax&&c>=h.destMin){var k,l;"-"==h.srcOri?(k=h.destMax-c,l=h.destMax-b):(k=b-h.destMin,l=c-h.destMin);for(var m=h.blocks,n=0;n<m.length;++n){var p=m[n],r=p[0],q=p[1],s=p[2];l>=q&&k<=q+s&&(p=Math.max(k,q)-q,q=Math.min(l,q+s)-q,"-"==h.destOri?e.push(new DASSegment(h.srcChr,h.srcMax-r-q,h.srcMax-r-p)):e.push(new DASSegment(h.srcChr,h.srcMin+
p+r,h.srcMin+q+r)))}}}d(e)}else{var e=!this.postFetchQueues[a],v=this;pusho(this.postFetchQueues,a,function(){v.sourceBlocksForRange(a,b,c,d)});e&&this.fetchChainsTo(a)}};"use strict";function DColour(a,b,c,d){this.red=a|0;this.green=b|0;this.blue=c|0;d&&(this.name=d)}DColour.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};function hex2(a){a="00"+a.toString(16);return a.substring(a.length-2)}
DColour.prototype.toHexString=function(){return"#"+hex2(this.red)+hex2(this.green)+hex2(this.blue)};var palette={red:new DColour(255,0,0,"red"),green:new DColour(0,255,0,"green"),blue:new DColour(0,0,255,"blue"),yellow:new DColour(255,255,0,"yellow"),white:new DColour(255,255,255,"white"),black:new DColour(0,0,0,"black"),gray:new DColour(180,180,180,"gray"),grey:new DColour(180,180,180,"grey")},COLOR_RE=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,CSS_COLOR_RE=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;
function dasColourForName(a){var b=palette[a];b||((b=COLOR_RE.exec(a))?b=new DColour("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(b=CSS_COLOR_RE.exec(a))?b=new DColour(b[1]|0,b[2]|0,b[3]|0,a):(console.log("couldn't handle color: "+a),b=palette.black),palette[a]=b);return b}
function makeColourSteps(a,b,c){for(var d=[],e=0;e<c.length;++e)d.push(dasColourForName(c[e]));c=[];e=0;a:for(;e<a;++e){for(var f=b[0]+(b[b.length-1]-b[0])*(1*e/(a-1)),g=0;g<b.length-1;++g)if(f>=b[g]&&f<=b[g+1]){var f=(f-b[g])/(b[g+1]-b[g]),h=d[g],g=d[g+1],g=(new DColour(h.red*(1-f)+g.red*f|0,h.green*(1-f)+g.green*f|0,h.blue*(1-f)+g.blue*f|0)).toSvgString();c.push(g);continue a}throw"Bad step";}return c}
function makeGradient(a,b,c,d){return d?makeColourSteps(a,[0,0.5,1],[b,c,d]):makeColourSteps(a,[0,1],[b,c])}"use strict";var dasLibErrorHandler=function(a){alert(a)},dasLibRequestQueue=[];function DASSegment(a,b,c,d){this.name=a;this.start=b;this.end=c;this.description=d}DASSegment.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};DASSegment.prototype.isBounded=function(){return this.start&&this.end};
DASSegment.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};function DASSource(a,b){var c;"string"==typeof a?(this.uri=a,c=b||{}):c=a||{};for(var d in c)"function"!=typeof c[d]&&(this[d]=c[d]);this.coords||(this.coords=[]);this.props||(this.props={});if((this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1))this.dasBaseURI+="/"}function DASCoords(){}
function coordsMatch(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}
DASSource.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var c=[];b=b.getElementsByTagName("SEGMENT");for(var d=0;d<b.length;++d){var e=b[d],f=e.getAttribute("id"),g=e.getAttribute("size"),h;g?(h=1,g|=0):((h=e.getAttribute("start"))&&(h|=0),(g=e.getAttribute("stop"))&&(g|=0));var k=null;e.firstChild&&(k=e.firstChild.nodeValue);c.push(new DASSegment(f,h,g,k))}a(c)})};
function DASSequence(a,b,c,d,e){this.name=a;this.start=b;this.end=c;this.alphabet=d;this.seq=e}
DASSource.prototype.sequence=function(a,b){var c=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(c,function(a){if(a){var c=[];a=a.getElementsByTagName("SEQUENCE");for(var f=0;f<a.length;++f){var g=a[f],h=g.getAttribute("id"),k=g.getAttribute("start"),l=g.getAttribute("stop"),m=null;if(g.firstChild)for(var g=g.firstChild.nodeValue,m="",n=0;;){var p=g.indexOf("\n",n);if(0<=p)m+=g.substring(n,p),n=p+1;else{m+=g.substring(n);break}}c.push(new DASSequence(h,k,l,"DNA",m))}b(c)}else b([])})};
function DASFeature(){}function DASGroup(){}function DASLink(a,b){this.desc=a;this.uri=b}
DASSource.prototype.features=function(a,b,c){b=b||{};var d;if(this.features_uri)d=this.features_uri;else{var e=[];if(a)e.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)e.push("group_id="+a);else for(var f=0;f<a.length;++f)e.push("group_id="+a[f]);if(b.adjacent){a=b.adjacent;"string"==typeof a&&(a=[a]);for(f=0;f<a.length;++f)e.push("adjacent="+a[f])}if(b.type)if("string"==typeof b.type)e.push("type="+b.type);else for(a=0;a<b.type.length;++a)e.push("type="+b.type[a]);b.maxbins&&
e.push("maxbins="+b.maxbins);0<e.length?d=this.dasBaseURI+"features?"+e.join(";"):c([],"No filters specified")}this.doCrossDomainRequest(d,function(a,b){if(a){for(var d=[],e={},f=a.getElementsByTagName("SEGMENT"),n=0;n<f.length;++n){var p=f[n],r=p.getAttribute("id");e[r]={min:p.getAttribute("start"),max:p.getAttribute("stop")};for(var p=p.getElementsByTagName("FEATURE"),q=0;q<p.length;++q){var s=p[q],v=new DASFeature;v.segment=r;v.id=s.getAttribute("id");v.label=s.getAttribute("label");var t=elementValue(s,
"START"),u=elementValue(s,"END");(t|0)>(u|0)?(v.min=u|0,v.max=t|0):(v.min=t|0,v.max=u|0);t=s.getElementsByTagName("TYPE");0<t.length&&(t=t[0],t.firstChild&&(v.type=t.firstChild.nodeValue),v.typeId=t.getAttribute("id"),v.typeCv=t.getAttribute("cvId"));v.type=elementValue(s,"TYPE");!v.type&&v.typeId&&(v.type=v.typeId);v.method=elementValue(s,"METHOD");(t=elementValue(s,"ORIENTATION"))||(t="0");v.orientation=t;v.score=elementValue(s,"SCORE");v.links=dasLinksOf(s);v.notes=dasNotesOf(s);t=s.getElementsByTagName("GROUP");
for(u=0;u<t.length;++u){var w=t[u],x=new DASGroup;x.type=w.getAttribute("type");x.id=w.getAttribute("id");x.links=dasLinksOf(w);x.notes=dasNotesOf(w);v.groups?v.groups.push(x):v.groups=Array(x)}if(v.notes)for(t=0;t<v.notes.length;++t)u=v.notes[t],0==u.indexOf("Genename=")&&(w=new DASGroup,w.type="gene",w.id=u.substring(9),v.groups?v.groups.push(w):v.groups=Array(w));t=s.getElementsByTagName("PART");if(0<t.length){w=[];for(u=0;u<t.length;++u)w.push(t[u].getAttribute("id"));v.parts=w}t=s.getElementsByTagName("PARENT");
if(0<t.length){s=[];for(u=0;u<t.length;++u)s.push(t[u].getAttribute("id"));v.parents=s}d.push(v)}}c(d,void 0,e)}else c([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){c([],a)})};function DASAlignment(a){this.type=a;this.objects={};this.blocks=[]}
DASSource.prototype.alignments=function(a,b,c){var d=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(d,function(a){if(a){var b=[];a=a.getElementsByTagName("alignment");for(var g=0;g<a.length;++g){for(var h=a[g],k=new DASAlignment(h.getAttribute("alignType")),l=h.getElementsByTagName("alignObject"),m=0;m<l.length;++m){var n=l[m],n={id:n.getAttribute("intObjectId"),accession:n.getAttribute("dbAccessionId"),version:n.getAttribute("objectVersion"),dbSource:n.getAttribute("dbSource"),dbVersion:n.getAttribute("dbVersion")};
k.objects[n.id]=n}h=h.getElementsByTagName("block");for(l=0;l<h.length;++l){for(var n=h[l],m={order:n.getAttribute("blockOrder"),segments:[]},n=n.getElementsByTagName("segment"),p=0;p<n.length;++p){var r=n[p],r={object:r.getAttribute("intObjectId"),min:r.getAttribute("start"),max:r.getAttribute("end"),strand:r.getAttribute("strand"),cigar:elementValue(r,"cigar")};m.segments.push(r)}k.blocks.push(m)}b.push(k)}c(b)}else c([],"Failed request "+d)})};function DASStylesheet(){this.styles=[]}
DASStylesheet.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=shallowCopy(a);b&&(a.zoom=b);a.style=c;this.styles.push(a)};function DASStyle(){}function parseGradient(a){var b=a.getAttribute("steps"),b=b?b|0:50,c=[],d=[];a=a.getElementsByTagName("STOP");for(var e=0;e<a.length;++e){var f=a[e];c.push(1*f.getAttribute("score"));d.push(f.firstChild.nodeValue)}return makeColourSteps(b,c,d)}
DASSource.prototype.stylesheet=function(a,b){var c,d=this.credentials;this.stylesheet_uri?(c=this.stylesheet_uri,d=!1):c=this.dasBaseURI+"stylesheet";doCrossDomainRequest(c,function(c){if(c){var d=new DASStylesheet;c=c.getElementsByTagName("TYPE");for(var g=0;g<c.length;++g){var h=c[g],k={};k.type=h.getAttribute("id");k.label=h.getAttribute("label");k.method=h.getAttribute("method");for(var h=h.getElementsByTagName("GLYPH"),l=0;l<h.length;++l){var m=h[l],n=m.getAttribute("zoom"),p=childElementOf(m),
m=new DASStyle;m.glyph=p.localName;for(p=p.firstChild;p;)p.nodeType==Node.ELEMENT_NODE&&(m[p.localName]="BGGRAD"==p.localName?parseGradient(p):p.firstChild.nodeValue),p=p.nextSibling;d.pushStyle(k,n,m)}}a(d)}else b&&b()},d)};function DASRegistry(a,b){b=b||{};this.uri=a;this.opts=b}
DASRegistry.prototype.sources=function(a,b,c){c||(c={});var d=[];c.taxon&&d.push("organism="+c.taxon);c.auth&&d.push("authority="+c.auth);c.version&&d.push("version="+c.version);c=this.uri;0<d.length&&(c=c+"?"+d.join("&"));doCrossDomainRequest(c,function(c){if(!c&&b)b();else{var d=[];c=c.getElementsByTagName("SOURCE");for(var g=0;g<c.length;++g){var h=c[g],k=h.getElementsByTagName("VERSION");if(!(1>k.length)){for(var l=k[0],m=l.getElementsByTagName("COORDINATES"),k=[],n=0;n<m.length;++n){var p=m[n],
r=new DASCoords;r.auth=p.getAttribute("authority");r.taxon=p.getAttribute("taxid");r.version=p.getAttribute("version");k.push(r)}for(var m=[],p=l.getElementsByTagName("CAPABILITY"),q,n=0;n<p.length;++n)r=p[n],m.push(r.getAttribute("type")),"das1:features"==r.getAttribute("type")&&(q=r.getAttribute("query_uri"),q=q.substring(0,q.length-8));n={};l=l.getElementsByTagName("PROP");for(p=0;p<l.length;++p)pusho(n,l[p].getAttribute("name"),l[p].getAttribute("value"));q&&(h=new DASSource(q,{source_uri:h.getAttribute("uri"),
name:h.getAttribute("title"),desc:h.getAttribute("description"),coords:k,props:n,capabilities:m}),d.push(h))}}a(d)}})};function elementValue(a,b){var c=a.getElementsByTagName(b);if(0<c.length&&c[0].firstChild){c=c[0];if(1==c.childNodes.length)return c.firstChild.nodeValue;for(var d="",e=0;e<c.childNodes.length;++e)d+=c.childNodes[e].nodeValue;return d}return null}
function childElementOf(a){if(a.hasChildNodes()){a=a.firstChild;do{if(a.nodeType==Node.ELEMENT_NODE)return a;a=a.nextSibling}while(null!=a)}return null}function dasLinksOf(a){for(var b=[],c=a.getElementsByTagName("LINK"),d=0;d<c.length;++d){var e=c[d];e.parentNode==a&&b.push(new DASLink(e.firstChild?e.firstChild.nodeValue:"Unknown",e.getAttribute("href")))}return b}
function dasNotesOf(a){var b=[];a=a.getElementsByTagName("NOTE");for(var c=0;c<a.length;++c)a[c].firstChild&&b.push(a[c].firstChild.nodeValue);return b}
function doCrossDomainRequest(a,b,c,d){if(window.XDomainRequest){var e=new XDomainRequest;e.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(e.responseText);b(a)};e.open("get",a)}else Date.now(),e=new XMLHttpRequest,e.onreadystatechange=function(){4==e.readyState&&(200<=e.status||0==e.status)&&b(e.responseXML,e)},e.open("get",a,!0),c&&(e.withCredentials=!0),d&&e.setRequestHeader("X-DAS-Authorisation",d),e.setRequestHeader("Accept","application/xml,*/*");e.send("")}
DASSource.prototype.doCrossDomainRequest=function(a,b,c){var d;this.xUser&&(d="Basic "+btoa(this.xUser+":"+this.xPass));try{return doCrossDomainRequest(a,b,this.credentials,d)}catch(e){if(c)c(e);else throw e;}};"use strict";Browser.prototype.removeAllPopups=function(){removeChildren(this.hPopupHolder);removeChildren(this.popupHolder)};
Browser.prototype.makeTooltip=function(a,b){var c=!1,d=this,e=null,f;f=function(b){c=!1;e&&(clearTimeout(e),e=null);a.removeEventListener("mouseout",f,!1)};var g=function(f){var k=f.clientX+window.scrollX,l=f.clientY+window.scrollY;e||(e=setTimeout(function(){var f;f="function"===typeof b?b():b;var h=makeElement("div",[makeElement("div",null,{className:"tooltip-arrow"}),makeElement("div",f,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(l+20)+"px",left:""+Math.max(k-
30,20)+"px"});d.hPopupHolder.appendChild(h);var p;p=function(b){try{d.hPopupHolder.removeChild(h)}catch(e){}window.removeEventListener("mousemove",p,!1);c&&null!=a.offsetParent&&g(b)};window.addEventListener("mousemove",p,!1);e=null},1E3))};a.addEventListener("mouseover",function(b){c=!0;a.addEventListener("mouseout",f,!1);g(b)},!1);a.addEventListener("DOMNodeRemovedFromDocument",function(a){c=!1;e&&(clearTimeout(e),e=null)},!1)};
Browser.prototype.popit=function(a,b,c,d){var e=this;d||(d={});a||(a={});var f=d.width||200,g;a.clientX?(d=a.clientX,g=a.clientY):(d=500,g=50);d+=document.documentElement.scrollLeft||document.body.scrollLeft;g+=document.documentElement.scrollTop||document.body.scrollTop;var h=window.innerWidth,k=g,l=Math.min(d-f/2-4,h-f-30),m=makeElement("div");m.className="popover fade "+(a.clientX?"bottom ":"")+"in";m.style.display="block";m.style.position="absolute";m.style.top=""+k+"px";m.style.left=""+l+"px";
m.style.width=f+"px";276<f&&(m.style.maxWidth=f+"px");m.appendChild(makeElement("div",null,{className:"arrow"}));if(b){var n=makeElement("button","",{className:"close"});n.innerHTML="&times;";n.addEventListener("mouseover",function(a){n.style.color="red"},!1);n.addEventListener("mouseout",function(a){n.style.color="black"},!1);n.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e.removeAllPopups()},!1);a=makeElement("h4",[makeElement("span",b,null,{maxWidth:"200px"}),n],
{},{paddingLeft:"10px",paddingRight:"10px"});var p,r,q,s;q=function(a){a.stopPropagation();a.preventDefault();l+=a.clientX-p;8>l&&(l=8);l>h-f-32&&(l=h-f-26);k+=a.clientY-r;k=Math.max(10,k);m.style.top=""+k+"px";m.style.left=""+Math.min(l,h-f-10)+"px";p=a.clientX;r=a.clientY};s=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",q,!1);window.removeEventListener("mouseup",s,!1)};a.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();p=
a.clientX;r=a.clientY;window.addEventListener("mousemove",q,!1);window.addEventListener("mouseup",s,!1)},!1);m.appendChild(a)}m.appendChild(makeElement("div",c,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(m);var v={node:m,displayed:!0};m.addEventListener("DOMNodeRemoved",function(a){a.target==m&&(v.displayed=!1)},!1);return v};
function makeTreeTableSection(a,b,c){function d(){c?(e.className="fa fa-caret-down",b.style.display="table"):(e.className="fa fa-caret-right",b.style.display="none")}var e=makeElement("i");d();e.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c=!c;d()},!1);a=makeElement("h6",[e," ",a],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return makeElement("div",[a,b],{})}function dlog(a){console.log(a)}"use strict";
var MIN_PADDING=3,DEFAULT_SUBTIER_MAX=100;function isDasBooleanTrue(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function isDasBooleanNotFalse(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function SubTier(){this.glyphs=[];this.height=0;this.quant=null}SubTier.prototype.indexFor=function(a){a=a.min();for(var b=0,c=this.glyphs.length;c>b;){var d=(b+c)/2|0;if(d>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[d].min()?c=d:b=d+1}return c};
SubTier.prototype.add=function(a){var b=this.indexFor(a);this.glyphs.splice(b,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};SubTier.prototype.hasSpaceFor=function(a){var b=this.indexFor(a);return 0<b&&this.glyphs[b-1].max()>=a.min()||b<this.glyphs.length&&this.glyphs[b].min()<=a.max()?!1:!0};var GLOBAL_GC;
function drawFeatureTier(a){Date.now();GLOBAL_GC=a.viewport.getContext("2d");sortFeatures(a);var b=[],c={},d={},e;for(e in a.ungroupedFeatures)for(var f=a.ungroupedFeatures[e],g=0;g<f.length;++g){var h=f[g];if(!h.parts){var k=a.styleForFeature(h);if(k)if("LINEPLOT"==k.glyph)pusho(c,k.id,h),d[k.id]=k;else{var l=glyphForFeature(h,0,k,a);l&&b.push(l)}}}for(var m in c)e=c[m],k=d[m],"LINEPLOT"==k.glyph&&b.push(makeLineGlyph(e,k,a));if(a.dasSource.collapseSuperGroups&&!a.bumped)for(var n in a.superGroups){c=
a.superGroups[n];a.groups[n]=shallowCopy(a.groups[n]);a.groups[n].type=a.groups[c[0]].type;d={};m=1E10;f=-1E10;g=null;for(l=0;l<c.length;++l)if(e=a.groupedFeatures[c[l]]){for(k=0;k<e.length;++k)h=e[k],pusho(d,h.type,h),m=Math.min(h.min,m),f=Math.max(h.max,f),h.segment&&!g&&(g=h.segment);if(a.groups[n]&&!a.groups[n].links||0==a.groups[n].links.length)a.groups[n].links=a.groups[c[0]].links;delete a.groupedFeatures[c[l]]}a.groups[n].max=f;a.groups[n].min=m;a.groups[n].segment=g;for(var p in d){e=d[p];
m=e[0];f=null;for(k=0;k<e.length;++k)h=e[k],h=new Range(h.min,h.max),f=f?union(f,h):h;f=f.ranges();for(g=0;g<f.length;++g){for(var r=f[g],q=((r.max()|0)-(r.min()|0)+1)*c.length,s=0,k=0;k<e.length;++k)if(h=e[k],(h.min|0)<=r.max()&&(h.max|0)>=r.min())var v=Math.max(h.min|0,r.min()),h=Math.min(h.max|0,r.max()),s=s+(h-v+1);var h=new DASFeature,t;for(t in m)h[t]=m[t];h.min=r.min();h.max=r.max();h.label&&1<c.length&&(h.label+=" ("+c.length+" vars)");h.visualWeight=1*s/q;pusho(a.groupedFeatures,n,h)}}delete a.superGroups[n]}t=
[];for(var u in a.groupedFeatures)t.push(u);t.sort(function(b,c){var d=a.groupedFeatures[b][0].score-a.groupedFeatures[c][0].score;return 0<d?-1:0==d?0:1});p={};for(h=0;h<t.length;++h)if(u=t[h],l=glyphsForGroup(a.groupedFeatures[u],0,a.groups[u],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))l.group=a.groups[u],p[u]=l;for(n in a.superGroups){c=a.superGroups[n];u=[];m=1E10;f=-1E10;for(t=0;t<c.length;++t)h=p[c[t]],p[c[t]]=null,h&&(u.push(h),m=Math.min(m,h.min()),f=Math.max(f,
h.max()));for(t=0;t<u.length;++t)h=u[t],b.push(new PaddedGlyph(h,m,f))}for(l in p)(h=p[l])&&b.push(h);n=new SubTier;u=[];p=a.dasSource.subtierMax||DEFAULT_SUBTIER_MAX;t=0;a:for(;t<b.length;++t)if(l=b[t],l.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(h=0;h<u.length;++h)if(c=u[h],c.hasSpaceFor(l)){c.add(l);continue a}u.length>=p||(c=new SubTier,c.add(l),u.push(c))}else n.add(l);0<n.glyphs.length&&(u=[n].concat(u));for(h=0;h<u.length;++h)c=u[h],c.quant&&c.glyphs.unshift(new GridGlyph(c.height));
for(h=0;h<u.length;++h)c=u[h],c.glyphs.sort(function(a,b){return(a.zindex||0)-(b.zindex||0)});a.subtiers=u;a.glyphCacheOrigin=a.browser.viewStart;Date.now()}function formatQuantLabel(a){a=""+a;var b=a.indexOf(".");if(0>b)return a;var c=2;"-"==a.substring(0,1)&&++c;return b>=c?a.substring(0,b):a.substring(0,b+2)}
DasTier.prototype.paint=function(){Date.now();var a=this.browser.retina&&1<window.devicePixelRatio,b=this.subtiers;if(b){var c=this.browser.featurePanelWidth+2E3;a&&(c*=2);var d=this.viewport.width|0;d<c-50&&(this.viewport.width=d=c);for(var e=MIN_PADDING,f=0;f<b.length;++f)e=e+b[f].height+MIN_PADDING;f=e=Math.max(e+6,this.browser.minTierHeight);a&&(f*=2);f!=this.viewport.height&&(this.viewport.height=f);Math.max(e,this.browser.minTierHeight);this.viewport.style.left="-1000px";this.viewport.style.width=
a?""+d/2+"px":""+d+"px";this.viewport.style.height=""+e+"px";this.layoutHeight=Math.max(e,this.browser.minTierHeight);this.updateHeight();this.drawOverlay();this.norigin=this.browser.viewStart;c=this.viewport.getContext("2d");c.clearRect(0,0,d,f);c.save();a&&c.scale(2,2);if(this.background&&(c.fillStyle=this.background,this.knownCoverage))for(var f=this.knownCoverage.ranges(),g=0;g<f.length;++g){var h=f[g],k=(h.min()-this.browser.viewStart)*this.browser.scale+1E3,h=(h.max()-this.browser.viewStart)*
this.browser.scale+1E3;c.fillRect(k,0,h-k,e)}e=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;c.translate(e,MIN_PADDING);for(f=0;f<b.length;++f){for(var l=null,g=b[f].glyphs,k=0;k<g.length;++k)h=g[k],h.min()<d-e&&h.max()>-e&&(h=g[k],h.draw(c),h.quant&&(l=h.quant));c.translate(0,b[f].height+MIN_PADDING)}c.restore();l&&(this.quantLeapThreshold&&this.featureSource&&sourceAdapterIsCapable(this.featureSource,"quantLeap"))&&(b=3+b[0].height*(1-(this.quantLeapThreshold-l.min)/(l.max-
l.min)),c.save(),a&&c.scale(2,2),c.strokeStyle="red",c.lineWidth=0.3,c.beginPath(),c.moveTo(0,b),c.lineTo(5E3,b),c.stroke(),c.restore());this.paintQuant();Date.now()}};
DasTier.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,b;this.subtiers&&0<this.subtiers.length&&(b=this.subtiers[0].quant);if(b){var c=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var d=this.quantOverlay.getContext("2d");
a&&d.scale(2,2);a=2;40<c&&(a=1+(c/20|0));var e=(c+2*MIN_PADDING)/(a-1),f=(b.max-b.min)/(a-1);d.fillStyle="white";d.globalAlpha=0.6;"right"==this.browser.rulerLocation?d.fillRect(20,0,30,c+2*MIN_PADDING):d.fillRect(0,0,30,c+2*MIN_PADDING);d.globalAlpha=1;d.strokeStyle="black";d.lineWidth=1;d.beginPath();if("right"==this.browser.rulerLocation){d.moveTo(42,MIN_PADDING);d.lineTo(50,MIN_PADDING);d.lineTo(50,c+MIN_PADDING);d.lineTo(42,c+MIN_PADDING);for(var g=1;g<a-1;++g){var h=g*e;d.moveTo(50,h);d.lineTo(45,
h)}}else{d.moveTo(8,MIN_PADDING);d.lineTo(0,MIN_PADDING);d.lineTo(0,c+MIN_PADDING);d.lineTo(8,c+MIN_PADDING);for(g=1;g<a-1;++g)h=g*e,d.moveTo(0,h),d.lineTo(5,h)}d.stroke();d.fillStyle="black";if("right"==this.browser.rulerLocation){d.textAlign="right";d.fillText(formatQuantLabel(b.max),41,8);d.fillText(formatQuantLabel(b.min),41,c+MIN_PADDING);for(g=1;g<a-1;++g)h=g*e,d.fillText(formatQuantLabel(1*b.max-g*f),41,h+3)}else{d.textAlign="left";d.fillText(formatQuantLabel(b.max),9,8);d.fillText(formatQuantLabel(b.min),
9,c+MIN_PADDING);for(g=1;g<a-1;++g)h=g*e,d.fillText(formatQuantLabel(1*b.max-g*f),9,h+3)}}else this.quantOverlay.style.display="none"}};
function glyphsForGroup(a,b,c,d,e){e=d.styleForFeature(c);var f,g=[];b=null;for(var h=0;h<a.length;++h){var k=a[h];k.orientation&&null==b&&(b=k.orientation);!f&&k.label&&(f=k.label);var l=d.styleForFeature(k);l&&!k.parts&&(k=glyphForFeature(k,0,l,d,null,!0))&&g.push(k)}if(0==g.length)return null;a="flat";d.dasSource.collapseSuperGroups&&!d.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-");d=null;if(f||e&&(e.LABEL||e.LABELS))d=c.label||f;c=new GroupGlyph(g,
a);d&&("+"===b?d=">"+d:"-"===b&&(d="<"+d),c=new LabelledGlyph(c,d,!1));c.bump=!0;return c}
function glyphForFeature(a,b,c,d,e,f){var g=d.browser.scale,h=d.browser.viewStart,k=c.glyph||"BOX",l=a.min,m=a.max,n=a.orientation,p=a.score,r=a.label||a.id,q=(l-h)*g,s=Math.max((m-h+1)*g,q+1),v=d.forceHeight||c.HEIGHT||e||12,t=v*=1,h=c.BUMP&&isDasBooleanTrue(c.BUMP),u;if("CROSS"===k||"EX"===k||"TRIANGLE"===k||"DOT"===k||"SQUARE"===k||"STAR"===k||"PLIMSOLL"===k){var w=c.FGCOLOR||"black",l=c.BGCOLOR||"none",g=c.STROKECOLOR;if(c.BGITEM&&a.itemRgb)w=a.itemRgb;else if(isDasBooleanTrue(c.COLOR_BY_SCORE2)&&
(m=c.BGGRAD||c._gradient,m||(m=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=m),v=a.score2,void 0!=v||!w))t=c.MIN2?1*c.MIN2:0,t=(1*(v||0)-t)/((c.MAX2?1*c.MAX2:1)-t)*m.length|0,0>t&&(t=0),t>=m.length&&(t=m.length-1),w=m[t];v=d.forceHeight||c.HEIGHT||e||12;t=v*=1;e=c.SIZE||v;c.RSIZE&&(e=1*c.RSIZE*v);c.STROKETHRESHOLD&&e<1*c.STROKETHRESHOLD&&(g=null);e*=1;v=(q+s)/2;m=e/2;"EX"===k?g=new ExGlyph(v,e,w):"TRIANGLE"===k?g=new TriangleGlyph(v,e,c.DIRECTION||"N",c.LINEWIDTH||e,w,g):"DOT"===k?g=new DotGlyph(v,
e,w,g):"PLIMSOLL"===k?g=new PlimsollGlyph(v,e,0.2*e,w,g):"SQUARE"===k?g=new BoxGlyph(v-m,0,e,e,w,g):"STAR"===k?(k=5,c.POINTS&&(k=c.POINTS|0),g=new StarGlyph(v,m,k,w,g)):g=new CrossGlyph(v,e,w);l&&("none"!=l&&5<s-q)&&(q=new BoxGlyph(q,0,s-q,e,l),g=new GroupGlyph([q,g]));if(isDasBooleanTrue(c.SCATTER)){l=d.quantMin(c);(w=d.quantMax(c))||(w=0>l?0:10);l||(l=0);d=(1*p-l)/(w-l);p=-1*l/(w-l);if(0>d||1<d)return null;d>=p?(v=Math.max(1,(d-p)*t),b=b+(1-p)*t-v):(Math.max(1,(d-p)*t),b+=(1-p)*t);u={min:l,max:w};
q=0;s="undefined"!==typeof a.forceLabel?a.forceLabel:c.LABEL;isDasBooleanNotFalse(s)&&(r&&!f)&&(g=new LabelledGlyph(g,r,!0,null,"above"==s?"above":"below"),"above"==s&&(q=g.textHeight+2),f=!0);g=new TranslatedGlyph(g,0,b-m-q,t)}}else if("HISTOGRAM"===k||"GRADIENT"===k&&"undefined"!==p)l=d.quantMin(c),(w=d.quantMax(c))||(w=0>l?0:10),l||(l=0),1*p<1*l&&(p=l),1*p>1*w&&(p=w),d=(1*p-l)/(w-l),p=-1*l/(w-l),"HISTOGRAM"===k&&(d>=p?(v=Math.max(1,(d-p)*t),b=b+(1-p)*t-v):(v=Math.max(1,(p-d)*t),b+=(1-p)*t),u={min:l,
max:w}),w=c.FGCOLOR||null,l=c.BGCOLOR||c.COLOR1||"green",c.BGITEM&&a.itemRgb&&(l=a.itemRgb),p=c.ALPHA?1*c.ALPHA:null,c.BGGRAD&&(m=c.BGGRAD,t=d*m.length|0,0>t&&(t=0),t>=m.length&&(t=m.length-1),l=m[t]),c.COLOR2&&(m=c._gradient,m||(m=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=m),t=d*m.length|0,0>t&&(t=0),t>=m.length&&(t=m.length-1),l=m[t]),g=new BoxGlyph(q,b,s-q,v,l,w,p);else if("HIDDEN"===k)g=new PaddedGlyph(null,q,s),f=!0;else if("ARROW"===k)d=c.FGCOLOR||"purple",b=isDasBooleanTrue(c.PARALLEL),
l=isDasBooleanTrue(c.SOUTHWEST),m=isDasBooleanTrue(c.NORTHEAST),g=new ArrowGlyph(q,s,v,d,b,l,m);else if("ANCHORED_ARROW"===k)w=c.FGCOLOR||"none",l=c.BGCOLOR||"green",g=new AArrowGlyph(q,s,v,l,w,n),g.bump=!0;else if("SPAN"===k)w=c.FGCOLOR||"black",g=new SpanGlyph(q,s,v,w);else if("LINE"===k)w=c.FGCOLOR||"black",g=new LineGlyph(q,s,v,c.STYLE||"solid",n,w);else if("PRIMERS"===k)w=c.FGCOLOR||"black",l=c.BGCOLOR||"red",g=new PrimersGlyph(q,s,v,l,w);else if("TEXT"===k)d=c.STRING||"text",l=c.FGCOLOR||"black",
g=new TextGlyph(q,s,v,l,d);else if("TOOMANY"===k)w=c.FGCOLOR||"gray",l=c.BGCOLOR||"orange",g=new TooManyGlyph(q,s,v,l,w);else if("POINT"===k)v=d.forceHeight||c.HEIGHT||30,l=d.quantMin(c),w=d.quantMax(c),d=(1*p-l)/(w-l),b=(p-1*l)*(1*v/(w-l))|0,u={min:l,max:w},l=c.FGCOLOR||c.COLOR1||"black",c.COLOR2&&(m=c._gradient,m||(m=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=m),t=d*m.length|0,0>t&&(t=0),t>=m.length&&(t=m.length-1),l=m[t]),g=new PointGlyph((q+s)/2,v-b,v,l);else if("__SEQUENCE"===k){k=
w=a.seq;t=e=a.quals;b=isDasBooleanTrue(c.__INSERTIONS);p=[];if(a.cigar)for(var n=parseCigar(a.cigar),t=k="",x=0,B=0;B<n.length;++B){var y=n[B];if("M"==y.op)k+=w.substr(x,y.cnt),t+=e.substr(x,y.cnt),x+=y.cnt;else if("D"==y.op)for(var A=0;A<y.cnt;++A)k+="-",t+="Z";else if("I"==y.op){var C=w.substr(x,y.cnt),A=new TriangleGlyph(q+k.length*g,5,"S",5,"red");b&&(A=new LabelledGlyph(A,C,!1,"center","above","7px sans-serif"));A.feature={label:"Insertion: "+C,type:"insertion",method:"insertion"};p.push(A);
x+=y.cnt}else"S"==y.op?x+=y.cnt:console.log("unknown cigop"+y.op)}g=null;if(d.currentSequence&&(w=d.currentSequence.start|0,n=d.currentSequence.end|0,w<=m&&n>=l)){e=Math.max(l,w);n=Math.min(m,n);for(g=d.currentSequence.seq.substr(e-w,n-e+1);l<e;)g="N"+g,e--;for(;m>n;)g+="N",n++}g=new SequenceGlyph(q,s,v,k,g,c.__SEQCOLOR,t);b&&(g=new TranslatedGlyph(g,0,7));0<p.length&&(p.splice(0,0,g),g=new GroupGlyph(p))}else if("__INSERTION"===k)A=new TriangleGlyph(q,5,"S",5,"red"),g=new LabelledGlyph(A,a.insertion||
a.altAlleles[0],!1,"center","above","7px sans-serif"),1<s-q&&(l=c.BGCOLOR||c.COLOR1||"green",q=new BoxGlyph(q,5,s-q,v,l,w),g=new GroupGlyph([q,g]));else{if("__NONE"===k)return null;w=c.FGCOLOR||null;l=c.BGCOLOR||c.COLOR1||"green";c.BGITEM&&a.itemRgb&&(l=a.itemRgb);g=new BoxGlyph(q,0,s-q,v,l,w)}if((isDasBooleanTrue(c.LABEL)||a.forceLabel)&&r&&!f)g=new LabelledGlyph(g,r,!1);h&&(g.bump=!0);g.feature=a;u&&(g.quant=u);c.ZINDEX&&(g.zindex=c.ZINDEX|0);return g}
DasTier.prototype.styleForFeature=function(a){var b=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var c=null,d=this.stylesheet.styles,e=0;e<d.length;++e){var f=d[e];if(!(f.zoom&&f.zoom!=b)&&!(f.orientation&&f.orientation!=a.orientation)){var g=f._labelRE;if(!g||!g.test)g=RegExp("^"+f.label+"$"),f._labelRE=g;if(!f.label||g.test(a.label)){g=f._methodRE;if(!g||!g.test)g=RegExp("^"+f.method+"$"),f._methodRE=g;if(!f.method||g.test(a.method)){if(f.type)if("default"==f.type){c||
(c=f.style);continue}else{g=f._typeRE;if(!g||!g.test)g=RegExp("^"+f.type+"$"),f._typeRE=g;if(!g.test(a.type))continue}return f.style}}}}return c};
function makeLineGlyph(a,b,c){var d=c.browser.viewStart,e=c.browser.scale,f=c.forceHeight||b.HEIGHT||30,g=c.quantMin(b);c=c.quantMax(b);for(var h=1*f/(c-g),k=b.FGCOLOR||b.COLOR1||"black",l=[],m=0;m<a.length;++m){var n=a[m],p=f-((n.score-1*g)*h|0);l.push((((n.min|0)+(n.max|0))/2-d)*e);l.push(p)}a=new LineGraphGlyph(l,k,f);a.quant={min:g,max:c};b.ZINDEX&&(a.zindex=b.ZINDEX|0);return a}
DasTier.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};DasTier.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"use strict";var MIN_TILE=100,rulerTileColors=["black","white"],baseColors={A:"green",C:"blue",G:"black",T:"red"},steps=[1,2,5];
function tileSizeForScale(a,b){b||(b=MIN_TILE);for(var c=steps.length;a*steps[c%steps.length]*Math.pow(10,c/steps.length|0)<b;)++c;return steps[c%steps.length]*Math.pow(10,c/steps.length|0)}
function drawSeqTier(a,b){var c=a.browser.retina&&1<window.devicePixelRatio,d=a.browser.scale,e=a.browser.viewStart-1E3/d|0,f=a.browser.viewEnd+2E3/d,g=a.browser.currentSeqMax,h=a.browser.featurePanelWidth+2E3;c&&(h*=2);var k=a.viewport.width|0;k<h-50&&(a.viewport.width=k=h);h=50;b&&b.seq&&(h+=25);var l=h;c&&(l*=2);a.viewport.height=l;a.viewport.style.height=""+h+"px";a.viewport.style.width=c?""+k/2+"px":""+k+"px";a.layoutHeight=h;a.updateHeight();h=a.viewport.getContext("2d");a.background&&(h.fillStyle=
a.background,h.fillRect(0,0,k,a.viewport.height));c&&h.scale(2,2);h.translate(1E3,0);c=f;0<g&&g<f&&(c=g);k=tileSizeForScale(d);l=Math.max(0,(e/k|0)*k);for(g=a.browser.viewStart;l<=c;)h.fillStyle=0==l/k%2?"white":"black",h.strokeStyle="black",h.fillRect((l-g)*d,8,k*d,3),h.strokeRect((l-g)*d,8,k*d,3),h.fillStyle="black",h.fillText(formatLongInt(l),(l-g)*d,22),l+=k;if(b&&b.seq)for(;e<=f;++e)e>=b.start&&e<=b.end&&(c=b.seq.substr(e-b.start,1).toUpperCase(),(k=baseColors[c])||(k="gray"),h.fillStyle=k,8<=
d?h.fillText(c,(e-g)*d,52):h.fillRect((e-g)*d,42,d,12));a.norigin=a.browser.viewStart;a.viewport.style.left="-1000px"}
function svgSeqTier(a,b){var c=a.browser.scale,d=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,f=a.browser.currentSeqMax,g=e;0<f&&f<e&&(g=f);for(var h=tileSizeForScale(c),k=Math.max(0,(d/h|0)*h),f=a.browser.viewStart,l=makeElementNS(NS_SVG,"g",[],{fontSize:"8pt"});k<=g;)l.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(k-f)*c,y:8,width:h*c,height:3,fill:0==k/h%2?"white":"black",stroke:"black"})),l.appendChild(makeElementNS(NS_SVG,"text",formatLongInt(k),{x:(k-f)*c,y:28,fill:"black",stroke:"none"})),
k+=h;if(b&&b.seq)for(;d<=e;++d)d>=b.start&&d<=b.end&&(g=b.seq.substr(d-b.start,1).toUpperCase(),(h=baseColors[g])||(h="gray"),8<=c?l.appendChild(makeElementNS(NS_SVG,"text",g,{x:(d-f)*c,y:52,fill:h})):l.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(d-f)*c,y:42,width:c,height:12,fill:h})));return l}"use strict";
function sortFeatures(a){for(var b=a.browser.drawnStart,c=a.browser.drawnEnd,d={},e={},f={},g={},h={},k={},l={},m={},n=[],p,r,q,s=function(){q={};for(var b=0;b<a.currentFeatures.length;++b){var c=a.currentFeatures[b];c.id&&(q[c.id]=c)}},v=function(a){var b=[];if(a.parents)for(var c=0;c<a.parents.length;++c){var d=a.parents[c],e=q[d];e&&"SO:0000704"==e.typeCv&&pushnew(b,d)}return b},t=0;t<a.currentFeatures.length;++t){var u=a.currentFeatures[t];if(!u.parts){var w=u.min<=c&&u.max>=b;if(!u.min||!u.max)n.push(u);
else{if(u.score&&"."!=u.score&&"-"!=u.score){var x=1*u.score;if(!p||x<p)p=x;if(!r||x>r)r=x}var x=[],B=null;if(u.groups)for(var y=0;y<u.groups.length;++y){var A=u.groups[y],C=A.id;if("gene"==A.type)B=C,k[C]=A;else if("translation"!=A.type){pusho(e,C,u);k[C]=A;x.push(C);A=g[C];if(!A||u.min<A)g[C]=u.min;A=h[C];if(!A||u.max>A)h[C]=u.max}}if(u.parents){q||s();for(y=0;y<u.parents.length;++y){var E=u.parents[y],H=q[E];if(H){H.parts||(H.parts=[u]);pushnewo(e,E,H);pusho(e,E,u);k[E]||(k[E]={type:H.type,id:H.id,
label:H.label||H.id});x.push(E);A=g[E];if(!A||u.min<A)g[E]=u.min;A=h[E];if(!A||u.max>A)h[E]=u.max;A=v(H);0<A.length&&(B=A[0],E=q[A[0]],k[A[0]]={type:E.type,id:E.id,label:E.label||E.id},a.dasSource.collapseSuperGroups||(a.dasSource.collapseSuperGroups=!0))}}}if(0==x.length)w&&pusho(d,u.type,u);else if(B)for(A=0;A<x.length;++A)C=x[A],pushnewo(l,B,C),m[C]=B}}}for(C in e)n=k[C],"number"!==typeof n.min&&(n.min=g[C]),"number"!==typeof n.max&&(n.max=h[C]),h[C]>=b&&g[C]<=c&&(f[C]=e[C]);a.ungroupedFeatures=
d;a.groupedFeatures=f;a.groups=k;a.superGroups=l;a.groupsToSupers=m;p&&(0<p?p=0:0>r&&(r=0),a.currentFeaturesMinScore=p,a.currentFeaturesMaxScore=r)}"use strict";TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;Browser.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
function FeatureInfo(a,b,c){var d=pick(c.type,b.type),e=pick(c.label,b.label,c.id,b.id);e&&0!=e.indexOf("__dazzle")&&(d=d+": "+e);this.hit=a;this.feature=b;this.group=c;this.title=d;this.sections=[]}FeatureInfo.prototype.setTitle=function(a){this.title=a};FeatureInfo.prototype.add=function(a,b){"string"===typeof b&&(b=makeElement("span",b));this.sections.push({label:a,info:b})};
Browser.prototype.featurePopup=function(a,b,c,d){var e=c.length;b=0<=--e?c[e]:{};var f=0<=--e?c[e]:{};c=new FeatureInfo(c,b,f);c.tier=d;for(var e=this.featureInfoPlugins||[],g=0;g<e.length;++g)try{e[g](b,c)}catch(h){console.log(h.stack||h)}e=d.featureInfoPlugins||[];for(g=0;g<e.length;++g)try{e[g](b,c)}catch(k){console.log(k.stack||k)}this.removeAllPopups();d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";e=0;b.method&&(g=makeElement("tr",
[makeElement("th","Method"),makeElement("td",b.method)]),d.appendChild(g),++e);g=f.segment?f:b;g=makeElement("tr",[makeElement("th","Location"),makeElement("td",g.segment+":"+g.min+"-"+g.max)]);d.appendChild(g);++e;void 0!==b.score&&(null!==b.score&&"-"!=b.score)&&(g=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+b.score)]),d.appendChild(g),++e);if((g=maybeConcat(f.links,b.links))&&0<g.length)g=makeElement("tr",[makeElement("th","Links"),makeElement("td",g.map(function(a){return makeElement("div",
makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(g),++e;b=maybeConcat(f.notes,b.notes);for(f=0;f<b.length;++f){var g="Note",l=b[f],m=l.match(TAGVAL_NOTE_RE);m&&(g=m[1],l=m[2]);g=makeElement("tr",[makeElement("th",g),makeElement("td",l)]);d.appendChild(g);++e}for(b=0;b<c.sections.length;++b)e=c.sections[b],d.appendChild(makeElement("tr",[makeElement("th",e.label),makeElement("td",e.info)]));this.popit(a,c.title||"Feature",d,{width:400})};"use strict";
function Karyoscape(a,b){this.browser=a;this.dsn=b;this.svg=makeElementNS(NS_SVG,"g");this.width=250}Karyoscape.prototype.update=function(a,b,c){this.start=b;this.end=c;if(!this.chr||a!=this.chr){this.chr=a;removeChildren(this.svg);var d=this;this.dsn.features(new DASSegment(a),{type:"karyotype"},function(b,c,g){d.chrLen=g&&g[a]&&g[a].max?g[a].max:null;d.karyos=b||[];d.redraw()})}else this.setThumb()};
var karyo_palette={gneg:"white",gpos25:"rgb(200,200,200)",gpos33:"rgb(180,180,180)",gpos50:"rgb(128,128,128)",gpos66:"rgb(100,100,100)",gpos75:"rgb(64,64,64)",gpos100:"rgb(0,0,0)",gpos:"rgb(0,0,0)",gvar:"rgb(100,100,100)",acen:"rgb(100,100,100)",stalk:"rgb(100,100,100)"};
Karyoscape.prototype.redraw=function(){removeChildren(this.svg);this.karyos=this.karyos.sort(function(a,b){return(a.min|0)-(b.min|0)});0<this.karyos.length?this.chrLen||(this.chrLen=this.karyos[this.karyos.length-1].max):(this.chrLen||(alert("Warning: insufficient data to set up spatial navigator"),this.chrLen=2E8),this.karyos.push({min:1,max:this.chrLen,label:"gneg"}));for(var a=null,b=0;b<this.karyos.length;++b){var c=this.karyos[b],d=1*c.min/this.chrLen*this.width,e=1*c.max/this.chrLen*this.width,
f=karyo_palette[c.label];f&&e>d&&(d=makeElementNS(NS_SVG,"rect",null,{x:d,y:"stalk"==c.label||"acen"==c.label?5:0,width:e-d,height:"stalk"==c.label||"acen"==c.label?5:15,stroke:"none",fill:f}),"g"==c.label.substring(0,1)&&(e=new Range(c.min,c.max),a=null==a?e:union(a,e)),this.browser.makeTooltip(d,c.id),this.svg.appendChild(d))}if(a){for(var a=a.ranges(),b="M 0 10 L 0 0",c="M 0 5 L 0 15",g=f=0;g<a.length;++g)e=a[g],d=1*e.min()/this.chrLen*this.width,e=1*e.max()/this.chrLen*this.width,0.75<d-f&&(b+=
" M "+d+" 0",c+=" M "+d+" 15"),b+=" L "+e+" 0",c+=" L "+e+" 15",f=e;0.75<this.width-f?(b+=" M "+this.width+" 0",c+=" M "+this.width+" 15"):(b+=" L "+this.width+" 0",c+=" L "+this.width+" 15");b+=" L "+this.width+" 10";c+=" L "+this.width+" 5";this.svg.appendChild(makeElementNS(NS_SVG,"path",null,{d:b+" "+c,stroke:"black",strokeWidth:2,fill:"none"}))}this.thumb=makeElementNS(NS_SVG,"rect",null,{x:50,y:-5,width:8,height:25,fill:"blue",fillOpacity:0.5,stroke:"none"});this.svg.appendChild(this.thumb);
this.setThumb();var h=this,k,l=function(a){a.stopPropagation();a.preventDefault();a=Math.max(-4,Math.min(a.clientX+k,h.width-4));h.thumb.setAttribute("x",a)},m=function(a){a.stopPropagation();a.preventDefault();if(h.onchange)h.onchange(1*((h.thumb.getAttribute("x")|0)+4)/h.width,!0);document.removeEventListener("mousemove",l,!0);document.removeEventListener("mouseup",m,!0)};this.thumb.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();k=h.thumb.getAttribute("x")-a.clientX;
document.addEventListener("mousemove",l,!0);document.addEventListener("mouseup",m,!0)},!1)};Karyoscape.prototype.setThumb=function(){var a=1*(((this.start|0)+(this.end|0))/2)/this.chrLen*this.width;this.thumb&&this.thumb.setAttribute("x",a-4)};"use strict";function FetchPool(){this.reqs=[];this.awaitedFeatures={}}FetchPool.prototype.addRequest=function(a){this.reqs.push(a)};FetchPool.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
function KSCacheBaton(a,b,c,d,e,f,g){this.chr=a;this.min=b;this.max=c;this.coverage=g;this.scale=d;this.features=e||[];this.status=f}KSCacheBaton.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};function KnownSpace(a,b,c,d,e,f){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=e;this.seqSource=f||new DummySequenceSource;this.viewCount=0;this.featureCache={};this.latestViews={}}
KnownSpace.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};KnownSpace.prototype.viewFeatures=function(a,b,c,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=c;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new FetchPool;this.awaitedSeq=new Awaited;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap)};
function filterFeatures(a,b,c){for(var d=[],e={},f=0;f<a.length;++f){var g=a[f];!g.min||!g.max?d.push(g):g.groups&&0<g.groups.length?pusho(e,g.groups[0].id,g):g.min<=c&&g.max>=b&&d.push(g)}for(var h in e){a=e[h];for(var k=1E11,l=-1E11,f=0;f<a.length;++f)g=a[f],k=Math.min(k,g.min),l=Math.max(l,g.max);if(k<=c||l>=b)for(f=0;f<a.length;++f)d.push(a[f])}return d}KnownSpace.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};
KnownSpace.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,d=!1,e,f=0;f<a.length;++f)try{this.startFetchesFor(a[f],c)&&(d=!0)}catch(g){a[f].updateStatus(g),console.log("Error fetching tier source"),console.log(g),e=g}if(d&&!this.seqWasFetched){this.seqWasFetched=!0;var h=this.min,k=this.max;if(this.cs&&this.cs.start<=h&&this.cs.end>=k)return a=this.cs.start==h&&this.cs.end==k?this.cs:new DASSequence(this.cs.name,h,k,this.cs.alphabet,this.cs.seq.substring(h-this.cs.start,
k+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,h,k,this.pool,function(a,d){if(d){if(!b.cs||h<=b.cs.start&&k>=b.cs.end||h>=b.cs.end||k<=b.cs.start||k-h>b.cs.end-b.cs.start)b.cs=d;c.provide(d)}else dlog("Noseq: "+miniJSONify(a)),c.provide(null)})}if(e)throw e;};
KnownSpace.prototype.startFetchesFor=function(a,b){var c=this,d=this.viewCount,e=a.getSource()||new DummyFeatureSource,f=a.needsSequence(this.scale),g=c.featureCache[a],h=a.getDesiredTypes(this.scale),k=this.chr,l=this.min,m=this.max;if(void 0===h)return!1;if(g&&g.chr===this.chr&&g.min<=l&&g.max>=m){var n=g.features;if(g.min<l||g.max>m)n=filterFeatures(n,l,m);c.provision(a,g.chr,intersection(g.coverage,new Range(l,m)),g.scale,h,n,g.status,f?b:null);n=e.getScales();if(g.scale<=this.scale||!n)return f}e.instrument&&
console.log("Starting  fetch "+d+" ("+l+", "+m+")");e.fetch(k,l,m,this.scale,h,this.pool,function(n,r,q,s){e.instrument&&console.log("Finishing fetch "+d);if(!((c.latestViews[a]||-1)>d)){s||(s=new Range(l,m));if(!g||l<g.min||m>g.max)c.featureCache[a]=new KSCacheBaton(k,l,m,q,r,n,s);c.latestViews[a]=d;c.provision(a,k,s,q,h,r,n,f?b:null)}});return f};
KnownSpace.prototype.provision=function(a,b,c,d,e,f,g,h){a.updateStatus(g);if(!g){g=!1;for(var k=a.getSource();MappedFeatureSource.prototype.isPrototypeOf(k)||CachingFeatureSource.prototype.isPrototypeOf(k)||OverlayFeatureSource.prototype.isPrototypeOf(k);)k=OverlayFeatureSource.prototype.isPrototypeOf(k)?k.sources[0]:k.source;if(BWGFeatureSource.prototype.isPrototypeOf(k)||RemoteBWGFeatureSource.prototype.isPrototypeOf(k)||BAMFeatureSource.prototype.isPrototypeOf(k)||RemoteBAMFeatureSource.prototype.isPrototypeOf(k))g=
!0;if(!k.opts||!k.opts.forceReduction&&!k.opts.noDownsample)if(d<this.scale/2&&200<f.length||g&&e&&1==e.length&&0<=e.indexOf("density"))f=downsample(f,this.scale);h?h.await(function(e){a.viewFeatures(b,c,d,f,e)}):a.viewFeatures(b,c,d,f)}};"use strict";var __DS_SCALES=[1,2,5];function ds_scale(a){return __DS_SCALES[a%__DS_SCALES.length]*Math.pow(10,a/__DS_SCALES.length|0)}function DSBin(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=c;this.features=[]}
function _featureOrder(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}DSBin.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(_featureOrder);for(var b=-1E10,c=0,d=0,e=1;e<a.length;++e){var f=a[e],g=Math.max(f.min,this.min),f=Math.min(f.max,this.max),d=d+(f-g+1);g>b?(c+=f-g+1,b=f):f>b&&(c+=f-b,b=f)}return 0<c?1*d/c:0};
DSBin.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};
function downsample(a,b){for(var c=0;ds_scale(c+1)<b;)++c;for(var c=ds_scale(c),d=[],e=-1E10,f=1E10,g=0;g<a.length;++g){var h=a[g];if(h.groups&&0<h.groups.length)return a;for(var k=h.min/c|0,l=h.max/c|0,e=Math.max(e,l),f=Math.min(f,k);k<=l;++k){var m=d[k];m||(m=new DSBin(c,k*c,(k+1)*c-1),d[k]=m);m.feature(h)}}g=[];for(k=f;k<=e;++k)if(m=d[k])h=new DASFeature,h.segment=a[0].segment,h.min=k*c+1,h.max=(k+1)*c,h.score=m.score(),h.type="density",g.push(h);Date.now();return g}"use strict";
var hexcase=0,b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}
function any_hmac_sha1(a,b,c){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)),c)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),8*a.length))}
function rstr_hmac_sha1(a,b){var c=rstr2binb(a);16<c.length&&(c=binb_sha1(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=c[f]^909522486,e[f]=c[f]^1549556828;c=binb_sha1(d.concat(rstr2binb(b)),512+8*b.length);return binb2rstr(binb_sha1(e.concat(c),672))}function rstr2hex(a){try{hexcase}catch(b){hexcase=0}for(var c=hexcase?"0123456789ABCDEF":"0123456789abcdef",d="",e,f=0;f<a.length;f++)e=a.charCodeAt(f),d+=c.charAt(e>>>4&15)+c.charAt(e&15);return d}
function rstr2b64(a){try{b64pad}catch(b){b64pad=""}for(var c="",d=a.length,e=0;e<d;e+=3)for(var f=a.charCodeAt(e)<<16|(e+1<d?a.charCodeAt(e+1)<<8:0)|(e+2<d?a.charCodeAt(e+2):0),g=0;4>g;g++)c=8*e+6*g>8*a.length?c+b64pad:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6*(3-g)&63);return c}
function rstr2any(a,b){var c=b.length,d=[],e,f,g,h,k=Array(Math.ceil(a.length/2));for(e=0;e<k.length;e++)k[e]=a.charCodeAt(2*e)<<8|a.charCodeAt(2*e+1);for(;0<k.length;){h=[];for(e=g=0;e<k.length;e++)if(g=(g<<16)+k[e],f=Math.floor(g/c),g-=f*c,0<h.length||0<f)h[h.length]=f;d[d.length]=g;k=h}c="";for(e=d.length-1;0<=e;e--)c+=b.charAt(d[e]);d=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2)));for(e=c.length;e<d;e++)c=b[0]+c;return c}
function str2rstr_utf8(a){for(var b="",c=-1,d,e;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=d&&(56319>=d&&56320<=e&&57343>=e)&&(d=65536+((d&1023)<<10)+(e&1023),c++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b}
function str2rstr_utf16le(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b}function str2rstr_utf16be(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b}function rstr2binb(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}
function binb2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}
function binb_sha1(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,f=-1732584194,g=271733878,h=-1009589776,k=0;k<a.length;k+=16){for(var l=d,m=e,n=f,p=g,r=h,q=0;80>q;q++){c[q]=16>q?a[k+q]:bit_rol(c[q-3]^c[q-8]^c[q-14]^c[q-16],1);var s=safe_add(safe_add(bit_rol(d,5),sha1_ft(q,e,f,g)),safe_add(safe_add(h,c[q]),sha1_kt(q))),h=g,g=f,f=bit_rol(e,30),e=d,d=s}d=safe_add(d,l);e=safe_add(e,m);f=safe_add(f,n);g=safe_add(g,p);h=safe_add(h,r)}return[d,e,f,g,h]}
function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}
Browser.prototype.makeSVG=function(a){a=a||{};var b=a.minTierHeight||20,c=document.implementation.createDocument(NS_SVG,"svg",null),d=makeElementNS(NS_SVG,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});c.documentElement.appendChild(d);var e=makeElementNS(NS_SVG,"a",makeElementNS(NS_SVG,"text","Graphics from Dalliance "+VERSION,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));e.setAttribute("xmlns:xlink",NS_XLINK);e.setAttribute("xlink:href",
"http://www.biodalliance.org/");d.appendChild(e);e=makeElementNS(NS_SVG,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});e=makeElementNS(NS_SVG,"clipPath",e,{id:"featureClip"});d.appendChild(e);for(var e=70,f=makeElementNS(NS_SVG,"g",null,{}),g=0;g<this.tiers.length;++g){var h=this.tiers[g],k=makeElementNS(NS_SVG,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),l=makeElementNS(NS_SVG,"g"),m=e,n=makeElementNS(NS_SVG,"rect",null,{x:0,y:m,width:"10000",height:50,fill:h.background});
k.appendChild(n);if("sequence"===h.dasSource.tier_type){var p=svgSeqTier(h,h.currentSequence);k.appendChild(makeElementNS(NS_SVG,"g",p,{transform:"translate(200, "+e+")"}));e+=80}else{if(!h.subtiers)continue;for(var p=(h.glyphCacheOrigin-this.viewStart)*this.scale,r=!1,q=0;q<h.subtiers.length;++q){for(var e=e+3,s=h.subtiers[q],v=[],t=0;t<s.glyphs.length;++t)v.push(s.glyphs[t].toSVG());k.appendChild(makeElementNS(NS_SVG,"g",v,{transform:"translate("+(200+p)+", "+e+")"}));if(s.quant){var r=!0,v=s.quant,
u=s.height,t=2;40<u&&(t=1+(u/20|0));var u=u/(t-1),w=(v.max-v.min)/(t-1),x=new SVGPath;x.moveTo(205,e);x.lineTo(200,e);x.lineTo(200,e+s.height);x.lineTo(205,e+s.height);for(var B=1;B<t-1;++B){var y=B*u;x.moveTo(200,e+y);x.lineTo(203,e+y)}l.appendChild(makeElementNS(NS_SVG,"path",null,{d:x.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));l.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(v.max),{x:197,y:e+7,textAnchor:"end"}));l.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(v.min),
{x:197,y:e+s.height,textAnchor:"end"}));for(B=1;B<t-1;++B)y=B*u,l.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(1*v.max-B*w),{x:197,y:e+y+3,textAnchor:"end"}))}e+=s.height+3}e-m<b&&(e=m+b)}l.appendChild(makeElementNS(NS_SVG,"text","string"===typeof h.config.name?h.config.name:h.dasSource.name,{x:200-(r?20:12),y:(e+m+8)/2,fontSize:"10pt",textAnchor:"end"}));n.setAttribute("height",e-m);f.appendChild(makeElementNS(NS_SVG,"g",[k,l]))}if(a.highlights){b=this.highlights||[];for(r=0;r<b.length;++r)if(u=
b[r],(u.chr==this.chr||u.chr=="chr"+this.chr)&&u.min<this.viewEnd&&u.max>this.viewStart)g=(Math.max(u.min,this.viewStart)-this.viewStart)*this.scale,h=(Math.min(u.max,this.viewEnd)-this.viewStart)*this.scale,f.appendChild(makeElementNS(NS_SVG,"rect",null,{x:200+g,y:70,width:h-g,height:e-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha}))}b=-1;"center"==a.ruler?b=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==a.ruler?b=200:"right"==a.ruler&&(b=200+(this.viewEnd-
this.viewStart+1)*this.scale);0<=b&&f.appendChild(makeElementNS(NS_SVG,"line",null,{x1:b,y1:70,x2:b,y2:e,stroke:"blue"}));d.appendChild(f);c.documentElement.setAttribute("width",this.featurePanelWidth+20+200);c.documentElement.setAttribute("height",e+50);return new Blob([(new XMLSerializer).serializeToString(c)],{type:"image/svg+xml"})};"use strict";function Range(a,b){if("number"!=typeof a||"number"!=typeof b)throw"Bad range "+a+","+b;this._min=a;this._max=b}Range.prototype.min=function(){return this._min};
Range.prototype.max=function(){return this._max};Range.prototype.contains=function(a){return a>=this._min&&a<=this._max};Range.prototype.isContiguous=function(){return!0};Range.prototype.ranges=function(){return[this]};Range.prototype._pushRanges=function(a){a.push(this)};Range.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};function _Compound(a){this._ranges=a}_Compound.prototype.min=function(){return this._ranges[0].min()};
_Compound.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};_Compound.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return!0;return!1};_Compound.prototype.isContiguous=function(){return 1<this._ranges.length};_Compound.prototype.ranges=function(){return this._ranges};_Compound.prototype._pushRanges=function(a){for(var b=0;b<this._ranges.length;++b)a.push(this._ranges[b])};
_Compound.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b)0<b&&(a+=","),a+=this._ranges[b].toString();return a};
function union(a,b){a instanceof Array||(a=[a],b&&a.push(b));if(0==a.length)return null;if(1==a.length)return a[0];for(var c=[],d=0;d<a.length;++d)a[d]._pushRanges(c);for(var c=c.sort(_rangeOrder),d=[],e=c[0],e=new Range(e._min,e._max),f=1;f<c.length;++f){var g=c[f];g._min>e._max+1?(d.push(e),e=new Range(g._min,g._max)):g._max>e._max&&(e._max=g._max)}d.push(e);return 1==d.length?d[0]:new _Compound(d)}
function intersection(a,b){for(var c=a.ranges(),d=b.ranges(),e=c.length,f=d.length,g=0,h=0,k=[];g<e&&h<f;){a=c[g];b=d[h];var l=Math.max(a.min(),b.min()),m=Math.min(a.max(),b.max());m>=l&&k.push(new Range(l,m));a.max()>b.max()?++h:++g}return 0==k.length?null:1==k.length?k[0]:new _Compound(k)}function coverage(a){var b=0;a=a.ranges();for(var c=0;c<a.length;++c)var d=a[c],b=b+(d.max()-d.min()+1);return b}
function rangeOrder(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}function _rangeOrder(a,b){return a._min<b._min?-1:a._min>b._min?1:a._max<b._max?-1:b._max>a._max?1:0}"use strict";var THUB_STANZA_REGEXP=/\n\s*\n/,THUB_PARSE_REGEXP=/(\w+) +(.+)\n?/,THUB_SUBGROUP_REGEXP=/subGroup[1-9]/,THUB_PENNANT_PREFIX="http://genome.ucsc.edu/images/";function TrackHub(a){this.genomes={};this.url=a}function TrackHubTrack(){}
TrackHubTrack.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};function TrackHubDB(a){this.hub=a}
TrackHubDB.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);textXHR(this.absURL,function(c,d){if(d)return a(null,d);c=c.replace("\\\n"," ");for(var e=[],f={},g=c.split(THUB_STANZA_REGEXP),h=0;h<g.length;++h){var k=g[h].replace(/\#.*/g,"").split(THUB_PARSE_REGEXP),l=new TrackHubTrack;l._db=b;for(var m=0;m<k.length-2;m+=3){var n=k[m+1],p=k[m+2];if(n.match(THUB_SUBGROUP_REGEXP)){l.subgroups||(l.subgroups={});for(var n=p.split(/\s/),p=n[0],r={name:n[1],tags:[],titles:[]},
q=2;q<n.length;++q){var s=n[q].split(/=/);r.tags.push(s[0]);r.titles.push(s[1])}l.subgroups[p]=r}else if("subGroups"===n){n=p.split(/(\w+)=(\w+)/);l.sgm={};for(q=0;q<n.length-2;q+=3)l.sgm[n[q+1]]=n[q+2]}else l[k[m+1]]=k[m+2]}if(l.track&&(l.type||l.container||l.view))e.push(l),f[l.track]=l}g=[];h=[];for(n=0;n<e.length;++n){l=e[n];k=!0;if(l.parent&&(m=l.parent.split(/\s+/),m=f[m[0]]))l._parent=m,m.children||(m.children=[]),m.children.push(l),m&&(k=!1);l.compositeTrack?h.push(l):k&&g.push(l)}for(e=0;e<
h.length;++e)if(f=h[e],f.children){l=!1;for(k=0;k<f.children.length;++k)n=f.children[k],n.view&&(n.shortLabel=f.shortLabel+": "+n.shortLabel,g.push(n),l=!0);l||g.push(f)}b._tracks=g;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};
function connectTrackHub(a,b,c){c=c||{};c.salt=!0;textXHR(a,function(d,e){if(e)return b(null,e);var f=d.split(THUB_PARSE_REGEXP),g=new TrackHub(a);c.credentials&&(g.credentials=c.credentials);for(var h=0;h<f.length-2;h+=3)g[f[h+1]]=f[h+2];if(g.genomesFile){var k=relativeURL(a,g.genomesFile);textXHR(k,function(a,d){if(d)return b(null,d);for(var e=a.split(THUB_STANZA_REGEXP),f=0;f<e.length;++f){var h=e[f].split(THUB_PARSE_REGEXP),q=new TrackHubDB(g);c.credentials&&(q.credentials=c.credentials);for(var s=
0;s<h.length-2;s+=3)q[h[s+1]]=h[s+2];q.twoBitPath&&(q.twoBitPath=relativeURL(k,q.twoBitPath));q.genome&&q.trackDb&&(q.absURL=relativeURL(k,q.trackDb),g.genomes[q.genome]=q)}b(g)},c)}else b(null,"No genomesFile")},c)}
TrackHubTrack.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant=THUB_PENNANT_PREFIX+b[0]);if(b=this.get("searchTrix"))a.trixURI=relativeURL(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var d=b[c],e=d.toDallianceSource();a.overlay.push(e);if(e.style)for(var f=
0;f<e.style.length;++f){var g=e.style[f];g.method=d.shortLabel;"transparentOverlay"==this.aggregate&&(g.style.ALPHA=0.5);a.style.push(g)}}return a}c=this.type.split(/\s+/);if("bigBed"==c[0])return b=c[1]|0,c="+"==c[2],a.bwgURI=relativeURL(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0])return a.bwgURI=relativeURL(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=
!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0])return a.bamURI=relativeURL(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)};
TrackHubTrack.prototype.bigwigStyles=function(){var a=this.type.split(/\s+/),b,c;3<=a.length&&(b=1*a[1],c=1*a[2]);var d;this.maxHeightPixels&&(a=this.maxHeightPixels.split(/:/),3==a.length?d=a[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));a="bars";this.graphTypeDefault&&(a=this.graphTypeDefault);var e="black",f=null;this.color&&(e="rgb("+this.color+")");this.altColor&&(f="rgb("+this.altColor+")");var g=new DASStylesheet,h=new DASStyle;h.glyph="points"==a?"POINT":"HISTOGRAM";
f?(h.COLOR1=e,h.COLOR2=f):h.BGCOLOR=e;h.HEIGHT=d||30;if(b||c)h.MIN=b,h.MAX=c;g.pushStyle({type:"default"},null,h);return g.styles};
TrackHubTrack.prototype.bigbedStyles=function(){var a="on"==(""+this.get("itemRgb")).toLowerCase(),b=this.get("visibility")||"full",c=this.get("color"),c=c?"rgb("+c+")":"blue",d=new DASStylesheet,e=new DASStyle;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR=c;e.HEIGHT="full"==b||"pack"==b?12:8;e.BUMP="full"==b||"pack"==b;e.LABEL="full"==b||"pack"==b;e.ZINDEX=20;a&&(e.BGITEM=!0);(b=this.get("colorByStrand"))?(b=b.split(/\s+/),c=shallowCopy(e),c.BGCOLOR="rgb("+b[0]+")",d.pushStyle({type:"bigwig",orientation:"+"},
null,c),e=shallowCopy(e),e.BGCOLOR="rgb("+b[1]+")",d.pushStyle({type:"bigwig",orientation:"-"},null,e)):d.pushStyle({type:"bigwig"},null,e);e=new DASStyle;e.glyph="BOX";e.FGCOLOR="black";a&&(e.BGITEM=!0);e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;d.pushStyle({type:"bb-translation"},null,e);a=new DASStyle;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="white";a.HEIGHT=10;a.ZINDEX=10;a.BUMP=!0;a.LABEL=!0;d.pushStyle({type:"bb-transcript"},null,a);return d.styles};
function THUB_COMPARE(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}"use strict";var __tier_idSeed=0;
function DasTier(a,b,c,d){this.config=c||{};this.id="tier"+ ++__tier_idSeed;this.browser=a;this.dasSource=shallowCopy(b);this.background=d;this.viewport=makeElement("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport"});this.overlay=makeElement("canvas",null,{width:+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport-overlay"});this.notifier=makeElement("div","",{className:"notifier"});this.notifierHolder=makeElement("div",this.notifier,
{className:"notifier-holder"});this.quantOverlay=makeElement("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=makeElement("i",null,{className:"fa fa-times"});this.bumpButton=makeElement("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=makeElement("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=makeElement("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);
b.pennant&&this.nameButton.appendChild(makeElement("img",null,{src:b.pennant,width:"16",height:"16"}));this.nameElement=makeElement("span",b.name);this.nameButton.appendChild(makeElement("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=makeElement("span",[this.nameButton],{className:"btn-group track-label"});this.row=makeElement("div",[this.viewport,this.overlay,this.quantOverlay],
{className:"tier"});d||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);this.initSources();var e=this;this.featureSource&&this.featureSource.getDefaultFIPs&&
this.featureSource.getDefaultFIPs(function(a){a&&e.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){e.notify(a,-1)});this.listeners=[]}DasTier.prototype.toString=function(){return this.id};DasTier.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
DasTier.prototype.init=function(){var a=this;if(a.dasSource.style)this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this);else{var b;b=a.dasSource.stylesheet_uri?new DASFeatureSource(a.dasSource):a.getSource();a.status="Fetching stylesheet";b.getStyleSheet(function(b,d){if(d||!b){a.error="No stylesheet";b=new DASStylesheet;var e=new DASStyle;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&
(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel());a.browser.refreshTier(a)})}};DasTier.prototype.setStylesheet=function(a){this.baseStylesheet=shallowCopy(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=shallowCopy(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=shallowCopy(b.style);b.style.id="style"+ ++this.styleIdSeed}this._updateFromConfig()};DasTier.prototype.getSource=function(){return this.featureSource};
DasTier.prototype.getDesiredTypes=function(a){a=[];var b=!1,c=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var d=this.stylesheet.styles,e=0;e<d.length;++e){var f=d[e];if(!f.zoom||f.zoom==c)if(!f.type||"default"==f.type){b=!0;break}else pushnew(a,f.type)}return b?null:a}};DasTier.prototype.needsSequence=function(a){return"sequence"===this.dasSource.tier_type&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob)&&20>a?!0:!1};
DasTier.prototype.viewFeatures=function(a,b,c,d,e){this.currentFeatures=d;this.currentSequence=e;this.knownChr=a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};DasTier.prototype.draw=function(){var a=this.currentSequence;"sequence"===this.dasSource.tier_type?drawSeqTier(this,a):drawFeatureTier(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};
DasTier.prototype.findNextFeature=function(a,b,c,d,e){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,e);else{if(this.knownCoverage&&(b>=this.knownCoverage.min()&&b<=this.knownCoverage.max())&&this.currentFeatures){for(var f=null,g=0;g<this.currentFeatures.length;++g){var h=this.currentFeatures[g];if(h.min&&h.max&&!(h.parents&&0<h.parents.length))if(0>c)if(1==d&&h.max>=b&&h.min<b){if(!f||h.min>
f.min||h.min==f.min&&h.max<f.max)f=h}else{if(h.max<b&&(!f||h.max>f.max||h.max==f.max&&h.min<f.min||h.min==f.mmin&&f.max>=b))f=h}else if(1==d&&h.min<=b&&h.max>b){if(!f||h.max<f.max||h.max==f.max&&h.min>f.min)f=h}else if(h.min>b&&(!f||h.min<f.min||h.min==f.min&&h.max>f.max||h.max==f.max&&f.min<=b))f=h}if(f)return e(f);b=0>c?this.knownStart:this.knownEnd}this.featureSource.findNextFeature(a,b,c,e)}};
DasTier.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};DasTier.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};
DasTier.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio,c=this.overlay.getContext("2d");this.overlay.height=this.viewport.height;this.overlay.width=this.viewport.width;b&&c.scale(2,2);for(var b=a.viewStart-1E3/a.scale,d=a.viewStart-1E3/a.scale,e=a.viewEnd+1E3/a.scale,f=0;f<a.highlights.length;++f){var g=a.highlights[f];if((g.chr===a.chr||g.chr==="chr"+a.chr)&&g.min<e&&g.max>d)c.globalAlpha=a.defaultHighlightAlpha,c.fillStyle=a.defaultHighlightFill,c.fillRect((g.min-
b)*a.scale,0,(g.max-g.min)*a.scale,this.overlay.height)}this.oorigin=a.viewStart;this.overlay.style.width=this.viewport.style.width;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="-1000px"};DasTier.prototype.updateStatus=function(a){a?(this.status=a,this.currentFeatures=[],this.currentSequence=null,this.draw(),this.updateHeight(),this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};
DasTier.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var c=this;this.notifierFadeTimeout=setTimeout(function(){c._notifierToStatus()},b)}}else this._notifierToStatus()};DasTier.prototype._notifierOn=function(a){this.notifier.textContent=a;this.notifier.style.opacity=0.8};DasTier.prototype._notifierOff=function(){this.notifier.style.opacity=0};
DasTier.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};DasTier.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};DasTier.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};
DasTier.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var c=this.config.height||this.dasSource.forceHeight;c!=this.forceHeight&&(this.forceHeight=c,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);c=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=c&&(this.forceMin=c,a=!0);this.forceMaxDynamic!=
this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);c=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=c&&(this.forceMax=c,a=!0);c=null;void 0!==this.config.quantLeapThreshold?c=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(c=this.dasSource.quantLeapThreshold);c!=this.quantLeapThreshold&&(this.quantLeapThreshold=c,a=!0);c=this.config.stylesheet||this.baseStylesheet;this.stylesheet!==c&&(this.stylesheet=
c,a=!0);c=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;c!==this.pinned&&(this.pinned=c,b=!0);a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};DasTier.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};DasTier.prototype.addTierListener=function(a){this.listeners.push(a)};DasTier.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(c){console.log(c)}this.browser.notifyTier()};
"use strict";Browser.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(sourcesAreEqual(this.tiers[b].dasSource,a))return this.tiers[b];return!1};Browser.prototype.makeButton=function(a,b){var c=makeElement("a",a,{href:"#"});b&&this.makeTooltip(c,b);return makeElement("li",c)};function activateButton(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):d.classList.remove("active")}}
Browser.prototype.showTrackAdder=function(a){function b(a){O.style.display="none";N.style.display="none";P.style.display="none";D=!1;removeChildren(z);for(var b=makeElement("div",null,{},{width:"100%"}),c=[],d=0;d<a.length;++d)c.push(a[d]);c.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});a=[];for(var e=[],d=0;d<c.length;++d){var f=c[d];f.children&&0<f.children.length&&"multiWig"!=f.container?a.push(f):e.push(f)}0<e.length&&a.push({shortLabel:"Others",
priority:-1E8,children:e});a.sort(THUB_COMPARE);for(var g=[],c=0;c<a.length;++c){f=e=a[c];!f.dimensions&&(f._parent&&f._parent.dimensions)&&(f=f._parent);d={};if(f.dimensions)for(var h=f.dimensions.split(/(\w+)=(\w+)/),k=0;k<h.length-2;k+=3)d[h[k+1]]=h[k+2];if(d.dimX&&d.dimY){for(var l=d.dimX,m=d.dimY,d=f.subgroups[l],h=f.subgroups[m],k={},p=0;p<e.children.length;++p){var q=e.children[p],f=q.sgm[l],r=q.sgm[m];k[f]||(k[f]={});k[f][r]=q}m=makeElement("table",null,{className:"table table-striped table-condensed"},
{tableLayout:"fixed"});f=makeElement("tr");f.appendChild(makeElement("th",null,{},{width:"150px",height:"100px"}));for(r=0;r<d.titles.length;++r)l=makeElement("th",makeElement("div",d.titles[r],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),f.appendChild(l);m.appendChild(f);for(var s=makeElement("tbody",null,{className:"table table-striped table-condensed"}),
u=0;u<h.titles.length;++u){var r=h.tags[u],v=makeElement("tr");v.appendChild(makeElement("th",h.titles[u]),{});for(var t=0;t<d.titles.length;++t){var f=d.tags[t],w=makeElement("td");if(k[f]&&k[f][r]){f=k[f][r];p=f.toDallianceSource();if(!p)continue;l=makeElement("tr");q=makeElement("td");q.style.textAlign="center";var y=makeElement("input");y.type="checkbox";y.dalliance_source=p;Q&&(y.dalliance_mapping=Q);g.push(y);w.appendChild(y);y.addEventListener("change",function(a){a.target.checked?n.addTier(a.target.dalliance_source):
n.removeTier(a.target.dalliance_source)})}v.appendChild(w)}s.appendChild(v)}m.appendChild(s);b.appendChild(makeTreeTableSection(e.shortLabel,m,0==c))}else{h=makeElement("tbody",null,{className:"table table-striped table-condensed"});k=makeElement("table",h,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});r=0;e.children.sort(THUB_COMPARE);for(d=0;d<e.children.length;++d)if(f=e.children[d],p=f.toDallianceSource())l=makeElement("tr"),q=makeElement("td",null,{},{width:"30px"}),
q.style.textAlign="center",y=makeElement("input"),y.type="checkbox",y.dalliance_source=p,Q&&(y.dalliance_mapping=Q),g.push(y),q.appendChild(y),y.addEventListener("change",function(a){a.target.checked?n.addTier(a.target.dalliance_source):n.removeTier(a.target.dalliance_source)}),l.appendChild(q),m=makeElement("td"),m.appendChild(document.createTextNode(f.shortLabel)),f.longLabel&&0<f.longLabel.length&&n.makeTooltip(m,f.longLabel),l.appendChild(m),h.appendChild(l),++r;1<a.length||"Others"!==e.shortLabel?
b.appendChild(makeTreeTableSection(e.shortLabel,k,0==c)):b.appendChild(k)}}var T=function(){for(var a=0;a<g.length;++a){var b=g[a],c=n.currentlyActive(b.dalliance_source);c?(b.checked=!0,b.disabled=null!=c.sequenceSource):b.checked=!1}};T();n.addTierListener(function(a){T()});z.appendChild(b)}function c(){activateButton(p,C);D="bin";O.style.display="none";N.style.display="inline";P.style.display="none";removeChildren(z);var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3",
"Add custom URL-based data"));a.appendChild(makeElement("p",["You can add indexed binary data hosted on an web server that supports CORS (",makeElement("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(makeElement("br"));a.appendChild(document.createTextNode("URL: "));I=makeElement("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(I);a.appendChild(makeElement("br"));
a.appendChild(makeElement("b","- or -"));a.appendChild(makeElement("br"));a.appendChild(document.createTextNode("File: "));J=makeElement("input",null,{type:"file",multiple:"multiple"});a.appendChild(J);a.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.'));z.appendChild(a);I.focus()}function d(){activateButton(p,E);O.style.display="none";N.style.display="inline";P.style.display="none";D="hub-connect";O.style.visibility="hidden";removeChildren(z);
var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Connect to a track hub."));a.appendChild(makeElement("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));I=makeElement("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(I);z.appendChild(a);I.focus()}function e(){activateButton(p,A);O.style.display="none";N.style.display="inline";
P.style.display="none";D="das";removeChildren(z);var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Add custom DAS data"));a.appendChild(makeElement("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(makeElement("br"));I=makeElement("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},
{width:"100%"});a.appendChild(I);a.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));z.appendChild(a);I.focus()}function f(){if(D)if("das"===D){var a=I.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);var b=new DASSource({name:"temporary",uri:a});V(b)}else if("bin"===D)(a=J.files)&&0<a.length?Z(a):(a=I.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),X({uri:a}));else if("reset"===
D)e();else if("reset-bin"===D)c();else if("reset-hub"===D)d();else if("prompt-bai"===D)(a=J.files)&&0<a.length&&a[0]?(K.baiBlob=a[0],k(K)):(a=K,O.style.display="none",N.style.display="inline",P.style.display="inline",removeChildren(z),D="prompt-bai",z.appendChild(makeElement("h2","Select an index file")),z.appendChild(makeElement("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
z.appendChild(document.createTextNode("Index file: ")),J=makeElement("input",null,{type:"file"}),z.appendChild(J),K=a);else if("prompt-tbi"===D)(a=J.files)&&0<a.length&&a[0]?(K.indexBlob=a[0],l(K)):(a=K,O.style.display="none",N.style.display="inline",P.style.display="inline",removeChildren(z),D="prompt-tbi",z.appendChild(makeElement("h2","Select an index file")),z.appendChild(makeElement("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
z.appendChild(document.createTextNode("Index file: ")),J=makeElement("input",null,{type:"file"}),z.appendChild(J),K=a);else if("finalize"===D||"finalize-bin"===D)K.name=G.value,a=M.value,K.mapping="__default__"!=a?a:void 0,L&&(K.maxbins=L.checked),1<F.value.length&&1<R.value.length&&(dlog("password"),K.xUser=F.value,K.xPass=R.value),n.addTier(K),"finalize-bin"==D?c():e();else if("hub-connect"===D)a=I.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),g(a);else{if("multiple"===D){for(a=0;a<S.length;++a)if(b=
S[a],!("bam"==b.tier_type&&!b.indexBlob&&!b.indexUri)&&!("tabix"==b.tier_type&&!b.indexBlob&&!b.indexUri)&&(b=W(b)))b.noPersist=!0,n.addTier(b);c()}}else n.removeAllPopups()}function g(a,c,d){c=c||{};connectTrackHub(a,function(e,f){if(f){if(!d)return g(a,{credentials:!0},!0);removeChildren(z);z.appendChild(makeElement("h2","Error connecting to track hub"));z.appendChild(makeElement("p",f));D="reset-hub"}else{var h=null,k=null,l;for(l in e.genomes){var m=null,q=!1;if(l==n.coordSystem.ucscName)q=!0;
else for(var r in n.chains)l==n.chains[r].coords.ucscName&&(m=r,q=!0);if(q&&(q={url:a,genome:l},c.credentials&&(q.credentials=!0),m&&(q.mapping=m,e.genomes[l].mapping=m),n.hubs.push(q),n.hubObjects.push(e.genomes[l]),q=x(e.genomes[l]),H.appendChild(q),!m||!h))h=e.genomes[l],k=q}h?(n.notifyTier(),activateButton(p,k),h.getTracks(function(a,c){b(a)})):(removeChildren(z),z.appendChild(makeElement("h2","No data for this genome")),z.appendChild(makeElement("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),
z.appendChild(makeElement("p","coordSystem.ucscName = "+n.coordSystem.ucscName)),D="reset-hub")}},c)}function h(a,b){var c=a.uri;if(b){var d=/(.+)\/[^\/]+\/?/.exec(c);d&&(c=d[1]+"/sources")}(new DASRegistry(c,{credentials:a.credentials})).sources(function(c){if(!c||0==c.length)return b?T(a):h(a,!0);var d=null;if(1==c.length)d=c[0];else for(var e=0;e<c.length;++e)if(c[e].uri===a.uri){d=c[e];break}e=c=!1;if(d&&(a.name=d.name,a.desc=d.desc,a.maxbins=d.maxbins?!0:!1,d.capabilities&&(a.capabilities=d.capabilities),
e=!0,d.coords&&1==d.coords.length))if(d=d.coords[0],coordsMatch(d,n.coordSystem))c=!0;else if(n.chains)for(var f in n.chains)coordsMatch(d,n.chains[f].coords)&&(a.mapping=f,c=!0);return T(a,c,e)},function(){return b?T(a):h(a,!0)})}function k(a){(a.baiBlob?new BlobFetchable(a.baiBlob):new URLFetchable(a.bamURI+".bai")).slice(0,256).fetch(function(b){var c=!1;b&&(b=new Uint8Array(b),c=readInt(b,0)==BAI_MAGIC);return c?T(a,!1,!1,!0):m("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}
function l(a){(a.indexBlob?new BlobFetchable(a.indexBlob):new URLFetchable(a.uri+".tbi")).slice(0,65536).fetch(function(b){var c=!1;if(b){var d=new Uint8Array(b);if(31==d[0]||139==d[1])b=unbgzf(b),d=new Uint8Array(b),c=readInt(d,0)==TABIX_MAGIC}return c?T(a,!1,!1,!0):m('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}function m(a){O.style.display="none";
N.style.display="inline";P.style.display="inline";removeChildren(z);a=a||"Custom data format not recognized";z.appendChild(makeElement("h2","Error adding custom data"));z.appendChild(makeElement("p",a));z.appendChild(makeElement("p","Currently supported formats are bigBed, bigWig, and BAM."));D="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var n=this;a=makeElement("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top"});var p=[],r,q;if(!this.noRegistryTabs){var s=this.makeButton("Registry","Browse compatible datasources from the DAS registry");p.push(s);for(var v in this.mappableSources)(function(a){var b=n.makeButton(n.chains[a].srcTag,"Browse datasources mapped from "+n.chains[a].srcTag);p.push(b);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();activateButton(p,b);r(n.mappableSources[a],a)},!1)})(v)}v={};for(var t=0;t<this.defaultSources.length;++t){var u=this.defaultSources[t],
w=u.group||"Defaults";v[w]?v[w].push(u):v[w]=[u]}var x=function(a){var c=a.hub,e=makeElement("i",null,{className:"fa fa-list-alt"}),f=c.shortLabel||"Unknown";a.mapping&&(f=f+" ("+a.genome+")");var f=makeElement("span",[f," ",e]),g=n.makeButton(f,c.longLabel);p.push(g);g.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();activateButton(p,g);removeChildren(z);c=n.makeLoader(24);c.style.marginLeft="auto";c.style.marginRight="auto";c.style.marginTop="100px";z.appendChild(makeElement("div",
c,null,{textAlign:"center"}));O.style.display="none";N.style.display="none";P.style.display="none";a.getTracks(function(a,c){c&&console.log(c);b(a)})},!1);e.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var c=makeElement("li",makeElement("a","Remove hub")),e=makeElement("li",makeElement("a","Enable all")),f=makeElement("li",makeElement("a","Disable all")),h=makeElement("ul",[c,e,f],{className:"dropdown-menu"},{display:"block"}),k=b.clientX;b=b.clientY;k+=document.documentElement.scrollLeft||
document.body.scrollLeft;b+=document.documentElement.scrollTop||document.body.scrollTop;h.style.position="absolute";h.style.top=""+(b+10)+"px";h.style.left=""+(k-30)+"px";n.hPopupHolder.appendChild(h);var l=function(a){console.log("cc");document.body.removeEventListener("click",l,!0);n.hPopupHolder.removeChild(h)};document.body.addEventListener("click",l,!0);c.addEventListener("click",function(b){for(b=0;b<n.hubObjects.length;++b)if(n.hubObjects[b].absURL==a.absURL){n.hubObjects.splice(b,1);break}for(b=
0;b<n.hubs.length;++b){var c=n.hubs[b];"string"===typeof c&&(c={url:c});if(c.url==a.hub.url&&!c.genome||c.genome==a.genome){n.hubs.splice(b,1);break}}n.notifyTier();H.removeChild(g);activateButton(p,E);d()},!1);e.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var c=0;c<a.length;++c){var d=a[c].toDallianceSource();n.currentlyActive(d)||n.addTier(d)}})},!1);f.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var c=0;c<a.length;++c){var d=
a[c].toDallianceSource();n.currentlyActive(d)&&n.removeTier(d)}})},!1)},!1);return g},B=null,y=null;for(w in v)(function(a,b){var c=n.makeButton(a,"Browse the default set of data for this browser");c.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();activateButton(p,c);r(new Observed(b))},!1);p.push(c);B||(B=c,y=b)})(w,v[w]);var A=this.makeButton("DAS","Add arbitrary DAS data");p.push(A);var C=this.makeButton("Binary","Add data in bigwig or bigbed format");p.push(C);for(w=
0;w<this.hubObjects.length;++w)x(this.hubObjects[w]);var E=this.makeButton("+","Connect to a new track-hub");p.push(E);var H=makeElement("ul",p,{className:"nav nav-tabs"},{marginBottom:"0px"});a.appendChild(H);var I,G,M,L,J,F,R,D=!1,K=null,w=makeElement("form",null,{},{display:"inline-block",width:"100%"});w.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();f();return!1},!0);var z=makeElement("div");z.style.position="relative";z.style.overflow="scroll";w.appendChild(z);
var Q,U;r=function(a,b){O.style.display="none";N.style.display="none";P.style.display="none";U&&U.removeListener(q);Q=b;U=a;U.addListenerAndFire(q)};q=function(a){D=!1;var b=[];removeChildren(z);if(a){for(var c=makeElement("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),d=makeElement("table",c,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),e=0,f=[],g=0;g<a.length;++g)f.push(a[g]);f.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});
for(g=0;g<f.length;++g){a=f[g];var h=makeElement("tr"),k=makeElement("td",null,{},{width:"30px"});k.style.textAlign="center";if(!a.props||a.props.cors){var l=makeElement("input");l.type="checkbox";l.dalliance_source=a;Q&&(l.dalliance_mapping=Q);k.appendChild(l);b.push(l);l.addEventListener("change",function(a){a.target.checked?n.addTier(a.target.dalliance_source):n.removeTier(a.target.dalliance_source)})}else k.appendChild(document.createTextNode("!")),n.makeTooltip(k,makeElement("span",["This data source isn't accessible because it doesn't support ",
makeElement("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));h.appendChild(k);k=makeElement("td");k.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&n.makeTooltip(k,a.desc);h.appendChild(k);c.appendChild(h);++e}var m=function(){for(var a=0;a<b.length;++a){var c=b[a];n.currentlyActive(c.dalliance_source)?c.checked=!0:c.checked=!1}};m();n.addTierListener(function(a){m()});z.appendChild(d)}else z.appendChild(makeElement("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};
s&&s.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();activateButton(p,s);r(n.availableSources)},!1);C.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c()},!1);E.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();d()},!1);A.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e()},!1);var N=makeElement("button","Add",{className:"btn btn-primary"});N.addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();f()},!1);var V=function(a,b){var c=n.knownSpace;if(c){var d=Math.max(c.min,(c.min+c.max-100)/2)|0,c=new DASSegment(c.chr,d,Math.min(d+99,c.max));a.features(c,{},function(c,d){if(d)b?(removeChildren(z),z.appendChild(makeElement("h2","Custom data not found")),z.appendChild(makeElement("p","DAS uri: "+a.uri+" is not answering features requests")),D="reset"):(dlog("retrying with credentials"),a.credentials=!0,V(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);h(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},
W=function(a){var b={name:a.name};a.mapping&&"__default__"!=a.mapping&&(b.mapping=a.mapping);if("bwg"==a.tier_type)return a.blob?b.bwgBlob=a.blob:a.uri&&(b.bwgURI=a.uri),b;if("bam"==a.tier_type)return a.blob?(b.bamBlob=a.blob,b.baiBlob=a.indexBlob):(b.bamURI=a.uri,b.baiURI=a.indexUri),b;if("tabix"==a.tier_type)return b.tier_type="tabix",b.payload=a.payload,a.blob?(b.blob=a.blob,b.indexBlob=a.indexBlob):(b.uri=a.uri,b.indexUri=a.indexUri),b;if("memstore"==a.tier_type)return b.tier_type="memstore",
b.payload=a.payload,a.blob?b.blob=a.blob:b.uri=a.uri,b},X=function(a){probeResource(a,function(a,b){if(b)removeChildren(z),z.appendChild(makeElement("h2","Couldn't access custom data")),z.appendChild(makeElement("p",""+b)),D="reset-bin";else{var c=W(a);return"bam"==a.tier_type?k(c):"tabix"==a.tier_type?l(c):T(c,!1,!1,!0)}})},T=function(a,b,c,d){O.style.display="none";N.style.display="inline";P.style.display="inline";removeChildren(z);z.appendChild(makeElement("h2","Add custom data: step 2"));z.appendChild(document.createTextNode("Label: "));
G=makeElement("input","",{value:a.name});z.appendChild(G);F=makeElement("input","");R=makeElement("input","");z.appendChild(makeElement("br"));z.appendChild(makeElement("br"));z.appendChild(makeElement("h4","Coordinate system: "));M=makeElement("select",null);M.appendChild(makeElement("option",n.nameForCoordSystem(n.coordSystem),{value:"__default__"}));if(n.chains)for(var e in n.chains)M.appendChild(makeElement("option",n.nameForCoordSystem(n.chains[e].coords),{value:e}));M.value=a.mapping||"__default__";
z.appendChild(M);b?z.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):(z.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),z.appendChild(makeElement("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));d||(z.appendChild(document.createTextNode("Quantitative: ")),L=makeElement("input",null,{type:"checkbox",checked:!0}),
"undefined"!==typeof a.maxbins&&(L.checked=a.maxbins),z.appendChild(L),c?z.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):z.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&z.appendChild(makeElement("p",[makeElement("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));G.focus();D="bin"===
D||"prompt-bai"===D||"prompt-tbi"===D?"finalize-bin":"finalize";K=a},S=null,Z=function(a){var b=S=[];D="multiple";for(var c=0;c<a.length;++c){var d=a[c];d&&b.push({blob:d})}for(c=0;c<b.length;++c)probeResource(b[c],function(a,b){b&&(a.error=b);for(var c=[],d={},e={},f=0;f<S.length;++f){var g=S[f];"bam"==g.tier_type&&!g.indexBlob&&(d[g.blob.name]=g);"tabix"==g.tier_type&&!g.indexBlob&&(e[g.blob.name]=g)}for(f=0;f<S.length;++f)if(g=S[f],"bai"===g.tier_type){var h=/(.+)\.bai$/.exec(g.blob.name);h&&d[h[1]]&&
(d[h[1]].indexBlob=g.blob,c.push(f))}else if("tabix-index"===g.tier_type&&(h=/(.+)\.tbi$/.exec(g.blob.name))&&e[h[1]])e[h[1]].indexBlob=g.blob,c.push(f);for(d=c.length-1;0<=d;--d)S.splice(c[d],1);Y()});Y()},Y=function(){removeChildren(z);var a=makeElement("table",S.map(function(a){makeElement("tr").appendChild(makeElement("td",a.name||a.blob.name));var b;b=a.error?makeElement("span","Error",null,{color:"red"}):a.tier_type?a.payload||a.tier_type:n.makeLoader(16);var c;if("bwg"==a.tier_type||"bam"==
a.tier_type&&a.indexBlob||"tabix"==a.tier_type&&a.indexBlob||"memstore"==a.tier_type){c=makeElement("select",null,null,{width:"100px"});c.appendChild(makeElement("option",n.nameForCoordSystem(n.coordSystem),{value:"__default__"}));if(n.chains)for(var d in n.chains)c.appendChild(makeElement("option",n.nameForCoordSystem(n.chains[d].coords),{value:d}));c.value=a.mapping||"__default__";c.addEventListener("change",function(b){a.mapping=c.value;console.log(a)},!1)}return makeElement("tr",[makeElement("td",
a.name||a.blob.name),makeElement("td",b),makeElement("td",c)])}),{className:"table table-striped table-condensed"});z.appendChild(a)},P=makeElement("button","Cancel",{className:"btn"});P.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===D?c():e()},!1);var O=makeElement("button","Refresh",{className:"btn"});O.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();n.queryRegistry(Q)},!1);this.makeTooltip(O,"Click to re-fetch data from the DAS registry");
v=makeElement("div",[N," ",P," ",O]);v.style.margin="10px";w.appendChild(v);a.appendChild(w);r(n.availableSources);this.showToolPanel(a);this.setUiMode("add");B&&(activateButton(p,B),r(new Observed(y)))}};"use strict";var TWOBIT_MAGIC=440477507;function TwoBitFile(){}
function makeTwoBit(a,b){var c=new TwoBitFile;c.data=a;c.data.slice(0,12500).fetch(function(a){if(!a)return b(null,"Couldn't access data");var e=new Uint8Array(a);if(readInt(e,0)!=TWOBIT_MAGIC)return b(null,"Not a .2bit fie");a=readInt(e,4);if(0!=a)return b(null,"Unsupported version "+a);c.seqCount=readInt(e,8);c.seqDict={};var f=16,g=0,h=0,k=function(){for(;g<c.seqCount;){var a=e[f];if(f+a+6>=e.length)return c.data.slice(h+f,12500).fetch(function(a){h+=f;f=0;e=new Uint8Array(a);k()});++f;for(var d=
"",n=1;n<=a;++n)d+=String.fromCharCode(e[f++]);a=readInt(e,f);f+=4;c.seqDict[d]=new TwoBitSeq(c,a);++g}return b(c)};k()})}TwoBitFile.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};TwoBitFile.prototype.fetch=function(a,b,c,d){var e=this.getSeq(a);if(e)e.fetch(b,c,d);else return d(null,"Couldn't find "+a)};function TwoBitSeq(a,b){this.tbf=a;this.offset=b}
TwoBitSeq.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=readInt(c,0);b.nBlockCnt=readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var e=null,f=0;f<b.nBlockCnt;++f)var g=readInt(c,4*f),h=readInt(c,4*(f+b.nBlockCnt)),g=new Range(g,g+h-1),e=e?union(e,g):g;b.nBlocks=e;b.mBlockCnt=readInt(c,8*b.nBlockCnt);
b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var TWOBIT_TABLE=["T","C","A","G"];
TwoBitSeq.prototype.fetch=function(a,b,c){--a;--b;var d=this;this.init(function(e){if(e)return c(null,e);var f=a>>2;e=b+3>>2;if(0>f||e>d.seqLength)return c("Coordinates out of bounds: "+a+":"+b);d.tbf.data.slice(d.seqOffset+f,e-f).fetch(function(e){function h(a){for(;n<=a;){var b=n&3,c=k[(n>>2)-f];m+=TWOBIT_TABLE[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++n}}if(null==e)return c("SeqFetch failed");var k=new Uint8Array(e);e=[];if(d.nBlocks){var l=intersection(new Range(a,b),d.nBlocks);l&&(e=l.ranges())}for(var m=
"",n=a,l=0;l<e.length;++l){var p=e[l];if(n>p.min())throw"N mismatch...";for(n<p.min()&&h(p.min()-1);n<=p.max();)m+="N",++n}n<=b&&h(b);return c(m)})})};TwoBitSeq.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"use strict";var NUM_REGEXP=/[0-9]+/;function stringToNumbersArray(a){for(var b=[],c;c=NUM_REGEXP.exec(a);)b.push(c[0]),a=a.substring(c.index+c[0].length);return b}var STRICT_NUM_REGEXP=/^[0-9]+$/;
function stringToInt(a){a=a.replace(RegExp(",","g"),"");return!STRICT_NUM_REGEXP.test(a)?null:a|0}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function pusho(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function pushnewo(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function pick(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}
function maybeConcat(a,b){var c=[];if(a)for(var d=0;d<a.length;++d)pushnew(c,a[d]);if(b)for(d=0;d<b.length;++d)pushnew(c,b[d]);return c}function arrayIndexOf(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function arrayRemove(a,b){var c=arrayIndexOf(a,b);return 0<=c?(a.splice(c,1),!0):!1}
function makeElement(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var e=0;e<b.length;++e){var f=b[e];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}}if(c)for(var g in c)try{a[g]=c[g]}catch(h){throw console.log("error setting "+g),h;}if(d)for(g in d)a.style[g]=d[g];return a}
function makeElementNS(a,b,c,d){a=document.createElementNS(a,b);if(c){c instanceof Array||(c=[c]);for(b=0;b<c.length;++b){var e=c[b];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}}setAttrs(a,d);return a}var attr_name_cache={};function setAttr(a,b,c){var d=attr_name_cache[b];if(!d){for(var d="",e=0;e<b.length;++e)var f=b.substring(e,e+1),g=f.toLowerCase(),d=g!=f?d+"-"+g:d+f;attr_name_cache[b]=d}a.setAttribute(d,c)}function setAttrs(a,b){if(b)for(var c in b)setAttr(a,c,b[c])}
function removeChildren(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}
function miniJSONify(a,b){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var c=null,d=0;d<a.length;++d)c=(null==c?"":c+", ")+miniJSONify(a[d],b);return"["+(c?c:"")+"]"}b=b||{};c=null;for(d in a)b[d]||void 0!=d&&"function"!=typeof a[d]&&(c=(null==c?"":c+", ")+d+": "+miniJSONify(a[d],b));return"{"+(c?c:"")+"}"}return typeof a}
function shallowCopy(a){var b={},c;for(c in a)b[c]=a[c];return b}function Observed(a){this.value=a;this.listeners=[]}Observed.prototype.addListener=function(a){this.listeners.push(a)};Observed.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};Observed.prototype.removeListener=function(a){arrayRemove(this.listeners,a)};Observed.prototype.get=function(){return this.value};Observed.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
function Awaited(){this.queue=[]}Awaited.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};Awaited.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var __dalliance_saltSeed=0;function saltURL(a){return a+"?salt="+b64_sha1(""+Date.now()+","+ ++__dalliance_saltSeed)}
function textXHR(a,b,c){c.salt&&(a=saltURL(a));var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(300<=d.status?b(null,"Error code "+d.status):b(d.responseText))};d.open("GET",a,!0);d.responseType="text";c&&c.credentials&&(d.withCredentials=!0);d.send("")}function relativeURL(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"use strict";var VERSION={CONFIG:5,MAJOR:0,MINOR:11,MICRO:10,PATCH:"",BRANCH:"dev",toString:function(){var a=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(a+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(a=a+"-"+this.BRANCH);return a}};"use strict";function formatLongInt(a){return(a|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
Browser.prototype.initUI=function(a,b){document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/bootstrap-scoped.css"}));document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/dalliance-scoped.css"}));document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/font-awesome.min.css"}));var c=this;c.disableDefaultFeaturePopup||this.addFeatureListener(function(a,b,d,e){c.featurePopup(a,b,d,e)});a.classList.add("dalliance");
var d=c.toolbar=makeElement("div",null,{className:"btn-toolbar toolbar"}),e=c.coordSystem.speciesName+" "+c.nameForCoordSystem(c.coordSystem);this.setDocumentTitle&&(document.title=e+" :: dalliance");var f=makeElement("input","",{className:"loc-field"});c.makeTooltip(f,"Enter a genomic location or gene name");var g=makeElement("p","",{className:"loc-status"}),h=makeElement("a",[makeElement("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),k=makeElement("input","",{type:"range",min:100,
max:250},{className:"zoom-slider"},{width:"150px"}),l=makeElement("a",[makeElement("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),m=makeElement("a",[makeElement("i",null,{className:"fa fa-eraser"})],{className:"btn"}),n=makeElement("a",[makeElement("i",null,{className:"fa fa-plus"})],{className:"btn"}),p=makeElement("a",[makeElement("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),r=makeElement("a",[makeElement("i",null,{className:"fa fa-print"})],{className:"btn"});makeElement("a",
[makeElement("i",null,{className:"fa fa-refresh"})],{className:"btn"});var q=makeElement("a",[makeElement("i",null,{className:"fa fa-cogs"})],{className:"btn"}),s=makeElement("a",[makeElement("i",null,{className:"fa fa-question"})],{className:"btn"}),v=makeElement("a",[makeElement("i",null,{className:"fa fa-road"})],{className:"btn"});c.makeTooltip(v,"Configure currently selected track(s) (E)");var t=makeElement("a",[makeElement("i",null,{className:"fa fa-chevron-left"})],{className:"btn"}),u=makeElement("a",
[makeElement("i",null,{className:"fa fa-chevron-right"})],{className:"btn pull-right"}),w=makeElement("div",null,{className:"btn-group pull-right"});this.noTrackAdder||w.appendChild(n);this.noTrackEditor||w.appendChild(v);this.noExport||w.appendChild(r);this.noOptions||w.appendChild(q);this.noHelp||w.appendChild(s);this.setUiMode=function(a){this.uiMode=a;var b={help:s,add:n,opts:q,"export":r,tier:v},c;for(c in b)c==a?b[c].classList.add("active"):b[c].classList.remove("active")};this.noLeapButtons||
d.appendChild(u);w.firstChild&&d.appendChild(w);this.noLeapButtons||d.appendChild(t);this.noTitle||d.appendChild(makeElement("div",makeElement("h4",e,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||d.appendChild(makeElement("div",[f,g],{className:"btn-group loc-group"}));this.noClearHighlightsButton||d.appendChild(m);this.noZoomSlider||d.appendChild(makeElement("div",[h,makeElement("span",k,{className:"btn"}),l],{className:"btn-group"}));a.appendChild(d);a.appendChild(b);
this.addViewListener(function(a,b,d,e,g){f.value=a+":"+formatLongInt(b)+".."+formatLongInt(d);k.min=g.min|0;k.max=g.max|0;k.value=g.current|0;c.storeStatus&&c.storeViewStatus();m.style.display=0<c.highlights.length?"inline-block":"none"});this.addTierListener(function(){c.storeStatus&&c.storeTierStatus()});f.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),c.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),c.search(f.value,function(a){g.textContent=
a?""+a:""})},!1);var x;n.addEventListener("click",function(a){x&&x.displayed?c.removeAllPopups():x=c.showTrackAdder(a)},!1);c.makeTooltip(n,"Add a new track from the registry or an indexed file. (A)");h.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(-10)},!1);c.makeTooltip(h,"Zoom in (+)");l.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(10)},!1);c.makeTooltip(l,"Zoom out (-)");k.addEventListener("change",function(a){c.zoomSliderValue=
1*k.value;c.zoom(Math.exp(1*k.value/c.zoomExpt))},!1);p.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);c.makeTooltip(p,"Favourite regions");r.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.openExportPanel()},!1);c.makeTooltip(r,"Export publication-quality SVG. (X)");q.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleOptsPopup(a)},!1);c.makeTooltip(q,"Configure options.");s.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();c.toggleHelpPopup(a)});c.makeTooltip(s,"Help; Keyboard shortcuts. (H)");v.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]])},!1);t.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?-1:1,!1)},!1);c.makeTooltip(t,function(a){a=c.getSelectedTier();var b;0<=a&&(b=c.tiers[a]);return b&&b.featureSource&&sourceAdapterIsCapable(b.featureSource,
"quantLeap")&&"number"==typeof b.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(b.config.name||b.dasSource.name)+'"" (ctrl+LEFT)':b&&b.featureSource&&sourceAdapterIsCapable(b.featureSource,"leap")?'Jump to the next feature in the selected track "'+(b.config.name||b.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});u.addEventListener("click",function(a){c.leap(c.reverseKeyScrolling?1:-1,!1)},!1);c.makeTooltip(u,function(a){a=c.getSelectedTier();
var b;0<=a&&(b=c.tiers[a]);return b&&b.featureSource&&sourceAdapterIsCapable(b.featureSource,"quantLeap")&&"number"==typeof b.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(b.config.name||b.dasSource.name)+'"" (ctrl+RIGHT)':b&&b.featureSource&&sourceAdapterIsCapable(b.featureSource,"leap")?'Jump to the next feature in the selected track "'+(b.config.name||b.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});m.addEventListener("click",
function(a){c.clearHighlights()},!1);c.makeTooltip(m,"Clear highlights (C)");c.addTierSelectionWrapListener(function(a){0>a&&(c.setSelectedTier(null),f.focus())});c.addTierSelectionListener(function(a){"tier"===c.uiMode&&(0==a.length?(c.hideToolPanel(),c.manipulatingTier=null,c.uiMode="none"):(a=c.tiers[a[0]],a!=c.manipulatingTier&&c.openTierPanel(a)))});var B=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),c.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),
a.preventDefault(),c.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==c.selectedTiers.length&&c.openTierPanel(c.tiers[c.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),c.openExportPanel();else if(67==a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),c.clearHighlights()};a.addEventListener("focus",function(b){a.addEventListener("keydown",B,!1)},!1);a.addEventListener("blur",function(b){a.removeEventListener("keydown",
B,!1)},!1);a.addEventListener("keydown",function(a){27===a.keyCode&&(a.preventDefault(),a.stopPropagation(),c.uiMode="none",c.hideToolPanel(),c.selectedTiers&&0<c.selectedTiers.length&&c.browserHolder.focus())},!1)};
Browser.prototype.showToolPanel=function(a,b){var c=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var d;d=b?a:makeElement("div",a,{},{overflowY:"auto",width:"100%"});var e=makeElement("div",makeElement("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});e.addEventListener("click",function(a){c.hideToolPanel();c.setUiMode("none")},!1);this.makeTooltip(e,"Close tool panel (ESC)");this.activeToolPanel=makeElement("div",[e,d],{className:"tool-holder"});
this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();c=this};Browser.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};
Browser.prototype.toggleHelpPopup=function(a){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(a=makeElement("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.uiPrefix+"help/index.html",className:"help-panel"}),this.showToolPanel(a,!0),this.setUiMode("help"))};
Browser.prototype.toggleOptsPopup=function(a){var b=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{a=makeElement("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var c=makeElement("table");c.cellPadding=5;var d=makeElement("input","",{type:"checkbox",checked:b.reverseScrolling});d.addEventListener("change",function(a){b.reverseScrolling=d.checked;b.storeStatus()},!1);c.appendChild(makeElement("tr",
[makeElement("td","Reverse trackpad scrolling",{align:"right"}),makeElement("td",d)]));var e=makeElement("input","",{type:"checkbox",checked:b.reverseKeyScrolling});e.addEventListener("change",function(a){b.reverseKeyScrolling=e.checked;b.storeStatus()},!1);c.appendChild(makeElement("tr",[makeElement("td","Reverse scrolling buttons and keys",{align:"right"}),makeElement("td",e)]));var f=makeElement("select");f.appendChild(makeElement("option","Left",{value:"left"}));f.appendChild(makeElement("option",
"Center",{value:"center"}));f.appendChild(makeElement("option","Right",{value:"right"}));f.appendChild(makeElement("option","None",{value:"none"}));f.value=b.rulerLocation;f.addEventListener("change",function(a){b.rulerLocation=f.value;b.positionRuler();for(a=0;a<b.tiers.length;++a)b.tiers[a].paintQuant();b.storeStatus()},!1);c.appendChild(makeElement("tr",[makeElement("td","Vertical guideline",{align:"right"}),makeElement("td",f)]));a.appendChild(c);c=makeElement("button","Reset browser",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});c.addEventListener("click",function(a){b.reset()},!1);a.appendChild(c);this.showToolPanel(a);this.setUiMode("opts")}};"use strict";function SVGPath(){this.ops=[]}SVGPath.prototype.moveTo=function(a,b){this.ops.push("M "+a+" "+b)};SVGPath.prototype.lineTo=function(a,b){this.ops.push("L "+a+" "+b)};SVGPath.prototype.closePath=function(){this.ops.push("Z")};SVGPath.prototype.toPathData=function(){return this.ops.join(" ")};
function PathGlyphBase(a,b){this._stroke=a;this._fill=b}PathGlyphBase.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};PathGlyphBase.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};
PathGlyphBase.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};function BoxGlyph(a,b,c,d,e,f,g,h){this.x=a;this.y=b;this._width=c;this._height=d;this.fill=e;this.stroke=f;this._alpha=g;this._radius=h||0}
BoxGlyph.prototype.draw=function(a){var b=this._radius;0<b?(a.beginPath(),a.moveTo(this.x+b,this.y),a.lineTo(this.x+this._width-b,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b),a.lineTo(this.x+this._width,this.y+this._height-b),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,b),a.lineTo(this.x+b,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b),a.lineTo(this.x,this.y+b),a.arcTo(this.x,this.y,this.x+
b,this.y,b),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};
BoxGlyph.prototype.toSVG=function(){var a=makeElementNS(NS_SVG,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};BoxGlyph.prototype.min=function(){return this.x};BoxGlyph.prototype.max=function(){return this.x+this._width};BoxGlyph.prototype.height=function(){return this.y+this._height};
function GroupGlyph(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();for(var c=[],d=0;d<a.length;++d){var e=a[d];c.push(new Range(e.min(),e.max()));this.h=Math.max(this.h,e.height())}this.coverage=union(c)}
GroupGlyph.prototype.drawConnectors=function(a){for(var b=this.coverage.ranges(),c=1;c<b.length;++c){var d=b[c],e=b[c-1];if(e&&d.min()>e.max()){var e=e.max(),d=d.min(),f=(e+d)/2;"hat+"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(f,0),a.lineTo(d,this.h/2)):"hat-"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(f,this.h),a.lineTo(d,this.h/2)):"collapsed+"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(d,this.h/2),4<d-e&&(a.moveTo(f-2,this.h/2-3),a.lineTo(f+2,this.h/2),a.lineTo(f-2,this.h/2+3))):
"collapsed-"===this.connector?(a.moveTo(e,this.h/2),a.lineTo(d,this.h/2),4<d-e&&(a.moveTo(f+2,this.h/2-3),a.lineTo(f-2,this.h/2),a.lineTo(f+2,this.h/2+3))):(a.moveTo(e,this.h/2),a.lineTo(d,this.h/2))}}};GroupGlyph.prototype.draw=function(a){for(var b=0;b<this.glyphs.length;++b)this.glyphs[b].draw(a);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};
GroupGlyph.prototype.toSVG=function(){for(var a=makeElementNS(NS_SVG,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());b=new SVGPath;this.drawConnectors(b);0<b.toPathData().length&&(b=makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(b));return a};GroupGlyph.prototype.min=function(){return this.coverage.min()};GroupGlyph.prototype.max=function(){return this.coverage.max()};GroupGlyph.prototype.height=function(){return this.h};
function LineGraphGlyph(a,b,c){this.points=a;this.color=b;this._height=c||50}LineGraphGlyph.prototype.min=function(){return this.points[0]};LineGraphGlyph.prototype.max=function(){return this.points[this.points.length-2]};LineGraphGlyph.prototype.height=function(){return this._height};
LineGraphGlyph.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b+=2){var c=this.points[b],d=this.points[b+1];0==b?a.moveTo(c,d):a.lineTo(c,d)}a.stroke();a.restore()};LineGraphGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<this.points.length;b+=2){var c=this.points[b],d=this.points[b+1];0==b?a.moveTo(c,d):a.lineTo(c,d)}return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};
function LabelledGlyph(a,b,c,d,e,f){this.glyph=a;this.text=b;this.anchor=d||"left";this.align=e||"below";f&&(this.font=f);this.font&&(GLOBAL_GC.save(),GLOBAL_GC.font=this.font);b=GLOBAL_GC.measureText(b);this.font&&GLOBAL_GC.restore();this.textLen=b.width;this.textHeight=5;this.bump=a.bump;this.measured=!c}
LabelledGlyph.prototype.toSVG=function(){var a=this.glyph.toSVG(),b={};"above"==this.align?(a=makeElementNS(NS_SVG,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return makeElementNS(NS_SVG,"g",[a,makeElementNS(NS_SVG,"text",this.text,b)])};LabelledGlyph.prototype.min=function(){return this.glyph.min()};
LabelledGlyph.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};LabelledGlyph.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};
LabelledGlyph.prototype.draw=function(a){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();a.fillStyle="black";this.font&&(a.save(),a.font=this.font);var b;b="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};function CrossGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}
CrossGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};CrossGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};
CrossGlyph.prototype.min=function(){return this._x-this._height/2};CrossGlyph.prototype.max=function(){return this._x+this._height/2};CrossGlyph.prototype.height=function(){return this._height};function ExGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}ExGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};
ExGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};ExGlyph.prototype.min=function(){return this._x-this._height/2};ExGlyph.prototype.max=function(){return this._x+this._height/2};ExGlyph.prototype.height=function(){return this._height};
function TriangleGlyph(a,b,c,d,e,f){PathGlyphBase.call(this,f,e);this._x=a;this._height=b;this._dir=c;this._width=d}TriangleGlyph.prototype=Object.create(PathGlyphBase.prototype);
TriangleGlyph.prototype.drawPath=function(a){var b=this._height/2,c=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-c,0),a.lineTo(this._x+c,0)):"W"===this._dir?(a.moveTo(this._x+c,b),a.lineTo(this._x-c,0),a.lineTo(this._x-c,this._height)):"E"===this._dir?(a.moveTo(this._x-c,b),a.lineTo(this._x+c,0),a.lineTo(this._x+c,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+c,this._height),a.lineTo(this._x-c,this._height));a.closePath()};
TriangleGlyph.prototype.min=function(){return this._x-this._height/2};TriangleGlyph.prototype.max=function(){return this._x+this._height/2};TriangleGlyph.prototype.height=function(){return this._height};function DotGlyph(a,b,c,d){this._x=a;this._height=b;this._fill=c;this._stroke=d}DotGlyph.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};
DotGlyph.prototype.toSVG=function(){var a=this._height/2;return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};DotGlyph.prototype.min=function(){return this._x-this._height/2};DotGlyph.prototype.max=function(){return this._x+this._height/2};DotGlyph.prototype.height=function(){return this._height};function PaddedGlyph(a,b,c){this.glyph=a;this._min=b;this._max=c;a&&(this.bump=a.bump)}
PaddedGlyph.prototype.draw=function(a){this.glyph&&this.glyph.draw(a)};PaddedGlyph.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():makeElementNS(NS_SVG,"g")};PaddedGlyph.prototype.min=function(){return this._min};PaddedGlyph.prototype.max=function(){return this._max};PaddedGlyph.prototype.height=function(){return this.glyph?this.glyph.height():1};function AArrowGlyph(a,b,c,d,e,f){PathGlyphBase.call(this,e,d);this._min=a;this._max=b;this._height=c;this._ori=f}
AArrowGlyph.prototype=Object.create(PathGlyphBase.prototype);AArrowGlyph.prototype.min=function(){return this._min};AArrowGlyph.prototype.max=function(){return this._max};AArrowGlyph.prototype.height=function(){return this._height};
AArrowGlyph.prototype.drawPath=function(a){var b=this._max,c=this._min,d=this._height,e=0,f=0,g=this._height+2,h=0.333333*this._height;this._ori&&("+"===this._ori?f=0.5*this._height:"-"===this._ori&&(e=0.5*this._height));b-c<g&&(c=(b+c-g)/2,b=c+g);a.moveTo(c+e,0+h);a.lineTo(b-f,0+h);a.lineTo(b-f,0);a.lineTo(b,0+this._height/2);a.lineTo(b-f,0+d);a.lineTo(b-f,0+h+h);a.lineTo(c+e,0+h+h);a.lineTo(c+e,0+d);a.lineTo(c,0+d/2);a.lineTo(c+e,0);a.lineTo(c+e,0+h)};
function SpanGlyph(a,b,c,d){PathGlyphBase.call(this,d,null);this._min=a;this._max=b;this._height=c}SpanGlyph.prototype=Object.create(PathGlyphBase.prototype);SpanGlyph.prototype.min=function(){return this._min};SpanGlyph.prototype.max=function(){return this._max};SpanGlyph.prototype.height=function(){return this._height};SpanGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,e);a.lineTo(c,e);a.moveTo(b,0);a.lineTo(b,d);a.moveTo(c,0);a.lineTo(c,d)};
function LineGlyph(a,b,c,d,e,f){this._min=a;this._max=b;this._height=c;this._style=d;this._strand=e;this._stroke=f}LineGlyph.prototype.min=function(){return this._min};LineGlyph.prototype.max=function(){return this._max};LineGlyph.prototype.height=function(){return this._height};LineGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;"hat"===this._style?(a.moveTo(b,e),a.lineTo((b+c)/2,"-"===this._strand?d:0)):a.moveTo(b,e);a.lineTo(c,e)};
LineGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};LineGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return makeElementNS(NS_SVG,"path",null,a)};
function PrimersGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}PrimersGlyph.prototype.min=function(){return this._min};PrimersGlyph.prototype.max=function(){return this._max};PrimersGlyph.prototype.height=function(){return this._height};PrimersGlyph.prototype.drawStemPath=function(a){var b=this._max,c=this._height/2;a.moveTo(this._min,c);a.lineTo(b,c)};
PrimersGlyph.prototype.drawTrigsPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,0);a.lineTo(b+d,e);a.lineTo(b,d);a.lineTo(b,0);a.moveTo(c,0);a.lineTo(c-d,e);a.lineTo(c,d);a.lineTo(c,0)};PrimersGlyph.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};
PrimersGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawStemPath(a);var b=new SVGPath;this.drawTrigsPath(b);return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};function ArrowGlyph(a,b,c,d,e,f,g){PathGlyphBase.call(this,null,d);this._min=a;this._max=b;this._height=c;this._color=d;this._parallel=e;this._sw=f;this._ne=g}ArrowGlyph.prototype=Object.create(PathGlyphBase.prototype);
ArrowGlyph.prototype.min=function(){return this._min};ArrowGlyph.prototype.max=function(){return this._max};ArrowGlyph.prototype.height=function(){return this._height};
ArrowGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height;if(this._parallel){var e=d/2,f=0.4*d;this._sw?(a.moveTo(b+e,d-f),a.lineTo(b+e,d),a.lineTo(b,e),a.lineTo(b+e,0),a.lineTo(b+e,f)):(a.moveTo(b,d-f),a.lineTo(b,f));this._ne?(a.lineTo(c-e,f),a.lineTo(c-e,0),a.lineTo(c,e),a.lineTo(c-e,d),a.lineTo(c-e,d-f)):(a.lineTo(c,f),a.lineTo(c,d-f))}else{var e=(b+c)/2,f=0.4*(c-b),g=d/3;this._ne?(a.moveTo(b+f,g),a.lineTo(b,g),a.lineTo(e,0),a.lineTo(c,g),a.lineTo(c-f,g)):(a.moveTo(b+
f,0),a.lineTo(c-f,0));this._sw?(a.lineTo(c-f,d-g),a.lineTo(c,d-g),a.lineTo(e,d),a.lineTo(b,d-g),a.lineTo(b+f,d-g)):(a.lineTo(c-f,d),a.lineTo(b+f,d))}a.closePath()};function TooManyGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}TooManyGlyph.prototype.min=function(){return this._min};TooManyGlyph.prototype.max=function(){return this._max};TooManyGlyph.prototype.height=function(){return this._height};
TooManyGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};
TooManyGlyph.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b+=3)a.moveTo(this._min,b),a.lineTo(this._max,b);a.stroke()}};function TextGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._string=e;this._textLen=GLOBAL_GC.measureText(e).width}
TextGlyph.prototype.min=function(){return this._min};TextGlyph.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};TextGlyph.prototype.height=function(){return this._height};TextGlyph.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};TextGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"text",this._string,{x:this._min,y:this._height-4})};
(function(a){function b(a,b,c,d,k,l,m){this._min=a;this._max=b;this._height=c;this._seq=d;this._ref=k;this._scheme=l;this._quals=m}var c=1<window.devicePixelRatio,d={};b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this._height};b.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};b.prototype.draw=function(a){var b=this._seq;b||(b="NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN");
for(var g=(this._max-this._min+1)/b.length,h=0;h<b.length;++h){var k=b.substr(h,1).toUpperCase(),l=baseColors[k];l||(l="gray");"mismatch"===this._scheme&&this._ref&&(l=this._ref.substr(h,1).toUpperCase(),l="N"===l?"gray":l===k?"black":"red");if(this._quals){var m=this._quals.charCodeAt(h)-33,n=a.globalAlpha;a.globalAlpha=this.alphaForQual(m)}if(8<=g){var m=l+"_"+k,p=d[m];if(!p){p=document.createElement("canvas");c?(p.width=16,p.height=20):(p.width=8,p.height=10);var r=p.getContext("2d");c&&r.scale(2,
2);r.fillStyle=l;r.fillText(k,0,8);d[m]=p}c?a.drawImage(p,this._min+h*g,0,8,10):a.drawImage(p,this._min+h*g,0)}else a.fillStyle=l,a.fillRect(this._min+h*g,0,g,this._height);this._quals&&(a.globalAlpha=n)}};b.prototype.toSVG=function(){for(var a=this._seq,b=(this._max-this._min+1)/this._seq.length,c=makeElementNS(NS_SVG,"g"),d=0;d<a.length;++d){var k=a.substr(d,1).toUpperCase(),l=baseColors[k];l||(l="gray");"mismatch"===this._scheme&&this._ref&&(l=this._ref.substr(d,1).toUpperCase(),l="N"===l?"gray":
l===k?"black":"red");var m=1;this._quals&&(m=this._quals.charCodeAt(d)-33,m=this.alphaForQual(m));8<=b?c.appendChild(makeElementNS(NS_SVG,"text",k,{x:this._min+d*b,y:8,fill:l,fillOpacity:m})):c.appendChild(makeElementNS(NS_SVG,"rect",null,{x:this._min+d*b,y:0,width:b,height:this._height,fill:l,fillOpacity:m}))}return c};a.SequenceGlyph=b})(this);function TranslatedGlyph(a,b,c,d){this.glyph=a;this._height=d;this._x=b;this._y=c}
TranslatedGlyph.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};TranslatedGlyph.prototype.min=function(){return this.glyph.min()+this._x};TranslatedGlyph.prototype.max=function(){return this.glyph.max()+this._x};TranslatedGlyph.prototype.minY=function(){return this._y};TranslatedGlyph.prototype.maxY=function(){return this._y+this.glyph.height()};TranslatedGlyph.prototype.draw=function(a){a.save();a.translate(this._x,this._y);this.glyph.draw(a);a.restore()};
TranslatedGlyph.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};function PointGlyph(a,b,c,d){this._x=a;this._y=b;this._height=c;this._fill=d}PointGlyph.prototype.min=function(){return this._x-2};PointGlyph.prototype.max=function(){return this._x+2};PointGlyph.prototype.height=function(){return this._height};
PointGlyph.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};PointGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};function GridGlyph(a){this._height=a||50}GridGlyph.prototype.notSelectable=!0;GridGlyph.prototype.min=function(){return-1E5};GridGlyph.prototype.max=function(){return 1E5};GridGlyph.prototype.height=function(){return this._height};
GridGlyph.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);a.stroke();a.restore()};GridGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};
function StarGlyph(a,b,c,d,e){PathGlyphBase.call(this,e,d);this._x=a;this._r=b;this._points=c}StarGlyph.prototype=Object.create(PathGlyphBase.prototype);StarGlyph.prototype.min=function(){return this._x-this._r};StarGlyph.prototype.max=function(){return this._x+this._r};StarGlyph.prototype.height=function(){return 2*this._r};
StarGlyph.prototype.drawPath=function(a){for(var b=this._x,c=this._r,d=this._r,e=0;e<this._points;++e){var f=6.28*e/this._points,g=b+d*Math.sin(f),f=c-d*Math.cos(f);0==e?a.moveTo(g,f):a.lineTo(g,f);f=6.28*(e+0.5)/this._points;g=b+0.4*d*Math.sin(f);f=c-0.4*d*Math.cos(f);a.lineTo(g,f)}a.closePath()};function PlimsollGlyph(a,b,c,d,e){this._x=a;this._height=b;this._overhang=c;this._fill=d;this._stroke=e;this._hh=b/2}
PlimsollGlyph.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};
PlimsollGlyph.prototype.toSVG=function(){var a=this._hh;return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),makeElementNS(NS_SVG,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};PlimsollGlyph.prototype.min=function(){return this._x-this._hh};PlimsollGlyph.prototype.max=function(){return this._x+this._hh};PlimsollGlyph.prototype.height=function(){return this._height};
"use strict";
Browser.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+
this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};Browser.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};
Browser.prototype.storeViewStatus=function(){this.cookieKey&&(!this.noPersist&&!this.noPersistView)&&(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+
this.cookieKey+".current-seq-length"]=this.currentSeqMax))};
Browser.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var a=[],b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.dasSource.noPersist||a.push({source:c.dasSource,config:c.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(a);a={};b=[];for(c=0;c<this.hubObjects.length;++c){var d=this.hubObjects[c],e={url:d.hub.url,genome:d.genome};d.credentials&&(e.credentials=d.credentials);d.mapping&&(e.mapping=d.mapping);a[e.url]=!0;b.push(e)}for(c=0;c<
this.hubs.length;++c)e=this.hubs[c],"string"===typeof e&&(e={url:e}),a[e.url]||b.push(e);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+
this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=VERSION.CONFIG}};
Browser.prototype.restoreStatus=function(){if(!this.noPersist){var a=localStorage["dalliance."+this.cookieKey+".version"];if(VERSION.CONFIG==(a?a|0:-100)){var a=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=hex_sha1(miniJSONify({sources:this.sources,hubs:this.hubs}));if(b!=a)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{a={};for(b=0;b<this.sources.length;++b){var c=this.sources[b],d=sourceDataURI(c),e=a[d];e||(a[d]=e=[]);e.push(c)}if(!this.noPersistView&&(b=localStorage["dalliance."+
this.cookieKey+".view-chr"],c=localStorage["dalliance."+this.cookieKey+".view-start"]|0,e=localStorage["dalliance."+this.cookieKey+".view-end"]|0,b&&c&&e)){this.chr=b;this.viewStart=c;this.viewEnd=e;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"===typeof b&&!isNaN(b)&&(this.savedZoom=b)}this.reverseScrolling=
(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==b;if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+
".sources"]){var f=JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<f.length;++b){c=this.sources[b]=f[b].source;this.restoredConfigs[b]=f[b].config;d=sourceDataURI(c);e=a[d]||[];for(d=0;d<e.length;++d){var g=e[d];sourcesAreEqual(c,g)&&g.featureInfoPlugin&&(c.featureInfoPlugin=g.featureInfoPlugin)}}}if(a=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(a);return!0}}}};
Browser.prototype.reset=function(){for(var a=this.tiers.length-1;0<=a;--a)this.removeTier({index:a},!0);for(a=0;a<this.defaultSources.length;++a)this.defaultSources[a].disabled||this.addTier(this.defaultSources[a]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)};"use strict";var __dalliance_sourceAdapterFactories={};function dalliance_registerSourceAdapterFactory(a,b){__dalliance_sourceAdapterFactories[a]=b}
(function(a){var b={};a.dalliance_registerParserFactory=function(a,d){b[a]=d};a.dalliance_makeParser=function(a){if(b[a])return b[a](a)}})(this);
DasTier.prototype.initSources=function(){var a=this,b=new DummyFeatureSource,c;"sequence"==this.dasSource.tier_type?c=this.dasSource.twoBitURI?new TwoBitSequenceSource(this.dasSource):new DASSequenceSource(this.dasSource):b=this.browser.createFeatureSource(this.dasSource);this.featureSource=b;this.sequenceSource=c;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};
Browser.prototype.createFeatureSource=function(a){var b=this.sourceCache.get(a);if(b)return b;if(a.tier_type&&__dalliance_sourceAdapterFactories[a.tier_type])b=(0,__dalliance_sourceAdapterFactories[a.tier_type])(a).features;else if(a.bwgURI||a.bwgBlob)var c=this.getWorker(),b=c?new RemoteBWGFeatureSource(a,c):new BWGFeatureSource(a);else if(a.bamURI||a.bamBlob)b=(c=this.getWorker())?new RemoteBAMFeatureSource(a,c):new BAMFeatureSource(a);else if(a.bamblrURI)b=new BamblrFeatureSource(a);else if(a.jbURI)b=
new JBrowseFeatureSource(a);else if(a.uri||a.features_uri)b=new DASFeatureSource(a);if(a.overlay){c=[];b&&c.push(new CachingFeatureSource(b));for(b=0;b<a.overlay.length;++b)c.push(this.createFeatureSource(a.overlay[b]));b=new OverlayFeatureSource(c,a)}a.mapping&&(b=new MappedFeatureSource(b,this.chains[a.mapping]));a.name&&!b.name&&(b.name=a.name);null!=b&&(b=new CachingFeatureSource(b),this.sourceCache.put(a,b));return b};function SourceCache(){this.sourcesByURI={}}
SourceCache.prototype.get=function(a){var b=this.sourcesByURI[sourceDataURI(a)];if(b)for(var c=0;c<b.configs.length;++c)if(sourcesAreEqual(b.configs[c],a))return b.sources[c]};SourceCache.prototype.put=function(a,b){var c=sourceDataURI(a),d=this.sourcesByURI[c];d||(d={configs:[],sources:[]},this.sourcesByURI[c]=d);d.configs.push(a);d.sources.push(b)};var __cfs_id_seed=0;
function CachingFeatureSource(a){var b=this;this.source=a;this.cfsid="cfs"+ ++__cfs_id_seed;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){b.cfsid="cfs"+ ++__cfs_id_seed})}CachingFeatureSource.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};CachingFeatureSource.prototype.search=function(a,b){if(this.source.search)return this.source.search(a,b)};
CachingFeatureSource.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};CachingFeatureSource.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};CachingFeatureSource.prototype.getScales=function(){return this.source.getScales()};CachingFeatureSource.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};
CachingFeatureSource.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};CachingFeatureSource.prototype.findNextFeature=function(a,b,c,d){this.source.findNextFeature(a,b,c,d)};CachingFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){this.source.quantFindNextFeature(a,b,c,d,e)};CachingFeatureSource.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};
CachingFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){if(null==f)throw"pool is null...";var h=f.awaitedFeatures[this.cfsid];h||(h=new Awaited,f.awaitedFeatures[this.cfsid]=h,this.source.fetch(a,b,c,d,e,f,function(a,b,c,d){h.res||h.provide({status:a,features:b,scale:c,coverage:d})}));h.await(function(a){g(a.status,a.features,a.scale,a.coverage)})};function FeatureSourceBase(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}
FeatureSourceBase.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};FeatureSourceBase.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(b){console.log(b)}};FeatureSourceBase.prototype.addActivityListener=function(a){this.activityListeners.push(a)};FeatureSourceBase.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
FeatureSourceBase.prototype.getScales=function(){return null};FeatureSourceBase.prototype.fetch=function(a,b,c,d,e,f,g){return g(null,[],1E9)};FeatureSourceBase.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};function DASFeatureSource(a){this.dasSource=new DASSource(a);this.busy=0;this.activityListeners=[]}DASFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
DASFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};DASFeatureSource.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};
DASFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){if(e&&0==e.length)g(null,[],d);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return g(null,this.cachedStaticFeatures,this.cachedStaticScale);var h=!1!==this.dasSource.maxbins;e={type:e};h&&(e.maxbins=1+((c-b)/d|0));var k=this;k.busy++;k.notifyActivity();this.dasSource.features(new DASSegment(a,b,c),e,function(a,b){k.busy--;k.notifyActivity();var c=d;h||(c=0.1);!b&&k.dasSource.dasStaticFeatures&&
(k.cachedStaticFeatures=a,k.cachedStaticScale=c);g(b,a,c)})}};
DASFeatureSource.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,c,d){if(this.dasSource.capabilities&&0<=arrayIndexOf(this.dasSource.capabilities,"das1:adjacent-feature")){var e=this;if(this.dasAdjLock)return dlog("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(b|0)+":"+(0<c?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=b;thisTier.dasSource.features(null,a,function(a){e.dasAdjLock=!1;0<a.length&&null!=a[0]&&(dlog("DAS adjacent seems to be working..."),
d(a[0]))})}};function DASSequenceSource(a){this.dasSource=new DASSource(a);this.awaitedEntryPoints=new Awaited;var b=this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}DASSequenceSource.prototype.fetch=function(a,b,c,d,e){this.dasSource.sequence(new DASSegment(a,b,c),function(a){return 1==a.length?e(null,a[0]):e("Didn't get sequence")})};
DASSequenceSource.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(c){for(var d=0;d<c.length;++d)if(c[d].name==a)return b({length:c[d].end});return b()})};function TwoBitSequenceSource(a){var b=this;this.source=a;this.twoBit=new Awaited;makeTwoBit(new URLFetchable(a.twoBitURI),function(a,d){d?dlog(d):b.twoBit.provide(a)})}
TwoBitSequenceSource.prototype.fetch=function(a,b,c,d,e){this.twoBit.await(function(d){d.fetch(a,b,c,function(d,f){if(f)return e(f,null);var k=new DASSequence(a,b,c,"DNA",d);return e(null,k)})})};TwoBitSequenceSource.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(c){c.getSeq(a)?c.getSeq(a).length(function(a){b({length:a})}):b()})};DASFeatureSource.prototype.getScales=function(){return[]};var bwg_preflights={};
function BWGFeatureSource(a){FeatureSourceBase.call(this);var b=this;this.readiness="Connecting";this.bwgSource=this.opts=a;b.bwgHolder=new Awaited;if(this.opts.preflight){var c=bwg_preflights[this.opts.preflight];if(!c){c=new Awaited;bwg_preflights[this.opts.preflight]=c;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c.provide("success"):c.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(d.withCredentials=
!0);d.send("")}c.await(function(a){"success"===a&&b.init()})}else b.init()}BWGFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);
BWGFeatureSource.prototype.init=function(){var a=this,b,c;this.bwgSource.bwgURI?(b=makeBwgFromURL,c=this.bwgSource.bwgURI):(b=makeBwgFromFile,c=this.bwgSource.bwgBlob);b(c,function(b,c){c?(a.error=c,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(b),a.readiness=null,a.notifyReadiness(),"bigbed"==b.type&&b.getExtraIndices(function(b){a.extraIndices=b}))},this.opts.credentials)};
BWGFeatureSource.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var b=0;b<this.extraIndices.length;++b)a.search.push(this.extraIndices[b].field)}return a};
BWGFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=this;this.bwgHolder.await(function(f){if(null==f)return g(h.error||"Can't access binary file",null,null);var l;l=!e||0==e.length||0<=arrayIndexOf(e,"density");h.opts.clientBin&&(l=!1);if("bigwig"==f.type||l||"undefined"!==typeof h.opts.forceReduction){l=-1;for(var m=0;m<f.zoomLevels.length;++m)if(f.zoomLevels[m].reduction<=d)l=m;else break;"undefined"!==typeof h.opts.forceReduction&&(l=h.opts.forceReduction);l=0>l?f.getUnzoomedView():
f.getZoomedView(l)}else l=f.getUnzoomedView();h.busy++;h.notifyActivity();l.readWigData(a,b,c,function(a){h.busy--;h.notifyActivity();var d=1E9;if("bigwig"===f.type){var e=(c-b)/a.length/2;e<d&&(d=e)}if(h.opts.link)for(e=0;e<a.length;++e){var l=a[e];l.label&&(l.links=[new DASLink("Link",h.opts.link.replace(/\$\$/,l.label))])}g(null,a,d)})})};
BWGFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){var f=this;f.busy++;f.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,c,d,function(a,b){f.busy--;f.notifyActivity();return e(a,b)})};BWGFeatureSource.prototype.findNextFeature=function(a,b,c,d){var e=this;e.busy++;e.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,c,function(a){e.busy--;e.notifyActivity();0<a.length&&null!=a[0]&&d(a[0])})};
BWGFeatureSource.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],c=0;c<a.zoomLevels.length;++c)b.push(a.zoomLevels[c].reduction);return b}return null};BWGFeatureSource.prototype.search=function(a,b){return!this.extraIndices||0==this.extraIndices.length?b(null,"No indices available"):this.extraIndices[0].lookup(a,b)};
BWGFeatureSource.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(b){b&&b.schema&&b.definedFieldCount<b.schema.fields.length&&a(function(a,d){for(var e=b.definedFieldCount;e<b.schema.fields.length;++e){var f=b.schema.fields[e];d.add(f.comment,a[f.name])}})})};
BWGFeatureSource.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new DASStylesheet;if("bigbed"==b.type){var d=new DASStyle;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;c.pushStyle({type:"bigwig"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;c.pushStyle({type:"bb-translation"},null,d);d=new DASStyle;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";
d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;c.pushStyle({type:"bb-transcript"},null,d);d=new DASStyle;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2="black";d.HEIGHT=30;c.pushStyle({type:"density"},null,d)}else d=new DASStyle,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,c.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};
function RemoteBWGFeatureSource(a,b){FeatureSourceBase.call(this);this.worker=b;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new Awaited;this.init()}RemoteBWGFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);
RemoteBWGFeatureSource.prototype.init=function(){var a=this,b=this.bwgSource.uri||this.bwgSource.bwgURI,c=this.bwgSource.blob||this.bwgSource.bwgBlob,d=function(b,c){a.readiness=null;a.notifyReadiness();b?a.worker.postCommand({command:"meta",connection:b},function(c,d){d?(a.error=d,a.keyHolder.provide(null)):(a.meta=c,a.keyHolder.provide(b))}):(a.error=c,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBBI",blob:c},d):this.worker.postCommand({command:"connectBBI",uri:b},d)};
RemoteBWGFeatureSource.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var b=0;b<this.meta.extraIndices.length;++b)a.search.push(this.meta.extraIndices[b].field)}return a};
RemoteBWGFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(f){if(!f)return h.busy--,h.notifyActivity(),g(h.error||"Can't access binary file",null,null);var l=-1,m=!e||0==e.length||0<=arrayIndexOf(e,"density");h.opts.clientBin&&(m=!1);if("bigwig"==h.meta.type||m||"undefined"!==typeof h.opts.forceReduction){for(m=1;m<h.meta.zoomLevels.length;++m)if(h.meta.zoomLevels[m]<=d)l=m-1;else break;"undefined"!==typeof h.opts.forceReduction&&
(l=h.opts.forceReduction)}h.worker.postCommand({command:"fetch",connection:f,chr:a,min:b,max:c,zoom:l},function(a,d){h.busy--;h.notifyActivity();var e=1E9;if("bigwig"===h.meta.type){var f=(c-b)/a.length/2;f<e&&(e=f)}if(h.opts.link)for(f=0;f<a.length;++f){var k=a[f];k.label&&(k.links=[new DASLink("Link",h.opts.link.replace(/\$\$/,k.label))])}g(d,a,e)})})};
RemoteBWGFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:b,dir:c,threshold:d,under:!1},function(a,b){console.log(a,b);f.busy--;f.notifyActivity();return e(a,b)})};
RemoteBWGFeatureSource.prototype.findNextFeature=function(a,b,c,d){var e=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:b,dir:c},function(a,b){e.busy--;e.notifyActivity();0<a.length&&null!=a[0]&&d(a[0])})};RemoteBWGFeatureSource.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};
RemoteBWGFeatureSource.prototype.search=function(a,b){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return b(null,"No indices available");var c=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,e){c.busy--;c.notifyActivity();b(a,e)})};
RemoteBWGFeatureSource.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var b=this;this.keyHolder.await(function(c){var d=b.meta;d&&d.schema&&d.definedFieldCount<d.schema.fields.length&&a(function(a,b){for(var c=d.definedFieldCount;c<d.schema.fields.length;++c){var h=d.schema.fields[c];b.add(h.comment,a[h.name])}})})};
RemoteBWGFeatureSource.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(c){c=b.meta;if(!c)return a(null,"bbi error");var d=new DASStylesheet;if("bigbed"==c.type){var e=new DASStyle;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=20;d.pushStyle({type:"bigwig"},null,e);e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="red";e.HEIGHT=10;e.BUMP=!0;e.ZINDEX=20;d.pushStyle({type:"bb-translation"},null,e);e=new DASStyle;e.glyph="BOX";e.FGCOLOR=
"black";e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;d.pushStyle({type:"bb-transcript"},null,e);e=new DASStyle;e.glyph="HISTOGRAM";e.COLOR1="white";e.COLOR2="black";e.HEIGHT=30;d.pushStyle({type:"density"},null,e)}else e=new DASStyle,e.glyph="HISTOGRAM",e.COLOR1="white",e.COLOR2="black",e.HEIGHT=30,d.pushStyle({type:"default"},null,e);12==c.definedFieldCount&&14<=c.fieldCount&&(d.geneHint=!0);return a(d)})};function BamblrFeatureSource(a){this.bamblr=a.bamblrURI}
BamblrFeatureSource.prototype.getScales=function(){return[]};BamblrFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"default"},null,c);return a(b)};
BamblrFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=d|0;1>h&&(h=1);(new URLFetchable(this.bamblr+"?seq="+a+"&min="+b+"&max="+c+"&rez="+h)).fetch(function(c){if(null==c)dlog("failing bamblr");else{c=new Int32Array(c);for(var d=[],e=0;e<c.length;++e){var f=new DASFeature;f.min=b+e*h;f.max=f.min+h-1;f.segment=a;f.type="bamblr";f.score=c[e];d.push(f)}g(null,d,h)}})};
function bamRecordToFeature(a){if(!(a.flag&4)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var c=parseCigar(a.cigar),d=0;d<c.length;++d){var e=c[d];if("M"==e.op||"D"==e.op)b+=e.cnt}}c=new DASFeature;c.min=a.pos+1;c.max=a.pos+b;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;return c}}
function BAMFeatureSource(a){FeatureSourceBase.call(this);var b=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight};this.bamHolder=new Awaited;if(this.opts.preflight){var c=bwg_preflights[this.opts.preflight];if(!c){c=new Awaited;bwg_preflights[this.opts.preflight]=c;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c.provide("success"):c.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&
(d.withCredentials="true");d.send("")}c.await(function(a){"success"===a&&b.init()})}else b.init()}BAMFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);
BAMFeatureSource.prototype.init=function(){var a=this,b,c;this.bamSource.bamBlob?(b=new BlobFetchable(this.bamSource.bamBlob),c=new BlobFetchable(this.bamSource.baiBlob)):(b=new URLFetchable(this.bamSource.bamURI,{credentials:this.opts.credentials}),c=new URLFetchable(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));makeBam(b,c,function(b,c){a.readiness=null;a.notifyReadiness();b?a.bamHolder.provide(b):(a.error=c,a.bamHolder.provide(null))})};
BAMFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=e&&1==e.length&&"density"==e[0],k=this;k.busy++;k.notifyActivity();this.bamHolder.await(function(d){if(!d)return k.busy--,k.notifyActivity(),g(k.error||"Couldn't fetch BAM");d.fetch(a,b,c,function(a,b){k.busy--;k.notifyActivity();if(b)g(b,null,null);else{for(var c=[],d=0;d<a.length;++d){var e=bamRecordToFeature(a[d]);e&&c.push(e)}g(null,c,1E9)}},{light:h})})};BAMFeatureSource.prototype.getScales=function(){return 1E9};
BAMFeatureSource.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new DASStylesheet;var c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new DASStyle;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};
function RemoteBAMFeatureSource(a,b){FeatureSourceBase.call(this);this.bamSource=a;this.worker=b;this.opts={credentials:a.credentials,preflight:a.preflight};this.keyHolder=new Awaited;this.init()}RemoteBAMFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);
RemoteBAMFeatureSource.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,c=this.bamSource.indexUri||this.bamSource.baiURI||b+".bai",d=this.bamSource.bamBlob||this.bamSource.blob,e=this.bamSource.baiBlob||this.bamSource.indexBlob,f=function(b,c){a.readiness=null;a.notifyReadiness();b?a.keyHolder.provide(b):(a.error=c,a.keyHolder.provide(null))};d?this.worker.postCommand({command:"connectBAM",blob:d,indexBlob:e},f):this.worker.postCommand({command:"connectBAM",uri:b,indexUri:c},
f)};RemoteBAMFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=e&&1==e.length&&"density"==e[0],k=this;k.busy++;k.notifyActivity();this.keyHolder.await(function(d){if(!d)return k.busy--,k.notifyActivity(),g(k.error||"Couldn't fetch BAM");k.worker.postCommand({command:"fetch",connection:d,chr:a,min:b,max:c,opts:{light:h}},function(a,b){k.busy--;k.notifyActivity();if(b)g(b,null,null);else{for(var c=[],d=0;d<a.length;++d){var e=bamRecordToFeature(a[d]);e&&c.push(e)}g(null,c,1E9)}})})};
RemoteBAMFeatureSource.prototype.getScales=function(){return 1E9};RemoteBAMFeatureSource.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new DASStylesheet;var c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new DASStyle;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};
function MappedFeatureSource(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}MappedFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};MappedFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};MappedFeatureSource.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};MappedFeatureSource.prototype.getScales=function(){return this.source.getScales()};
MappedFeatureSource.prototype.simplifySegments=function(a,b){if(0==a.length)return a;a.sort(function(a,b){var c=a.name-b.name;return c?c:(c=a.start-b.start)?c:a.end-b.end});for(var c=[],d=a[0],e=0;e<a.length;++e){var f=a[e];f.name!=d.name||f.start>d.end+b?(c.push(d),d=f):d=new DASSegment(d.name,Math.min(d.start,f.start),Math.max(d.end,f.end))}c.push(d);return c};
MappedFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=this,k=c-b+1;h.busy++;h.notifyActivity();this.mapping.sourceBlocksForRange(a,b,c,function(b){if(0==b.length)h.busy--,h.notifyActivity(),g("No mapping available for this regions",[],d);else{b=h.simplifySegments(b,Math.max(100,0.05*k));var c=[],n=null,p=b.length,r;b.map(function(b){h.source.fetch(b.name,b.start,b.end,d,e,f,function(d,e,f){d&&!r&&(r=d);if(e)for(d=0;d<e.length;++d){var k=e[d],l=k.segment;0==l.indexOf("chr")&&(l=l.substr(3));
var x=h.mapping.mapPoint(l,k.min),l=h.mapping.mapPoint(l,k.max);!x||!l||x.seq!=l.seq||x.seq!=a?k.parts&&0<k.parts.length&&c.push(k):(k.segment=x.seq,k.min=x.pos,k.max=l.pos,k.min>k.max&&(l=k.max,k.max=k.min,k.min=l),x.flipped&&("-"==k.orientation?k.orientation="+":"+"==k.orientation&&(k.orientation="-")),c.push(k))}e=new Range(h.mapping.mapPoint(b.name,b.start).pos,h.mapping.mapPoint(b.name,b.end).pos);n=n?union(n,e):e;--p;0==p&&(h.busy--,h.notifyActivity(),g(r,c,f,n))})})}})};
function DummyFeatureSource(){}DummyFeatureSource.prototype.getScales=function(){return null};DummyFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){return g(null,[],1E9)};DummyFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};function DummySequenceSource(){}DummySequenceSource.prototype.fetch=function(a,b,c,d,e){return e(null,null)};
function JBrowseFeatureSource(a){this.store=new JBrowseStore(a.jbURI,a.jbQuery)}JBrowseFeatureSource.prototype.getScales=function(){return null};JBrowseFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};
JBrowseFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){e&&0==e.length?g(null,[],d):this.store.features(new DASSegment(a,b,c),{},function(a,b){g(b,a,1E5)})};function sourceAdapterIsCapable(a,b){return a.capabilities?a.capabilities()[b]:!1}function JBrowseStore(a,b){this.base=a;this.query=b}var topLevelResp;
JBrowseStore.prototype.features=function(a,b,c){url=this.base+"/features/"+a.name;b=[];this.query&&b.push(this.query);a.isBounded&&(b.push("start="+a.start),b.push("end="+a.end));0<b.length&&(url=url+"?"+b.join("&"));var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState)if(300<=d.status)c(null,"Error code "+d.status);else{var b=JSON.parse(d.response).features,f=[];for(fi=0;fi<b.length;++fi){var g=b[fi],h=new DASFeature;h.segment=a;h.min=(g.start|0)+1;h.max=g.end|0;g.name&&(h.label=
g.name);h.type=g.type||"unknown";f.push(h)}c(f)}};d.open("GET",url,!0);d.responseType="text";d.send("")};"use strict";function EnsemblFeatureSource(a){this.source=a;this.base=a.uri||"http://beta.rest.ensembl.org";this.species=a.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof a.type?[a.type]:a.type||["regulatory"]}EnsemblFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
EnsemblFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
EnsemblFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="__NONE";0<=this.type.indexOf("exon")&&b.pushStyle({type:"transcript"},null,c);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&b.pushStyle({type:"gene"},null,c);c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=10;b.pushStyle({type:"cds"},null,c);c=new DASStyle;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",
method:".+_UTR_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",method:"missense_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",method:"splice_.+_variant"},null,c);c=new DASStyle;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";b.pushStyle({type:"variation",method:"regulatory_region_variant"},null,
c);c=new DASStyle;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.STROKECOLOR="black";b.pushStyle({type:"variation"},null,c);c=new DASStyle;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:".+_UTR_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:"missense_variant"},null,c);c=new DASStyle;c.glyph="TRIANGLE";
c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:"splice_.+_variant"},null,c);c=new DASStyle;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";b.pushStyle({type:"indel",method:"regulatory_region_variant"},null,c);c=new DASStyle;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";c.STROKECOLOR="black";b.pushStyle({type:"indel"},null,c);c=new DASStyle;c.glyph="BOX";c.FGCOLOR=
"black";c.BGCOLOR="orange";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};EnsemblFeatureSource.prototype.getScales=function(){return[]};
EnsemblFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=this;url=this.base+"/feature/region/"+this.species+"/"+a+":"+b+"-"+c;b=[];for(c=0;c<this.type.length;++c)b.push("feature="+this.type[c]);b.push("content-type=application/json");url=url+"?"+b.join(";");var k=new XMLHttpRequest;k.onreadystatechange=function(){if(4==k.readyState)if(h.busy--,h.notifyActivity(),300<=k.status){var b="Error code "+k.status;try{var c=JSON.parse(k.response);c.error&&(b=c.error)}catch(d){}g(b,null)}else{b=JSON.parse(k.response);
c=[];for(fi=0;fi<b.length;++fi){var e=b[fi],f=[],q=new DASFeature;q.segment=a;q.min=e.start|0;q.max=e.end|0;q.type=e.feature_type||"unknown";q.id=e.ID;if(e.Parent){var s=new DASGroup;s.id=e.Parent;q.groups=[s]}e.strand&&(0>e.strand?q.orientation="-":0<e.strand&&(q.orientation="+"));e.consequence_type&&(q.method=e.consequence_type);if(e.alt_alleles&&(f.push("Alleles="+e.alt_alleles.join("/")),1<e.alt_alleles.length&&(e.alt_alleles[1].length!=e.alt_alleles[0].length||"-"==e.alt_alleles[1])))q.type=
"indel";0<f.length&&(q.notes=f);c.push(q)}g(null,c)}};h.busy++;h.notifyActivity();k.open("GET",url,!0);k.responseType="text";k.send("")};dalliance_registerSourceAdapterFactory("ensembl",function(a){return{features:new EnsemblFeatureSource(a)}});"use strict";
function OverlayFeatureSource(a,b){this.sources=a;this.opts=b||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var c=0;c<this.sources.length;++c)this.initN(c);this.merge="concat"==b.merge?OverlayFeatureSource_merge_concat:OverlayFeatureSource_merge_byKey}
OverlayFeatureSource.prototype.initN=function(a){var b=this.sources[a],c=this;this.business[a]=0;b.addActivityListener&&b.addActivityListener(function(b){c.business[a]=b;c.notifyActivity()});b.addChangeListener&&b.addChangeListener(function(){c.notifyChange()});b.addReadinessListener&&b.addReadinessListener(function(b){c.readiness[a]=b;c.notifyReadiness()})};OverlayFeatureSource.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);this.notifyReadinessListener(a)};
OverlayFeatureSource.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)this.notifyReadinessListener(this.readinessListeners[a])};OverlayFeatureSource.prototype.notifyReadinessListener=function(a){for(var b=null,c=0;c<this.readiness.length;++c)if(null!=this.readiness[c]){b=this.readiness[c];break}try{a(b)}catch(d){console.log(d)}};OverlayFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
OverlayFeatureSource.prototype.notifyActivity=function(){for(var a=0,b=0;b<this.business.length;++b)a+=this.business[b];for(b=0;b<this.activityListeners.length;++b)try{this.activityListeners[b](a)}catch(c){console.log(c)}};OverlayFeatureSource.prototype.addChangeListener=function(a){this.changeListeners.push(a)};OverlayFeatureSource.prototype.notifyChange=function(){for(var a=0;a<this.changeListeners.length;++a)try{this.changeListeners[a](this.busy)}catch(b){console.log(b)}};
OverlayFeatureSource.prototype.getScales=function(){return this.sources[0].getScales()};OverlayFeatureSource.prototype.getStyleSheet=function(a){return this.sources[0].getStyleSheet(a)};OverlayFeatureSource.prototype.capabilities=function(){var a={},b=this.sources[0];b.capabilities&&(a=shallowCopy(b.capabilities()));for(b=1;b<this.sources.length;++b){var c=this.sources[b];c.capabilities&&(c=c.capabilities(),c.search&&(a.search=c.search))}return a};
OverlayFeatureSource.prototype.search=function(a,b){for(var c=0;c<this.sources.length;++c)if(sourceAdapterIsCapable(this.sources[c],"search"))return this.sources[c].search(a,b)};OverlayFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){g=new OverlayBaton(this,g,this.sources.length);for(var h=0;h<this.sources.length;++h)this.fetchN(g,h,a,b,c,d,e,f)};OverlayFeatureSource.prototype.fetchN=function(a,b,c,d,e,f,g,h){this.sources[b].fetch(c,d,e,f,g,h,function(c,d,e){return a.completed(b,c,d,e)})};
OverlayFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){return this.sources[0].quantFindNextFeature(a,b,c,d,e)};OverlayFeatureSource.prototype.findNextFeature=function(a,b,c,d){return this.sources[0].findNextFeature(a,b,c,d)};function OverlayBaton(a,b,c){this.source=a;this.callback=b;this.count=c;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}
OverlayBaton.prototype.completed=function(a,b,c,d){if(null==this.scale||0==a)this.scale=d;if(this.returns[a])throw"Multiple returns for source "+a;this.returns[a]=!0;this.returnCount++;this.features[a]=c;b&&(this.statuses[a]=b,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){a="";for(b=0;b<this.count;++b)if(c=this.statuses[b])0<a.length&&(a+=", "),a+=c;return this.callback(a,null,this.scale)}this.callback(null,this.source.merge(this.features),this.scale)}};
OverlayFeatureSource.prototype.getDefaultFIPs=function(a){for(var b=0;b<this.sources.length;++b){var c=this.sources[b];c.getDefaultFIPs&&c.getDefaultFIPs(a)}};OverlayFeatureSource.prototype.keyForFeature=function(a){return""+a.min+".."+a.max};
function OverlayFeatureSource_merge_byKey(a){for(var b=[],c=1;c<a.length;++c){for(var d={},e=a[c],f=0;f<e.length;++f)d[this.keyForFeature(e[f])]=e[f];b.push(d)}c=[];a=a[0];for(f=0;f<a.length;++f){for(var g=a[f],h=0;h<b.length;++h)if(d=b[h],e=d[this.keyForFeature(g)])for(var k in e)"score"===k?g.score2=e.score:"min"===k||("max"===k||"segment"===k||"_cachedStyle"===k)||(g[k]=e[k]);c.push(g)}return c}
function OverlayFeatureSource_merge_concat(a){for(var b=[],c=0;c<a.length;++c)for(var d=a[c],e=this.sources[c].name,f=0;f<d.length;++f){var g=d[f];g.method=e;b.push(g)}return b}"use strict";
Browser.prototype.mergeSelectedTiers=function(){for(var a=[],b=[],c=0;c<this.selectedTiers.length;++c){var d=this.tiers[this.selectedTiers[c]];a.push(shallowCopy(d.dasSource));for(var e=d.stylesheet.styles,f=0;f<e.length;++f){var g=e[f],h=shallowCopy(g);h.method=d.dasSource.name.replace(/[()+*?]/g,"\\$&");h._methodRE=null;h.style=shallowCopy(g.style);void 0===h.style.ZINDEX&&(h.style.ZINDEX=c);d.forceMin&&(h.style.MIN=d.forceMin);d.forceMax&&(h.style.MAX=d.forceMax);b.push(h)}}this.addTier({name:"Merged",
merge:"concat",overlay:a,noDownsample:!0,style:b});this.setSelectedTier(this.tiers.length-1)};"use strict";var REGION_PATTERN=/([\d+,\w,\.,\_,\-]+):([0-9,]+)([KkMmGg])?([\-,\,.]+([0-9,]+)([KkMmGg])?)?/;function parseLocCardinal(a,b){var c=a.replace(/,/g,"");return"k"===b||"K"===b?1E3*c:"m"==b||"M"===b?1E6*c:c}
Browser.prototype.search=function(a,b){var c=this,d=REGION_PATTERN.exec(a);if(d){var e=d[1],f;if(d[5])f=parseLocCardinal(d[2],d[3]),d=parseLocCardinal(d[5],d[6]);else{var g=this.viewEnd-this.viewStart+1;f=parseLocCardinal(d[2],d[3])-g/2|0;d=f+g-1}this.setLocation(e,f,d,b)}else{if(!a||0==a.length)return!1;var h=0,k=!1,l=function(d,e){--h;if(e)return b(e);d||(d=[]);for(var f=5E8,g=-1E8,l=null,m=0;m<d.length;++m){var t=d[m];null==l&&(l=t.segment);f=Math.min(f,t.min);g=Math.max(g,t.max)}if(l)k=!0,c.highlightRegion(l,
f,g),m=Math.max(2500,0.3*(g-f+1)|0),c.setLocation(l,f-m,g+m,b);else if(0==h&&!k)return b("no match for '"+a+"'")},m=function(b,c){c.lookup(a,function(c,d){if(null==c||2>c.length)return b.featureSource.search(a,l);var e=c[1].split(",")[0];return b.featureSource.search(e,l)})};if(this.searchEndpoint)return h=1,this.doDasSearch(c.searchEndpoint,a,l);for(e=0;e<this.tiers.length;++e)(function(b){sourceAdapterIsCapable(b.featureSource,"search")?b.dasSource.trixURI?(++h,b.trix?m(b,b.trix):connectTrix(new URLFetchable(b.dasSource.trixURI),
new URLFetchable(b.dasSource.trixURI+"x"),function(a){b.trix=a;m(b,a)})):(++h,b.featureSource.search(a,l)):b.dasSource.provides_search&&(++h,c.doDasSearch(b.dasSource,a,l))})(this.tiers[e])}};Browser.prototype.doDasSearch=function(a,b,c){a.features(null,{group:b,type:"transcript"},function(a){a||(a=[]);for(var e=[],f=0;f<a.length;++f){var g=a[f];g.label.toLowerCase()==b.toLowerCase()&&e.push(g)}return c(e)},!1)};"use strict";
var __dalliance_smallGlyphs={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};
Browser.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),this.setUiMode("none");else{var b=function(a){a.BGGRAD||(1==v?("LINEPLOT"==a.glyph||__dalliance_smallGlyphs[a.glyph]?a.FGCOLOR=m.value:a.BGCOLOR=m.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=m.value,a.COLOR2=n.value,a.COLOR3=2<v?p.value:null),a._gradient=null)},c=function(b){for(var c=copyStylesheet(a.stylesheet),d=a.browser.zoomForCurrentScale(),e=0;e<c.styles.length;++e){var f=
c.styles[e];f.zoom&&f.zoom!=d||b(f.style)}return c},d=function(d){a.mergeConfig({stylesheet:c(b)})};this.manipulatingTier=a;var e=makeElement("div",null,{className:"tier-edit"});if(a.dasSource.mapping){var f=this.chains[a.dasSource.mapping].coords;e.appendChild(makeElement("div","Mapped from "+f.auth+f.version,null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"}))}var g=makeElement("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",
marginBottom:"5px",textAlign:"center",display:"none"});e.appendChild(g);var h=makeElement("input",null,{type:"text"}),k=makeElement("input",null,{type:"checkbox"}),l=makeElement("select");l.appendChild(makeElement("option","Histogram",{value:"HISTOGRAM"}));l.appendChild(makeElement("option","Line Plot",{value:"LINEPLOT"}));l.appendChild(makeElement("option","Ribbon",{value:"GRADIENT"}));l.appendChild(makeElement("option","Scatter",{value:"SCATTER"}));var m=makeElement("input",null,{type:"text",value:"#dd00dd"}),
n=makeElement("input",null,{type:"text",value:"#dd00dd"}),p=makeElement("input",null,{type:"text",value:"#dd00dd"});try{m.type=n.type=p.type="color"}catch(r){}var q=[m,n,p],f=makeElement("i",null,{className:"fa fa-plus-circle"}),s=makeElement("i",null,{className:"fa fa-minus-circle"}),v=1,t=makeElement("td",q),u=function(a){v=a;for(var b=0;b<a;++b)q[b].style.display="block";for(b=a;b<q.length;++b)q[b].style.display="none"};f.addEventListener("click",function(a){3>v&&(u(v+1),d(null))},!1);s.addEventListener("click",
function(a){1<v&&(u(v-1),d(null))},!1);var w=makeElement("input",null,{type:"text",value:"0.0"}),x=makeElement("input",null,{type:"text",value:"10.0"}),B=makeElement("input",null,{type:"checkbox"}),y=makeElement("input",null,{type:"checkbox"}),A=makeElement("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),C=makeElement("input",null,{type:"text",value:a.quantLeapThreshold,disabled:!A.checked}),E=makeElement("input",null,{type:"text",value:"50"}),H=makeElement("input",null,{type:"checkbox"}),
I=makeElement("input",null,{type:"checkbox"}),G=null;0<a.stylesheet.styles.length&&(G=a.stylesheet.styles[0].style);var M=function(){h.value="string"===typeof a.config.name?a.config.name:a.dasSource.name;k.checked=a.pinned;a.forceHeight?E.value=""+a.forceHeight:G&&G.HEIGHT&&(E.value=""+G.HEIGHT);"number"==typeof a.quantLeapThreshold?(A.checked=!0,C.disabled=!1,parseFloat(C.value)!=a.quantLeapThreshold&&(C.value=a.quantLeapThreshold)):(A.checked=!1,C.disabled=!0);if(0<a.stylesheet.styles.length){for(var b=
G=a.stylesheet.styles[0].style,c=!1,d=!1,d=a.browser.zoomForCurrentScale(),e=0,f=0;f<a.stylesheet.styles.length;++f){var q=a.stylesheet.styles[f];if(!(q.zoom&&q.zoom!=d)&&(++e,q=a.stylesheet.styles[f].style,"LINEPLOT"==q.glyph||"HISTOGRAM"==q.glyph||"GRADIENT"==q.glyph||isDasBooleanTrue(q.SCATTER)))c||(b=G=q),c=!0}g.style.display=e==a.stylesheet.styles.length?"none":"block";d=c&&1==e;c?(z.style.display="table-row",Q.style.display="table-row",N.style.display="none",V.style.display="none"):(z.style.display=
"none",Q.style.display="none",N.style.display="table-row",H.checked=isDasBooleanTrue(G.BUMP),V.style.display="table-row",I.checked=isDasBooleanTrue(G.LABEL));d?(D.style.display="table-row",K.style.display="table-row"):(D.style.display="none",K.style.display="none");d=1;b.COLOR1?(m.value=dasColourForName(b.COLOR1).toHexString(),b.COLOR2&&(n.value=dasColourForName(b.COLOR2).toHexString(),b.COLOR3?(p.value=dasColourForName(b.COLOR3).toHexString(),d=3):d=2)):"LINEPLOT"==b.glyph||"DOT"==b.glyph&&b.FGCOLOR?
m.value=dasColourForName(b.FGCOLOR).toHexString():b.BGCOLOR&&(m.value=dasColourForName(b.BGCOLOR).toHexString());u(d);isDasBooleanTrue(b.SCATTER)?l.value="SCATTER":l.value=b.glyph;var r,s;void 0!==b.MIN&&(d=parseFloat(b.MIN),isNaN(d)||(r=d));!a.forceMinDynamic&&(void 0!==b.MIN||void 0!==a.forceMin)?(B.checked=!0,w.disabled=!1):(B.checked=!1,w.disabled=!0);void 0!==b.MAX&&(d=parseFloat(b.MAX),isNaN(d)||(s=d));!a.forceMaxDynamic&&(void 0!==b.MAX||void 0!==a.forceMax)?(y.checked=!0,x.disabled=!1):(y.checked=
!1,x.disabled=!0);void 0!=a.forceMin&&(r=a.forceMin);void 0!=a.forceMax&&(s=a.forceMax);"number"==typeof r&&r!=parseFloat(w.value)&&(w.value=r);"number"==typeof s&&s!=parseFloat(x.value)&&(x.value=s);(b=getSeqStyle(a.stylesheet))?(J.style.display="table-row",L.checked="mismatch"===b.__SEQCOLOR,R.style.display="table-row",F.checked=isDasBooleanTrue(b.__INSERTIONS)):(J.style.display="none",R.style.display="none")}c&&sourceAdapterIsCapable(a.featureSource,"quantLeap")?U.style.display="table-row":U.style.display=
"none"},L=makeElement("input",null,{type:"checkbox"}),J=makeElement("tr",[makeElement("th","Color mismatches"),makeElement("td",L)]);L.addEventListener("change",function(b){b=copyStylesheet(a.stylesheet);getSeqStyle(b).__SEQCOLOR=L.checked?"mismatch":"base";a.mergeConfig({stylesheet:b})});var F=makeElement("input",null,{type:"checkbox"}),R=makeElement("tr",[makeElement("th","Show insertions"),makeElement("td",F)]);F.addEventListener("change",function(b){b=copyStylesheet(a.stylesheet);getSeqStyle(b).__INSERTIONS=
F.checked?"yes":"no";a.mergeConfig({stylesheet:b})});var D=makeElement("tr",[makeElement("th","Style"),makeElement("td",l)]),K=makeElement("tr",[makeElement("th",["Colour(s)",f,s]),t]),z=makeElement("tr",[makeElement("th","Min value"),makeElement("td",[B," ",w])]),Q=makeElement("tr",[makeElement("th","Max value"),makeElement("td",[y," ",x])]),U=makeElement("tr",[makeElement("th","Threshold leap:"),makeElement("td",[A," ",C])]),N=makeElement("tr",[makeElement("th","Bump overlaps"),makeElement("td",
H)]),V=makeElement("tr",[makeElement("th","Label features"),makeElement("td",I)]),f=makeElement("table",[makeElement("tr",[makeElement("th","Name",{},{width:"150px",textAlign:"right"}),h]),makeElement("tr",[makeElement("th","Pin to top"),k]),makeElement("tr",[makeElement("th","Height"),makeElement("td",E)]),D,K,z,Q,U,N,V,J,R]);M();e.appendChild(f);f=makeElement("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});f.addEventListener("click",function(b){a.setConfig({})},
!1);e.appendChild(f);h.addEventListener("input",function(b){a.mergeConfig({name:h.value})},!1);k.addEventListener("change",function(b){a.mergeConfig({pinned:k.checked})},!1);for(f=0;f<q.length;++f)q[f].addEventListener("change",d,!1);l.addEventListener("change",function(d){d=c(function(a){"SCATTER"===l.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=l.value,a.SCATTER=void 0);b(a)});a.mergeConfig({stylesheet:d})},!1);B.addEventListener("change",function(b){b={forceMinDynamic:!B.checked};w.disabled=
!B.checked;var c=parseFloat(w.value);B.checked&&("number"==typeof c&&!isNaN(c))&&(b.forceMin=parseFloat(c));a.mergeConfig(b)});w.addEventListener("input",function(b){b=parseFloat(w.value);"number"==typeof b&&!isNaN(b)&&a.mergeConfig({forceMin:b})},!1);y.addEventListener("change",function(b){b={forceMaxDynamic:!y.checked};x.disabled=!y.checked;var c=parseFloat(x.value);y.checked&&("number"==typeof c&&!isNaN(c))&&(b.forceMax=parseFloat(c));a.mergeConfig(b)});x.addEventListener("input",function(b){b=
parseFloat(x.value);"number"==typeof b&&!isNaN(b)&&a.mergeConfig({forceMax:b})},!1);E.addEventListener("input",function(b){b=parseFloat(E.value);"number"==typeof b&&!isNaN(b)&&a.mergeConfig({height:Math.min(500,b|0)})},!1);var W=function(){C.disabled=!A.checked;if(A.checked){var b=parseFloat(C.value);"number"==typeof b&&!isNaN(b)&&a.mergeConfig({quantLeapThreshold:parseFloat(C.value)})}else a.mergeConfig({quantLeapThreshold:null})};A.addEventListener("change",function(a){W()},!1);C.addEventListener("input",
function(a){W()},!1);I.addEventListener("change",function(b){b=c(function(a){a.LABEL=I.checked?"yes":"no"});a.mergeConfig({stylesheet:b})},!1);H.addEventListener("change",function(b){b=c(function(a){a.BUMP=H.checked?"yes":"no"});a.mergeConfig({stylesheet:b})},!1);this.showToolPanel(e);this.setUiMode("tier");a.addTierListener(M);var X=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=X&&(X=a.browser.scale,M())})}};
function getSeqStyle(a){for(var b=0;b<a.styles.length;++b){var c=a.styles[b].style;if("__SEQUENCE"===c.glyph)return c}}function copyStylesheet(a){var b=shallowCopy(a);b.styles=[];for(var c=0;c<a.styles.length;++c){var d=b.styles[c]=shallowCopy(a.styles[c]);d._methodRE=d._labelRE=d._typeRE=void 0;d.style=shallowCopy(d.style);d.style.id=void 0}return b}"use strict";
function connectTrix(a,b,c){b.fetchAsText(function(b){if(!b)return c(null,"Couldn't fetch index-index");b=b.split(/(.+)([0-9A-F]{10})\n/);for(var e=[],f=[],g=1;g<b.length;g+=3)e.push(b[g]),f.push(parseInt(b[g+1],16));return c(new TrixIndex(e,f,a))})}function TrixIndex(a,b,c){this.keys=a;this.offsets=b;this.ix=c}
TrixIndex.prototype.lookup=function(a,b){for(var c,d=0;d<this.keys.length;++d)if(0>a.localeCompare(this.keys[d])){c=this.ix.slice(this.offsets[d-1],this.offsets[d]-this.offsets[d-1]);break}c||(c=this.ix.slice(this.offsets[this.offsets.length-1]));c.fetchAsText(function(c){c=c.split("\n");for(var d=0;d<c.length;++d)if(0==c[d].indexOf(a.toLowerCase()+" "))return b(c[d].split(" "));return b(null)})};"use strict";var TABIX_MAGIC=21578324;function TabixFile(){}
function connectTabix(a,b,c){var d=new TabixFile;d.data=a;d.tbi=b;d.tbi.fetch(function(a){if(!a)return dlog("Couldn't access Tabix");a=unbgzf(a,a.byteLength);var b=new Uint8Array(a);if(readInt(b,0)!=TABIX_MAGIC)return c(null,"Not a tabix index");var g=readInt(b,4);d.format=readInt(b,8);d.colSeq=readInt(b,12);d.colStart=readInt(b,16);d.colEnd=readInt(b,20);d.meta=readInt(b,24);d.skip=readInt(b,28);readInt(b,32);d.indices=[];var h=36;d.chrToIndex={};d.indexToChr=[];for(var k=0;k<g;++k){for(var l="";;){var m=
b[h++];if(0==m)break;l+=String.fromCharCode(m)}d.chrToIndex[l]=k;0==l.indexOf("chr")?d.chrToIndex[l.substring(3)]=k:d.chrToIndex["chr"+l]=k;d.indexToChr.push(l)}l=1E9;for(m=0;m<g;++m){for(var n=h,p=readInt(b,h),h=h+4,k=0;k<p;++k){readInt(b,h);var r=readInt(b,h+4),h=h+(8+16*r)}for(var r=readInt(b,h),q=h+=4,k=0;k<r;++k){var s=readVob(b,q),q=q+8;if(s){k=s.block;0<s.offset&&(k+=65536);k<l&&(l=k);break}}h+=8*r;0<p&&(d.indices[m]=new Uint8Array(a,n,h-n))}c(d)})}
TabixFile.prototype.blocksForRange=function(a,b,c){var d=this.indices[a];if(!d)return[];a=reg2bins(b,c);for(var e=[],f=0;f<a.length;++f)e[a[f]]=!0;a=[];for(var g=[],f=readInt(d,0),h=4,k=0;k<f;++k){var l=readInt(d,h),m=readInt(d,h+4),h=h+8;if(e[l])for(var n=0;n<m;++n){var p=readVob(d,h),r=readVob(d,h+8);(4681>l?g:a).push(new Chunk(p,r));h+=16}else h+=16*m}f=readInt(d,h);e=null;b=Math.min(b>>14,f-1);c=Math.min(c>>14,f-1);for(f=b;f<=c;++f)if((b=readVob(d,h+4+8*f))&&(!e||b.block<e.block||b.offset<e.offset))e=
b;d=[];if(null!=e)for(f=0;f<g.length;++f)c=g[f],c.maxv.block>=e.block&&c.maxv.offset>=e.offset&&d.push(c);g=d;d=[];for(f=0;f<g.length;++f)d.push(g[f]);for(f=0;f<a.length;++f)d.push(a[f]);d.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});a=[];if(0<d.length){g=d[0];for(f=1;f<d.length;++f)c=d[f],c.minv.block==g.maxv.block?g=new Chunk(g.minv,c.maxv):(a.push(g),g=c);a.push(g)}return a};
TabixFile.prototype.fetch=function(a,b,c,d){function e(){if(l>=h.length)return d(k);if(m){var a=new Uint8Array(m);f.readRecords(a,h[l].minv.offset,k,b,c,g);m=null;++l;return e()}var p=h[l],a=p.minv.block;f.data.slice(a,p.maxv.block+65536-a).fetch(function(a){m=unbgzf(a,p.maxv.block-p.minv.block+1);return e()})}var f=this;a=this.chrToIndex[a];if(void 0==a)return d([]);var g=this.indexToChr[a],h;void 0===a?h=[]:(h=this.blocksForRange(a,b,c))||d(null,"Error in index fetch");var k=[],l=0,m;e()};
TabixFile.prototype.readRecords=function(a,b,c,d,e,f){a:for(;;){for(var g="";b<a.length;){var h=a[b++];if(10==h){h=g.split("\t");if(h[this.colSeq-1]==f){var k=parseInt(h[this.colStart-1]),l=k;0<this.colEnd&&(l=parseInt(h[this.colEnd-1]));this.format&65536&&++k;k<=e&&l>=d&&c.push(g)}continue a}else g+=String.fromCharCode(h)}break}};"use strict";
function TabixFeatureSource(a){FeatureSourceBase.call(this);this.readiness="Connecting";this.source=a;this.tabixHolder=new Awaited;var b=this,c=dalliance_makeParser(a.payload);if(c)this.parser=c;else throw"Unsuported tabix payload "+a.payload;this.source.blob?(a=new BlobFetchable(this.source.blob),c=new BlobFetchable(this.source.indexBlob)):(a=new URLFetchable(this.source.uri,{credentials:this.source.credentials}),c=new URLFetchable(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));
connectTabix(a,c,function(a,c){b.tabixHolder.provide(a);b.readiness=null;b.notifyReadiness()})}TabixFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);TabixFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=this;h.busy++;h.notifyActivity();this.tabixHolder.await(function(d){d.fetch(a,b,c,function(a,b){h.busy--;h.notifyActivity();for(var c=[],d=h.parser.createSession(function(a){c.push(a)}),e=0;e<a.length;++e)d.parse(a[e]);d.flush();g(null,c,1E9)})})};
TabixFeatureSource.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};TabixFeatureSource.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};dalliance_registerSourceAdapterFactory("tabix",function(a){return{features:new TabixFeatureSource(a)}});"use strict";function MemStore(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}
MemStore.prototype.addFeatures=function(a){for(var b={},c=0;c<a.length;++c){var d=a[c],e=d.segment||d.chr,f=this.featuresByChr[e];f||(f=[],this.featuresByChr[e]=f);f.push(d);b[e]=!0;d=d.max-d.min+1;d>this.maxLength&&(this.maxLength=d)}for(e in b)f=this.featuresByChr[e],f.sort(function(a,b){var c=a.min-b.min;return 0!=c?c:a.max-b.max});this.chrRing=null};MemStore.prototype._indexFor=function(a,b){for(var c=0,d=a.length;d>c;){var e=(c+d)/2|0;if(e>=a.length)return a.length;b<a[e].min?d=e:c=e+1}return d};
MemStore.prototype.fetch=function(a,b,c){var d=this.featuresByChr[a];d||(d=0==a.indexOf("chr")?this.featuresByChr[a.substring(3)]:this.featuresByChr["chr"+a]);if(!d)return[];var e=Math.max(0,this._indexFor(d,b-this.maxLength-1));a=Math.min(d.length-1,this._indexFor(d,c));for(var f=[];e<=a;++e){var g=d[e];g.min<=c&&g.max>=b&&f.push(g)}return f};
MemStore.prototype.findNextFeature=function(a,b,c){if(null==this.chrRing){this.chrRing=[];for(a in this.featuresByChr)this.chrRing.push(a);this.chrRing.sort()}var d=this.featuresByChr[a];d||(a=0==a.indexOf("chr")?a.substring(3):"chr"+a,d=this.featuresByChr[a]);if(!d)return null;var e=Math.max(0,Math.min(this._indexFor(d,b),d.length-1));if(0<c){for(;e<d.length;){var f=d[e++];if(f.min>b)return f}a=this.chrRing.indexOf(a)+1;a>=this.chrRing.length&&(a=0);return this.findNextFeature(this.chrRing[a],0,
c)}for(;0<=e;)if(f=d[e--],f.max<b)return f;a=this.chrRing.indexOf(a)-1;0>a&&(a=this.chrRing.length-1);return this.findNextFeature(this.chrRing[a],1E10,c)};
function MemStoreFeatureSource(a){this.source=a;FeatureSourceBase.call(this);this.storeHolder=new Awaited;this.parser=dalliance_makeParser(a.payload);if(!this.parser)throw"Unsupported memstore payload: "+a.payload;var b=this;this._load(function(a,d){if(a){for(var e=new MemStore,f=[],g=a.split("\n"),h=b.parser.createSession(function(a){f.push(a)}),k=0;k<g.length;++k){var l=g[k];0<l.length&&h.parse(l)}h.flush();e.addFeatures(f);b.storeHolder.provide(e)}else b.error=d||"No data",b.storeHolder.provide(null)})}
MemStoreFeatureSource.prototype=Object.create(FeatureSourceBase.prototype);MemStoreFeatureSource.prototype._load=function(a){if(this.source.blob){var b=new FileReader;b.onloadend=function(){return a(b.result,b.error)};b.readAsText(this.source.blob)}else textXHR(this.source.uri,a,{})};MemStoreFeatureSource.prototype.fetch=function(a,b,c,d,e,f,g){var h=this;this.storeHolder.await(function(d){return d?(d=d.fetch(a,b,c),g(null,d,1E8)):g(h.error)})};
MemStoreFeatureSource.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};MemStoreFeatureSource.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};MemStoreFeatureSource.prototype.getScales=function(){return 1E8};MemStoreFeatureSource.prototype.findNextFeature=function(a,b,c,d){var e=this;this.storeHolder.await(function(f){return f?d(f.findNextFeature(a,b,c)):d(null,e.error)})};
MemStoreFeatureSource.prototype.capabilities=function(){return{leap:!0}};dalliance_registerSourceAdapterFactory("memstore",function(a){return{features:new MemStoreFeatureSource(a)}});"use strict";function VCFParser(){}VCFParser.prototype.createSession=function(a){return new VCFParseSession(this,a)};function VCFParseSession(a,b){this.parser=a;this.sink=b}
VCFParseSession.prototype.parse=function(a){var b=a.split("\t");a=new DASFeature;a.segment=b[0];a.id=b[2];a.refAllele=b[3];a.altAlleles=b[4].split(",");a.min=parseInt(b[1]);a.max=a.min+a.refAllele.length-1;var b=a.altAlleles[0],c=a.refAllele;b.length>c.length?(a.type="insertion",0==b.indexOf(c)?(a.insertion=b.substr(c.length),a.min+=c.length,a.max=a.min-1):a.insertion=b):a.type=b.length<c.length?"deletion":"substitution";this.sink(a)};VCFParseSession.prototype.flush=function(){};
VCFParser.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="__INSERTION";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"insertion"},null,c);c=new DASStyle;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(255, 60, 60)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,c);c=new DASStyle;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.BGCOLOR=
"#888888";c.STROKECOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};VCFParser.prototype.getDefaultFIPs=function(a){a(function(a,c){c.add("Ref. allele",a.refAllele);c.add("Alt. alleles",a.altAlleles.join(","))})};dalliance_registerParserFactory("vcf",function(){return new VCFParser});"use strict";function BedWigParser(a){this.type=a}BedWigParser.prototype.createSession=function(a){return"wig"==this.type?new WigParseSession(this,a):new BedParseSession(this,a)};
var __KV_REGEXP=/([^=]+)=(.+)/,__SPACE_REGEXP=/\s/;function BedParseSession(a,b){this.parser=a;this.sink=b}
BedParseSession.prototype.parse=function(a){var b=a.split(__SPACE_REGEXP);if(!(3>b.length)){var c=parseInt(b[1])+1;a=parseInt(b[2]);a={segment:b[0],min:c,max:a};3<b.length&&"."!==b[3]&&(a.label=b[3]);4<b.length&&(a.score=parseFloat(b[4]));5<b.length&&(a.orientation=b[5]);if(8<b.length){var d=b[8];BED_COLOR_REGEXP.test(d)&&(a.itemRgb="rgb("+d+")")}if(12<=b.length){var d=parseInt(b[6]),e=parseInt(b[7]),f=parseInt(b[9]),g=b[10].split(",").map(function(a){return parseInt(a)}),h=b[11].split(",").map(function(a){return parseInt(a)});
a.type="transcript";var k=new DASGroup;k.id=b[3];k.type="transcript";k.notes=[];a.groups=[k];if(12<b.length){var l=k=b[12];13<b.length&&(l=b[13]);b=new DASGroup;b.id=k;b.label=l;b.type="gene";a.groups.push(b)}b=null;for(k=0;k<f;++k)l=h[k]+c,l=new Range(l,l+g[k]),b=b?union(b,l):l;h=b.ranges();for(c=0;c<h.length;++c)f=h[c],g=shallowCopy(a),g.min=f.min(),g.max=f.max(),this.sink(g);if(e>d&&(d=intersection(b,new Range(d,e)))){a.type="translation";d=d.ranges();for(c=0;c<d.length;++c)f=d[c],g=shallowCopy(a),
g.min=f.min(),g.max=f.max(),this.sink(g)}}else this.sink(a)}};BedParseSession.prototype.flush=function(){};function WigParseSession(a,b){this.parser=a;this.sink=b;this.wigState=null}
WigParseSession.prototype.parse=function(a){a=a.split(__SPACE_REGEXP);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var c=__KV_REGEXP.exec(a[b]);c&&("chrom"==c[1]?this.chr=c[2]:"start"==c[1]?this.pos=parseInt(c[2]):"step"==c[1]?this.step=parseInt(c[2]):"span"==c[1]&&(this.span=parseInt(c[2])))}}else if("variableStep"==a[0]){this.wigState="variableStep";this.chr=null;for(b=this.span=1;b<a.length;++b)c=__KV_REGEXP.exec(a[b]),"chrom"==
c[1]?this.chr=c[2]:"span"==c[1]&&(this.span=parseInt(c[2]))}else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};
WigParseSession.prototype.flush=function(){};
BedWigParser.prototype.getStyleSheet=function(a){var b=new DASStylesheet;if("wig"==this.type){var c=new DASStyle;c.glyph="HISTOGRAM";c.BGCOLOR="blue";c.HEIGHT=30;b.pushStyle({type:"default"},null,c)}else c=new DASStyle,c.glyph="BOX",c.FGCOLOR="black",c.BGCOLOR="blue",c.HEIGHT=8,c.BUMP=!0,c.LABEL=!0,c.ZINDEX=20,b.pushStyle({type:"default"},null,c),c=new DASStyle,c.glyph="BOX",c.FGCOLOR="black",c.BGCOLOR="red",c.HEIGHT=10,c.BUMP=!0,c.ZINDEX=20,b.pushStyle({type:"translation"},null,c),c=new DASStyle,
c.glyph="BOX",c.FGCOLOR="black",c.BGCOLOR="white",c.HEIGHT=10,c.ZINDEX=10,c.BUMP=!0,c.LABEL=!0,b.pushStyle({type:"transcript"},null,c),c=new DASStyle,c.glyph="HISTOGRAM",c.COLOR1="white",c.COLOR2="black",c.HEIGHT=30,b.pushStyle({type:"density"},null,c);return a(b)};dalliance_registerParserFactory("bed",function(a){return new BedWigParser(a)});dalliance_registerParserFactory("wig",function(a){return new BedWigParser(a)});"use strict";
function probeResource(a,b,c){var d=/^.+\t[0-9]+\t[0-9]+.*$/,e=/([^=]+)=\"?([^\"]+)\"?/;(a.blob?new BlobFetchable(a.blob):new URLFetchable(a.uri)).slice(0,65536).salted().fetch(function(f,g){if(!f)return c||(a.credentials=!0,probeResource(a,b,!0)),b(a,"Couldn't fetch data");var h=new Uint8Array(f),k=readInt(h,0);if(k==BIG_WIG_MAGIC||k==BIG_BED_MAGIC){a.tier_type="bwg";h=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(h=h.exec(a.uri||a.blob.name))a.name=h[1];return b(a,null)}if(k==BAI_MAGIC)return a.tier_type=
"bai",b(a,null);if(31==h[0]||139==h[1]){h=unbgzf(f);h=new Uint8Array(h);k=readInt(h,0);if(k==BAM_MAGIC){a.tier_type="bam";h=/\/?([^/]+?)(.bam)?$/;if(h=h.exec(a.uri||a.blob.name))a.name=h[1];return b(a,null)}if(k==TABIX_MAGIC)return a.tier_type="tabix-index",b(a,null);if(1768301347==k){a.tier_type="tabix";a.payload="vcf";h=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(h=h.exec(a.uri||a.blob.name))a.name=h[1];return b(a,null)}console.log("magic = "+k.toString(16));return b(a,"Unsupported format")}for(var h=String.fromCharCode.apply(null,
h).split("\n"),l=0;l<h.length;++l)if(k=h[l].replace("\r",""),0!=k.length&&0!=k.indexOf("browser")){if(0==k.indexOf("track")){h="bed";k=k.split(/\s/);for(l=1;l<k.length;++l){var m=e.exec(k[l]);m&&("type"==m[1]&&"wiggle_0"==m[2]?h="wig":"name"==m[0]&&(a.name=m[2]))}finishProbeBedWig(a,h);return b(a,null)}if(0==k.indexOf("fixedStep")||0==k.indexOf("variableStep"))return finishProbeBedWig(a,"wig"),b(a,null);if(d.test(k))return finishProbeBedWig(a,null),b(a,null);break}return b(a,"Unsupported format")})}
function finishProbeBedWig(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}
Browser.prototype.openExportPanel=function(){var a=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var b=makeElement("div",null,{className:"export-form"}),c=makeElement("select");c.appendChild(makeElement("option","SVG",{value:"svg"}));c.appendChild(makeElement("option","Dalliance config",{value:"config"}));c.appendChild(makeElement("option","Dalliance sources",{value:"sources"}));c.appendChild(makeElement("option","Dalliance page",{value:"page"}));c.value="svg";b.appendChild(makeElement("p",
["Export as: ",c]));var d=makeElement("input",null,{type:"checkbox",checked:this.exportHighlights});d.addEventListener("change",function(b){a.exportHighlights=d.checked;a.storeStatus()},!1);var e=makeElement("input",null,{type:"checkbox",checked:this.exportRuler});e.addEventListener("change",function(b){a.exportRuler=e.checked;a.storeStatus()},!1);var f=makeElement("button","Export",{className:"btn btn-primary"});f.addEventListener("click",function(b){removeChildren(g);var f,h,n;"svg"===c.value?(f=
URL.createObjectURL(a.makeSVG({highlights:d.checked,ruler:e.checked?a.rulerLocation:"none"})),h="SVG",n="image/svg"):"config"===c.value?(n=JSON.stringify(a.exportFullConfig(),null,2),h=new Blob([n],{type:"text/plain"}),f=URL.createObjectURL(h),h="Configuration",n="text/plain"):"sources"===c.value?(n=JSON.stringify(a.exportSourceConfig(),null,2),h=new Blob([n],{type:"text/plain"}),f=URL.createObjectURL(h),h="Source array",n="text/plain"):"page"===c.value&&(h=a.exportPageTemplate(),n="text/html",h=
new Blob([h],{type:n}),f=URL.createObjectURL(h),h="Page template");f&&(b=makeElement("a","[Download]",{href:f,download:"dalliance-view.svg",type:n}),n=makeElement("a","[Preview in browser]",{href:f,type:n,target:"_new"}),g.appendChild(makeElement("p",[""+h+" created: ",b,n])))},!1);a.addViewListener(function(){removeChildren(g)});a.addTierListener(function(){removeChildren(g)});var g=makeElement("p",""),h=makeElement("table",[makeElement("tr",[makeElement("th","Include highlights",{},{width:"200px",
textAlign:"right"}),makeElement("td",d)]),makeElement("tr",[makeElement("th","Include vertical guideline"),makeElement("td",e)])]);b.appendChild(h);b.appendChild(f);b.appendChild(g);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(b,this.svgHolder);this.activeToolPanel=b;this.setUiMode("export")}};
Browser.prototype.exportFullConfig=function(a){a={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+hex_sha1(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig()};this.uiPrefix&&(a.uiPrefix=this.uiPrefix);return a};
Browser.prototype.exportSourceConfig=function(a){a=[];for(var b=0;b<this.tiers.length;++b){var c=this.tiers[b],d=shallowCopy(c.dasSource);d.coords=void 0;d.props=void 0;d.disabled||(d.disabled=void 0);c.config.stylesheet?(d.style=c.config.stylesheet.styles,d.stylesheet_uri=void 0):d.style&&(d.style=copyStylesheet({styles:d.style}).styles);"string"===typeof c.config.name&&(d.name=c.config.name);void 0!==c.config.height&&(d.forceHeight=c.config.height);void 0!==c.config.forceMin&&(d.forceMin=c.config.forceMin);
c.config.forceMinDynamic&&(d.forceMinDynamic=c.config.forceMinDynamic);void 0!==c.config.forceMax&&(d.forceMax=c.config.forceMax);c.config.forceMaxDynamic&&(d.forceMaxDynamic=c.config.forceMaxDynamic);a.push(d)}return a};
Browser.prototype.exportPageTemplate=function(a){a=a||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.uiPrefix+'dalliance-compiled.js">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(a),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'};
var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],
IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,
7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,
9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,
125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,
82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,
8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,
0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,
9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,
5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,
129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ZStream(){}ZStream.prototype.inflateInit=function(a,b){a||(a=DEF_WBITS);b&&(b=!1);this.istate=new Inflate;return this.istate.inflateInit(this,b?-a:a)};ZStream.prototype.inflate=function(a){return null==this.istate?Z_STREAM_ERROR:this.istate.inflate(this,a)};
ZStream.prototype.inflateEnd=function(){if(null==this.istate)return Z_STREAM_ERROR;var a=istate.inflateEnd(this);this.istate=null;return a};ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)};ZStream.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};function Inflate(){this.was=[0]}
Inflate.prototype.inflateReset=function(a){if(null==a||null==a.istate)return Z_STREAM_ERROR;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?BLOCKS:METHOD;a.istate.blocks.reset(a,null);return Z_OK};Inflate.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return Z_OK};
Inflate.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),Z_STREAM_ERROR;this.wbits=b;a.istate.blocks=new InfBlocks(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return Z_OK};
Inflate.prototype.inflate=function(a,b){var c,d;if(null==a||null==a.istate||null==a.next_in)return Z_STREAM_ERROR;b=b==Z_FINISH?Z_BUF_ERROR:Z_OK;for(c=Z_BUF_ERROR;;)switch(a.istate.mode){case METHOD:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.next_in[a.next_in_index++])&15)!=Z_DEFLATED){a.istate.mode=BAD;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=BAD;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=FLAG;case FLAG:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+d)%31){a.istate.mode=BAD;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(d&PRESET_DICT)){a.istate.mode=BLOCKS;break}a.istate.mode=DICT4;case DICT4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=DICT3;case DICT3:if(0==a.avail_in)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=DICT2;case DICT2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=DICT1;case DICT1:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=DICT0;return Z_NEED_DICT;case DICT0:return a.istate.mode=BAD,a.msg="need dictionary",a.istate.marker=0,Z_STREAM_ERROR;
case BLOCKS:c=a.istate.blocks.proc(a,c);if(c==Z_DATA_ERROR){a.istate.mode=BAD;a.istate.marker=0;break}c==Z_OK&&(c=b);if(c!=Z_STREAM_END)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=DONE;break}a.istate.mode=CHECK4;case CHECK4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=CHECK3;case CHECK3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=CHECK2;case CHECK2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=CHECK1;case CHECK1:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=BAD;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}};
Inflate.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(null==a||null==a.istate||a.istate.mode!=DICT0)return Z_STREAM_ERROR;if(a._adler.adler32(1,b,0,c)!=a.adler)return Z_DATA_ERROR;a.adler=a._adler.adler32(0,null,0,0);e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,d=c-e);a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=BLOCKS;return Z_OK};var mark=[0,0,255,255];
Inflate.prototype.inflateSync=function(a){var b,c,d;if(null==a||null==a.istate)return Z_STREAM_ERROR;a.istate.mode!=BAD&&(a.istate.mode=BAD,a.istate.marker=0);if(0==(b=a.avail_in))return Z_BUF_ERROR;c=a.next_in_index;for(d=a.istate.marker;0!=b&&4>d;)a.next_in[c]==mark[d]?d++:d=0!=a.next_in[c]?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(4!=d)return Z_DATA_ERROR;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=
BLOCKS;return Z_OK};Inflate.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?Z_STREAM_ERROR:a.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
function InfBlocks(a,b,c){this.hufts=new Int32Array(3*MANY);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=IB_TYPE;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new InfCodes;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new InfTree}
InfBlocks.prototype.reset=function(a,b){b&&(b[0]=this.check);this.mode==IB_CODES&&this.codes.free(a);this.mode=IB_TYPE;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};
InfBlocks.prototype.proc=function(a,b){var c,d,e,f,g,h,k;f=a.next_in_index;g=a.avail_in;d=this.bitb;e=this.bitk;h=this.write;for(k=h<this.read?this.read-h-1:this.end-h;;)switch(this.mode){case IB_TYPE:for(;3>e;){if(0!=g)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);g--;d|=(a.next_in[f++]&255)<<e;e+=8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;e-=3;c=e&7;d>>>=c;e-=c;this.mode=IB_LENS;break;case 1:var l=
new Int32Array(1),m=new Int32Array(1),n=[],p=[];inflate_trees_fixed(l,m,n,p,a);this.codes.init(l[0],m[0],n[0],0,p[0],0,a);d>>>=3;e-=3;this.mode=IB_CODES;break;case 2:d>>>=3;e-=3;this.mode=IB_TABLE;break;case 3:return d>>>=3,e-=3,this.mode=BAD,a.msg="invalid block type",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b)}break;case IB_LENS:for(;32>e;){if(0!=g)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=g,
a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);g--;d|=(a.next_in[f++]&255)<<e;e+=8}if((~d>>>16&65535)!=(d&65535))return this.mode=BAD,a.msg="invalid stored block lengths",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);this.left=d&65535;d=e=0;this.mode=0!=left?IB_STORED:0!=this.last?IB_DRY:IB_TYPE;break;case IB_STORED:if(0==g)return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=
f-a.next_in_index,a.next_in_index=f,write=h,this.inflate_flush(a,b);if(0==k&&(h==end&&0!=read&&(h=0,k=h<this.read?this.read-h-1:this.end-h),0==k&&(this.write=h,b=this.inflate_flush(a,b),h=this.write,k=h<this.read?this.read-h-1:this.end-h,h==this.end&&0!=this.read&&(h=0,k=h<this.read?this.read-h-1:this.end-h),0==k)))return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);b=Z_OK;c=this.left;c>g&&(c=g);c>k&&(c=k);arrayCopy(a.next_in,
f,window,h,c);f+=c;g-=c;h+=c;k-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;14>e;){if(0!=g)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);g--;d|=(a.next_in[f++]&255)<<e;e+=8}this.table=c=d&16383;if(29<(c&31)||29<(c>>5&31))return this.mode=IB_BAD,a.msg="too many length or distance symbols",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,
a.next_in_index=f,this.write=h,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);else for(k=0;k<c;k++)this.blens[k]=0;d>>>=14;e-=14;this.index=0;mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;3>e;){if(0!=g)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);g--;d|=(a.next_in[f++]&255)<<e;e+=8}this.blens[INFBLOCKS_BORDER[this.index++]]=
d&7;d>>>=3;e-=3}for(;19>this.index;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=Z_OK)return b=c,b==Z_DATA_ERROR&&(this.blens=null,this.mode=IB_BAD),this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,write=h,this.inflate_flush(a,b);this.index=0;this.mode=IB_DTREE;case IB_DTREE:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];e<c;){if(0!=g)b=
Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);g--;d|=(a.next_in[f++]&255)<<e;e+=8}c=this.hufts[3*(this.tb[0]+(d&inflate_mask[c]))+1];m=this.hufts[3*(this.tb[0]+(d&inflate_mask[c]))+2];if(16>m)d>>>=c,e-=c,this.blens[this.index++]=m;else{k=18==m?7:m-14;for(l=18==m?11:3;e<c+k;){if(0!=g)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,
b);g--;d|=(a.next_in[f++]&255)<<e;e+=8}d>>>=c;e-=c;l+=d&inflate_mask[k];d>>>=k;e-=k;k=this.index;c=this.table;if(k+l>258+(c&31)+(c>>5&31)||16==m&&1>k)return this.blens=null,this.mode=IB_BAD,a.msg="invalid bit length repeat",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);m=16==m?this.blens[k-1]:0;do this.blens[k++]=m;while(0!=--l);this.index=k}}this.tb[0]=-1;l=new Int32Array(1);m=new Int32Array(1);n=new Int32Array(1);
p=new Int32Array(1);l[0]=9;m[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,l,m,n,p,this.hufts,a);if(c!=Z_OK)return c==Z_DATA_ERROR&&(this.blens=null,this.mode=BAD),b=c,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);this.codes.init(l[0],m[0],this.hufts,n[0],this.hufts,p[0],a);this.mode=IB_CODES;case IB_CODES:this.bitb=d;this.bitk=e;a.avail_in=g;a.total_in+=f-a.next_in_index;a.next_in_index=
f;this.write=h;if((b=this.codes.proc(this,a,b))!=Z_STREAM_END)return this.inflate_flush(a,b);b=Z_OK;this.codes.free(a);f=a.next_in_index;g=a.avail_in;d=this.bitb;e=this.bitk;h=this.write;k=h<this.read?this.read-h-1:this.end-h;if(0==this.last){this.mode=IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:this.write=h;b=this.inflate_flush(a,b);h=this.write;if(this.read!=this.write)return this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);
mode=DONE;case IB_DONE:return b=Z_STREAM_END,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);case IB_BAD:return b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b);default:return b=Z_STREAM_ERROR,this.bitb=d,this.bitk=e,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,this.write=h,this.inflate_flush(a,b)}};
InfBlocks.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};InfBlocks.prototype.set_dictionary=function(a,b,c){arrayCopy(a,b,window,0,c);this.read=this.write=c};InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS};
InfBlocks.prototype.inflate_flush=function(a,b){var c,d,e;d=a.next_out_index;e=this.read;c=(e<=this.write?this.write:this.end)-e;c>a.avail_out&&(c=a.avail_out);0!=c&&b==Z_BUF_ERROR&&(b=Z_OK);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,e,c));arrayCopy(this.window,e,a.next_out,d,c);d+=c;e+=c;e==this.end&&(e=0,this.write==this.end&&(this.write=0),c=this.write-e,c>a.avail_out&&(c=a.avail_out),0!=c&&b==Z_BUF_ERROR&&(b=Z_OK),a.avail_out-=
c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,e,c)),arrayCopy(this.window,e,a.next_out,d,c),d+=c,e+=c);a.next_out_index=d;this.read=e;return b};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;function InfCodes(){}InfCodes.prototype.init=function(a,b,c,d,e,f,g){this.mode=IC_START;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=f;this.tree=null};
InfCodes.prototype.proc=function(a,b,c){var d,e,f=0,g=0,h=0,k,l,m,h=b.next_in_index;k=b.avail_in;f=a.bitb;g=a.bitk;l=a.write;for(m=l<a.read?a.read-l-1:a.end-l;;)switch(this.mode){case IC_START:if(258<=m&&10<=k&&(a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),h=b.next_in_index,k=b.avail_in,f=a.bitb,g=a.bitk,l=a.write,m=l<a.read?a.read-l-1:a.end-l,c!=Z_OK)){this.mode=
c==Z_STREAM_END?IC_WASH:IC_BADCODE;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=IC_LEN;case IC_LEN:for(d=this.need;g<d;){if(0!=k)c=Z_OK;else return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);k--;f|=(b.next_in[h++]&255)<<g;g+=8}d=3*(this.tree_index+(f&inflate_mask[d]));f>>>=this.tree[d+1];g-=this.tree[d+1];e=this.tree[d];if(0==e){this.lit=this.tree[d+2];this.mode=IC_LIT;break}if(0!=(e&16)){this.get=
e&15;this.len=this.tree[d+2];this.mode=IC_LENEXT;break}if(0==(e&64)){this.need=e;this.tree_index=d/3+this.tree[d+2];break}if(0!=(e&32)){this.mode=IC_WASH;break}this.mode=IC_BADCODE;b.msg="invalid literal/length code";c=Z_DATA_ERROR;a.bitb=f;a.bitk=g;b.avail_in=k;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c);case IC_LENEXT:for(d=this.get;g<d;){if(0!=k)c=Z_OK;else return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,
a.inflate_flush(b,c);k--;f|=(b.next_in[h++]&255)<<g;g+=8}this.len+=f&inflate_mask[d];f>>=d;g-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=IC_DIST;case IC_DIST:for(d=this.need;g<d;){if(0!=k)c=Z_OK;else return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);k--;f|=(b.next_in[h++]&255)<<g;g+=8}d=3*(this.tree_index+(f&inflate_mask[d]));f>>=this.tree[d+1];g-=this.tree[d+1];e=this.tree[d];if(0!=(e&16)){this.get=
e&15;this.dist=this.tree[d+2];this.mode=IC_DISTEXT;break}if(0==(e&64)){this.need=e;this.tree_index=d/3+this.tree[d+2];break}this.mode=IC_BADCODE;b.msg="invalid distance code";c=Z_DATA_ERROR;a.bitb=f;a.bitk=g;b.avail_in=k;b.total_in+=h-b.next_in_index;b.next_in_index=h;a.write=l;return a.inflate_flush(b,c);case IC_DISTEXT:for(d=this.get;g<d;){if(0!=k)c=Z_OK;else return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);k--;f|=(b.next_in[h++]&
255)<<g;g+=8}this.dist+=f&inflate_mask[d];f>>=d;g-=d;this.mode=IC_COPY;case IC_COPY:for(d=l-this.dist;0>d;)d+=a.end;for(;0!=this.len;){if(0==m&&(l==a.end&&0!=a.read&&(l=0,m=l<a.read?a.read-l-1:a.end-l),0==m&&(a.write=l,c=a.inflate_flush(b,c),l=a.write,m=l<a.read?a.read-l-1:a.end-l,l==a.end&&0!=a.read&&(l=0,m=l<a.read?a.read-l-1:a.end-l),0==m)))return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);a.window[l++]=a.window[d++];m--;d==a.end&&
(d=0);this.len--}this.mode=IC_START;break;case IC_LIT:if(0==m&&(l==a.end&&0!=a.read&&(l=0,m=l<a.read?a.read-l-1:a.end-l),0==m&&(a.write=l,c=a.inflate_flush(b,c),l=a.write,m=l<a.read?a.read-l-1:a.end-l,l==a.end&&0!=a.read&&(l=0,m=l<a.read?a.read-l-1:a.end-l),0==m)))return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);c=Z_OK;a.window[l++]=this.lit;m--;this.mode=IC_START;break;case IC_WASH:7<g&&(g-=8,k++,h--);a.write=l;c=a.inflate_flush(b,
c);l=a.write;if(a.read!=a.write)return a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);this.mode=IC_END;case IC_END:return c=Z_STREAM_END,a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);case IC_BADCODE:return c=Z_DATA_ERROR,a.bitb=f,a.bitk=g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c);default:return c=Z_STREAM_ERROR,a.bitb=f,a.bitk=
g,b.avail_in=k,b.total_in+=h-b.next_in_index,b.next_in_index=h,a.write=l,a.inflate_flush(b,c)}};InfCodes.prototype.free=function(a){};
InfCodes.prototype.inflate_fast=function(a,b,c,d,e,f,g,h){var k,l,m,n,p,r,q,s,v,t,u,w;r=h.next_in_index;q=h.avail_in;n=g.bitb;p=g.bitk;s=g.write;v=s<g.read?g.read-s-1:g.end-s;a=inflate_mask[a];t=inflate_mask[b];do{for(;20>p;)q--,n|=(h.next_in[r++]&255)<<p,p+=8;k=n&a;l=c;m=d;w=3*(m+k);if(0==(b=l[w]))n>>=l[w+1],p-=l[w+1],g.window[s++]=l[w+2],v--;else{do{n>>=l[w+1];p-=l[w+1];if(0!=(b&16)){b&=15;u=l[w+2]+(n&inflate_mask[b]);n>>=b;for(p-=b;15>p;)q--,n|=(h.next_in[r++]&255)<<p,p+=8;k=n&t;l=e;m=f;w=3*(m+
k);b=l[w];do if(n>>=l[w+1],p-=l[w+1],0!=(b&16)){for(b&=15;p<b;)q--,n|=(h.next_in[r++]&255)<<p,p+=8;k=l[w+2]+(n&inflate_mask[b]);n>>=b;p-=b;v-=u;if(s>=k)k=s-k,g.window[s++]=g.window[k++],g.window[s++]=g.window[k++],u-=2;else{k=s-k;do k+=g.end;while(0>k);b=g.end-k;if(u>b){u-=b;if(0<s-k&&b>s-k){do g.window[s++]=g.window[k++];while(0!=--b)}else arrayCopy(g.window,k,g.window,s,b),s+=b;k=0}}do g.window[s++]=g.window[k++];while(0!=--u);break}else if(0==(b&64))k+=l[w+2],k+=n&inflate_mask[b],w=3*(m+k),b=l[w];
else return h.msg="invalid distance code",u=h.avail_in-q,u=p>>3<u?p>>3:u,q+=u,r-=u,p-=u<<3,g.bitb=n,g.bitk=p,h.avail_in=q,h.total_in+=r-h.next_in_index,h.next_in_index=r,g.write=s,Z_DATA_ERROR;while(1);break}if(0==(b&64)){if(k+=l[w+2],k+=n&inflate_mask[b],w=3*(m+k),0==(b=l[w])){n>>=l[w+1];p-=l[w+1];g.window[s++]=l[w+2];v--;break}}else{if(0!=(b&32))return u=h.avail_in-q,u=p>>3<u?p>>3:u,q+=u,r-=u,p-=u<<3,g.bitb=n,g.bitk=p,h.avail_in=q,h.total_in+=r-h.next_in_index,h.next_in_index=r,g.write=s,Z_STREAM_END;
h.msg="invalid literal/length code";u=h.avail_in-q;u=p>>3<u?p>>3:u;q+=u;r-=u;p-=u<<3;g.bitb=n;g.bitk=p;h.avail_in=q;h.total_in+=r-h.next_in_index;h.next_in_index=r;g.write=s;return Z_DATA_ERROR}}while(1)}}while(258<=v&&10<=q);u=h.avail_in-q;u=p>>3<u?p>>3:u;r-=u;g.bitb=n;g.bitk=p-(u<<3);h.avail_in=q+u;h.total_in+=r-h.next_in_index;h.next_in_index=r;g.write=s;return Z_OK};function InfTree(){}
InfTree.prototype.huft_build=function(a,b,c,d,e,f,g,h,k,l,m){var n,p,r,q,s,v,t,u,w;v=0;p=c;do this.c[a[b+v]]++,v++,p--;while(0!=p);if(this.c[0]==c)return g[0]=-1,h[0]=0,Z_OK;s=h[0];for(r=1;r<=BMAX&&0==this.c[r];r++);q=r;s<r&&(s=r);for(p=BMAX;0!=p&&0==this.c[p];p--);l=p;s>p&&(s=p);h[0]=s;for(h=1<<r;r<p;r++,h<<=1)if(0>(h-=this.c[r]))return Z_DATA_ERROR;if(0>(h-=this.c[p]))return Z_DATA_ERROR;this.c[p]+=h;this.x[1]=r=0;v=1;for(t=2;0!=--p;)this.x[t]=r+=this.c[v],t++,v++;v=p=0;do{if(0!=(r=a[b+v]))this.v[this.x[r]++]=
p;v++}while(++p<c);c=this.x[l];v=this.x[0]=p=0;b=-1;u=-s;for(w=t=this.u[0]=0;q<=l;q++)for(a=this.c[q];0!=a--;){for(;q>u+s;){b++;u+=s;w=l-u;w=w>s?s:w;if((n=1<<(r=q-u))>a+1)if(n-=a+1,t=q,r<w)for(;++r<w&&!((n<<=1)<=this.c[++t]);)n-=this.c[t];w=1<<r;if(this.hn[0]+w>MANY)return Z_DATA_ERROR;this.u[b]=t=this.hn[0];this.hn[0]+=w;0!=b?(this.x[b]=p,this.r[0]=r,this.r[1]=s,r=p>>>u-s,this.r[2]=t-this.u[b-1]-r,arrayCopy(this.r,0,k,3*(this.u[b-1]+r),3)):g[0]=t}this.r[1]=q-u;v>=c?this.r[0]=192:m[v]<d?(this.r[0]=
256>this.v[v]?0:96,this.r[2]=this.v[v++]):(this.r[0]=f[this.v[v]-d]+16+64,this.r[2]=e[this.v[v++]-d]);n=1<<q-u;for(r=p>>>u;r<w;r+=n)arrayCopy(this.r,0,k,3*(t+r),3);for(r=1<<q-1;0!=(p&r);r>>>=1)p^=r;p^=r;for(r=(1<<u)-1;(p&r)!=this.x[b];)b--,u-=s,r=(1<<u)-1}return 0!=h&&1!=l?Z_BUF_ERROR:Z_OK};
InfTree.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(a==Z_DATA_ERROR)e.msg="oversubscribed dynamic bit lengths tree";else if(a==Z_BUF_ERROR||0==b[0])e.msg="incomplete dynamic bit lengths tree",a=Z_DATA_ERROR;return a};
InfTree.prototype.inflate_trees_dynamic=function(a,b,c,d,e,f,g,h,k){this.initWorkArea(288);this.hn[0]=0;f=this.huft_build(c,0,a,257,cplens,cplext,f,d,h,this.hn,this.v);if(f!=Z_OK||0==d[0])return f==Z_DATA_ERROR?k.msg="oversubscribed literal/length tree":f!=Z_MEM_ERROR&&(k.msg="incomplete literal/length tree",f=Z_DATA_ERROR),f;this.initWorkArea(288);f=this.huft_build(c,a,b,0,cpdist,cpdext,g,e,h,this.hn,this.v);return f!=Z_OK||0==e[0]&&257<a?(f==Z_DATA_ERROR?k.msg="oversubscribed distance tree":f==
Z_BUF_ERROR?(k.msg="incomplete distance tree",f=Z_DATA_ERROR):f!=Z_MEM_ERROR&&(k.msg="empty distance tree with lengths",f=Z_DATA_ERROR),f):Z_OK};function inflate_trees_fixed(a,b,c,d,e){a[0]=fixed_bl;b[0]=fixed_bd;c[0]=fixed_tl;d[0]=fixed_td;return Z_OK}
InfTree.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(BMAX+1),this.r=new Int32Array(3),this.u=new Int32Array(BMAX),this.x=new Int32Array(BMAX+1));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;b<BMAX+1;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;arrayCopy(this.c,0,this.u,0,BMAX);arrayCopy(this.c,0,this.x,0,BMAX+1)};
var testArray=new Uint8Array(1),hasSubarray="function"===typeof testArray.subarray,hasSlice=!1;function arrayCopy(a,b,c,d,e){if(0!=e){if(a){if(!c)throw"Undef dest";}else throw"Undef src";0==b&&e==a.length?arrayCopy_fast(a,c,d):hasSubarray?arrayCopy_fast(a.subarray(b,b+e),c,d):1==a.BYTES_PER_ELEMENT&&100<e?arrayCopy_fast(new Uint8Array(a.buffer,a.byteOffset+b,e),c,d):arrayCopy_slow(a,b,c,d,e)}}function arrayCopy_slow(a,b,c,d,e){for(var f=0;f<e;++f)c[d+f]=a[b+f]}
function arrayCopy_fast(a,b,c){b.set(a,c)}var ADLER_BASE=65521,ADLER_NMAX=5552;
function adler32(a,b,c,d){if(null==b)return 1;var e=a&65535;a=a>>16&65535;for(var f;0<d;){f=d<ADLER_NMAX?d:ADLER_NMAX;for(d-=f;16<=f;)e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,f-=16;if(0!=f){do e+=b[c++]&255,a+=e;while(0!=--f)}e%=ADLER_BASE;
a%=ADLER_BASE}return a<<16|e}
function jszlib_inflate_buffer(a,b,c,d){a=b?new Uint8Array(a,b,c):new Uint8Array(a);c=new ZStream;c.inflateInit(DEF_WBITS,!0);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;a=[];for(var e=0;;){var f=new Uint8Array(32E3);c.next_out=f;c.next_out_index=0;c.avail_out=f.length;var g=c.inflate(Z_NO_FLUSH);if(g!=Z_OK&&g!=Z_STREAM_END)throw c.msg;if(0!=c.avail_out){var h=new Uint8Array(f.length-c.avail_out);arrayCopy(f,0,h,0,f.length-c.avail_out);f=h}a.push(f);e+=f.length;if(g==Z_STREAM_END)break}d&&(d[0]=
(b||0)+c.next_in_index);if(1==a.length)return a[0].buffer;b=new Uint8Array(e);for(c=d=0;c<a.length;++c)e=a[c],arrayCopy(e,0,b,d,e.length),d+=e.length;return b.buffer}
(function(){function a(){p.call(document.querySelectorAll("input[type=range]"),c);(new MutationObserver(function(a){a.forEach(function(a){a.addedNodes&&p.call(a.addedNodes,function(a){b(a);a.childElementCount&&p.call(a.querySelectorAll("input"),b)})})})).observe(document,{childList:!0,subtree:!0})}function b(a){"input"==a.localName&&("range"!=a.type&&"range"==a.getAttribute("type"))&&c(a)}function c(a){function b(a){var c=(parseFloat(getComputedStyle(this,0).width)-k.width)/J;c&&(H+=(a.clientX-I)/
c,I=a.clientX,A=!0,this.value=H)}function c(){this.removeEventListener("mousemove",b,!0);this.removeEventListener("mouseup",c,!0)}function e(){C||(this.style.boxShadow=!h?"0 0 0 2px #fb0":"inset 0 0 20px rgba(0,127,255,.1), 0 0 1px rgba(0,127,255,.4)")}function f(a){return!isNaN(a)&&+a==parseFloat(a)}function p(){G=f(a.min)?+a.min:0;M=f(a.max)?+a.max:100;M<G&&(M=100<G?G:100);L=f(a.step)&&0<a.step?+a.step:1;J=M-G;x(!0)}function x(b){!B&&!y&&(F=a.getAttribute("value"));f(F)||(F=(G+M)/2);F=Math.round((F-
G)/L)*L+G;F<G?F=G:F>M&&(F=G+~~(J/L)*L);A&&F!=E&&a.dispatchEvent(r);A=!1;if(b||F!=E)E=F,d(a,{background:"-moz-element(#__sliderthumb__) "+(J?100*((F-G)/J):0)+"% no-repeat, "+l})}var B,y,A,C,E,H,I,G,M,L,J,F=a.value;g||(g=document.body.appendChild(document.createElement("hr")),d(g,{"-moz-appearance":h?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"}),document.mozSetImageElement("__sliderthumb__",g));var R=function(){return""+
F};a.__defineGetter__("value",R);a.__defineSetter__("value",function K(b){F=""+b;B=!0;x();delete a.value;a.value=F;a.__defineGetter__("value",R);a.__defineSetter__("value",K)});a.__defineGetter__("type",function(){return"range"});["min","max","step"].forEach(function(b){a.hasAttribute(b)&&(y=!0);a.__defineGetter__(b,function(){return this.hasAttribute(b)?this.getAttribute(b):""});a.__defineSetter__(b,function(a){null===a?this.removeAttribute(b):this.setAttribute(b,a)})});a.readOnly=!0;d(a,m);p();
(new MutationObserver(function(b){b.forEach(function(b){"value"!=b.attributeName?(p(),y=!0):B||(F=a.getAttribute("value"),x())})})).observe(a,n);a.addEventListener("mousedown",function(a){C=!0;setTimeout(function(){C=!1},0);if(!a.button&&J){var d=(parseFloat(getComputedStyle(this,0).width)-k.width)/J;if(d){var e=a.clientX-this.getBoundingClientRect().left-k.width/2-(F-G)*d;Math.abs(e)>k.radius&&(A=!0,this.value-=-e/d);H=F;I=a.clientX;this.addEventListener("mousemove",b,!0);this.addEventListener("mouseup",
c,!0)}}},!0);a.addEventListener("keydown",function(a){36<a.keyCode&&41>a.keyCode&&(e.call(this),A=!0,this.value=F+(38==a.keyCode||39==a.keyCode?L:-L))},!0);a.addEventListener("focus",e,!0);a.addEventListener("blur",function(){this.style.boxShadow=""},!0)}function d(a,b){for(var c in b)a.style.setProperty(c,b[c],"important")}var e=document.createElement("input");try{if(e.type="range","range"==e.type)return}catch(f){return}e.style.background="linear-gradient(red, red)";if(e.style.backgroundImage&&"MozAppearance"in
e.style&&document.mozSetImageElement&&this.MutationObserver){var g,h="MacIntel"==navigator.platform,k={radius:h?9:6,width:h?22:12,height:h?16:20},l="linear-gradient(transparent "+(h?"6px, #999 6px, #999 7px, #ccc 8px, #bbb 9px, #bbb 10px, transparent 10px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)",m={"min-width":k.width+"px","min-height":k.height+"px","max-height":k.height+"px",padding:"0 0 "+(h?"2px":"1px"),border:0,"border-radius":0,cursor:"default","text-indent":"-999999px"},
n={attributes:!0,attributeFilter:["min","max","step","value"]},p=Array.prototype.forEach,r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1);"loading"==document.readyState?document.addEventListener("DOMContentLoaded",a,!0):a()}})();
